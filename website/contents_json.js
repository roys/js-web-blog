window.SpaBlog=window.SpaBlog||{};(function(SpaBlog){
SpaBlog.pages=[
    {
        "title": "About Roy",
        "summary": null,
        "niceUrl": "/about",
        "text": "I'm Roy Solberg, a Norwegian system developer working as Android Tech Lead for <a href=\"http://fotmob.com\">FotMob</a> - one of the world's biggest football ⚽ apps.\n\nBefore I started working with FotMob I worked 10 years as an IT consultant. I'm a full stack developer, but have an extra passion when it comes to mobile apps, smart homes, virtual assistants and other new tech.\n\nI mainly started this blog as <a href=\"/2017/08/security-vulnerability-disclosures\">I grew tired of seeing all these security vulnerabilities</a> in web and mobile apps. \n\n<h5>Speaking</h5>I always give a few talks every year - lately especially on IT security and related to findings I have presented on my blog. Other topics include smart homes and mobile app development. If you're interested in me giving a talk just <a href=\"https://spamty.eu/mail/v4/796/sx477Orkbc77ae0788/\" onclick=\"window.open('https://spamty.eu/mail/v4/796/sx477Orkbc77ae0788/', '', 'toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=0,width=750,height=720'); return false;\" title=\"Click to reveal my e-mail address\">send me an e-mail</a> or give me a word on <a href=\"https://twitter.com/roysolberg\">Twitter</a> or <a href=\"https://linkedin.com/in/roysolberg\">LinkedIn</a>. 🙂\n\nI give both talks that are on a higher level (not technical) and on as a low level as desired. I also do workshops.\n\n<h5>Find me</h5><a class=\"deep-purple-text text-lighten-2 no-ext\" href=\"https://twitter.com/roysolberg\" title=\"Twitter\"><i class=\"icon-twitter\"></i></a> <a class=\"deep-purple-text text-lighten-2 no-ext\" href=\"https://stackoverflow.com/users/467650/roy-solberg\" title=\"Stack Overflow\"><i class=\"icon-stackoverflow\"></i></a> <a class=\"deep-purple-text text-lighten-2 no-ext\" href=\"https://github.com/roys\" title=\"GitHub\"><i class=\"icon-github-circled\"></i></a> <a class=\"deep-purple-text text-lighten-2 no-ext\" href=\"https://linkedin.com/in/roysolberg\" title=\"LinkedIn\"><i class=\"icon-linkedin\"></i></a> <a class=\"deep-purple-text text-lighten-2 no-ext\" href=\"https://spamty.eu/mail/v4/796/sx477Orkbc77ae0788/\" onclick=\"window.open('https://spamty.eu/mail/v4/796/sx477Orkbc77ae0788/', '', 'toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=0,width=750,height=720'); return false;\" title=\"Click to reveal my e-mail address\"><i class=\"icon-mail-alt\"></i></a>\n\n<h5>Stay up to date</h5>The best way to stay up to date is to either <a href=\"https://twitter.com/roysolberg\">follow me on Twitter</a>, <a href=\"/atom\">subscribe to my Atom (RSS) feed</a> or sign up for my mailing list in the form below:"
    },
    {
        "title": "Screen capture service",
        "summary": null,
        "niceUrl": "/screen-capture-service",
        "text": "Do you want to submit <a href=\"https://developers.facebook.com/docs/games/instant-games/guides/lightweight/\">lightweight Facebook Instant Games</a>, but don't have a device to record a screen capture? Well, I can help you out.\n\nI offer up to 3 screencasts of gameplay of your game on a Samsung J1 Ace (SM-J110H) for a 100 USD. If you need more recordings to get your game approved I can give you up to 3 more screencasts for 50 USD.\n\nIf you are interested <a href=\"https://spamty.eu/mail/v4/796/sx477Orkbc77ae0788/\" onclick=\"window.open('https://spamty.eu/mail/v4/796/sx477Orkbc77ae0788/', '', 'toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=0,width=750,height=720'); return false;\" title=\"Click to reveal my e-mail address\">send me an e-mail</a> or give me a word on <a href=\"https://twitter.com/roysolberg\">Twitter</a>. :)\n\nThese are the reference devices listed by Facebook:\n - Samsung Grand Neo Plus (GT-I9060I)\n - <em>Samsung J1 Ace (SM-J110H)</em>\n - Samsung Galaxy S3 Neo (I9301I)\n - Motorola Moto G (XT1033)\n - Motorola Droid RazrM (XT907)\n - Asus ZenFone C (Z007)\n - Huawei Honor Holly (Hol-U19)\n - HTC Desire\n - Sony Xperia E4 (E2115)\n"
    }
],
SpaBlog.posts=[
    {
        "title": "Building a real SPA blog",
        "published": true,
        "publishDate": "2017-08-08T06:00:00.000Z",
        "summary": "This blog is a real single-page application with no server code or database. It's refreshingly easy to work with.",
        "niceUrl": "/2017/08/building-a-real-spa-blog",
        "text": "<h4>tl;dr</h4>This blog is created with <i>Knockout</i> and <i>Materialize</i>, and have all blog posts in a single <i>JavaScript array</i>. All static.\n                \n<h4>Medium</h4>I wanted a blog. A plain and simple blog. More often than not I read blog posts hosted by <a href=\"https://medium.com/\">medium.com</a>. It seems like they are really dominating these days (at least for tech blogs). And I understand why; the layout is so simple yet attractive and easy to read.\n                \nI expected to settle with a medium.com blog. However, it isn't possible to have ads in the blog posts. And I wanted that.\n\n<h4>Wordpress</h4>Wordpress has ruled the world for quite a long time. <a href=\"https://wordpress.com\">wordpress.com</a> of course costs money if you want to make any money using ads. I don't expect many dollars in income, so I'd like to avoid any fixed costs. Then there is <a href=\"https://wordpress.org\">wordpress.org</a>, but I don't really want to host it myself and stay up to date with <a href=\"https://www.cvedetails.com/product/4096/Wordpress-Wordpress.html\">security issues</a> and all.\n\n<h4>Blogger</h4>I looked at Google's <a href=\"https://blogger.com\">blogger.com</a>. Customizing the layout and templates I thought I was getting there. They have some really nice features. But I couldn't make it look and feel exactly right. And it felt cumbersome to do all the adjustments to get where I wanted.\n\n<h4>Good old days</h4>I knew I didn't want to reinvent the wheel. If this had been somewhere from 2000 to 2007 I probably would have mashed something together using PHP and MySQL. But the thought of doing that in 2017 repelled me. I didn't want any database setup, SQL or stuff that takes time from creating the actual product.\n\n<h4>Cloud hosting</h4>Further on I didn't want some hosting at one of the big companies offering \"free\" (they tend to end up costing a few bucks) backend hosting with all the hassle of setting up a new environment and installing some SDKs that needs to be constantly updated or suddenly removes support for some version of whatever you use.\n\n<h4>Requirements</h4>Basically I had the following requirements.\n<ul><li> - High readability and ok design</li><li> - Ad support</li><li> - Simple hosting</li><li> - Easy, but advanced customization</li><li> - Quick to set up with no hassle (no database setup, easy development, no unecessary heavy build systems)</li><li> - SEO friendly</li></ul>\n<h4>Solution</h4>I was wondering about using just static HTML files. That would indeed answer most of my requirements. But then I thought about having a simple JavaScript SPA.\n\n<h5>JavaScript framework</h5>I suppose <a href=\"https://angular.io/\">Angular 2</a> or <a href=\"https://facebook.github.io/react/\">React</a> would be among the most logical choices of JavaScript frameworks in 2017. But I wanted productivity and not use a lot of time to learn yet another framework when all I want is a quick and simple blog, so I went for good old <a href=\"http://knockoutjs.com/\">Knockout</a> which I have used quite a lot as earlier on as an IT consultant.\n\n<img class=\"materialboxed responsive-img\" title=\"Knockout js dead? Not the Google auto completion you want.\" data-caption=\"Knockout js dead? Not the Google auto completion you want.\" alt=\"Is Knockout JS dead?\" src=\"/images/knockout-js_dead.png\">\n\nWhile one might argue that Knockout is beyond its prime time, it sure works great and it is mature. And no matter which newer JavaScript framework I would go for it would soon be considered \"old\". If you haven't read the article <a href=\"https://hackernoon.com/how-it-feels-to-learn-javascript-in-2016-d3a717dd577f\">How it feels to learn JavaScript in 2016</a> by Jose Aguinaga, you really should. It's painful to read, but so true.\n\n<h5>Design</h5>I'm no designer. So I like to use UI frameworks that ensures that I can't get it completely wrong. I really like Google's <a href=\"https://material.io/guidelines/\">Material Design</a> and is used to using it on Android. I quickly found <a href=\"http://materializecss.com\">Materialize</a> and haven't looked back. It has great features and is a joy to use. I just wish it didn't depend on jQuery.\n\n<h4>GitHub project</h4>If you're interested you can have a look at the source code for this blog at <a href=\"https://github.com/roys/js-web-blog\">https://github.com/roys/js-web-blog</a>. The project itself is licenced under the MIT License, but for the contents (posts and images) I reserve all rights.\n",
        "images": [
            "/images/knockout-js_dead.png"
        ],
        "category": {
            "title": "Software development",
            "url": "/software-development"
        },
        "tags": [
            {
                "title": "JavaScript",
                "url": "/javascript"
            },
            {
                "title": "SPA",
                "url": "/spa"
            }
        ],
        "commentsIdentifier": "http://blog.roysolberg.com/2017/08/get-your-ssn-here"
    },
    {
        "title": "Security vulnerability disclosures",
        "published": true,
        "publishDate": "2017-08-09T21:00:00.000Z",
        "summary": "I'm preparing a series of posts where I'm disclosing several security vulnerabilities that I discovered the spring and summer of 2017.",
        "niceUrl": "/2017/08/security-vulnerability-disclosures",
        "text": "<h4>tl;dr</h4>Over the years I've discovered so many security holes and information leaks on the Internet. Earlier I've only notified the involved parties, but I think it's time to go public doing \"responsible disclosure\".\n                \n<h4>The purpose</h4>Working with preparing these posts I've asked myself repeatedly if I should go public with my findings or not.\n\nI'm still not entirely sure what the right answer is. What I do know is that <b>I want increased focus on web security</b> and that I feel a <a href=\"https://en.wikipedia.org/wiki/Social_responsibility\">social responsibility</a> to do so.\n\nThe purpose of posting these vulnerabilities is fivefold:\n - Make people aware that close to all their personal information is already in the hands of anyone who wants it.\n - I want computer security to be a (bigger) part of the IT education and training.\n - I want computer security to be a natural part of any developer's mindset.\n - I want businesses to know that there might be consequences of being sloppy with people's data.\n - Make your and my own data more safe.\n\n<b>Hopefully the issues presented on this site can be a small part of getting some kind of discussion on how to deal with computer security and personal data.</b>\n\n<h4>What I have done</h4>While looking for security vulnerabilities I have followed a few simple rules.\n\n<h5>What I have done:</h5> - Only looked at webapps (frontends and APIs) and mobile apps\n - Only looked at Norwegian services (though some are internationally available)\n - Immediately reported any security concerns and given reasonably time to fix any problems\n - Only spent minutes until I found some security hole or information leak\n\n<h5>What I have not done:</h5> - Not hid my identity:\n   - I have worked from my home IP\n   - When logged in I have used my own personal account\n   - I have not tried to fly under the radar in regards of staying out of logs etc.\n - Not looked for or used security holes in operating systems, app servers, networking equipment, etc.\n - Not interfered with the operation of the web apps or companies\n - Not altered or deleted any data\n - Not stored any personal data or even tried accessing anything beyond proving the weakness\n\n<h4>Information sensitivity</h4>The levels of the sensitivity in the information leaks I found vary. They go all the way from <i>\"Nah, I don't really care\"</i> to <i>\"0hly shit, this is not cool\"</i>. But I think they all represent some unique points in respect of vulnerabilities and in respect of type of personal information.\n\n<h4>Responsible disclosure</h4>I'm all for <a href=\"https://en.wikipedia.org/wiki/Responsible_disclosure\">responsible disclosure</a> and have immediately reported my findings. Generally I'm not publishing any details the problem has been confirmed fixed. However, sadly, in some cases there's just no interest or response from the other party.\n\nIf you want more thoughts about responsible disclosure I would recommend reading <a href=\"https://www.troyhunt.com/kids-pass-just-reminded-us-how-hard-responsible-disclosure-is/\">Troy Hunt's site</a> (and maybe especially the video in that link).\n",
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Background article",
                "url": "/background"
            }
        ]
    },
    {
        "title": "Case #1: Get your Social Security numbers here!",
        "published": true,
        "hot": false,
        "publishDate": "2017-08-14T05:30:00.000Z",
        "updateDate": "2017-08-17T16:50:00.000Z",
        "summary": "Using only the plate number of a Norwegian car you can find the name, address, Social Security number, etc. of the owners.",
        "niceUrl": "/2017/08/get-your-ssn-here",
        "text": "<h4>tl;dr</h4>While <a href=\"https://en.wikipedia.org/wiki/National_identification_number#Norway\">Norway's version of the Social Security number (SSN)</a> isn't considered sensitive personal information, it can still be used for ID theft and is sometimes treated as an authenticator and not only used for identification. Knowing (or systematically picking) a car's number plate you can get quite a bit of personal information about the owners. Also, services hosted alongside the one in question seem to have dubious security.\n\n<h4>Summary</h4><table class=\"summary\">\n    <tr>\n        <td style=\"width:30%\">Who:</td>\n        <td>Tryg's mobile app and Infotorg's web services</td>\n    </tr>\n    <tr>\n        <td style=\"width:30%\">Severity level:</td>\n        <td><span class=\"green-text\">Low</span> to <span class=\"orange-text\">medium</span></td>\n    </tr>\n    <tr>\n        <td style=\"width:30%\">Reported:</td>\n        <td>February 2017</td>\n    </tr>\n    <tr>\n        <td style=\"width:30%\">Reception and handling:</td>\n        <td><span class=\"red-text\">Very poor</span></td>\n    </tr>\n    <tr>\n        <td style=\"width:30%\">Status:</td>\n        <td><span class=\"red-text\"><strike>Not fixed</strike></span> <span class=\"green-text\">Fixed after this post was published</span></td>\n    </tr>\n    <tr>\n        <td style=\"width:30%\">Issue:</td>\n        <td>A lot of personal info available for anyone who wants it</td>\n    </tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4><img style=\"float:left;width:240px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from Tryg's app Trygg på reise.\" data-caption=\"Screenshot from Tryg's app Trygg på reise.\" src=\"/images/tryg-trygg_paa_reise.png\"/>The way to get the name (typically to look up the phone number to make contact) of a car owner in Norway has typically been to just send an SMS that costs some cents. A friend and former colleague told me about the insurance company Tryg's app <a href=\"https://play.google.com/store/apps/details?id=com.no.tryg&hl=en\">Trygg på reise (Safe travel)</a> where you can look up this information for free (plus Google broke their SMS app Hangouts making it impossible to send SMSes to 4 digit phone numbers). I had used it for quite a long time when one day I was curious about where it got its data from, if it maybe was possible to create some services on top of that data.\n\n<h4>Approach (technical stuff)</h4><h5>HTTP proxy</h5>If you want to intercept traffic between a server and a mobile app (even SSL), the HTTP proxy <a href=\"https://www.charlesproxy.com/\">Charles</a> (and Android 6 or below for SSL) is the <b>the</b> way to go. It's very easy to use and gives a very good overview of the data going back and forth. And it let's you easily copy the HTTP requests as <a href=\"https://curl.haxx.se/\">Curl</a> commands.\n\nWithin a couple of minutes you have a pretty decent control of the HTTP calls for that app.\n\n<h5>Web Service endpoint</h5>The first surprise I got was that the app and server actually use the procotol <a href=\"https://en.wikipedia.org/wiki/SOAP\">SOAP</a> which is just terrible to work with. (I suspect people having to use, develop and debug SOAP services live in a fog of <a href=\"http://www.urbandictionary.com/define.php?term=FML#1256378\">#FML</a>.)\n<!--img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"We can finally get all the details about the real-life replica of Il Tempo Gigante. Picture by Curt (https://www.flickr.com/photos/curt-dk/ / CC BY-NC 2.0)\" data-caption=\"We can finally get all the details about the real-life replica of Il Tempo Gigante. Picture by Curt (https://www.flickr.com/photos/curt-dk/ / CC BY-NC 2.0)\" src=\"/images/il_tempo_gigante.jpg\"/-->\n<img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Some of the data about the real-life replica of Il Tempo Gigante returned by the web service.\" data-caption=\"Some of the data about the real-life replica of Il Tempo Gigante returned by the web service.\" src=\"/images/il_tempo_gigante_ws.png\"/>The second surprise was that the web service actually sent back much more info than what it display in the user interface in the app, and not only the municipality that you also get with the amentioned SMS service. I've summarized all the details further down after all the technical details here. <b>But seeing both the owner and co-owner's SSNs and addresses surprised me the most.</b>\n\nI noticed that the web service call always included the username and password instead of the returned session id. No biggie, but a bit strange. <b>The strings for usernames and password were all upper case and only 6-7 characters long. The password was almost the same as the username and all of them containing the name of the customer and the abbreviation of the service name. I hope that isn't the standard, that it gives me a clue on how the logins for the other services are.</b>\n\n<img class=\"materialboxed responsive-img\" title=\"Curl version of the HTTP request from the Tryg app.\" data-caption=\"Curl version of the HTTP request from the Tryg app.\" src=\"/images/curl_infotorg.png\"/>\n<h4>Security issue?</h4>The data returned is returned as intended, so there's so information leak in itself. The web service works as it should. However, <b>it's more questionable if it's okay that a service like to be facing a public client</b>.\n\nThe data returned from the service is as follows:\n - The owner's first, middle and last name (alt. company name)\n - The owner's full address\n - The owner's Social Security number (org.no. if company)\n - The owner's birthday (as it's part of the SSN in Norway)\n - Any co-owner's first, middle and last name\n - Any co-owner's full address\n - Any co-owner's Social Security number\n - The co-owner's birthday (as it's part of the SSN in Norway)\n - A lot of technical data about the vehicle\n - The insurance company and date of the vehicle insurance\n - The insurance company and dates of the previous vehicle insurance\n - The name of the previous owner\n - Info if and when the vehicle was stolen\n\n<b>Is this okay?</b> All the app does is show the name of the owner and details about the vehicle itself.\n\nApparently the name of the co-owner and previous owner is public information according to the law called <a href=\"https://lovdata.no/dokument/NL/lov/2006-05-19-16\">Offentlighetsloven (Freedom of information act)</a> (Norwegian link only).\n\n<h4>But wait, could there be more?</h4><a href=\"https://www.infotorg.no/alle-tjenester\">Infotorg provides quite a few services.</a> (Norwegian link only, sorry.) Having the URL for the web service I of course checked out what else was on the server. I was a bit surprised to see that the root site had a seemingly complete list of all the services available at Infotorg. There were links to the documentation and WSDLs (Web Services Description Language) telling about all these services available and how to connect to them and use them. And these services do indeed contain much more sensitive information. There is a national population register, financial information, credit assement, employee register, lay judge register, etc. etc. <b>It's important to note that I never had (or tried to get) access to these other services. My point is that the openess is a bit too much, and seemingly the user credentials policy isn't very strict. But this is just speculation.</b>\n\nTo add to the eerie feeling about these services there are links to some test site and test CMS and information about a test client. Google has of course indexed all these other sites and sub domains. Also there are pages giving errors that gives more information about infrastructure and services running.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>I sent an e-mail to the contact e-mail address provided by Tryg at the app's Play Store page. <b>I never got an answer.</b>\n\nI also used a web form to get in touch with Infotorg.\n\n<h5>Day 1 - X</h5>I got an answer from Infotorg in less than 24 hours. That's prompt, that's good. And they wanted more details.\n\nWhen I provided more details with an example Curl command for them to try I got an automatic e-mail back telling that the person handling this was unavailable. <b>I never heard back after that</b>, so I tried again one month later and this time including a e-mail address from the automatic e-mail that was supposed to be used for urgent cases. <b>I never heard back.</b> So I tried again writing both e-mails again five days before publishing this. <b>I never heard back.</b>\n\n<h5>Day 186</h5>I'm publishing this post. So is this responsible disclosure? Yes, I tried hard to get an answer. But on the other hand, it seems to me that the involved parties don't think that this is a disclosure to begin with, and that it isn't a problem.\n\n<div style=\"background-color:#ffecb3;padding:10px 10px 15px 10px;\" class=\"\"><h4 id=\"update\">Update</h4><h5>Day 187 - Tuesday - post publish day 1</h5>Tryg's user at Infotorg's service got closed (as far as I understand, after Tryg contacted Infotorg).\n\n<h5>Day 188 - Wednesday - post publish day 2</h5>Tryg reached out to me. They thanked for the help finding the issue, said they were sorry for it being there in the first place, and told me it had been resolved.\n\n<h5>Day 189 - Thursday - post publish day 3</h5>digi.no published the article <i><a href=\"https://www.digi.no/artikler/norsk-mobilapp-apnet-for-tapping-av-masse-informasjon-om-norske-bileiere/400386\">Norsk mobilapp åpnet for tapping av masse informasjon om norske bileiere</a></i>.\n\nTryg <a href=\"#comment-3472389318\">commented on this post</a> here themselves.\n\n<b>I think Tryg - when the information finally reached them - has handled the case very well. They reacted promptly, fixed the problem, and has been very open and honest about everything. I'm really happy with that.</b>\n</div>\n\n<h4>Some fun facts</h4><h5>Fun fact #1: The previous King of Norway had his cars registered on him personally</h5><a href=\"https://no.wikipedia.org/wiki/Kongelige_biler_i_Norge\">His Majesty The King has got a few cars</a>. Looking up e.g. the one with licence plate <i>A-1</i> you'll see that now the car is registered with <i>The Royal Court</i>, but it used to be registered directly on our previous King - <a href=\"https://en.wikipedia.org/wiki/Olav_V_of_Norway\">Olav V</a>. They have also trusted the insurance company <a href=\"https://if.no\">If</a> since 1995.\n\n<h5>Fun fact #2: The service also works for Norway's new personal licence plates</h5>The summer 2017 Norwegian Public Roads Administration opened for paying to get your own personal licence plate. It's been quite a few news articles about people getting different funny and fascinating plates. The web service in question works for those as well. Maybe something to think about before sticking your head out there.\n\n<h5>Fun fact #3: Exposed by one single post</h5>Reporting this issue I got a question back for more details. There's no better way to understand a security issue than seeing your own data. The person who responded had got this fully closed private Facebook profile. Or, did he? Well, he had <b>one single public post; a check-in</b>. The check-in was from when he got a free car wash from a big radio show in Norway. In that post there was a picture of the car in the car wash. So he got a pretty low profile on the Internet, but still one could look up the name, address, SSN, etc. Doesn't that hurt just a little bit?\n\n<h4>Conclusion</h4><b>We should probably not fear for our SSN. But I'm still not sure if I like the idea that just based on a licence plate anyone should get your full address or know any details about your insurances.\n\nFurther I hope all of Infotorg's more sensitive services are much more secure than first impression I got; that they are alerted if anyone tries any brute force attacks or systematic information gathering, and that the logins don't consist of only a few capital letters.\n\nAlso, I wish that it wasn't so hard to get the attention when trying to report a security concern...</b>\n\n<h4>At last some - hopefully - far fetched ideas</h4>I call this \"far fetched\", because it's hard to believe it would happen, but I can't help thinking it.\n\nWe know from media the later years that governments from different countries do collect quite a bit of intelligence and information about people. Wouldn't be interesting for some states to get a catalogue of a big part of Norway's population? I mean, they get a real one-to-one identifier and full names and quite a bit of meta information. Combining this information over time with information from other sources? Observering a dataset like discussed here over time, one can get a sense of family relations, split-ups, address changes, income changes, etc. Is that okay? What if you at some point shared an address with a person that has got an entry ban in a country you want to travel to? Should they stop you too just to be sure?\n\nWhat about insurance companies? They could in theory use the dataset to target potential customers. If they know that they beat the prices of one other particular insurance company they could make contact and try to sell their product instead. But then again, they have probably always had full access to these data.\n\nIf you use your imagination I'm sure you can come up with other ways to (ab)use the data.\n",
        "images": [
            "/images/il_tempo_gigante_ws.png",
            "/images/tryg-trygg_paa_reise.png",
            "/images/curl_infotorg.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Social Security numbers",
                "url": "/ssn"
            },
            {
                "title": "OWASP 2013 A2",
                "url": "/owasp-2013-a2"
            },
            {
                "title": "OWASP 2013 A6",
                "url": "/owasp-2013-a6"
            }
        ],
        "commentsIdentifier": "http://blog.roysolberg.com/2017/08/get-your-ssn-here"
    },
    {
        "title": "Case #2: Good authentication, but lacking authorization",
        "published": true,
        "publishDate": "2017-08-21T07:00:00.000Z",
        "summary": "That a service is heavily gated doesn't mean that your information is safe. I'm taking it down a notch this week; this is not a severe case, but an OK reminder for us developers on how we protect our resources and to never trust the client.",
        "niceUrl": "/2017/08/auth-auth",
        "text": "<h4>tl;dr</h4>The service uses the industry de facto standard for high security in Norway - <a href=\"https://bankid.no\">BankID</a> - for authentication, but still missed authorization check on a HTTP PUT call. A classical weakness to be found in web apps of today.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td>Anonymous, let's call them <a href=\"https://en.wikipedia.org/wiki/Fictional_company\">Acme</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"green-text\">Very low</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>March 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Very good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>1 x <a href=\"https://www.norsk-tipping.no/flax\">Flax scratch ticket</a> (≈3 USD (1:600,000 chance to win 125,000.- USD (but no, I didn't win anything)))</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Missing authorization on REST endpoint + still authenticated after browser timing out session</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4>Acme is a \"service booklet\" for your home. It's a place to store all of the documentation about who's done what and your proof that all is ok if you were to sell your home. Everything about my house is stored at their servers.\n\nI got a \"snap\" of 5 scratch tickets from a friend that he got from Acme for reporting some problem with him getting the wrong house number. I thought maybe there could be an easy way for me to get some scratch tickets as well.\n\n<h4>Approach (technical stuff)</h4>This was a quick one I did while grabbing some lunch one Saturday.\n\n<h5>Browser developer tools</h5>I logged in to Acme using BankID and having <a href=\"https://developers.google.com/web/tools/chrome-devtools/\">Chrome DevTools</a> open. I surfed back and forth and got an impression of the web app and got a list of URLs that was being called + headers and cookies and whatnot.\n\nAs with most web apps today there were a lot of Ajax calls going on, transferring JSON. I then tried replacing some IDs in URLs. In general stuff seemed pretty good. The security seemed to be in place.\n\nThen I saw this sort of \"task list\" where you have these set tasks - and can create new ones - for stuff you need to do with your home. You can also share them with third parties so they can do them for your and sign of on the work done. Once finished can set the task to status <i>Done</i>.\n\n<h5>Curl</h5>Most developer tools for browsers let you copy any HTTP request as a <a href=\"https://curl.haxx.se/\">Curl</a> command. <b>I got an ID of one of the tasks of my friend and his approval to change the status of it.</b>\n\nI've changed URLs and IDs, but otherwise it was this command used:<pre class=\"prettyprint\">\ncurl 'https://example.com/UpdateTask' \\\n    -H 'Cookie: &lt;some cookies for BankID, session and Google Analytics&gt;' \\\n    -H 'Origin: https://example.com' \\\n    -H 'Accept-Encoding: gzip, deflate, br' \\\n    -H 'Accept-Language: nb-NO,nb;q=0.8,no;q=0.6,nn;q=0.4,en-US;q=0.2,en;q=0.2' \\\n    -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.98 Safari/537.36' \\\n    -H 'Content-Type: application/json;charset=UTF-8' \\\n    -H 'Accept: application/json, text/plain, */*' \\\n    -H 'Referer: https://example.com/app/index.html' \\\n    -H 'X-Requested-With: XMLHttpRequest' \\\n    -H 'Connection: keep-alive'  \\\n    --data-binary '{\"taskId\":&lt;some other person’s task ID&gt;,\"status\":true}' \\\n    --compressed</pre>\n<b>And bingo, the server returned HTTP 200 and the task was changed.</b>\n\n<h5>Session management</h5>Returning to my computer some time after doing this, the browser told me I got logged out because of the session being timed out. I tried one of the Curl commands one more time and saw that the HTTP request went through and returned HTTP 200. <b>Apparently I was still logged in and had a valid session even though my browser told me otherwise.</b>\n\n<h4>Classical issue</h4><b>I think this is one of the more common issues in web apps today. When authorization of GETting data is in place, one have a tendency not to check if the client is allowed to do what he's telling the server when PUTting data back.</b>\n\n<h4>Reception and handling</h4><h5>Day zero</h5>I sent an e-mail telling about the two minor issues.\n\n<h5>Day 2 - before noon</h5>I got a long and well-written reply thanking me for finding the issue and telling that the developers were looking at it. They also went on telling that they were growing and there was a new employee coming in who would have the service's security as its responsiblity.\n\n<h5>Day 2 - night</h5>I got an update. <b>They had found the authorization issue and were in the process of fixing it.</b> In regards of the session still being valid they said it was just that the sever had one hour session timeout while the JavaScript app had it set to 20 minutes.\n\n<h4>Anonymous you say?</h4><b>I contacted Acme telling them that I was posting this. Until then they were very professional and open, but suddenly they became a bit defensive.</b> And they wanted to \"inform me\" that I had broken their terms the moment I had checked if they had any security holes. They did not want me to mention their company name or brand. They were afraid of the media. I can fully understand that. Who doesn't want to protect their brand?\n\n<b>I think they have handled the situation so well, and the issue was so minor, that I want to encourage them to come forward.</b>\n\n<h4>Conclusion</h4>This was a minor issue, but an issue I see quite a bit. The reception and handling was good, at least until I told I was publishing this. Developers: Go and check those POST and PUT requests and double check that you verify if the client is allowed to do what it wants to.\n",
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Authorization",
                "url": "/authorization"
            },
            {
                "title": "Session handling",
                "url": "/session-handling"
            },
            {
                "title": "OWASP 2013 A2",
                "url": "/owasp-2013-a2"
            },
            {
                "title": "OWASP 2013 A7",
                "url": "/owasp-2013-a7"
            }
        ],
        "commentsIdentifier": "http://blog.roysolberg.com/2017/08/auth-auth"
    },
    {
        "title": "Case #3: Who's got your IP address today?",
        "published": true,
        "publishDate": "2017-08-28T04:45:00.000Z",
        "summary": "One of the \"digital mailbox\" services used by more than 400 central and local Norwegian government agencies to send mail, was leaking IP addresses and full names.",
        "niceUrl": "/2017/08/digipost-leak",
        "text": "<h4>tl;dr</h4><i>Digipost</i> - one of two \"digital mailboxes\" in Norway where you can get mail from public authorities - leaked users' full real name, IP addresses and login timestamps.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://www.posten.no/en/\">Norwegian postal service's</a> <a href=\"https://www.digipost.no/\">Digipost</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>May 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Very good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>125 USD worth of gift certificates</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with users' name and IP address</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4>In Norway we have two official suppliers for a \"digital mailbox\" where Norwegian public agencies can send you letters and documents. It's considered a more secure way than regular mail for delivering important letters and documents. The mailboxes have been pushed pretty hard the last couple of years, ensuring that as many as possible will sign up for it.\n\nI've personally used Digipost for quite a few years now. I think it's a great service for receiving important documents. One day I was wondering if my information and documents were safe with them.\n\n<h4>Approach (technical stuff)</h4><h5>HATEOAS</h5>Earlier on I used to attend the very good Java conference <a href=\"https://javazone.no/\">JavaZone</a> every year. Five years ago I was at a talk from a couple of consultants working with Digipost, called <a href=\"https://vimeo.com/49392437\">Hypermediadrevet API i praksis</a> (Hypermedia driven API in practice). It was an inspiring talk which made me make at least the next REST API hypermedia driven.\n\nLittle did I know that I would use this \"Hypermedia as the Engine of Application State\" (HATEOAS) to an advantage when looking for security issues at the same site years later. Simply explained, the HATEOAS makes REST APIs more self-documenting and easier to browse through using the links provided.\n\n<h5>Browser developer tools</h5><img style=\"width:500px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Wait a minute, those aren't my logins? Screenshot from Chrome containing JSON with login history.\" data-caption=\"Wait a minute, those aren't my logins? Screenshot from Chrome containing JSON with login history.\" src=\"/images/digipost_eventlogs.png\"/>I logged in to Digipost having <a href=\"https://developers.google.com/web/tools/chrome-devtools/\">Chrome DevTools</a> open to see what was going on. I opened one or more of the REST URLs in a different tab. Having a JSON viewer browser extension like <a href=\"https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa\">JSON Formatter</a> (that hopefully doesn't ship everything it sees to a third party server) makes looking at JSON a pleasure. The API being hypermedia driven meant that you get instant linkification and can browse through the data quickly.\n\nDigipost seemingly uses an auto increment integer as ID for the user, making it easy to check if your data is secured against the access of others. (Remind me to write a post about the pros and cons against IDs like that (and no, security by obscurity does not make your data safe)). I changed a few IDs here and there and mostly got different kinds of error messages thrown back at me. <b>However, I quickly found two URLs that didn't seem to have a proper authorization check.</b>\n\n<h4>Security issue</h4>Two URLs without proper authorization checks was found.\n\nThe first URL apparently returned the number of unpaid invoices you have. Not something you would care about if someone accessed.\n\n<b>The second one was the alarming one for me. It returned the account activities for the past 30 days.</b> The data had the following elements:\n- Date of activity\n- <b>Full name</b> of the person performing the activity\n- Type of activity (e.g. level of authorization and authentication method)\n- <b>IP address</b> of client\n- The role of the person\n\n<h4>What's the big deal about this?</h4>The information exposed isn't sensitive, so why should you care? Well, I think there are two important points here.\n\n<b>The first point is that a service like this - promoted and pushed by the government - should have zero tolerance on any kind of information leak.</b> As system developers we make mistakes all the time. Every week we go to work and create new bugs. Hopefully they aren't security related, but sometimes they are. When working with services like this it's so incredibly important to have proper methods and routines to minimize the chance that this can't happen.\n\n<b>The second point is that I think the combination of a full real name and a fresh IP address is unfortunate.</b> It doesn't really matter for me, and probably not for you, but what about public figures or persons with unlisted addresses?\n\n<h4>Reception and handling</h4><h5>Day zero</h5>At night I sent an e-mail to the customer service.\n\n<h5>Day 2</h5>Less than 48 hours afterwards I got an e-mail apologizing that I didn't receive an answer before and telling that they had fixed the issue and were going to deploy it the same day.\n\n<h5>Day X</h5>I received a reward of some gift cards which I appreciated, but what might've impressed me the most was that the chief of security actually took the time to add hand written thank you note.\n\n<b>I think the issue in question was handled very well. Digipost responded quickly, fixed it quickly, and communicated in a clear and professional way. Even when reaching out telling about this post they responded in the same manner.</b>\n\n<h4>Conclusion</h4><b>It's important to underline that I never got access to any documents, communication or any information regarded as sensitive.</b> But for me this is a type of service that should have the same level of security as a bank. There just shouldn't be any information leaks. I truly believe that the information leaked could've be used for bad purposes.\n",
        "images": [
            "/images/digipost_eventlogs.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Authorization",
                "url": "/authorization"
            },
            {
                "title": "OWASP 2013 A7",
                "url": "/owasp-2013-a7"
            }
        ],
        "commentsIdentifier": "http://blog.roysolberg.com/2017/08/digipost-leak"
    },
    {
        "title": "My dumb smart home",
        "published": true,
        "publishDate": "2017-08-31T05:15:00.000Z",
        "summary": "My smart home isn't all smart. When it comes to security it's pretty dumb.",
        "niceUrl": "/2017/08/my-dumb-smart-home",
        "text": "<div style=\"background-color:#ffecb3;padding:10px 10px 10px 10px;\">This post was originally <a href=\"https://plus.google.com/+RoySolberg/posts/gNt4paU7KEZ\">published on Google+</a> September 2015.</div>\n<h4>tl;dr</h4>It isn't that the home automation system <a href=\"http://www.hdlautomation.com/\">HDL-BUS Pro</a> has any security holes; it doesn't have any security. If your house, the hotel you're staying on or your business uses HDL you should definitely read on.\n                \n<h4>Intro</h4>This spring I moved into my new house. When building a house in 2014/2015 you kind of feel obligated to make it a bit smart. Being a programmer it makes it a must. I looked into quite a few systems and protocols for home automation. Since this is a new building I preferred a cabled system instead of a wireless one. The electrical contractor for the house wasn't much updated on smart homes, but luckily they had a few electricians which knew and installs HDL-BUS Pro systems. So a bit coincidentally I ended up with HDL.\n\nLong before the actual installation I went to a training for \"programming\" (configuring really) the system. I was very curious about the underlying protocol and how stuff worked under the hood. Luckily HDL is open about its buspro protocol - and that's a healthy sign - and I learned about and was given the specification for the internal communication between the components. This was when I first was a bit surprised about the lack of security. <b>It's a straight forward simple protocol - and that's a good thing - but it completely lacks encryption, authentication and authorization.</b>\n\nHDL has a component called IP gateway which is a gateway between ethernet and the wired HDL components. The IP gateway is necessary to configure the components through the Windows application called HDL-BUS Pro Setup Tool. It also supports remote configuration from anywhere on the Internet.\n\n<h4>Security precaution #1</h4>If you have an IP gateway connected to your ethernet you want to make that a network that isn't reachable for unauthorized parties - meaning that both wired and wireless network shouldn't be available for anyone you don't trust. My neighbour was over the other day and casually asked \"What's the password for the Wi-Fi?\" Of course, I run the guest Wi-Fi in my house on a separate network so I could give him access. However, I suspect that most people (or businesses) with HDL don't realize the dangers and let anyone access the same network. If you want your IP gateway to be available via your Wi-Fi you want to make sure that the encryption, password and security in general is at a high level.\n\n<h4>Security precaution #2</h4>Very much like the precaution #1 regarding Wi-Fi and cabled ethernet, you should think twice if you have your ethernet available over your powerlines. What about that power outlet you have outside your house or just inside the garage?\n\n<h4>Security precaution #3</h4>With so many \"trusted\" devices connected to your Wi-Fi chances are that the security in or more of them have been comprimised. A typical home Wi-Fi for a family have several phones, tablets, laptops, TVs, and a video game console connected. Also with Internet of Things on the rise more and more units are allowed on your local network. If only one of those are compromised, someone could theoretically get access to your smart home. Considering precaution #1-3 you probably shouldn't have the IP gateway connected to the ethernet at all.\n\n<h4>Security precaution #4</h4>Do you have any outdoor sensors for e.g. temperature or motion connected to your system? Well, I don't think you should. What happens if someone hooks up an IP gateway and a computer on that unit or the unit's wires? Correct, they have full access to your system.\n\n<h4>Security precaution #5</h4>Being on a ethernet with a HDL system and recent version of the IP gateway's firmware lets you enable remote access. So, have you possibly had any unwelcome guests connected to your local network at some point? Have you checked if someone has enabled remote access to your system? Or maybe they just fetched the IP address, username and password from the IP gateway. Either way someone could access your system from remote at any desired time later on. My advice is to have the remote connection disabled.\n\n<h4>Security precaution #6</h4>If you have ever accessed your HDL system from remote through the IP gateway you should consider changing the login info and/or disable the remote access. As mentioned, HDL doesn't have any encryption, meaning that nearly anyone could possibly have picked up your login info when connecting through the Internet.\n\n<h4>Security precaution #7</h4>HDL has an SMS gateway that lets you text commands to the HDL system. Typically a set of phone numbers are whitelisted for sending commands. Commands can be something like \"VACATION\", \"ALARM OFF\", \"OPEN GARAGE\". It is very easy to spoof a phone number when sending a text. If someone knows - or guesses - the phone number you send commands from, so can they. If someone has/had access to the SMS gateway that someone could know the commands and even set up other commands.\n\n<h4>Hacking scenario #1</h4>So, what's the problem with having anyone connected to your HDL system either remotely or locally? Well, what if someone reads the status of the motion sensors? Then it could be possible to know if there's anybody home, maybe they could even make educated guesses about who's home depending on which areas that are in use. You don't post a sign outside your home telling potenial burglars that you aren't home, so you shouldn't let your smart home do that either.\n\n<h4>Hacking scenario #2</h4>Okay, somebody knows that noone's home, but you're protected by your smart home aren't you? Motion detectors, alarm sound, blinking lights, SMS warnings on intrusion. If someone has access to your HDL system they can easily turn this off. They could even turn it off, break in, turn the alarm system back on after leaving, and you wouldn't have a clue what happened.\n\n<h4>Hacking scenario #3</h4>If you have smoke detectors connected to the system any communication with the HDL system can be disabled.\n\n<h4>Hacking scenario #4</h4>Got your garage door connected to the system? Or even your front door? Well, you've probably figured it out by now. The doors can be opened (after disabling any alarms).\n\n<h4>Hacking scenario #5</h4>Someone could connect to your system and do vandalism like turning the heat on for full or control the blinds. Some things might be considered just a prank, but what if someone pushes the dimmers, relays and heating to the edge by either turning them on and off quickly or turning them to a 100%? Would it do damage to the components? Cause a fire?\n\n<h4>Hacking scenario #6</h4>Those previous five scenarios were the ones on top of my head. I'm sure you can think of a sixth and endless more yourself.\n\n<h4>Conclusion</h4>This isn't some zero-day vulnerability disclosure of HDL-BUS pro. The system is working as intended. These are just my observations, worries and security tips when dealing with HDL. Make your local network secure, consider not having an IP gateway connected, make sure wires and components aren't accessible for anyone who shouldn't have access. <b>I wish they taught this on the HDL training.</b>\n\nFor the ones of you trusting on your local network security I want to quote a great book I'm reading now - <a href=\"http://shop.oreilly.com/product/0636920033547.do\">Abusing the Internet of Things\" by Nitesh Dhanjani</a>: <i>\"As we add additional IoT devices to our homes, the reliance on WiFi security becomes a hard sell. Given the impact to our physical privacy and safety, it's difficult to stand by the argument that all bets are off once a single device (computer or IoT device) is compromised. Homes in developed countries are bound to have dozens of remotely controllable IoT devices. The single point of failure can't be the WiFi password. What's more, a compromised computer or device will already have access to the network, so a remote attacker does not need the WiFi password.\"</i>\n",
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Smart home",
            "url": "/smart-home"
        },
        "tags": [
            {
                "title": "HDL Buspro",
                "url": "/hdl-buspro"
            },
            {
                "title": "Internet of Things",
                "url": "/iot"
            }
        ]
    },
    {
        "title": "Case #4: Blast from the past",
        "published": true,
        "publishDate": "2017-09-04T05:25:00.000Z",
        "summary": "In 2017 you don't see that many sites running PHP, but recently I stumbled on this site of classical PHP vulnerabilities.",
        "niceUrl": "/2017/09/php-hack",
        "text": "<h4>tl;dr</h4>A small Norwegian company is using a completely broken and open amateur PHP CMS. The site is open for (at least) local file inclusion and it's possible to completely take over the CMS.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td>Anonymous, let's call them <a href=\"https://en.wikipedia.org/wiki/Fictional_company\">Acme2</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"red-text\">Critical</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>August 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"red-text\">Poor</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"red-text\">Not fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>Not even a thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Completely broken PHP web site</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>I actually can't remember why I landed on the web site. Someone asked me to read something on this or a linking web site. Having seen a lot of bad sites over the years you can sometimes tell just from looking at the front page that you'll find some issues there.\n\nThe site is for a very small Norwegian company doing some kind of training programs for other companies. It has some public facing login for editing the content inline and is written in the server-side scripting language <a href=\"https://en.wikipedia.org/wiki/PHP\">PHP</a>. <a href=\"https://trends.google.com/trends/explore?date=all&q=%2Fm%2F060kv\">There was a time when PHP was very popular</a>, but I guess those days over.\n\n<h4>Approach (technical stuff)</h4>Once in a while I take a quick peek at web sites' source code. I was expecting to find something on this particular one, but I didn't expect to find it that quickly:\n<pre class=\"prettyprint\">\n&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\"&gt;\n&lt;head&gt;\n&lt;title>[name of company]&lt;/title&gt;\n...\n&lt;link rel=\"stylesheet\" type=\"text/css\"\n    href=\"merge.php?css[]=%2Fcss%2Fstandard.css&amp;css[]=%2Fcss%2Fcustom.css\" /&gt;\n...\n&lt;/head&gt;\n...\n&lt;/html&gt;\n</pre>\nCan you spot the opening? <b>Obviously the CSS was produced by some PHP script combining separate CSS files into one. Could it be that it would work for other files and directories?</b>\n\nWell, first I had to find the name of some other PHP files. I didn't see any, so I logically guessed on <span class=\"code\">index.php</span>: <pre class=\"prettyprint\">http://example.com/merge.php?css[]=index.php</pre>\nBut then it responed something like <pre class=\"prettyprint lang-php\">/* File is not a CSS or JavaScript file. */</pre>\nGood, maybe there was some sort of security in place after all?\n\nAs you might know, PHP is built mainly using the programming language C. And C uses <a href=\"https://en.wikipedia.org/wiki/Null_character\">null bytes</a> to terminate strings. So the next natural step is to try a URL like <pre class=\"prettyprint\">http://example.com/merge.php?css[]=index.php%00.css</pre> where the script will still check for the <span class=\"code\">.css</span> file ending, but when using the input string to include a underlying file it'll only use the part up to the null byte (URL encoded as <span class=\"code\">%00</span>).\n\n<b>This was bulls eye. I got the source of the <span class=\"code\">index.php</span> file back. At this point you know that you are golden.</b>\n\nNormally I would just provide a URL like <pre class=\"prettyprint\">http://example.com/merge.php?css[]=../../../../../etc/passwd%00.css</pre> just to prove the point to the site owner. Not that <span class=\"code\"><a href=\"https://en.wikipedia.org/wiki/Passwd\">/etc/passwd</a></span> contains any passwords any longer, but it will typically reveal usernames and shows that one can retrieve almost any file from the file system. However, this was a Windows machine and the <span class=\"code\">index.php</span> was not containing anything fun in itself.\n\n<span class=\"code\">index.php</span> did however point me towards other scripts files and moments later <b>I got hold of this PHP file that actually defined the username and <a href=\"https://en.wikipedia.org/wiki/Cryptographic_hash_function\">hashed</a> version of the password of the admin user.</b> Given the state of the site I'd be surprised if there even was some random <a href=\"https://en.wikipedia.org/wiki/Salt_(cryptography)\">salt</a> per user. So what you do you do when you have a hash? Well, you search for a online <a href=\"https://en.wikipedia.org/wiki/Rainbow_table\">rainbow table</a> site.\n\n<b>I got an immediate hit for the hash.</b> Not surprisingly the hash function used was the no longer recommended <a href=\"https://en.wikipedia.org/wiki/SHA-1\">SHA-1</a> and the password itself was so short and simple that you probably won't find it on <a href=\"https://en.wikipedia.org/wiki/List_of_the_most_common_passwords\">lists of the most common passwords</a>. Using the username and password you'd get full access to the content management system for the site.\n\nAt this point I stopped looking any further. I had enough info to report the issue and give a sense of the severity of what I saw.\n\n<h5>What I overlooked</h5>In my eagerness to find the security holes in the web app (and due to lacking branding) I didn't notice that this was actually not a homemade PHP site like I first thought. I didn't see it until writing this post, but there was a very interesting HTML meta tag: <pre class=\"prettyprint\">&lt;meta name=\"generator\" content=\"gpEasy CMS\" /&gt;</pre>\nWhile I couldn't easily find the full history, it seems like gpEasy CMS is an old version of <a href=\"http://www.typesettercms.com/\">Typesetter CMS</a>. I couldn't find the file inclusion among <a href=\"https://www.cvedetails.com/product/19479/Gpeasy-Gpeasy-Cms.html?vendor_id=10881\">the issues on CVE details</a>, though there was <a href=\"https://packetstormsecurity.com/search/?q=gpeasy\">another site with quite a few issues listed</a>.\n\n<h4>Security issue</h4>This is a completely broken PHP CMS. It's possible to retrieve about any file on the server, and you can change any contents of the site.\n\nThis is only speculation as I didn't look further after finding the file inclusion issue, but when you find a site like this you most probably also will find other types of holes like remote code injection.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>I sent an e-mail to the contact address. <b>8 minutes later I got a response. That's a new record.</b> But the answer wasn't that uplifting. Apparently the site hadn't been of much in use the last years (though I would definitely guessed otherwise looking at the public accounting and taxation figures..). It didn't seem to be of any interest doing anything with the site or server. So hopefully there isn't anything of value there and hopefully no one makes the server into some kind of <a href=\"https://en.wikipedia.org/wiki/Zombie_(computer_science)\">zombie</a>.\n\n<h4>Anonymous you say?</h4>This is a small company, possibly not in any real operation. They haven't fixed - and probably won't fix - the issue. I don't think it's right naming them. Let's just hope no one else finds the site and that they don't have any important or customer data on the server.\n\n<h4>Conclusion</h4>This was a blast from the past for me. It's been quite some time since I last saw an amateur PHP site like this. PHP once was very hot as the scripting language, partly because it is very easy to get started with, but it had a lot of pitfalls and it was so easy to make a site insecure. As the language matured the usage has gone down. Today most issues I see are HTTP service endpoints with lacking authorization checks.\n",
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "PHP",
                "url": "/php"
            },
            {
                "title": "File inclusion",
                "url": "/file-inclusion"
            },
            {
                "title": "OWASP 2013 A1",
                "url": "/owasp-2013-a1"
            }
        ]
    },
    {
        "title": "Building an almost real SPA blog",
        "published": true,
        "publishDate": "2017-09-07T14:50:00.000Z",
        "summary": "I thought I could have this blog as a real single-page application with no server code. That sort of worked. If it only hadn't been for the previews.",
        "niceUrl": "/2017/09/an-almost-real-spa-blog",
        "text": "<h4>tl;dr</h4>My first post on this blog was <a href=\"/2017/08/building-a-real-spa-blog\">Building almost a real SPA blog</a>. While the title mostly is still true, I ended up having a bit more <span class=\"code\">.htaccess</span> config and a small Python script for previews of posts in social media and add support for web feed.\n                \n<h4>Single-page application</h4>I was able to build this blog as a <a href=\"https://en.wikipedia.org/wiki/Single-page_application\">single-page application</a>. I had - and still have - all contents in <a href=\"https://github.com/roys/js-web-blog/blob/master/contents.js\">one single static JavaScript array</a> and use the JavaScript framework <i>Knockout</i> and the front-end framework <i>Materialize</i>. So far so good.\n                \n<h4>Search engine optimization</h4>Google has since 2014 been able to <a href=\"https://webmasters.googleblog.com/2015/10/deprecating-our-ajax-crawling-scheme.html\">render and understand JavaScript web applications</a>. <b>Using the Search Console's <a href=\"https://www.google.com/webmasters/tools/googlebot-fetch\">Fetch as Google</a> I have been able to verify that Google understands my site just perfect.</b> Doing a <a href=\"https://www.google.no/search?q=site:blog.roysolberg.com\">site: search</a> also confirms that.\n\nI have to admit that I don't care too much about other search engines like Bing, Yahoo, etc. Google is in its own class when it comes to searching. However, because of the mentioned Python script I now have a tool for that as well. More about that in a second.\n\n<h4>Article preview</h4><img style=\"width:450px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Typical article preview using Open Graph Protocol tags.\" data-caption=\"Typical article preview using Open Graph Protocol tags.\" src=\"/images/linkedin_preview.png\"/>I sometimes post my articles to <a href=\"https://twitter.com/roysolberg\">Twitter</a>, Facebook and <a href=\"https://www.linkedin.com/in/roysolberg/\">LinkedIn</a>. <b>When creating a preview of the links those sites certainly does not try to parse any of the contents as a modern browser. They just look for <a href=\"https://dev.twitter.com/cards/overview\">Twitter Cards</a> or <a href=\"http://ogp.me/\">Open Graph Protocol</a> (OGP) meta tags.</b> If they don't find anything they typically default to the <span class=\"code\">&lt;title/&gt;</span> tag.\n\nMy <span class=\"code\">index.html</span> only has a standard <span class=\"code\">&lt;title/&gt;</span> tag which makes no sense in the context of my articles. That makes the previews pretty bad, so I mostly skipped them in the start. However, I think the content is so much better with a good preview of the contents. I'm sure it also makes more people click the links.\n\n<h4>Web feed</h4>Naturally one doesn't get any web feed like <a href=\"https://en.wikipedia.org/wiki/Atom_(standard)\">Atom</a> or <a href=\"https://en.wikipedia.org/wiki/RSS\">RSS</a> out of the box when building a single-page application. And that's also one of the things I wanted to have for my site.\n\nSo far I've added support for Atom which you can acess at <a href=\"https://blog.roysolberg.com/atom\">https://blog.roysolberg.com/atom</a>.\n\n<h4>The easy way out</h4>I couldn't find a way to solve the preview challenge without resorting to some backend code. I really like <a href=\"https://en.wikipedia.org/wiki/Python_(programming_language)\">the programming language Python</a>. Writing just a few lines of code I was able to create a script that read the contents in the JavaScript array and produced the necessary OGP tags. You can <a href=\"https://github.com/roys/js-web-blog/blob/master/preview.cgi\">see the source code of the script on GitHub</a>.\n\nNow that I had the script for generating the preview I needed a way to route the bots to it. For that I used the already existing <span class=\"code\">.htaccess</span> configuration file and look for the <a href=\"https://en.wikipedia.org/wiki/User_agent\">User-Agent header</a> belonging to the different sites' bots. You can <a href=\"https://github.com/roys/js-web-blog/blob/master/.htaccess\">see the source code for .htaccess on GitHub</a>.\n\nBecause of the preview setup I got support for other non-Google search engines for free. They access the same code as generated by the Python script. Google is still served the same site as you are.\n\nHaving the preview script it didn't take long to make support for the Atom feed. You can <a href=\"https://github.com/roys/js-web-blog/blob/master/atom.cgi\">see the source code of the script on GitHub</a>.\n\n<h4>Wishes for the future</h4><b>I don't think the Open Graph Protocol is very flexible or ready for single-page applications and thicker clients.</b>\n\n<b>The first thing that hit me when creating the script was that I couldn't just inject the meta data as HTTP headers.</b> I had to create HTML markup for it. I can't understand why one shouldn't be able to choose between headers and tags.\n\nSecondly the different social media sites need to start doing what Google has been doing since 2014; render the pages with some kind of <a href=\"https://en.wikipedia.org/wiki/Headless_browser\">headless browser</a> to be able to understand the contents and get dynamically injected OGP meta tags. It's not that much magic or resource demanding in 2017.\n\n<h4>GitHub project</h4>If you're interested you can have a look at the source code for this blog at <a href=\"https://github.com/roys/js-web-blog\">https://github.com/roys/js-web-blog</a>. The project itself is licenced under the MIT License, but for the contents (posts and images) I reserve all rights.\n",
        "images": [
            "/images/linkedin_preview.png"
        ],
        "category": {
            "title": "Software development",
            "url": "/software-development"
        },
        "tags": [
            {
                "title": "JavaScript",
                "url": "/javascript"
            },
            {
                "title": "SPA",
                "url": "/spa"
            }
        ]
    },
    {
        "title": "Case #5: Tell me your bank account no. and I'll tell you how rich you are",
        "published": true,
        "hot": false,
        "publishDate": "2017-09-11T05:00:00.000Z",
        "summary": "I'm sure you expect your bank accounts to be safe from prying eyes. For a while other customers knowing my bank account number could check my account balance.",
        "niceUrl": "/2017/09/skandiabanken-leak",
        "text": "<h4>tl;dr</h4>The Norwegian bank Skandiabanken leaked the balance of other customers' bank accounts. I also question parts of their session handling.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://skandiabanken.no\">Skandiabanken</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"red-text\">High</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>September 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Very good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A big thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with other customers' bank account balances and account names</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4>Skandiabanken - soon to be called Sbanken - is a fairly large bank in Norway with its more than 400,000 customers. It was Norway's first pure online bank when it started in 2000. I have been a customer since that first time and all along from the start it's been my favourite bank.\n\nThis summer a regulation for personal savings accounts for shares was approved. From September 1st 2017 it was possible to move shares and funds into this new type of account. The timing meant that all banks in Norway suddenly were in a hurry for getting the product ready.\n\nThe morning of the opening of the new account type I was logged in to create one for myself. I noticed that there was a few missing text translations and some places where it said <i>undefined</i> in the user interface. This new part of the bank wasn't all bug free yet.\n\n<h4>Approach (technical stuff)</h4><img style=\"width:500px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from Vivaldi containing JSON with back account details.\" data-caption=\"Screenshot from Vivaldi containing JSON with back account details.\" src=\"/images/skandiabanken_accountdetails.png\"/>I opened <a href=\"https://help.vivaldi.com/article/developer-tools/\">Vivaldi developer tools</a> when logged in, to see what was going on in regards of network calls. I was surprised to see that one of the presumably new <a href=\"https://en.wikipedia.org/wiki/Ajax_(programming)\">Ajax</a> calls contained one of my bank account numbers. I could be wrong, but I think it's atypical for them to use that ID when asking for data from the backend. That of course doesn't mean anything, but I got curious and wondered if my data was properly secured.\n\nThe Ajax call returned <a href=\"https://en.wikipedia.org/wiki/JSON\">JSON</a> with the balance and some other data about the bank account in question. <b>I asked a friend for a bank account number and permission to check if I could get any of his data returned. And indeed I got his data.</b>\n\n<h4>Security issue</h4><b>Knowing just the bank account number of another customer one would get these data:</b>\n- Some UUID of the bank account\n- Customer's own name of the account\n- <b>The account's bank balance</b>\n- <b>The account's book balance</b>\n\n<h4>Reception and handling</h4><h5>Day zero</h5>I notified the bank and they immediately responded and started checking out the issue.\n\n<b>Just hours later they had rolled out a fix for the problem.</b> This must be the quickest fix I have ever seen for a security issue.\n\nLater the same I day I was phoned up by one of the chiefs who thanked me and told me they were grateful for that I found and reported the issue.\n\n<h5>Day 4 - incorrectly reporting a second issue...</h5>I had left my browser logged into this new part of the bank called \"Min sparing\" (\"My savings\"). When I returned to the computer quite a bit later I noticed that I was still logged in. And I noticed that I could close and open my browser and still be logged in to this part of the bank. Going to other parts of the bank would log me out from everything.\n\nI reported this by e-mail, but just after that I learned that <a href=\"https://skandiabanken.no/sporsmal-og-svar/min-sparing/hvor-lenge-kan-jeg-vare-inaktiv-i-min-sparing-appen-for-jeg-blir-logget-ut/\">this part of the bank has 9 hours session time</a> and not 20 minutes as most parts of the bank. I felt a bit embarrassed for reporting a non-issue and wasting their time.\n\n<h5>Day 5 - ...or was I into something?</h5>The next morning I realized something. Though this \"My savings\" session time was intentionally high, Skandiabanken offers simultaneous logins, and logging out from one session doesn't invalidate any others. <b>This means that if you are able to get access to a computer where the user forgot to log out after accessing \"My savings\" in the last hours you can get hold of the cookies and keep the session alive by only calling the server once in a while.</b>\n\n<b>What's more is that you can do this call from any location. You don't have to use the same computer or IP address.</b> The \"My savings\" page gives a pretty good glance into your economy (like shares, funds and some transactions), and using the mentioned Ajax call you <s>can</s> could also use the same cookie to access the balance of other known account numbers for that logged in user. <b>Hopefully the session can't be kept alive forever without signing in again.</b> While testing I had this one session alive for more than 36 hours (while changing locations and having other devices logged in and out).\n\n<b>Skandiabanken replied and told me that this session handling is a feature and not a bug.</b> They want a long session time, and they don't want to restrict the session to IP addresses because of mobile clients.\n\n<h5>Day 5 - new webapp deployed</h5>Skandiabanken seems to have removed the bank account number from the Ajax call, making it always return the balance of the payment account for funds and making the \"My savings\" page only getting savings related data. I would say that's a step in right direction. The 9 hours session time seems to stay the same.\n\n<h4>Conclusion</h4><b>As far as I know the security hole with balance access was introduced that morning and was only in the wild less than a day.</b> I have worked with online banking as an IT consultant and know how seriously security is taken in that industry. I was pleased - but not surprised - to see how seriously and professionally Skandiabanken handled everything.\n\nI feel confident that this issue would've been discovered relatively quickly by the bank itself hadn't I reported it. However, for me online banking is one of those services that just need to always be secure and never leak information like this.\n\n<b>What makes me a bit uneasy is the session handling feature/issue where someone could be watching my economy with a logged in session that I'm unaware of.</b>\n\n<b>Please remember to always hit that <i>Log out</i> button.</b>\n",
        "images": [
            "/images/skandiabanken_accountdetails.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Authorization",
                "url": "/authorization"
            },
            {
                "title": "Bank account",
                "url": "/bank-account"
            },
            {
                "title": "OWASP 2013 A7",
                "url": "/owasp-2013-a7"
            }
        ],
        "commentsIdentifier": "https://blog.roysolberg.com/2017/09/skandiabanken-leak"
    },
    {
        "title": "1995: When you could get a demo of the Internet on a floppy disk",
        "published": true,
        "publishDate": "2017-09-13T21:00:00.000Z",
        "updateDate": "2017-09-16T06:10:00.000Z",
        "summary": "This one is for you who actually know what that save icon in Word is.",
        "niceUrl": "/2017/09/internet-demo",
        "text": "<h4>tl;dr</h4>I've uploaded all the HTML files from a Norwegian Internet Service Provider's Internet demo diskette so you can (almost) surf like it's 1995.\n\n<h4>Background</h4><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"The diskette containing the browser and demo pages.\" data-caption=\"The diskette containing the browser and demo pages.\" src=\"/images/floppy02.jpg\">\nBack in 1995 - one year before I tried the Internet for the first time, and two years before I got Internet access at home - my mother brought me this floppy disk from work. She thought I might be interested in checking it out. <b>It was a demo of the Internet!</b>\n\nI didn't really know what the <a href=\"https://en.wikipedia.org/wiki/World_Wide_Web\">World Wide Web</a> was about. The diskette contained the web browser <a href=\"https://en.wikipedia.org/wiki/Mosaic_(web_browser)\">Mosaic</a>, and it actually gave a feel of what the Internet was like.\n\n<h4>Demo</h4>Below is the demo itself. It's nice to see the HTML pages still working the same 22 years later. You can also <a href=\"https://blog.roysolberg.com/stuff/sol/initial.htm\">open demo in full screen</a>.\n<input type=\"button\" value=\" < \" onclick=\"window.parent.frames[1].history.back()\"/> <input type=\"button\" value=\" > \" onclick=\"window.parent.frames[1].history.forward()\"/>\n<iframe style=\"margin: none;padding: none;border:1px solid #000;line-height: 0;\" src=\"https://blog.roysolberg.com/stuff/sol/initial.htm\" width=\"600\" height=\"600\" />\n\n<h4>First lines of HTML</h4>When I tried the demo disk I remember being curious about how those pages worked. I found the source code and from there I wrote my first lines of HTML. It was pretty cool to see how the markup was rendered in the browser from the floppy disk. Little did I know I would code web pages for a living 10 years later. :)\n\n<h4>References</h4>- <a href=\"https://www.nrk.no/trondelag/hun-lanserte-internett-i-norge-1.11078996\">– Folk syntes internett var for raringer</a>\n- <a href=\"http://www.oslo.net/historie/CW/utg/9510/cw951033.html\">\"Scandinavia online\" på lufta</a>\n",
        "images": [
            "/images/floppy01.jpg",
            "/images/floppy02.jpg"
        ],
        "category": {
            "title": "Internet archive",
            "url": "/internet-archive"
        },
        "tags": [
            {
                "title": "1990s",
                "url": "/security-monday"
            }
        ]
    },
    {
        "title": "Case #6: Who's looking at your pictures?",
        "published": true,
        "publishDate": "2017-09-18T05:25:00.000Z",
        "summary": "A campaign where you can upload your pictures is making a small version of them publicly available at a \"impossible to guess\" URL. It was possible to systematically retrieve all the images.",
        "niceUrl": "/2017/09/picture-leak",
        "text": "<h4>tl;dr</h4>A campaign web site from Norway's leading supplier of branded goods, where one could upload images - typically of your kid, and typically including their first name and year of birth - was, and still is, making a small 90 x 90 pixels image publicly available. It was possible to systematically retrieve the data.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"http://www.orklafoods.no/\">Orkla Food</a>'s <a href=\"http://kampanje.stabburetleverpostei.no\">campaign</a> by <a href=\"https://www.japanphoto.no/\">Japan Photo</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"green-text\">Low</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>August 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"orange-text\">Partially fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>A small version of the uploaded picture and often the given name and year of birth of the person in the picture is available publicly available</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4><img style=\"width:300px;float:left;margin-right:20px;\" title=\"Example of the image type that is publicly available.\" src=\"/images/leverpostei02.jpg\"/><i>Stabburet Leverpostei</i> is a kind of <a href=\"https://en.wikipedia.org/wiki/Liver_pâté\">liver pâté</a> that has been part of the diet for many Norwegians for generations. They have had a pretty iconic can with a picture of a kid on the front. At first they had the same kid from 1955 to 1970, but in more recent times they have been using the front as more of a marketing opportunity with competitions, campaigns and more a frequent change and use of several different faces.\n\nIn August 2017 I saw a TV commercial telling that <b>if you bought 3 cans of Stabburet Leverpostei you could upload your own picture and receive your own cover that you can use at home.</b>\n\nOf course this made me wonder if the images were securly stored.\n\n<h4>Approach (technical stuff)</h4><img style=\"width:439px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Image created by the campaign website.\" data-caption=\"Image created by the campaign website.\" src=\"/images/leverpostei01.png\"/>I went through the wizard for uploading images, getting the lid and buying other products at the same time as having <a href=\"https://developers.google.com/web/tools/chrome-devtools/\">Chrome DevTools</a> open. I looked for anything out of the ordinary and of course tried out different URLs with different IDs and input.\n\nWhat I saw was that every image uploaded got a <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier\">UUID</a> which was used when refering to the image in the different web pages.\n\nThey also had this share function where you share the lid that you had created to different social media. What this did was just refer to this UUID at some URL.\n\nThe sensible thing would be to make the image publicly available at some URL the moment the customer chose to share the image. As long as it is public, one should expect the image to be accessible to anyone knowing or guessing the URL.\n\n<b>The first problem was - and still is - that all images - shared or not - are publicly available if you just know the URL. For me this looks like quite a trend. Developers often assume that because a URL is hard to guess it should be considered private.</b> This spring we had some media coverage in Norway on how <a href=\"https://www.digi.no/artikler/16-mai-ble-det-full-kriseberedskap-i-evry-etter-datalekkasje-rotarsaken-kan-pavirke-alle-norske-selskaper/383149\">a change in the browser Microsoft Edge made Bing index a lot of URLs like these</a> (Norwegian text). Yes, the URLs might be hard to guess, but the problem is that the URL will always be valid, it will always be public, and you don't know who's accessing it.\n\nGoing through the checkout process I noticed that the URL for the final receipt - <a href=\"http://www.stabburetleverpostei.no/takk-for-din-lokkbestilling/\">http://www.stabburetleverpostei.no/takk-for-din-lokkbestilling/</a> - included the mentioned UUID. And, what's more, <b>the URL redirecting to that URL had the format <span class=\"code\">http://kampanje.stabburetleverpostei.no/checkout/finished/&lt;some auto incremental ID&gt;</span>. Iterating the ID made it possible to collect the UUIDs from seemingly all the orders (I only tried a few).</b>\n\nE.g., going to\n<a style=\"font-size:smaller;\" class=\"code\" href=\"http://kampanje.stabburetleverpostei.no/checkout/finished/2095270\">http://kampanje.stabburetleverpostei.no/checkout/finished/<b>2095270</b></a>\nwould redirect to \n<a style=\"font-size:smaller;\" class=\"code\" href=\"http://www.stabburetleverpostei.no/takk-for-din-lokkbestilling/?lokkid=0498600376a123f1530f1fed7083b350\">/takk-for-din-lokkbestilling/?lokkid=<b>0498600376a123f1530f1fed7083b350</b></a>\nwhich meant that the image could be seen at\n<a style=\"font-size:smaller;\" class=\"code\" href=\"http://kampanje.stabburetleverpostei.no/bestill/streamthumb/0498600376a123f1530f1fed7083b350\">/bestill/streamthumb/<b>0498600376a123f1530f1fed7083b350</b></a>.\n\n<h4>Security issues</h4>I found two issues in the campaign web site. One is now fixed, but the other persists:\n- <b>Fixed: One could iterate through the completed orders and get the URL of all images</b>\n- <b>Not fixed: Seemingly all images from the orders - even the ones not completed - are public (often including given name and year of birth)</b>\n\nThe fact that all images are publicly available is not mentioned in the terms of this campaign.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>At night I sent an e-mail to the contact address (for Eurofoto (owned by Japan Photo)) telling them about by my findings.\n\n<h5>Day 1</h5>Just before midnight I received an e-mail telling me that they have stopped adding the image UUID to the URL of the \"thank you\" page. That's a very impressive response time. It does, however, seem like all images still are publicly available.\n\n<h4>Why the low severity level?</h4>On one hand one could blow this up really big; a lot of pictures of kids with what's probably often their real given name and their year of birth. But, let's be real; in this case we are talking about <b>small</b> images; about 90 x 90 pixels are of the person itself (and then the rest is the rest of the can with the name, year and stuff).\n\nNow, this is <b>speculation</b>, but I wouldn't be surprised if the full size images are available on some other public URL. However, I did not find that. And looking at the image data being uploaded we're looking at a image size (of the person) as small as about 220 x 220 pixels. That is still a pretty low resolution.\n\nAlso, there is no connection between the images and data like full name or location.\n\n<h4>Conclusion</h4><b>You - as a consumer - should always assume that whatever kind of images or information that you are uploading or sending to some third party can end up in either the wrong hands or be publicly available.\n\nAll you developers: Please don't think that UUIDs makes data private. You still need authentication and authorization; and you still need to check that it's actually working.\n\nIf companies choose to store images like in this case, they should indeed mention that in the terms of the site. That is not the case here.</b> I also wish they would mention for how long they are storing the images.\n",
        "images": [
            "/images/leverpostei01.png",
            "/images/leverpostei02.jpg"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "UUID",
                "url": "/uuid"
            },
            {
                "title": "Images",
                "url": "/images"
            },
            {
                "title": "OWASP 2013 A4",
                "url": "/owasp-2013-a4"
            }
        ]
    },
    {
        "title": "Case #7: Fitness center chain was leaking personal info",
        "published": true,
        "publishDate": "2017-09-25T05:15:00.000Z",
        "summary": "Is your gym telling on you? It sure was telling on me and my fellow members. Everything from contact info to pictures to bank account numbers to the time people enter the gym was leaking for a long, long time.",
        "niceUrl": "/2017/09/gym-leak",
        "text": "<h4>tl;dr</h4>A fitness center chain consisting of three centers was leaking the members' names, e-mail addresses, phone numbers, pictures, bank account numbers, logs of all visits, etc. They are still running vulnerable server software.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"http://energi-trening.no\">Energi Treningssenter</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"red-text\">High</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>April 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"orange-text\">Partially fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>All kinds of personal info was leaked</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>Energi Treningssenter at Askøy is an excellent fitness center. It's modern, big and has all the equipment you want. I used to train there for a while, so I had - and still have - access to the member site where you see your personal details, payment history and full log of your visits.\n\n<b>Some years ago I noticed that the picture taken for the key card to the gym was publicly available. Just knowing the URL you could iterate through the images of all the members without having to be logged in.</b> I never bothered to report it back then. When I started considering this article series I remembered the issue with the pictures and wondered if my personal data was safe. The whole site had much of the feel as <a href=\"https://blog.roysolberg.com/2017/09/php-hack\">the completely vulnerable PHP site</a> I wrote about earlier on.\n\n<h4>Approach (technical stuff)</h4>I logged in to the gym's site while having <a href=\"https://en.wikipedia.org/wiki/Web_development_tools\">the browser development tools</a> open. I looked for anything out of the ordinary in the HTTP calls and in the source code.\n\n<h5>No encryption</h5>The first thing that hit me is that all URLs are <span class=\"code\">http</span> and not <span class=\"code\">https</span>. Even when submitting the form with username and password there is no encryption.\n\n<h5>The secrets of the source</h5><img style=\"width:480px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Source code from membership page\" data-caption=\"Source code from membership page\" src=\"/images/energi02.png\"/>I spotted three links to an <a href=\"https://en.wikipedia.org/wiki/Active_Server_Pages\">ASP</a> that was hidden with CSS: <span class=\"code\">display: none;</span>\n\nThe ASP looked like it let you change database fields for any user, but from failing to even change my own data I'm not sure what the deal was. However, this page was vulnerable for <a href=\"https://en.wikipedia.org/wiki/Cross-site_scripting\">XSS</a>. A good opportunity to steal the session cookie which seems to work perfectly fine across IP addresses. Or one could just let the user send his or her personal data directly.\n\nThe source also revealed the use of some kind of \"add on\" used for file upload. Is it possible to upload code that can be executed? I hope not. I wasn't able to make tell for sure, but there was indeed web forms for uploading all kinds of files.\n\n<h5>Known vulnerabilities</h5>There seems to be three different servers involved serving the site. Looking at the headers and the default error pages reveals outdated server software that have known vulnerabilities. However, <a href=\"/2017/08/security-vulnerability-disclosures\">as I've stated in the background for these posts</a>, that is out of scope for now.\n\n<h5>Plain text passwords</h5>When you log in you will be told if the username you entered exists or not. If you use the \"Forgot password\" function you're told if you're entering a known e-mail address or not. And the e-mail you receive is not for resetting the password, it just contains both the username and the password. Fail x 3.\n\n<h5>The lucky guess</h5><img style=\"width:480px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Full list of all visits of other members was available\" data-caption=\"Full list of all visits of other members was available\" src=\"/images/energi03.png\"/>The page with all the personal details doesn't have any IDs or anything, but that doesn't mean that I couldn't try adding it. I tried <span class=\"code\">account.asp?id=&lt;some ID&gt;</span>, and voilà, I got access to other users' personal details. The ID was an incremental integer. <b>Iterating the ID one could seemingly get everyone's name, e-mail address, phone number, bank account number, payment history and full visit log.</b>\n\n<h4>Security issues</h4><img style=\"width:480px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Membership page with another member's data\" data-caption=\"Membership page with another member's data\" src=\"/images/energi01.png\"/>A lot of personal data of previous and current members was leaked:\n- Customer number (also used as username)\n- <b>Full name</b>\n- <b>E-mail address</b>\n- <b>Phone number</b>\n- <b>Bank account number</b>\n- <b>Picture</b>\n- Not fixed: <b>Log of all visits</b>\n- Full payment history\n\nIn addition there are quite a few issues that's probably still making the customer data vulnerable:\n - Not fixed: There's no encryption - not even when logging in\n - Not fixed: Passwords are stored in plain text\n - Not fixed: \"Forgot password\" e-mail contains both username and password\n - Not fixed: Cross Site Scripting\n - Not fixed: Old application server with known vulnerabilities\n - Not fixed: Old ASP.NET version with known vulnerabilities\n\nI believe that these issues have been around for many years.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>At night I sent an e-mail telling about the information leak and general concerns about the solution.\n\nJust 1,5 hour later I got a reply telling that the issue was forwarded to the right body.\n\n<h5>Day 22</h5>I received an e-mail telling that the vendor of the system had fixed the issue. <b>I see that they have removed the issue with the information leak, but everything else still is the same.</b>\n\n<h4>Conclusion</h4>This is yet another example of our personal data in the wild. There are countless security vulnerabilities out there. You should assume that anyone who wants to, knows everything about you and everything you do. <b>And companies that have these types of vulnerabilities won't tell you when they become aware of them.</b>\n\nAnd to start connecting the dots between the cases I'm representing; <b>do you remember two weeks ago where you could <a href=\"/2017/09/skandiabanken-leak\">see the bank account balance using just the bank account number</a>? Well, wasn't it nice that this case gave you that bank account number?</b>\n\n<b>Looking at the old versions of the software running on these sites I would definitely guess that the data is still vulnerable.</b>\n",
        "images": [
            "/images/energi01.png",
            "/images/energi02.png",
            "/images/energi03.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "XSS",
                "url": "/xss"
            },
            {
                "title": "ASP.NET",
                "url": "/asp-net"
            },
            {
                "title": "Images",
                "url": "/images"
            },
            {
                "title": "OWASP 2013 A3",
                "url": "/owasp-2013-a3"
            },
            {
                "title": "OWASP 2013 A7",
                "url": "/owasp-2013-a7"
            }
        ]
    },
    {
        "title": "Case #8: SQL injection vulnerable for 10 years",
        "published": true,
        "publishDate": "2017-10-02T04:55:00.000Z",
        "updateDate": "2017-10-02T07:05:00.000Z",
        "summary": "A company offering an online project and customer relationship management system had a very easy-to-spot SQL injection vulnerability for 10 years or more.",
        "niceUrl": "/2017/10/10-years-of-injection",
        "text": "<h4>tl;dr</h4>A Norwegian company with a centralized online project management tool had an SQL injection vulnerability for at least 10 years.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td>Anonymous, let's call them <a href=\"https://en.wikipedia.org/wiki/Fictional_company\">Acme3</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"red-text\">Critical</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>Summer 2017 (and possibly 2007)</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"red-text\">Poor</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"orange-text\">Who knows..</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>SQL injection affecting all customers</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>In 2007 I was working for a company that started using a <a href=\"https://en.wikipedia.org/wiki/Software_as_a_service\">SaaS</a> project tool and, more or less, a complete CRM. As a software developer I personally used it for time-tracking for the projects and customers I was working with.\n\n<b>It was a very poor tool for time-tracking (as most time-tracking tools are even today), but that was soon to be overshadowed when I noticed that the URLs contained <a href=\"https://en.wikipedia.org/wiki/SQL\">SQL</a>. Not only did the service leak data, it was possible to alter data. Not only was this possible within our own company, but this was across all of the service's customers.</b>\n\nI of course told about this to my boss. <b>To emphasize the problem I changed my boss' name to be surrounded by the infamous <a href=\"https://en.wikipedia.org/wiki/Blink_element\">&lt;blink/&gt; tag</a> to make it constantly blink while he was logged in.</b>\n\nI also prepared an article for the great \"software engineering disaster blog\" <a href=\"https://thedailywtf.com/\">The Daily WTF</a> which I read daily back then. However, I changed jobs in 2007 and soon forgot all about the article, the security hole and Acme3.\n\nPreparing my blog I looked back at some old issues I had screenshot and made notes from and of course found this one. <b>Checking out their online demo I saw that they still had the SQL injection issue. 10 years later.</b> Seeing the old screenshots that says \"Copyright 2000\" one can wonder how many their customers who have been affected by this.\n\n<h4>Approach (technical stuff)</h4>You don't need very heavy measures to find any issues when you find out that the URLs of a site actually uses SQL. The URLs were \"concealed\" because of the site using <a href=\"https://en.wikipedia.org/wiki/Framing_(World_Wide_Web)\">frames</a>. I had a look at their JavaScript and noticed that it built SQL queries which was used as URL parameters.\n\nThe URLs looked like this: <pre class=\"prettyprint lang-html\">http://example.com/lookup.asp\n?title=Employees&list=0&headers=Employee+Id;First+name;Last+name\n&select=SELECT+EMPLOYEE_ID,FIRST_NAME,LAST_NAME+FROM+EMPLOYEES\n&goURL=someother.asp&key=EmployeeID&projID=&where=&order=3&records=all</pre>\nIt can't really get much worse than this.\n\n<b>So from here one could change the query to e.g. include the password.</b> It's hard to believe, but it does actually look like they have some <a href=\"https://en.wikipedia.org/wiki/Salt_(cryptography)\">salt</a> in the password hashes. <b>But that doesn't matter much as it was possible to run <span class=\"code\">UPDATE</span> statements using the URL.</b>\n\nMy favorite changes I did was in the line of these:\n<pre class=\"prettyprint lang-html\">http://example.com/lookup.asp?headers=version\n&select=<b>UPDATE+EMPLOYEES+SET+FIRST_NAME='&lt;blink&gt;<blink>John+Boss</blink>&lt;/blink&gt;'</b>\n+WHERE+USER_ID='myboss';SELECT+@@VERSION,@@VERSION+AS+ver&order=ver</pre><pre class=\"prettyprint lang-html\">http://example.com/lookup.asp?headers=version\n&select=<b>UPDATE+EMPLOYEES+SET+FIRST_NAME='John+&quot;I+better+report+these+security+issues+to+Acme3+soon&quot;+Boss'</b>\n+WHERE+USER_ID='myboss';SELECT+@@VERSION,@@VERSION+AS+ver&order=ver</pre>\n<b>But what was even more worrying was that each company had a different database in the same database server, and it was possible to do queries across databases.</b> I never tried altering data for other companies, but gaining read access is bad enough. The database user seemed to have access to all kinds of databases and system tables.\n\n<h4>Security issues</h4>Depending on how a company was using the service it was possible for anyone to get access to the following information:\n- <b>Employees' names, usernames, position, password hashes, addresses, phone numbers, e-mail addresses, pictures, payrolls</b>\n- <b>All kinds of info about companies' projects</b>\n- <b>Customers of the company</b>\n- <b>Outoing invoices</b>\n- <b>Budgets</b>\n- <b>Accounting</b>\n- Timesheets\n- And everything else you would expect from a borderline project tool/CRM\n\nFrom the look of it was possible to alter any data as well.\n\n<h4>Reception and handling</h4><h5>Day zero 2017</h5>The company was non-existing in social media etc. I never managed to find any e-mail addresses. But <b>they had a contact form on their website which I used to tell them about this.</b> The only problem was that the form doesn't work at all in some browsers and doesn't give any feedback if it's been successfully submitted in the rest of the browsers.\n\n<b>I got no response.</b>\n\n<h5>Day 14ish</h5><b>I tried the contact form once again just asking if the form was working at all. I never got an answer.</b>\n\n<h5>Day 21ish</h5><b>Suddenly one night there was someone online on a chat on their site.</b> I filled in my name and asked if the contact form on their site worked. The guy just replied <i>\"We saw your \"security\" report\"</i>. What? Why haven't they contacted me? He went on telling that the issue is fixed now. They <i>\"had a round of security this summer\"</i>. Then he told me to say if I saw anything else, gave me a short \"thank you\" and finished <i>\"night\"</i>.\n\nI'm not sure if the conversation was directly unfriendly, but it sure wasn't friendly. And it makes me think that this isn't serious people. Though, at least now I knew the issue was reported and they claimed to have fixed it. I don't want to check.\n\n<h4>Anonymous you say?</h4>This is a bit of a special case going back so many years. Did they receive any reports 10 years ago at all? It would be easier to name them if I was able to communicate with them. The not-so-friendly support chat gave me some bad vibes, and I haven't been able to find out much about the company or the people behind it.\n\nFrom public financial information I see that they have had 1-2 million USD in annual revenue the last 10 years. As far as I can understand they don't have any other products, so they should have quite a few customers using this service.\n\n<h4>Conclusion</h4>From time to time there are news articles about <a href=\"https://en.wikipedia.org/wiki/Industrial_espionage\">industrial espionage</a>. Companies like Acme3 sure makes it easy to those looking for data.\n\n<b>Are you working in one of the companies using this system? Maybe you should use an expert to take a quick look at the systems where your company stores information you don't want to be leaked or even altered.</b>\n\n<b>Is it possible that an issue like this was existing for ten years without no one taking advantage of it? That's hard to believe.</b>\n",
        "images": [],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "XSS",
                "url": "/xss"
            },
            {
                "title": "ASP.NET",
                "url": "/asp-net"
            },
            {
                "title": "Microsoft SQL Server",
                "url": "/mssql"
            },
            {
                "title": "Data alteration",
                "url": "/data-alteration"
            },
            {
                "title": "OWASP 2013 A1",
                "url": "/owasp-2013-a1"
            },
            {
                "title": "OWASP 2013 A3",
                "url": "/owasp-2013-a3"
            }
        ]
    },
    {
        "title": "DOM II: JavaScript Hell",
        "published": true,
        "publishDate": "2017-10-05T19:30:00.000Z",
        "summary": "Have some fun destroying websites using my bookmarklet.",
        "niceUrl": "/2017/10/dom2-bookmarklet",
        "text": "<h4>Bookmarklet</h4><p style=\"text-align:center;\"><a onclick=\"ga('send','event','game','play','dom2',2);return true;\" href=\"javascript:var%20s=document.createElement('script');s.type='text/javascript';s.onerror=function(e){alert('Failed%20to%20load%20the%20script.%20The%20site\\'s%20Content%20Security%20Policy%20might%20be%20blocking%20it.%20Feel%20free%20to%20try%20again.');};document.body.appendChild(s);s.src='https://blog.roysolberg.com/js/dom2.min.js';void(0);\" class=\"waves-effect waves-light btn-large\">DOM II: JavaScript Hell</a></p>\n<b>Just click the button to play the game on this page.</b>\n\n<b>To try it on other pages, just drag the button to your bookmark row in your browser.</b> After that you can just click the bookmark when visiting other sites.\n\n<h4>What's a bookmarklet?</h4>A <a href=\"https://en.wikipedia.org/wiki/Bookmarklet\">bookmarklet</a> is a bookmark stored in a web browser that contains JavaScript commands that add new features to the browser. Bookmarklets can be useful tools, e.g. for increasing the readability of web pages, do searches, create short urls, etc.\n\n<a onclick=\"ga('send','event','game','play','dom2',3);return true;\" href=\"javascript:var%20s=document.createElement('script');s.type='text/javascript';s.onerror=function(e){alert('Failed%20to%20load%20the%20script.%20The%20site\\'s%20Content%20Security%20Policy%20might%20be%20blocking%20it.%20Feel%20free%20to%20try%20again.');};document.body.appendChild(s);s.src='https://blog.roysolberg.com/js/dom2.min.js';void(0);\">DOM II: JavaScript Hell</a> might not be very useful, but hopefully it's an enjoyable small game if you're bored or if you're disliking a web site. :)\n\n<h4>Inspiration</h4>I never forgot about the similar <a href=\"https://github.com/erkie/erkie.github.com\">bookmarklet created by Erik Rothoff Andersson</a> in 2010. I wanted to create something like that, but with my own code and my own twists and also have mobile support.\n\nOh, and the name? Since this game is all about <a href=\"https://en.wikipedia.org/wiki/Document_Object_Model\">DOM</a> manipulation I figured that the name would be a nice play-on-words and tribute to Doom and more specifically <a href=\"https://en.wikipedia.org/wiki/Doom_II:_Hell_on_Earth\">Doom II: Hell on Earth</a>.\n\n<h4>Security</h4>As <a href=\"/category/security\">I write a bit about security</a> I think it's natural to give you a word of warning when it comes to bookmarklets. My bookmarklet is safe to use, but you shouldn't take my word for it. You should never run bookmarklets on pages that have private information stored on it. Luckily, today online banks etc. uses a <a href=\"https://en.wikipedia.org/wiki/Content_Security_Policy\">Content Security Policy</a> that will stop bookmarklets to be run on their page. Otherwise one would risk e.g. financial or private information getting in the wrong hands.\n\n<h4>Feedback</h4>Please leave a comment or send me an e-mail if you see any bugs or have have any suggestions for the game. My guess is that there will be quite a few mobile devices having the some odd values reported from the gyroscope.\n",
        "images": [],
        "links": [],
        "category": {
            "title": "Software development",
            "url": "/software-development"
        },
        "tags": [
            {
                "title": "JavaScript",
                "url": "/javascript"
            },
            {
                "title": "Bookmarklet",
                "url": "/bookmarklet"
            },
            {
                "title": "Game",
                "url": "/game"
            }
        ]
    },
    {
        "title": "Case #9: IKEA is telling your name to everyone on the Internet",
        "published": true,
        "publishDate": "2017-10-09T05:35:00.000Z",
        "summary": "Ever been logged in at ikea.com? Then there's a chance you don't surf very anonymously.",
        "niceUrl": "/2017/10/ikea-name-leak",
        "text": "<h4>tl;dr</h4>ikea.com stores logged-in users' names in a cookie that is sent unencrypted over http. They also had an XSS vulnerability that made it easy to get hold of the name.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"http://ikea.com\">IKEA</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"green-text\">Low</span> to <span class=\"orange-text\">medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>August 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"red-text\">Poor</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"orange-text\">Partially fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Cookie with full name sent over HTTP and XSS to get hold of it.</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>I have both ordered stuff online at ikea.com and also designed kitchen and walk-in warderobe using their planners. That means that I have an online account there.\n\nI have always liked IKEA. Lots of cheap furnitures and other products, and mostly good value for the money. Even though they figured out warehouses a long time ago I have bad experiences with their online store. They didn't deliver the products on the estimated dates, they didn't deliver the right amount of stuff and they were unable to deliver the whole order, making me stuck with stuff I had to store and couldn't start to assemble.\n\n<h4>Approach (technical stuff)</h4>I browsed ikea.com while having the <a href=\"https://en.wikipedia.org/wiki/Web_development_tools\">browser development tools</a> open.\n\n<h5>Cookie with name and location</h5>Looking at the site's cookies I noticed that some of the values clearly was <a href=\"https://en.wikipedia.org/wiki/Base64\">Base64 encoded</a>. They store so many cookies that there might be some more hidden treasures, but I decoded a few and found that my full name and selected IKEA warehouse was stored in one of them. Also there was one without any encoding with my postal code and place.\n\nUsing a script like the following is a quick and dirty way of getting the cookie names and values (though some have parts of the values as BASE64 encoded):\n<pre class=\"prettyprint lang-js\">document.cookie.split(';').forEach(\n    function(cookie){\n        var parts = cookie.split('=',2);\n        console.log(\n            parts[0] + ' = '\n             + decodeURIComponent(\n                 function(parts){\n                    try{\n                        return parts[1] + ' / '\n                        + atob(parts[1]);\n                    }catch(e){\n                        return parts[1];\n                    }\n                }(parts)));\n    }\n);</pre>\n<a class=\"code\" href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent\">decodeURIComponent()</a> is used for decoding the URL encoded values.\n<a class=\"code\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/atob\">atob()</a> is used for decoding the Base64 encoded values.\n\n<img style=\"float:left;width:450px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Some of the many cookies on ikea.com. The one called 'user_info_16' contains the user's name and is not flagged as HttpOnly or Secure.\" data-caption=\"Some of the many cookies on ikea.com. The one called 'user_info_16' contains the user's name and is not flagged as HttpOnly or Secure.\" src=\"/images/ikea01.png\">ikea.com is served both with and without SSL. The cookies containing name and location is not flagged with either <a class=\"code\" href=\"https://en.wikipedia.org/wiki/HTTP_cookie#HttpOnly_cookie\">HttpOnly</a> or <a class=\"code\" href=\"https://en.wikipedia.org/wiki/HTTP_cookie#Secure_cookie\">Secure</a>. That means two things; your name is sent unencrypted over the Internet if you type in <span class=\"code\">ikea.com</span> in your browser, and the cookie can be stolen via <a href=\"https://en.wikipedia.org/wiki/Cross-site_scripting\">XSS</a>.\n\n<h5>XSS</h5>I didn't find any XSS vulnerabilities, but a quick Google search led me to <a href=\"https://www.openbugbounty.org/search/?search=ikea.com&type=host\">https://www.openbugbounty.org/search/?search=ikea.com&type=host</a> telling about several possibilities for XSS.\n\nThere's nothing like a proper \"proof of concept\" when reporting a bug or security issue, so I created a small JavaScript for fetching a user's name:\n<pre class=\"prettyprint lang-js\">var index;\nvar key = 'user_info_16=';\nindex = document.cookie.indexOf(key);\nif (index === -1) {\n    alert('You have not visited ikea.com, have you?');\n} else {\n    var temp = document.cookie.substring(index + key.length);\n    temp = temp.substring(0, temp.indexOf(';'));\n    if (temp === 'notloggedin') {\n        alert('You are not logged in, are you?');\n    } else {\n        temp = atob(temp);\n        temp = decodeURIComponent(temp);\n        temp = temp.split(';');\n        alert('Is your name ' + temp[0] + ' ' + temp[1] + '?');\n    }\n}</pre>\nThe script searches for the <span class=\"code\">user_info_16</span> cookie, decodes the Base64 encoding and extracts the user's name and presents it in a dialog.\n\nRemoving the line breaks, URL encoding and appending it to the URL with the XSS vulnerability left me with the URL <a href=\"http://www.ikea.com/no/no/catalog/categories/departments/bedroom/tools/cobe/roomset/20161_cosl01a/%252Fpl%252Fpl%252Fcatalog%252Fcategories%252Fdepartments%252Fbedroom%252Ftools%252Fcobe%252Froomset%252F20161_cosl01a%253Fcid%253Dpl%25253Eot%25253Egoogle_plus%25253Eikea_share/u0026gsrc/u003d3p/u0026ic/u003d1/u0026jsh/u003dm;/_/scs/apps-static/_/js/k%3Doz.gapi.da.V3wBH64AFtA.O/m%3D__features__/am%3DAQ/rt%3Dj/d%3D1/rs%3DAGLTcCPcFVjcjQUijyKE8VUwPY2wbCZTVAp76e5%2522%253e%253cimg%2520src%253Da%2520onerror%253D%2522var%2520index%253Bvar%2520key%253D%2527user_info_16%253D%2527%253Bindex%253Ddocument.cookie.indexOf(key)%253Bif(index%253D%253D%253D-1)%257Balert(%2527You%2520have%2520not%2520visited%2520ikea.com%252C%2520have%2520you%253F%2527)%253B%257Delse%257Bvar%2520temp%253Ddocument.cookie.substring(index%252Bkey.length)%253Btemp%253Dtemp.substring(0%252Ctemp.indexOf(%2527%253B%2527))%253Bif(temp%253D%253D%253D%2527notloggedin%2527)%257Balert(%2527You%2520are%2520not%2520logged%2520in%252C%2520are%2520you%253F%2527)%253B%257Delse%257Btemp%253Datob(temp)%253Btemp%253DdecodeURIComponent%2520(temp)%253Btemp%253Dtemp.split(%2527%253B%2527)%253Balert(%2527Is%2520your%2520name%2520%2527%252Btemp%255B0%255D%252B%2527%2520%2527%252Btemp%255B1%255D%252B%2527%253F%2527)%253B%257D%257D%2522%253E%252F\">http://www.ikea.com/no/no/catalog/categories/departments/bedroom/tools/cobe/roomset/20161_cosl01a/%252Fpl%252Fpl%252Fcatalog%252Fcategories%252Fdepartments%252Fbedroom%252Ftools%252Fcobe%252Froomset%252F20161_cosl01a%253Fcid%253Dpl%25253Eot%25253Egoogle_plus%25253Eikea_share/u0026gsrc/u003d3p/u0026ic/u003d1/u0026jsh/u003dm;/_/scs/apps-static/_/js/k%3Doz.gapi.da.V3wBH64AFtA.O/m%3D__features__/am%3DAQ/rt%3Dj/d%3D1/rs%3DAGLTcCPcFVjcjQUijyKE8VUwPY2wbCZTVAp76e5%2522%253e%253cimg%2520src%253Da%2520onerror%253D%2522var%2520index%253Bvar%2520key%253D%2527user_info_16%253D%2527%253Bindex%253Ddocument.cookie.indexOf(key)%253Bif(index%253D%253D%253D-1)%257Balert(%2527You%2520have%2520not%2520visited%2520ikea.com%252C%2520have%2520you%253F%2527)%253B%257Delse%257Bvar%2520temp%253Ddocument.cookie.substring(index%252Bkey.length)%253Btemp%253Dtemp.substring(0%252Ctemp.indexOf(%2527%253B%2527))%253Bif(temp%253D%253D%253D%2527notloggedin%2527)%257Balert(%2527You%2520are%2520not%2520logged%2520in%252C%2520are%2520you%253F%2527)%253B%257Delse%257Btemp%253Datob(temp)%253Btemp%253DdecodeURIComponent%2520(temp)%253Btemp%253Dtemp.split(%2527%253B%2527)%253Balert(%2527Is%2520your%2520name%2520%2527%252Btemp%255B0%255D%252B%2527%2520%2527%252Btemp%255B1%255D%252B%2527%253F%2527)%253B%257D%257D%2522%253E%252F</a>.\n\nNow, browsers today often have often implemented some sort of XSS auditor to protect the user, so the above script didn't work out of the box with browsers built on later versions of <a href=\"https://en.wikipedia.org/wiki/Chromium_(web_browser)\">Chromium</a>. So to use this in an attack one would probably have to some browser-depended adjustments. Using an <a href=\"https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet\">XSS Filter Evasion Cheat Sheet</a> will probably always find a vulnerability for any browser brand and version.\n\n<img style=\"float:left;width:450px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"The cross-site scripting and cookie vulnerability in action.\" data-caption=\"The cross-site scripting and cookie vulnerability in action.\" src=\"/images/ikea02.png\">The URL worked just fine in the latest version of Firefox, as seen in the screenshot.\n\n<h4>Security issues</h4>The three issues in question were these:\n- <b>Logged-in users' full name is sent unencrypted over the Internet</b> (not fixed)\n- <b>User's location used for calculating postage is sent unencrypted over the Internet</b> (not fixed)\n- <b>It was possible for any website to retrieve your name</b> (fixed (at least for the URL reported))\n\n<h4>Reception and handling</h4><h5>Day zero 2017</h5><b>I searched and searched to find some sort of contact point that wasn't the regular customer service phone. I failed. But I found a list of press contacts and tried the first one. I never got an answer.</b>\n\n<h5>Day 5</h5><b>I sent an e-mail to the second press contact with the first one on copy. I never got an answer.</b>\n\n<h5>Day 18</h5><b>I sent an e-mail to the third press contact with the two first ones on copy. I also mentioned that I was now going to give up.</b>\n\n<h5>Day 19</h5>I didn't hear back from any of the press contacts directly, but I did receive an e-mail from an \"mCommerce Specialist\" asking for details. I wrote back with the technical details. <b>It took me 19 days to be able to give details about the issues.</b>\n\nI got a reply the same day saying that they were going to look into this. <b>They also said that reports like this should go through their press center. It would be nice if they would write this somewhere on their website, and that the press contacts actually responded.</b>\n\n<h5>Day 59</h5>I asked if they were actually going to do something about this, if I should wait to write about these issues.\n\n<h5>Day 61</h5><b>I got a longer good answer explaining more about the challenges and timeline. They are working on it, but it probably won't be fixed anytime soon.</b>\n\n<h4>Conclusion</h4>As mentioned before, you should assume that anyone who wants to, knows everything about you and everything you do. Even when you think you are anonymous you might not be just that.\n\nIf you are concerned about privacy you want to both log out of sites and delete the cache.\n\nI also hope that we'll soon see most websites switch to secure communications only and leave http behind.\n",
        "images": [
            "/images/ikea01.png",
            "/images/ikea02.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "XSS",
                "url": "/xss"
            },
            {
                "title": "OWASP 2013 A3",
                "url": "/owasp-2013-a3"
            }
        ]
    },
    {
        "title": "Case #10: Your memories aren't safe",
        "published": true,
        "publishDate": "2017-10-16T05:30:00.000Z",
        "summary": "A digital memory book and social platform for people with special needs was found to be open for anyone to read, change and delete its users' content.",
        "niceUrl": "/2017/10/hackable-digital-memory-book",
        "text": "<h4>tl;dr</h4><i>Memoria</i> - a digital memory book and social platform for persons in care - had a webapp with vulnerabilities for reading, changing and deleting others' messages and pictures.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"http://minmemoria.no/\">Memoria</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"red-text\">High</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>August 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Users could read, alter and delete other users contents.</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>Watching the TV one night in August there was this <a href=\"http://minmemoria.no/wp-content/uploads/2017/05/Memoria-TV2-nyhetene.mp4\">news story on TV 2</a> about a digitial memory book and social platform for communication between families, healthcare professionals and users of care services. A great idea and it seemed like a pretty good product. Of course, I wondered if their security was in order. I mean, this is a site with a lot of personal stuff, like messages, pictures and personal stories.\n\n<h4>Approach (technical stuff)</h4>I created a profile and surfed around the site while having my <a href=\"https://en.wikipedia.org/wiki/Web_development_tools\">browser development tools</a> open. The site is running the good old <a href=\"https://angularjs.org/\">Angular 1.X</a> with a lot of Ajax calls transfering JSON with data.\n\nThe pages would be of the style <span class=\"code\">https://app.minmemoria.no/#/patients/&lt;some patient ID&gt;/albums</span>. So what would be the URL be for some kind of administrator page?\n\nI guessed <span class=\"code\">https://app.minmemoria.no/#/<b>admin</b></span> and was right. While there was some kind of authorization check I got partial access. I could e.g. see all the institutions in the system, and <b>was able to create my own new institution</b>. I did not try to delete any, but I wouldn't be surprised if that was possible..\n\nMany of the URLs had some kind of ID, so I of course tried changing them seeing if I could get hold of other people's data. But the ID wasn't your regular incremental integer, so I had to create another account and see what kind of IDs that got. Now I was logged in with one user in Chrome and one user in Vivaldi. I'm still not sure what the system for the IDs is, but it is a big number that changes quite a bit from one entry to another. It doesn't seem to be a timestamp with milliseconds or seconds, but it doesn't change more than you would be able to guess or brute force other peoples IDs.\n\nIn general there seemed to be proper authorization checks when the URL contained one ID - just like the first one mentioned. However, there were quite a few URL of the format <span class=\"code\">https://app.minmemoria.no/#/patients/&lt;some patient ID&gt;/&lt;some entity type&gt;/&lt;some entity ID&gt;</span>, and at least in some cases <b>there was no check if the logged in user was allowed to access that entity ID</b>.\n\nFor example <b>I could read other persons' stories</b> using the URL <span class=\"code\">https://app.minmemoria.no/#/patients/&lt;a patient I had access to&gt;/stories/&lt;some other patient's story ID&gt;</span>.\n\n<img style=\"float:left;width:450px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"It was possible to read and change other persons' stories.\" data-caption=\"It was possible to read and change other persons' stories.\" src=\"/images/memoria01.png\">This type of failing authentication check was the same for <span class=\"code\">PUT</span> and <span class=\"code\">DELETE</span> calls. So <b>I was able to change other persons' stories and delete other persons' pictures</b>. (As mentioned, I created several users and patients so I only accessed and altered contents between these accounts.)\n\nThe <a href=\"https://curl.haxx.se/\">Curl</a> command copied from Chrome for changing others' messages looked like this:<pre class=\"prettyprint\">\ncurl 'https://app.minmemoria.no/api/personas/&lt;a patient I had access to&gt;/events/&lt;message ID&gt;' \\\n    -X PUT \\\n    -H 'Origin: https://app.minmemoria.no' \\\n    -H 'Accept-Encoding: gzip, deflate, br' \\\n    -H 'x-request-id: &lt;some UUID&gt;' \\\n    -H 'Accept-Language: nb-NO,nb;q=0.8,no;q=0.6,nn;q=0.4,en-US;q=0.2,en;q=0.2' \\\n    -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36' \\\n    -H 'Content-Type: application/json;charset=UTF-8' \\\n    -H 'Accept: application/json, text/plain, */*' \\\n    -H 'Referer: https://app.minmemoria.no/' \\\n    -H 'Cookie: &lt;session cookie++&gt;' \\\n    -H 'Connection: keep-alive' \\\n    -H 'x-service-version: 1.0' \\\n    --data-binary '{\"articleBody\":\"My altered message\"}' \\\n    --compressed</pre>\nThe Curl command for deleting others' pictures looked like this:<pre class=\"prettyprint\">\ncurl 'https://app.minmemoria.no/api/personas/&lt;a patient I had access to&gt;/folders/&lt;folder ID&gt;/assets/&lt;picture ID&gt;' \\\n    -X DELETE \\\n    -H 'Origin: https://app.minmemoria.no' \\\n    -H 'Accept-Encoding: gzip, deflate, br' \\\n    -H 'x-request-id: &lt;some UUID&gt;' \\\n    -H 'Accept-Language: nb-NO,nb;q=0.8,no;q=0.6,nn;q=0.4,en-US;q=0.2,en;q=0.2' \\\n    -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36' \\\n    -H 'Accept: application/json, text/plain, */*' \\\n    -H 'Referer: https://app.minmemoria.no/' \\\n    -H 'Cookie: &lt;session cookie++&gt;' \\\n    -H 'Connection: keep-alive' \\\n    -H 'x-service-version: 1.0' \\\n    --compressed</pre>\nI feel pretty sure there was more problems than these, but I had found more than enough to report.\n\n<h4>Security issues</h4>The issues I saw while doing a quick test of the site:\n- <b>Any user could create an institution via the admin pages</b>\n- <b>Any user could read any patients' stories</b>\n- <b>Any user could change any patients' messages</b>\n- <b>Any user could delete any patients' pictures</b>\n\nSurely there were other issues here as well. I stopped checking for more when I found these.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>At night, I sent an e-mail to their contact e-mail address.\n\n<h5>Day 1</h5>Just after lunch I received an e-mail thanking for the discovery and telling that they've reported it to the developers.\n\n<b>I never received any more replies, so I don't know when they fixed it.</b>\n\n<h5>Day 49</h5>I sent a new e-mail asking what the status was.\n\n<h5>Day 50</h5>I got an answer telling that they had fixed the issues.\n\n<h4>Conclusion</h4>Privacy of any social media platform is so important. It's so easy to create web sites today, but it's still hard to make them properly secure.\n\nHowever, in this case there seems to be a big lack of understanding how to - and/or desire to - secure web apps. Memoria doesn't appear very concerned about security when they had issues like these. I wish they would show more respect for the care service users and their families. I hope they'll use some third party for security audits in the future.\n",
        "images": [
            "/images/memoria01.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Data alteration",
                "url": "/data-alteration"
            },
            {
                "title": "Authorization",
                "url": "/authorization"
            },
            {
                "title": "OWASP 2013 A7",
                "url": "/owasp-2013-a7"
            }
        ]
    },
    {
        "title": "Case #11: Tracking tens of thousands of kids worldwide",
        "published": true,
        "hot": true,
        "publishDate": "2017-10-18T12:55:00.000Z",
        "updateDate": "2018-03-30T07:30:00.000Z",
        "summary": "Tens of thousands - possibly several hundred thousands - of kids can be tracked via their Gator and Caref watches.",
        "niceUrl": "/2017/10/tracking-kids",
        "text": "<h4>tl;dr</h4><i>Gator Watch</i> - a GPS watch for kids - is leaking data in all ends and anyone on the Internet can live track your kid. We're not talking about a security vulnerability, we're talking about non-existing security.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"http://gatorwatch.com/\">Gator Watch</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"red-text\">Critical</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>August 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"red-text\">Poor</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"red-text\">Not fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Anyone can track any watch, listen to voice messages, fake location, etc. etc.</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"gatorwatch.com claimed to have sold 300,000 watches before releasing their more secure Gator 3.\" data-caption=\"gatorwatch.com claimed to have sold 300,000 watches before releasing their more secure Gator 3.\" src=\"/images/gator01.png\"/>I bought a Gator 2 smartwatch for my kid after reading some reviews about different watches. The concept was pretty good, but how good was the security?\n\n<b>The company behind Gator Watch claims to have sold more than 300,000 watches. As far as I can understand they are all trackable for anyone on the Internet.</b>\n\nI reported the issue in the start of August and was giving the vendor 90 days to fix the issues, so I was planning to publish this post in the start of November, but suddenly this case was all over the news.\n\nThe Gator watch is some places branded as Caref GPS Phone Watch. I'm not entirely sure if this is the same as the Gator 1 watch or if it's also Gator 2.\n\n<h4>Approach (technical stuff)</h4>Looking back at this issue I really started in the wrong end. The biggest issues was so easy to spot without being very technical.\n\n<h5>Watch to server communication</h5>Playing with the watch and the config I saw that <a href=\"http://gatorwatch.com/support/\">it's possible to set up which server the watch connects to.</a>.\n\nFirst I tried connecting to the Gator Watch server via <span class=\"code\">telnet</span> trying to send HTTP commands. That failed, and I tried a couple of other commands, but the remote server just closed the connection on me.\n\nThen I set it up to my own router's IP address, added a port forwarding to my machine where I was running a very simple Python script printing whatever came my way. <b>I configured the watch to use my IP, and surely it started sending simple strings with stuff like IMEI, positions, battery level, etc. It kept the connection open. The connection was not encrypted and there was no type of session ID or token or anything. It always used the IMEI as the identifier. This was pretty shocking.</b>\n\nThe quick-and-dirty Python script I hacked together to listen to the watch:\n<pre class=\"prettyprint lang-python\">#!/usr/bin/env python\nimport socket\n\nTCP_IP = '0.0.0.0'\nTCP_PORT = 17015\nBUFFER_SIZE = 20\n\ns = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\ns.bind((TCP_IP, TCP_PORT))\ns.listen(1)\n\nconn = None\ntry:\n    conn, addr = s.accept()\n    print 'Connection address:', addr\n    while 1:\n        data = conn.recv(BUFFER_SIZE)\n        if not data: break\n        print \"received data:\", data\n        #conn.send(data)  # echo\nexcept KeyboardInterrupt:\n    print '\\nBye bye :)'\nfinally:\n    if conn is not None:\n        conn.close()\n    if s is not None:\n        s.close()</pre>\nI sent some of the commands I got to the Gator Watch server via <span class=\"code\">telnet</span>, and now it kept the connection open. <b>This way one can easily spoof the position of anyone as long as you have the IMEI.</b>\n\nHere's some of the data received from our watch to my fake server (I've randomized the data and removed some newlines):\n<pre class=\"prettyprint lang-python\">received data: (45353IMEIHERE416P02,GT03.V10.20170303,7,23201)\n\nreceived data: (45353IMEIHERE416P02,G,160805A6027.0330N00512.3931E000.41058310.00,6)\n\nreceived data: (45353IMEIHERE416P02,G,160805A6027.0352N00512.3879E001.411000074.23,6)\n\nreceived data: (45353IMEIHERE416P02,0,1,160805,220200,5)\n\nreceived data: (45353IMEIHERE416P02,0,1,160805,220200,5)</pre>\n<b>The data contains the software version, IMEI, time, location method (GPS vs Wi-Fi), location coordinates, battery left.</b>\n\n<b>Sending the data to thet server you can get back who is allowed to call the watch. Like <span class=\"code\">#555-2368#Dad</span>. So that makes it pretty easy to identify the family of the child.</b>\n\n<h5>HTTP proxy</h5><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Using Charles to intercept the communication between Gator Android app and server.\" data-caption=\"Using Charles to intercept the communication between Gator Android app and server.\" src=\"/images/gator02.png\"/><a href=\"/2017/08/get-your-ssn-here\">Just as in my first case</a> I set up Charles as HTTP+HTTPS proxy to listen to the communication between the Gator Watch server and Gator Watch app. <b>I was shocked to see that there is no encryption between the server and the app.</b>\n\nWhat's more is that the app and server used an incremental integer as ID for the watch. <b>I could - and still can - just change the ID and get the posisition of any other watch. And it didn't stop there. I could - and still can - easily download the voice messages left by any child or their parent.</b> I changed the ID and got the position of a kid in Sweden. I only downloaded one other voice message, and it was appearantly from a Swedish parent sending some sort of first test message to his kid.\n\n<h5>Decompiling the app</h5>I downloaded the APK for the <a href=\"https://play.google.com/store/apps/details?id=com.gatorgroup.carefwatch\">Android app</a> and decompiled it. It was an hybrid <a href=\"https://angularjs.org/\">Angular</a> app. Again, there was no signs of the app using https for anything. <b>The JavaScript source code gave away addresses to other servers and I found a URL with a what looks like an admin interface.</b>\n\n<h5>Android system log</h5>Being an Android developer I work most days with the phone's system log on the screen. What I didn't see until after I found out of everything, is that <b>the Gator app actually constantly logs the URL which you can just open in your browser and change the integer ID in and get the position of any child wearing the watch</b>.\n\n<img class=\"materialboxed responsive-img\" title=\"The Gator app constantly prints out one of the vulnerable URLs to the Android system log.\" data-caption=\"The Gator app constantly prints out one of the vulnerable URLs to the Android system log.\" src=\"/images/gator04.png\"/>\n<h4>Security issues</h4><img style=\"float:right;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"I got the location and voice messages of a random watch in Sweden. (Screenshot from gps-coordinates.net.)\" data-caption=\"I got the location and voice messages of a random watch in Sweden. (Screenshot from gps-coordinates.net.)\" src=\"/images/gator03.png\"/>The issues I saw were these:\n- <b>Anyone can easily track all Gator watches using a web browser</b>\n- <b>Anyone can download any voice message left by child or grown-up</b>\n- <b>Anyone can spoof the location of a watch</b>\n- <b>Anyone can get hold of phone numbers and names that is allowed to call a watch</b>\n- <b>There is no encryption between the app and the server</b>\n- <b>There is no encryption between the watch and the server</b>\n\n<h4>Reception and handling</h4><h5>Day zero</h5>Saturday evening I sent an e-mail to customer support of Gator Norway explaining the issues.\n\n<h5>Day 3</h5>Tuesday morning I got a reply thanking me for sending them the information. They would check this out as soon as possible. And <i>\"We want our watch to be safe for both children and parents!\"</i>\n\n<h5>Day 16</h5>Without my knowledge <a href=\"https://www.forbrukerradet.no/\">The Norwegian Consumer Council</a> and security company <a href=\"https://www.mnemonic.no\">mnemonic</a> started their own testing of different smartwatch brands sold in Norway - among them the Gator 2 watch.\n\n<h5>Day 18</h5>I asked for a status on the issue.\n\n<h5>Day 39</h5><b>They used 3 weeks to get back to me, and told that it \"would take some time\" to fix this.</b> I can understand that adding security on a completely broken system isn't done very easily. They also said that the Gator 3 Watch and Gator 3 app is already secured.\n\n<h5>Day 76</h5><a href=\"https://www.forbrukerradet.no/siste-nytt/elendig-sikkerhet-i-smartklokker-for-barn\">The Norwegian Consumer Council suddenly broke the news about security issues in smartwatches for children</a> (Norwegian article) - among them Gator Watch. <a href=\"http://www.bbc.com/news/technology-41652742\">BBC also brought the news.</a> (English article) <b>This is when I decided to write this post with the technical details and all.</b> There was no reason to wait the normal 90 days when this is out. It's important that as many people as possible is told about this.\n\n<h4>Conclusion</h4><b>If you ask me this is as bad as it can get. As a parent you want your kid to be nothing but safe. And when you buy a product like this you expect to make them more safe. But what happens is that you put your child at risk. Any predator can track your kid, and even start see patterns in when a child usually goes to e.g. school or after-school activities. It would even be possible to fake the position of the child, tricking parents to believe everything is fine or that their child is somewhere else than they are looking for him/her.\n\nAs a developer I just cannot understand how a product like this can end up on the market. Any developer involved in the project on any level would know that this is a really bad product. It's not like anyone mistakenly has screwed up. No one has cared to add any layer of security.\n\nIf your child is using Gator Watch I would recommend you stop him or her from doing that. Now.</b>\n\nFor those of you wanting to go even deeper I would recommend the solid <a href=\"https://fil.forbrukerradet.no/wp-content/uploads/2017/10/watchout-rapport-october-2017.pdf\">report by Norwegian Consumer Council and mnemonic</a> (PDF, English, 49 pages). They also cover some other brands, go into more privacy issues and show how they did the technical tests.\n\n<div style=\"background-color:#ffecb3;padding:10px 10px 15px 10px;\" class=\"\"><h4 id=\"update\">Update</h4><a href=\"/2018/03/gator-watch-revisited\">Read my follow-up on the Gator Watch</a> almost half a year later.</div>\n",
        "images": [
            "/images/gator01.png",
            "/images/gator02.png",
            "/images/gator03.png",
            "/images/gator04.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Internet of Things",
                "url": "/iot"
            },
            {
                "title": "#WatchOut",
                "url": "/watchout"
            }
        ]
    },
    {
        "title": "Case #12: Insurance company leaking personal data",
        "published": true,
        "publishDate": "2017-10-23T08:50:00.000Z",
        "summary": "One of the biggest insurance companies in Norway leaked personal data and used 4.5 months to fix the issue.",
        "niceUrl": "/2017/10/gjensidige-leak",
        "text": "<h4>tl;dr</h4><i>Gjensidige Forsikring</i> - one of Norway's biggest insurance companies - was leaking information about customers' cancelled insurances to other customers. First they used 3.5 months to falsely conclude there was no issue, and then one additional month to fix it. Also, their web site can be abused for sending e-mails.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://gjensidige.no/group/about-us\">Gjensidige Forsikring</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>May 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"red-text\">Poor</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"orange-text\">Partially fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>375 USD worth of gift certificates</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Personal data leak + possibility to spoof e-mails</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>I have had some insurances with Gjensidige for quite some time. Luckily I haven't had much use for them, but from the little contact I have had I must say I'm a happy customer.\n\nAs my insurance company I'm logged in at their site from time to time. Back in May I also took a quick peek at their web site in regards of data security.\n\n<h4>Approach (technical stuff)</h4>When I was logged in I opened <a href=\"https://help.vivaldi.com/article/developer-tools/\">Vivaldi developer tools</a> to inspect the pages and network traffic. There were quite a few <a href=\"https://en.wikipedia.org/wiki/Ajax_(programming)\">Ajax</a> calls in the different pages asking for data to display.\n\n<h5>The missing authorization check</h5><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Some of the data returned for a cancelled insurance.\" data-caption=\"Some of the data returned for a cancelled insurance.\" src=\"/images/gjensidige01.png\"/>As should be,for most calls the browser didn't specify any customer ID or anything like that. Those calls were safe. They do, however, have some calls that include some sort of ID, which is specified on the client side. Most of them seemed to do a proper authorization check, but as shown in the cases presented on this blog, there sometimes are exceptions to this.\n\n<b>The REST endpoint giving back a list of cancelled insurances did not check if the ID sent in by the client. This ID seems to be an auto increment integer and I could just step one number to get another customer's cancelled insurances.</b>\n\nThe Curl command copied from the browser looked like this: <pre class=\"prettyprint\">curl 'https://www.gjensidige.no/ip-web/forsikringer/annullerte/&lt;customer ID&gt;' \\\n    -H 'x-klient-lokasjon: Meldingsboks' \\\n    -H 'Applikasjon: INTERNETT' \\\n    -H 'Accept-Language: nb-NO,nb;q=0.8,no;q=0.6,nn;q=0.4,en-US;q=0.2,en;q=0.2' \\\n    -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.97 Safari/537.36 Vivaldi/1.9.818.49' \\\n    -H 'Accept: application/json' \\\n    -H 'Referer: https://www.gjensidige.no/no/1/Din+side/forsikring/administrer-forsikringer/forsikringsdokumenter-new' \\\n    -H 'Accept-Encoding: gzip, deflate, sdch, br' \\\n    -H 'Cookie: JSESSIONID=&lt;session cookie&gt;; &lt;a bunch of more cookies&gt;;' \\\n    -H 'Connection: keep-alive' --compressed \\\n    | python -m json.tool</pre>\nI added <span class=\"code\">| python -m json.tool</span> just to get a \"pretty print\" of the JSON returned to the command line.\n\n<h5>Faking e-mails</h5>I reported the authorization issue using an online form on their site. <b>When I submitted I noticed that the POST request in fact included the name and e-mail address from the sender, and also the e-mail address to whom it should be sent to.</b>\n\nThis, of course, got my attention. I saw that you could craft your own e-mails, choosing your own contents, topic, sender and receiver. I copied the <a href=\"https://curl.haxx.se/\">Curl</a> command from the browser and easily changed it to send a \"fake\" e-mail.\n\n<a href=\"https://en.wikipedia.org/wiki/Email_spoofing\">E-mail spoofing</a> is nothing new, but there are a few interesting points here. There should be no reason why you would need the send and receiver addresses sent from the client. That's what makes it possible to forge e-mails in this case. Gjensidige uses <a href=\"https://en.wikipedia.org/wiki/Sender_Policy_Framework\">Sender Policy Framework</a> (SPF) for their domain, but that wouldn't help in this case as the server sending the e-mails should be whitelisted. However, the server used in this case is not whitelisted, and Gjensidige has the rule <span class=\"code\">~all</span> set. That rule allows for any servers to send e-mails (with <span class=\"code\">SOFTFAIL</span>) from this domain. So, this again means that you don't really need Gjensidige's server to send spoofed e-mails from Gjensidige. So, maybe this is a feature and not a bug? I hope that they don't think this is all right.\n\nHaving this issue opens up for nice opportunities for <a href=\"https://en.wikipedia.org/wiki/Phishing\">phishing</a>, or just abuse their server to send spam.\n\n<img class=\"materialboxed responsive-img\" title=\"The form that can be abused for spoofing e-mails.\" data-caption=\"The form that can be abused for spoofing e-mails.\" src=\"/images/gjensidige02.png\"/>\n\n<h4>Security issues</h4>The information leaked that I saw for cancelled insurances was this:\n- Customer ID\n- Insurance type\n- Insurance number\n- Price\n- Start date\n- Cancellation date\n- Reason for cancellation:\n  - Missing payments\n  - Missing self-declaration\n  - Need ceased\n  - Insurance converted to other type\n- Depending on insurance type there some extra information:\n  - Full name and year of birth of customer\n  - Full name and year of birth of child\n  - Street address\n  - Car type and plate number\n  - Labour union membership\n\n<b>Some customers, if not most, have several types of insurances which would open for combining information about them.</b> Now, I always minimize the amount of data I access to ensure no one can question my intentions, so I have to <b>make an educated guess that there might even be other types of information on some customers</b>.\n\nFurther more - and this is not fixed, so I'm not sure if they consider it a security issue - <b>it's possible to use their own server to send fake e-mails from their own e-mail addresses</b>.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>It wasn't very easy to find the correct contact point, but the closest I got was a general contact form originally to be used for <a href=\"https://en.wikipedia.org/wiki/Whistleblower\">whistle-blowers</a>. I submitted the form Friday night.\n\nIt was when submitting this form the first time that I noticed that - as described in more details in the \"Approach\" part - it was actually possible to use this form as a way to send e-mails from anyone to anyone through their site. So I submitted the form one more time telling them about that as well.\n\n<h5>Day 3</h5>Early Monday morning I got a confirmation that they had received information about the two issues and would inform the right persons. They also asked for me for a phone number where I could be reached.\n\nI wrote back and told them my phone number. I don't think they ever tried to call me.\n\n<h5>Day 80</h5><b>Having not heard anything back and not seeing any fixes I asked them for a status.</b>\n\n<h5>Day 83</h5>In the morning I got a reply telling me that they had \"taken care of it\" and named another guy who would contact me when he would be back from vacation.\n\nAt night I got copied in on an e-mail from that guy where he asked a third guy about giving me feedback.\n\nA couple of minutes later the second guy told me that he knew they had taken this seriously and worked on the issue. I would be contacted by a third guy when he was back from vacation.\n\n<h5>Day 111</h5>I got a response from the Director of Group Security. He thanked me and quoted a security technician saying that the service in question would return an empty list if the logged in user wasn't authorized to get the list from the customer id it used for the request. The director also said that the reason it had taken me so long to get a reply was that they had gone thoroughly through all aspects of this issue.\n\n<b>Gjensidige used more than 3.5 months to \"thoroughly\" go through \"all aspects\" of the issue and falsely concluded that the issue was not an issue.</b>\n\nI wrote back and asked if I had misunderstood something and gave concrete examples of customer ids that actually would give data back.\n\n<h5>Day 112</h5>I got a reply back telling me that they had forwarded this information to the person responsibly for the security of gjensidige.no.\n\n<h5>Day 125</h5>I got more feedback telling me that they had confirmed that there was an issue and re-opened the case.\n\n<h5>Day 148</h5>I got a new e-mail telling me that they had fixed and closed the issue in production 9 days earlier.\n\n<h5>Day 163</h5>Writing this post I was surprised to see that the issue with e-mail spoofing remained. I had assumed they closed it earlier on. I sent a new e-mail asking about this.\n\n<h5>Day 164</h5>I got a reply telling that the second report with the e-mail spoofing was stopped before it reached Group Security and the IT department.\n\n<b>It actually Gjensidige 4.5 months to fix an information leak of this severity.</b>\n\n<h4>Conclusion</h4>Gjensidige has been very polite and nice in their communication, and also grateful for getting the reports. <b>I would have said their reception and handling was great, had it not been for my own and other customers' data were accessible for all of 4.5 months after the initial report.</b>\n\nWhile I understand that not everybody has the flexible server environments like <a href=\"/2017/08/digipost-leak\">Digipost</a> or <a href=\"/2017/09/skandiabanken-leak\">Skandiabanken</a>, even <b>using 4 weeks from the second report before fixing it in production isn't very impressive. This is an insurance company. They need to ensure that their customers' data is safe with them.</b>\n",
        "images": [
            "/images/gjensidige01.png",
            "/images/gjensidige02.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Authorization",
                "url": "/authorization"
            },
            {
                "title": "E-mail spoofing",
                "url": "/email-spoofing"
            },
            {
                "title": "OWASP 2013 A7",
                "url": "/owasp-2013-a7"
            }
        ]
    },
    {
        "title": "Add security.txt to your site",
        "published": true,
        "publishDate": "2017-11-04T14:35:00.000Z",
        "updateDate": "2017-11-05T19:15:00.000Z",
        "summary": "Sometimes it's really difficult and time consuming to find a way to report a security vulnerability. But there is a very simple solution for that.",
        "niceUrl": "/2017/11/security-txt",
        "text": "<h4>tl;dr</h4><a href=\"https://twitter.com/edoverflow\">Ed Foudil</a> has proposed <span class=\"code\">security.txt</span> as a standard method for making it easier to report security issues. It's a plain text file with contact info that should be located in the <span class=\"code\">.well-known</span> directory of a web site (or root of a file system). Currently it's a \"Internet draft\" that has been submitted for <a href=\"https://en.wikipedia.org/wiki/Request_for_Comments\">RFC</a> review.\n                \n<h4>Why we need security.txt</h4>Over the last three months I have <a href=\"/category/security\">published 12 fresh security issues</a> on my blog. While finding the issues has typically only taken a few minutes, finding somewhere to report the issue sometimes have be a real pain and very time consuming.\n\nIn most cases I have had to contact first-line customer support and try to write in a way that will ensure that they understand that they need to report this to the right party. Often this can work ok, but <b>I have even experienced to be turned down by the customer support because they have not understood what I was trying to tell them.</b>\n\n<h5>IKEA</h5>In <a href=\"/2017/10/ikea-name-leak\">the case with IKEA</a> I spent so much time trying to find the correct contact point. They had no general e-mail addresses or anything anywhere. <b>I ended up e-mailing three press contacts with the issues, and it took three weeks before I got their attention and got to tell them what the issue actually was. And according to IKEA this is actually the way any security issue should be reported.</b> <span class=\"code\">security.txt</span> would have been a much better solution.\n\n<h5>Gjensidige</h5>In <a href=\"/2017/10/gjensidige-leak\">the case with the insurance company Gjensidige</a> <b>they managed to lose one of two reports before it reached the IT department</b>. <span class=\"code\">security.txt</span> would have solved this nicely.\n\n<h5>Tryg and Infotorg</h5>In <a href=\"/2017/08/get-your-ssn-here\">the case with 1 million+ Norwegian Social Security numbers etc. exposed</a>, <b>the insurance company Tryg did not read the e-mails sent to the specified contact e-mail address, and Infotorg - who was responsible for the delivering the data - just stopped responding.</b> It was probably a lost case for Infotorg, but at least Tryg would have been notified with a <span class=\"code\">security.txt</span>.\n\n<h5>Project site with SQL injection</h5>In <a href=\"/2017/10/10-years-of-injection\">the case with the company vulnerable for for SQL injection for 10 years</a> I did not know if their customer support form worked at all as I never got a reply. Writing to an e-mail address specified in <span class=\"code\">security.txt</span> would've helped here.\n\n<h5>In general</h5>In most cases the info would have been delivered directly to the correct persons instead of being delayed in some kind of first-line of customer support. You want it to make it easy to report a security issue, and you want the report to get to the right destination asap.\n\n<h4>How to write security.txt</h4>It's a really simple standard. And simple is indeed beautiful. <span class=\"code\">security.txt</span> should be a plain text file located in the <span class=\"code\">.well-known</span> directory of the site, just like <a href=\"https://www.iana.org/assignments/well-known-uris/well-known-uris.xhtml\">a bunch of others</a> as per <a href=\"https://tools.ietf.org/html/rfc5785\">RFC 5785</a>.\n\n<h5>Contact directive</h5>The only directive that must be present in <span class=\"code\">security.txt</span> is <span class=\"code\">Contact</span>, which lets you specify either an e-mail address (maybe not very smart considering spam) or a phone number or a URI that provides contact info. The order defines the preferred method of contact.\n\nFor my own <a class=\"code\" href=\"/.well-known/security.txt\">security.txt</a> I have used Google's <a href=\"https://www.google.com/recaptcha/admin#mailhide\">reCAPTCHA Mailhide</a> and a link to <a href=\"https://twitter.com/roysolberg\">my own Twitter account</a>.\n\n<h5>Signature directive</h5>In order to ensure the authenticty of the <span class=\"code\">security.txt</span> one should use the <span class=\"code\">Signature</span> directive to sign it using either an external or internal signature.\n\n<h5>Encryption directive</h5>The <span class=\"code\">Encryption</span> lets you add your key for encrypted communication, like your <a href=\"https://en.wikipedia.org/wiki/Pretty_Good_Privacy\">PGP</a> key or similar.\n\n<h5>Acknowledgement directive</h5>The <span class=\"code\">Acknowledgement</span> allows you to link to a page where security researchers are recognized for their reports.\n\n<h5>It's a proposal</h5>It's a proposal, so be sure to check out <a href=\"https://securitytxt.org\">securitytxt.org</a> for the latest update of the specification. Also, at the time of writing, you should take a look at <a href=\"https://github.com/securitytxt/security-txt/tree/draft\">the draft branch at https://github.com/securitytxt/</a> for the latest development. There's also some interesting discussions on the <a href=\"https://github.com/securitytxt/security-txt/issues?q=\">issue tracker of the same project</a>.\n\n<h4>Example security.txt</h4><pre class=\"prettyprint\">Contact: https://example.com/security-contact-form/\nContact: https://example.com/mailhide/security\nContact: 555-2368\n\nSignature: https://example.com/.well-known/security.txt.sig\nEncryption: https://example.com/pgp-key.txt\nAcknowledgement: https://example.com/security-hall-of-fame.html</pre>\n<h4>Conclusion</h4>This is one is easy. Please add support for <span class=\"code\">security.txt</span> - as soon as you can - to make the web a safer and more secure place for us all.\n",
        "images": [
            "/images/security.png"
        ],
        "links": [],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "security.txt",
                "url": "/security-txt"
            }
        ]
    },
    {
        "title": "Case #13: Leaking shopping data",
        "published": true,
        "publishDate": "2017-11-13T19:40:00.000Z",
        "niceUrl": "/2017/11/goshopping-leak",
        "summary": "No one can see what you are shopping online, right?",
        "text": "<h4>tl;dr</h4><i>GoShopping</i> - a company owning several online stores - let anyone see all your previous orders and order lines using just your e-mail address.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://goshopping.no/\">GoShopping</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"green-text\">Low</span> to <span class=\"orange-text\">medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>July 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"red-text\">Poor</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Leak with all order details</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>I recently returned to <a href=\"https://www.kitchenone.no/\">KitchenOne</a> to buy some accessories to my coffee machine. I didn't have any account (I don't think you can have), but was a bit relieved and surprised when I during checkout could just enter my e-mail address and it would fill out my name, address and phone number.\n\nThat made me think. <b>Is it OK that anyone can enter my e-mail address to a service and get back my full name, address and phone number? And maybe there could be more than meets the eye?</b>\n\n<h4>Approach (technical stuff)</h4><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"The service was leaking all data about my previous order - including order lines and payment information.\" data-caption=\"The service was leaking all data about my previous order - including order lines and payment information.\" src=\"/images/goshopping01.png\"/>When I was at the checkout step I opened <a href=\"https://help.vivaldi.com/article/developer-tools/\">Vivaldi developer tools</a> to inspect the network traffic. There was a <a href=\"https://en.wikipedia.org/wiki/Ajax_(programming)\">Ajax</a> call to the mother site GoShopping's CMS (they're using <a href=\"https://umbraco.com/\">the open source ASP.NET CMS Umbraco</a>) returning some JSON with the name, address and phone number. <b>But the JSON contained more. It contained my previous order in full details including all items that I bought. And even my payment information was included.</b>\n<br style=\"clear:left;\"/>\n<h4>Security issues</h4><img style=\"float:right;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"The service was leaking all data about my previous order - including order lines and payment information.\" data-caption=\"The service was leaking all data about my previous order - including order lines and payment information.\" src=\"/images/goshopping02.png\"/>The service for looking up the address from the e-mail address leaked the following information:\n - Seemingly all orders\n - For an order there was this information:\n   - The date of the purchase\n   - <b>Each and all products ordered</b>\n   - Any discount\n   - <b>Name and address used for payment</b> (in addition to the one used for delivery)\n   - <b>Credit card number with <a href=\"https://en.wikipedia.org/wiki/PAN_truncation\">PAN truncation</a></b>\n\n<b>And then there's the question if the user wants it to be possible to look up his or her name, address and phone number using their e-mail address. What if you have some kind of unlisted address? This part has not been fixed, but is assumingly working as intended.</b>\n\n<h4>Reception and handling</h4><h5>Day zero</h5>Monday night I sent an e-mail telling about the leak.\n\n<h5>Day 3</h5>I got an e-mail back telling that they would look into the issue.\n\n<h5>Day 79</h5><b>Having not heard anything back and not seeing any fixes I asked them for a status. I did not receive any reply on this e-mail.</b>\n\n<h5>Day 91</h5><b>I told them I would write about the case here on my blog that very same day.</b>\n\n<b>10 minutes(!) later I got a reply telling that the issue would be fixed some time the week after. As a believer in <a href=\"https://en.wikipedia.org/wiki/Responsible_disclosure\">responsible disclosure</a> I decided to wait for them to release the fix.</b>\n\n<h5>Day 10X</h5>I tested the leaking endpoint and found that it was fixed.\n\n<b>Would they have relased any fix if I didn't tell them I was going to do a write-up? I'm not so sure about that.</b>\n\n<h4>Similar case</h4>I discovered a similar less severe case with <a href=\"https://power.no\">Power</a> in September. Power is a chain selling consumer electronics. When you check out you can specify your phone number. If you have been shopping there sometime before they can fill out the check out form with name, and address. Seems okay, right?\n\nThere's a couple of problems here. The first one is that <b>they also returned the customer's e-mail address</b>. And this was what I complained about in <a href=\"https://twitter.com/roysolberg/status/913690656257773568\">my tweet to Power</a>. They have recently fixed this and removed the e-mail address for the data returned.\n\n<img style=\"float:right;width:400px;margin-left:20px;\" class=\"materialboxed responsive-img\" title=\"My tweet to the consumer electronics chain Power.\" data-caption=\"My tweet to the consumer electronics chain Power.\" src=\"/images/goshopping03-power.png\"/>The second problem is like in this case. <b>Okay, so the company removes the biggest issue, but have you agreed to that it should be possible to look up your name and address using your e-mail address or phone number? What if you have an unlisted phone number? What if you have an unlisted address?</b>\n\n<h4>Conclusion</h4>This case is a classic example of server endpoints returning more data than what is shown to the user - and this time the data really shouldn't be there.\n\nI don't like when it takes more than 3 months to fix something that seemingly is so easy to fix. And I'm not sure they would have fixed this at all if I hadn't been following them up and if I hadn't had this blog. At least now the users' data is more secure.\n",
        "images": [
            "/images/goshopping02.png",
            "/images/goshopping01.png",
            "/images/goshopping03-power.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            }
        ]
    },
    {
        "title": "Summarizing 13 security vulnerabilities",
        "published": true,
        "publishDate": "2017-11-20T05:55:00.000Z",
        "niceUrl": "/2017/11/summary-13-cases",
        "summary": "Let me spell out why you should care that I recently so easily found 13 security vulnerabilities.",
        "text": "<h4>tl;dr</h4>I'm summarizing <a href=\"/category/security\">the 13 security issues I've presented on the blog</a> over the last three months.\n                \n<h4>Crime types</h4><b>In the table below I've tried to show how different types of criminals can directly use the information from the different cases.</b> Of course, combining sources would make you even more vulnerable, so I'll get more into that further down in this post.\n\n<table class=\"checkmarks striped\">\n<thead>\n<tr>\n    <th></th>\n    <th></th>\n    <th style=\"text-align:center;padding-bottom:0px;\" colspan=\"6\">Directly applicable for</th>\n</tr>\n<tr>\n    <th style=\"width:28%\">Case</th>\n    <th style=\"width:12%\">Jealous partner</th>\n    <th style=\"width:12%\">Stalker</th>\n    <th style=\"width:12%\">Kid&#8203;napper</th>\n    <th style=\"width:12%\">White-collar crimi&#8203;nal</th>\n    <th style=\"width:12%\">Political hacker</th>\n    <th style=\"width:12%\">Foreign intell&#8203;igence</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n    <td><a href=\"/2017/08/get-your-ssn-here\">#1 - Tryg + Infotorg</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/08/auth-auth\">#2 - Acme</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/08/digipost-leak\">#3 - Digipost</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/php-hack\">#4 - Acme2</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/skandiabanken-leak\">#5 - Sbanken</a></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/picture-leak\">#6 - Orkla + Japan Photo</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/gym-leak\">#7 - Energi Treningssenter</a></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/10-years-of-injection\">#8 - Acme3</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/ikea-name-leak\">#9 - IKEA</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/hackable-digital-memory-book\">#10 - Memoria</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/tracking-kids\">#11 - Gator Watch</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/gjensidige-leak\">#12 - Gjensidige</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/11/goshopping-leak\">#13 - GoShopping</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n</tbody>\n</table>\n\n<h5>Jealous partner</h5>With <i>jealous partner</i> I'm considering persons who have some kind of <a href=\"https://en.wikipedia.org/wiki/Abusive_power_and_control\">abusive power and control</a> or <a href=\"https://en.wikipedia.org/wiki/Pathological_jealousy\">jealousy</a>. They could make use of usage data like the time the partner entered the door at the gym or what he or she bought at the store at what time.\n\n<h5>Stalker</h5>A <a href=\"https://en.wikipedia.org/wiki/Stalking\">stalker</a> is a person with unwanted or obsessive attention towards another person. Using information leaks a stalker would be able to get more personal information (i.e. address, phone number, e-mail address) about the victim. And getting something like the victim's IP address would open for attacks on computer equipment which again can lead to more leaks of personal data (think your mobile phone with all your images, your e-mail, etc.).\n\n<h5>Kidnapper</h5><a href=\"https://en.wikipedia.org/wiki/Kidnapping\">Kidnappers</a> would be able to use location data and other usage information to understand patterns and when it's a fitting time to commit the crime.\n\n<h5>White-collar crimi​nal</h5>In <a href=\"https://en.wikipedia.org/wiki/White-collar_crime\">while-collar crime</a> I include identity theft and other types of finacially motivated crimes. Useful information could be Social Security Numbers (SSN), names, addresses, phone numbers, etc.\n\n<h5>Political hacker</h5>With <i>political hacker</i> I mean individuals or groups that have some kind of political motivation to get access to data about politicians. A list of people's names and IP addresses would be great news for trying to break into a politician's computer network.\n\n<h5>Foreign intelligence</h5>I suppose some foreign intelligence organizations wouldn't mind getting an up to date high quality list of names, Social Security Numbers and addresses for most of the grown population in a nation. And for more targeted operations full names and IP addresses sure helps.\n\n<h4>Information leaks</h4>More often than not the security issues I have found have included some sort of personal information leak. In the table below I'm summarizing the severity and the leaks.\n\n<table class=\"checkmarks striped\">\n<thead>\n<tr>\n    <th style=\"width:28%\">Case</th>\n    <th style=\"width:18%\">Severity</th>\n    <th style=\"width:30%\">Data leaked</th>\n    <th style=\"width:12%\">Enum&#8203;eration vulvner&#8203;ability</th>\n    <th style=\"width:12%\">Privacy threat</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n    <td><a href=\"/2017/08/get-your-ssn-here\">#1 - Tryg + Infotorg</a></td>\n    <td><span class=\"green-text\">Low</span> to <span class=\"orange-text\">medium</span></td>\n    <td>SSN, names, addresses, birthdays, etc.</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/08/auth-auth\">#2 - Acme</a></td>\n    <td><span class=\"green-text\">Very low</span></td>\n    <td>-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/08/digipost-leak\">#3 - Digipost</a></td>\n    <td><span class=\"orange-text\">Medium</span></td>\n    <td>Names and IP addresses</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/php-hack\">#4 - Acme2</a></td>\n    <td><span class=\"red-text\">Critical</span></td>\n    <td>-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/skandiabanken-leak\">#5 - Sbanken</a></td>\n    <td><span class=\"red-text\">High</span></td>\n    <td>Bank account balances</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/picture-leak\">#6 - Orkla + Japan Photo</a></td>\n    <td><span class=\"green-text\">Low</span></td>\n    <td>Pictures and first names</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/gym-leak\">#7 - Energi Treningssenter</a></td>\n    <td><span class=\"red-text\">High</span></td>\n    <td>Names, visit logs, e-mail addresses, phone numbers, bank account numbers, pictures</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/10-years-of-injection\">#8 - Acme3</a></td>\n    <td><span class=\"red-text\">Critical</span></td>\n    <td>A lot of different company data</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/ikea-name-leak\">#9 - IKEA</a></td>\n    <td><span class=\"green-text\">Low</span> to <span class=\"orange-text\">medium</span></td>\n    <td>Names and locations</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/hackable-digital-memory-book\">#10 - Memoria</a></td>\n    <td><span class=\"red-text\">High</span></td>\n    <td>Private messages</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/tracking-kids\">#11 - Gator Watch</a></td>\n    <td><span class=\"red-text\">Critical</span></td>\n    <td>Kids' location, voice messages, phone numbers</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/gjensidige-leak\">#12 - Gjensidige</a></td>\n    <td><span class=\"orange-text\">Medium</span></td>\n    <td>Names, addresses, insurance details</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/11/goshopping-leak\">#13 - GoShopping</a></td>\n    <td><span class=\"green-text\">Low</span> to <span class=\"orange-text\">medium</span></td>\n    <td>Names, addresses, order details</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n</tr>\n</tbody>\n</table>\n\n<h5>Data leaked</h5><b>A lot</b> of different personal data has been leaked. And looking at the cases you'll see that you can use data from one source to look up data in another.\n\n<h5>Enum​eration vulvner​ability</h5>The checkmark for <i>enum​eration vulvner​ability</i> indicates if it was possible to access all the data systematically or not. Only a few of them needed knowledge like a bank account number or e-mail address, so this is bad news for you as an end user.\n\n<h5>Privacy threat</h5>While not all cases are directly applicable for criminals, almost every single one of them poses a threat to your privacy. This threat goes from you not surfing anonymously on the Internet to your home network being vulnerable for further attacks to your kids being tracked to your online shopping being exposed etc.\n\n<h4>Combining sources</h4>While the vulnerabilities alone are bad, combining them may make them more severe. So which of the 13 could have been used together?\n\nIn the table below I've marked the the cases in which there are some overlapping data that will make it possible to get retrieve more data or increase the <a href=\"https://en.wikipedia.org/wiki/Attack_surface\">attack surface</a>.\n<table class=\"checkmarks striped\">\n<thead>\n<tr>\n    <th style=\"width:28%\">Case</th>\n    <td style=\"width:5%;text-align:center;\">#1</td>\n    <td style=\"width:5%;text-align:center;\">#2</td>\n    <td style=\"width:5%;text-align:center;\">#3</td>\n    <td style=\"width:5%;text-align:center;\">#4</td>\n    <td style=\"width:5%;text-align:center;\">#5</td>\n    <td style=\"width:5%;text-align:center;\">#6</td>\n    <td style=\"width:5%;text-align:center;\">#7</td>\n    <td style=\"width:5%;text-align:center;\">#8</td>\n    <td style=\"width:5%;text-align:center;\">#9</td>\n    <td style=\"width:5%;text-align:center;\">#10</td>\n    <td style=\"width:5%;text-align:center;\">#11</td>\n    <td style=\"width:5%;text-align:center;\">#12</td>\n    <td style=\"width:5%;text-align:center;\">#13</td>\n</tr>\n</thead>\n<tbody>\n<tr>\n    <td><a href=\"/2017/08/get-your-ssn-here\">#1 - Tryg + Infotorg</a></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/08/auth-auth\">#2 - Acme</a></td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/08/digipost-leak\">#3 - Digipost</a></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/php-hack\">#4 - Acme2</a></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/skandiabanken-leak\">#5 - Sbanken</a></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/picture-leak\">#6 - Orkla + Japan Photo</a></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/09/gym-leak\">#7 - Energi Treningssenter</a></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/10-years-of-injection\">#8 - Acme3</a></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/ikea-name-leak\">#9 - IKEA</a></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/hackable-digital-memory-book\">#10 - Memoria</a></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/tracking-kids\">#11 - Gator Watch</a></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/10/gjensidige-leak\">#12 - Gjensidige</a></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n<tr>\n    <td><a href=\"/2017/11/goshopping-leak\">#13 - GoShopping</a></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td></td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;background-color:#4CAF50;\">&#x2714;</td>\n    <td></td>\n    <td style=\"text-align:center;\">-</td>\n</tr>\n</tbody>\n</table>\n\n<h4>Conclusion</h4><b>I wanted to write this post to try to make it clear on why you should care about these issues. When I can find all this data with very little time and effort then this sure must be the tip of a very small iceberg in an ocean with a lot of very big icebergs.</b>\n",
        "images": [
            "/images/summary01.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            }
        ]
    },
    {
        "title": "From the archive #1: Kindergarten leaking data",
        "published": true,
        "publishDate": "2017-11-27T06:45:00.000Z",
        "summary": "This one my of my regrets. This is one of those cases I should have told the world about. But now it's such a long time ago that naming anyone won't do any good.",
        "niceUrl": "/2017/11/kindergarten-leak",
        "text": "<h4>tl;dr</h4>An online kindergarten service used by a lot of kindergartens was leaking a lot of data about all of the kids and their parents.\n                \n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><i>It's too long ago, so I won't tell</i></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"red-text\">High</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>2013</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Very good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>iPad mini with engraved thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with data about kids and parents</td>\n</tr>\n</table>\n<h4>Background</h4>Early 2013 they started using an online system in my kid's kindergarten. The system contained personal info about kids as well as parents and was used for pictures and messages.\n\nI really liked the system. It was very easy to do stuff like notifying if your kid was home sick, to see pictures of everyday life or to see if the sleep schedule was followed as it should. It also seemed pretty user friendly for the staff who had an iPad where they could easily click and register when a child was delivered in the morning and do all other communication with the parents. It was supposed to replace all post-it notes and paperwork.\n\n<b>When we were told about the system and got logins for it we also got a brochure telling <i>\"All data in &lt;the system&gt; is handled with a very high degree of security\"</i>. Of course, a statement like that works pretty much as a cue for me to look into the security of the system.</b>\n\n<h4>Approach (technical stuff)</h4>It's hard to recall all the details years afterwards and this was before I kept any notes about my findings, so the technical description isn't very long or deep. I started out as I normally do; I was using the site while having <a href=\"https://en.wikipedia.org/wiki/Web_development_tools\">the browser development tools</a> open. In general stuff looked pretty good. There seemed to be proper encryption, authentication and authorization all over the place. But one of the challenges with web application security is that authorization is off by default and you have to actively add it and implement it correctly.\n\nEven if the authorization seems okay, there is almost always this one place or function where it's forgotten about. Often it's that one functionality that was added later or that one that no one uses that much. <b>The kindergarten system had a function for exporting all the data they had stored about your child. It was some sort of background job that ran asynchronously and was kickstarted by some URL. The URL contained an incremental integer ID named <span class=\"code\">childId</span>. The scope of the ID was the entire kindergarten (though the online system was running many, many kindergartens).</b>\n\n<b>As you might have guessed, one could just change the ID and you started the background job for another child in the same kindergarten. When the job was done you got a downloadable ZIP file will all of the contents.</b>\n\n<h4>Security issue</h4><img style=\"float:left;width:350px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from the front page of the generated downloadable pages.\" data-caption=\"Screenshot from the front page of the generated downloadable pages.\" alt=\"Screenshot from security issue.\" src=\"/images/kindergarten01.png\"><img style=\"clear:left;float:left;width:350px;margin-right:20px;margin-top:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from some of the personal data of the generated downloadable pages.\" data-caption=\"Screenshot from some of the personal data of the generated downloadable pages.\" alt=\"Screenshot from security issue.\" src=\"/images/kindergarten02.png\">The URL for creating a downloadable archive with all of the contents belonging to the child didn't have an authorization check. <b>It was possible to systematically download all contents for all children within the same kindergarten.</b>\n\n<b>This is the data that was available:\n- Full name of the child\n- Birthday of the child\n- Address of the child\n- Full name of the parents\n- Phone numbers of the parents\n- E-mail address of the parents\n- General practitioner (GP) of the child\n- Info about the child following the govnerment vaccination program or not\n- Potenial other health information like allergies\n- The child's sleep needs\n- Pictures of the child\n- Pictures of other children in the same kindergarten department\n- Messages sent between parents and kindergarten</b>\n\n<h4>Reception and handling</h4><h5>Day zero</h5>Pretty late at night I sent an e-mail to both the manager of our kindergarten and the CEO of the whole kindergarten system.\n\n<b>Just 30 minutes later that night I got a reply from the CEO thanking for the report and saying that they would look into it immediately.</b>\n\n<h5>Day 1</h5>Early at night I got a new longer reply from the CEO. <b>They had already closed the issue for all customers.</b> While this was a classical programming error, the description of the system structure, storage and access control was pretty satisfying. And <b>supposedly the kindergartens are not allowed to store any information that is regarded as sensitive (as defined by law), though I assume all parents feel that all that data about their child is pretty sensitive.</b>\n\nA couple of hours later <b>I also got a reply from the manager of the kindergarten. It was a bit more \"light\" than what I would have wished for, with no critical voicing towards the vendor of the system, but he thanked me and said he was sorry for the incident.</b>\n\n<h5>Day 15</h5>Out of the blue the CEO sent me an e-mail asking if he had found the correct address on me as they wanted to send me a little something.\n\n<b>I have to admit that receiving an iPad mini and their general tone through the process probably was enough to hold me back from telling the media back then.</b>\n\n<h4>Another kindergarten system with vulnerabilities</h4>After I started this blog I noticed <a href=\"https://twitter.com/FixInTheWild/status/882853395203330049\">a tweet about a talk about vulnerabilities in an online kindergarten system</a>. It's a great talk given by Halvor Sakshaug at <a href=\"https://ndcoslo.com/\">NDC Oslo</a> earlier this year.\n\n<b>From the screenshots I could see that this is a completely different kindergarten service than the one I used. So this means even more kids' security and information was vulnerable.</b>\n\n<h4>Conclusion</h4><b>This issue has always been bothering me a bit. It was pretty serious, but I didn't disclose it publicly. It's one of many examples of serious issues that has absolutely no consequences for the company doing the harm and the users jeopardized are never informed about it.</b>\n\n<b>With this issue as a backdrop it was one of the reasons I decided to start disclose security issues on my blog. People need to know that all their personal data is in the hands of anyone who wants it.</b>\n\nAnd with the mentioned other kindergarten system with vulnerabilities, and <a href=\"/2017/10/tracking-kids\">the security issues in the smart watch for kids that I discovered</a> late this summer, I really feel even more that we need more disclosure and give more attention to IT security.\n",
        "images": [
            "/images/kindergarten02.png",
            "/images/kindergarten01.png"
        ],
        "links": [
            {
                "title": "Background: Purpose of these posts",
                "url": "/2017/08/security-vulnerability-disclosures"
            }
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Authorization",
                "url": "/authorization"
            },
            {
                "title": "OWASP 2013 A7",
                "url": "/owasp-2013-a7"
            }
        ]
    },
    {
        "title": "Hack my hackable website [no longer available]",
        "published": true,
        "publishDate": "2017-12-19T22:10:00.000Z",
        "updateDate": "2020-04-13T09:00:00.000Z",
        "summary": "I created a \"hackable\" web app for a presentation I gave about web app security. Now you can try it out yourself.",
        "niceUrl": "/2017/12/hack-my-site",
        "text": "<div style=\"background-color:#ffecb3;padding:10px 10px 15px 10px;\" class=\"\"><h5 id=\"update\">Site no longer available</h5><b>April 2020:</b> It was a fun experiment, but I have for now removed the site hosting the hacking challenge. 🙂</div><h4>tl;dr</h4>Try to \"hack\" <a>https://ra.gl/ [link broken]</a> . You can see the rules and goal on that site.\n\n<h4>Hack my site</h4>I give a few talks every year. The last years I've mostly talked about different mobile development topics, but because of this blog I have recently had the opportunity to talk about web application security.\n\nLast week I gave a talk at <a href=\"http://gdgbergen.no\">Google Developer Group Bergen, Norway</a>. The talk was about <a href=\"https://www.meetup.com/GDGBergen/events/245558721/\">hacking web apps</a>.\n\nAfter the talk itself we had a session with some hands-on \"hacking\" of a web app. For this I had created a web site that had intentional \"security vulnerabilities\".\n\n<h4>The goal</h4><b>The goal of the assignment is simple: Just log in on the administrator page at <a>ra.gl [link broken]</a> and get hold of your unique keyword that proves your accomplishment.</b>\n\n<h4>The rules</h4>I have some rules so that the site isn't ruined completely. It is after all hosted in a shared hosting environment and I don't want anyone else harmed.\n\n<h5>Please stay away from doing this:</h5>- DOS attacks\n- Port scanning\n- Attacks on any other sites or domains hosted on the same server\n- Attacks on network infrastructure\n- Attacks on server software (OS, app server, programming frameworks)\n- Any interference or attacks on the web host company\n- Anything you think might not be okay\n\n<h5>Please do this:</h5>- Try to find any logical errors and/or information leaks in the web pages within this domains\n\n<h4>The tools</h4><b>You don't really need anything else then your <a href=\"https://en.wikipedia.org/wiki/Web_development_tools\">browser's development tools</a>.</b> Personally I like to frequently use its <i>\"Copy as <a href=\"https://curl.haxx.se/\">cURL</a>\"</i> menu option and tweak the HTTP requests in a simple text editor.\n\n<h4>The vulnerabilities</h4>The security vulnerabilities are the typical ones that <a href=\"http://blog.roysolberg.com/tag/security-monday\">I have found and presented on my blog</a>. I you have read some of those posts you might have some clues on what it could be.\n\nIt's isn't a very hard task to break in. But that is actually part of the point. There are some many weaknesses with so many web apps today. With some knowledge and open eyes you can get far. If you are able to hit gold all the way you can solve it within some minutes, but most people seem to need more time.\n\n<h4>Happy hacking!</h4>I hope you enjoy this small assignment! Don't hesitate to give me feedback or if you have any ideas for improvements or other cool stuff that should be included. :-)\n\n<a>Start hacking! [link broken]</a>\n\n<div style=\"background-color:#ffecb3;padding:10px 10px 15px 10px;\" class=\"\"><h5 id=\"update\">Site no longer available</h5><b>April 2020:</b> It was a fun experiment, but I have for now removed the site hosting the hacking challenge. 🙂</div>\n",
        "images": [
            "/images/ra.gl.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Challenge",
                "url": "/challenge"
            }
        ]
    },
    {
        "title": "Guide: How to crack Android apps",
        "published": true,
        "hot": true,
        "publishDate": "2018-02-09T21:40:00.000Z",
        "updateDate": "2019-01-29T14:30:00.000Z",
        "summary": "Learn how to reverse engineer Android apps, alter them, and put them back together. No root needed.",
        "niceUrl": "/2018/02/crack-android-apps",
        "text": "<div style=\"white-space: normal;\" class=\"col s12 m6 right\">\n                <div id=\"mc_embed_signup\" class=\"\">\n                    <form action=\"https://roysolberg.us17.list-manage.com/subscribe/post?u=914df4966855c5c9ff1a2b5cb&amp;id=65ad1b4962\" method=\"post\" id=\"mc-embedded-subscribe-form\" name=\"mc-embedded-subscribe-form\" class=\"validate\" target=\"_blank\" novalidate>\n                        <div id=\"mc_embed_signup_scroll\">\n                            <h6>I'm writing an e-book about cracking android apps. Sign up now and be notified when it's done and get 30% discount!</h6>\n                            <div class=\"mc-field-group\">\n                                <label for=\"mce-EMAIL\">E-mail address</label>\n                                <input type=\"email\" value=\"\" name=\"EMAIL\" class=\"required email\" id=\"mce-EMAIL\" placeholder=\"you@example.com\">\n                            </div>\n                            <div id=\"mce-responses\" class=\"clear\">\n                                <div class=\"response\" id=\"mce-error-response\" style=\"display:none\"></div>\n                                <div class=\"response\" id=\"mce-success-response\" style=\"display:none\"></div>\n                            </div>\n                            <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->\n                            <div style=\"position: absolute; left: -5000px;\" aria-hidden=\"true\">\n                                <input type=\"text\" name=\"b_914df4966855c5c9ff1a2b5cb_65ad1b4962\" tabindex=\"-1\" value=\"\">\n                            </div>\n                            <div class=\"clear\">\n                                <input style=\"margin-top: 10px;\" type=\"submit\" value=\"Get notified\" name=\"subscribe\" id=\"mc-embedded-subscribe\" class=\"btn waves-effect waves-light\">\n                            </div>\n                        </div>\n                    </form>\n                </div>\n            </div><h4>tl;dr</h4>This tutorial for how to crack Android apps is one of my more technical posts. If you aren't a developer you might want to skip this one. :) I'm assuming some basic knowledge of UN*X, Java and Android.\n             \n<h4>Why crack an app?</h4>Sometimes I like to check if online services I use really are secure. <a href=\"/category/security\">I've presented quite a few cases to prove that they very often are not.</a> Mostly I can use very simple techniques to check the security as there are so many basic security vulnerabilities out there. When it comes to apps I often use a HTTP proxy like <a href=\"https://www.charlesproxy.com/\">Charles</a> to take a look at the HTTP and HTTPS traffic. However, <b>once in a while there are apps that use e.g. <a href=\"https://en.wikipedia.org/wiki/HTTP_tunnel\">HTTP tunneling</a> or <a href=\"https://en.wikipedia.org/wiki/HTTP_Public_Key_Pinning\">certificate pinning</a>. In those cases you need to go one step further to be able to listen to the network traffic.</b>\n\nOther reasons to decompile apps could be to recover lost source code, to inject language translations or even fix a bug. But hey, remember, don't do anything you are not allowed to. Don't break the law. This guide is just for educational purposes when you have legitimate reasons to do what you do.\n\n<h4>Contents</h4>These are the topics that I'll cover.\n\n- Online alternatives\n- Getting the tools\n- Getting the APK\n- Decompiling the app\n- Altering the app\n- Getting the app back together\n\n<h4>Online alternatives</h4><b>Very often you don't have to get your hands too dirty getting the hands of a decompiled app. There are some good services out there that can provide you with most Android APKs, and then even some to decompile them.</b>\n\n<h5>Online APK archives</h5>To get hold of an APK you can typically just google the package name. There are quite a few sites where to download them from. Some are more frequently updated than others. Note that you can get hold of different versions and the APK for different architectual platforms.\n\nA word of wisdom: <b>Don't download and run some random APK out there (at least do it in a sandboxed and/or emulated environment). There are quite a few sites that serves bogus or altered APKs. The app might look allright, but still have some malware injected. Don't blindly trust the ones that I recommend either.</b> If the APK is signed with the same key as an APK that you got from Play Store you should be able to trust its origin (though there have been cases of private keys in the wild (even repackaged APKs uploaded to the vendor's own web site)).\n\nHere's a few you might want to try out:\n - <a href=\"https://apkmirror.com\">APKMirror</a>\n - <a href=\"https://apkpure.com/\">APKPure</a>\n - <a href=\"https://www.apkmonk.com/\">APKMonk</a>\n\n<h5>Online decompiler</h5>The quickest and easiest way to decompile an APK is to just use an online service. You just upload the APK and get an archive with all the resources and decompiled files. <b><a href=\"http://www.javadecompilers.com/apk\">javadecompilers.com</a> is the one I have used, and I have been pretty happy with it.</b>\n\nAs you might know, the <a href=\"https://en.wikipedia.org/wiki/Android_application_package\">APK file is really just a ZIP file</a>, so you can typically just rename it to <span class=\"code\">.zip</span> and double click it or run <span class=\"code\">unzip</span> and you can start investigating the app. If it's a <a href=\"https://en.wikipedia.org/wiki/Web_application#Definition_and_similar_terms\">hybrid app</a> you might not have to decompile it at all to get access to everything. Actually, the <a href=\"/2017/10/tracking-kids\">Gator Watch app</a> was a hybrid app and gave away everything with little effort.\n\n<h4>Getting the tools</h4><h5>Android - SDK, tools and emulators</h5>You need to have at least the Android tools and SDK, but <b>for most people I would recommend <a href=\"https://developer.android.com/studio/index.html\">to just install Android Studio</a></b> and follow the instructions to set it up as normal (but skip stuff like the SDK for Android TV and other stuff that will slow down your download).\n\n<h5>Apktool - disassembling and reassembling APKs</h5><a href=\"https://ibotpeaches.github.io/Apktool/install/\">Apktool can be installed manually</a>, or if it's available via your package manager you can just install it using a command like <span class=\"code\">apt-get install apktool</span>.\n\n<h4>Getting the APK</h4>The first step of the reverse engineering is to get hold of the APK. I'll use my own Android app <a href=\"https://play.google.com/store/apps/details?id=com.roysolberg.android.developertools\">Developer Tools</a> as an example app. It's open source and if you want you can <a href=\"https://github.com/roys/java-android-developertools\">get the source code and APKs from GitHub</a>.\n\nThe command-line tool <a href=\"https://developer.android.com/studio/command-line/adb.html\">adb (Android Debug Bridge)</a> is used for all communication with the device or emulator. You can find the tool in the Android's installation folder <span class=\"code\">platform-tools</span>.\n\n<pre class=\"prettyprint lang-bsh\"> $ # Lists all packages:\n $ adb shell pm list packages\n &lt;loong list of apps /&gt;\n\n $ # Simple way of searching for packages:\n $ adb shell pm list packages |grep roysolberg\n package:com.roysolberg.android.smarthome\n package:com.roysolberg.android.datacounter\n package:com.roysolberg.android.developertools\n\n $ # Get the path of a package:\n $ adb shell pm path com.roysolberg.android.developertools\n package:/data/app/com.roysolberg.android.developertools-1/base.apk\n\n $ # Get hold of the APK actual APK file:\n $ adb pull /data/app/com.roysolberg.android.developertools-1/base.apk\n /data/app/com.roysolberg.android.developertools-...file pulled. 25.2 MB/s (2035934 bytes in 0.077s)</pre>\n<h4>Decoding the APK</h4>The next step is to unzip and decompile the APK. Apktool does this for us.\n <pre class=\"prettyprint lang-bsh\"> $ # Decode the pulled APK into a directory named base:\n $ apktool decode base.apk\n \n $ # d works as an alias for decode:\n $ apktool d base.apk\n</pre>\n<h4>Altering the app</h4>This is where the hard work starts. <b>The resource files are now fully readable, but the code is now in the <a href=\"https://github.com/JesusFreke/smali\">smali format</a>.</b> You can think of smali as a sort of assembly language.\n\nAs an example we'll first change the language string <span class=\"code\">app_name</span> to <span class=\"code\">Hacker Tools</span>.\n<pre class=\"prettyprint lang-bsh\"> $ # Edit the main language file:\n $ vi base/res/values/strings.xml\n</pre>\nThen we'll change some hard coded text so that we have changed both resources and actual code.\n<pre class=\"prettyprint lang-bsh\"> $ # Search for file we want to change:\n $ grep -nr 'originally' base/smali\n base/smali/com/roysolberg/android/developertools/ui/activity/MainActivity.smali:651:    const-string v4, \"This app was originally just created for myself to make some developement tasks a bit easier. I've released it to Play Store hoping that someone else might find it useful.\\n\\nIf you want to get in touch me, please send me a mail at dev-null@example.com.\\n\\nPlease note that I take no credit for the third party apps.\"\n\n $ # Edit the smali file and change the string value:\n $ vi base/smali/com/roysolberg/android/developertools/ui/activity/MainActivity.smali\n</pre>\n<h4>Getting the app back together</h4>There are quite a few steps getting everything together. <b>We need to rebuild the app, sign it, zipalign it, and then install it.</b> If the properly signed app is still installed it needs to first be uninstalled as our signature violates the existing one.\n\nThe command-line tool <a href=\"https://developer.android.com/studio/command-line/zipalign.html\">zipalign</a> is needed to align the contents of the APK for Android to be able to run it. You can find the tool in the Android's installation folder <span class=\"code\">build-tools/&lt;some version number&gt;</span>.\n<pre class=\"prettyprint lang-bsh\"> $ # First build a new APK with the changes:\n $ apktool build base -o base.unaligned.apk\n\n $ # Sign the app using the Android debug certificate generated from Android Studio installation:\n $ jarsigner -verbose -sigalg MD5withRSA -digestalg SHA1 -keystore ~/.android/debug.keystore -storepass android base.unaligned.apk androiddebugkey\n \n $ # Align APK:\n $ zipalign -v 4 base.unaligned.apk base.aligned.apk\n\n $ # If original app (with different signature) is installed it must be uninstalled:\n $ adb uninstall com.roysolberg.android.developertools\n Success\n\n $ # Final step is to install the newly altered app (-r for reinstall (keeping the app's data)):\n $ adb install -r base.aligned.apk\n Success\n\n $ # To keep an eye on the log and what's going on you can use logcat:\n $ adb logcat\n</pre>\n<b>That's it! :-)</b>\n\n<h4>A few addtional tips</h4><h5>Reading smali</h5>It might take a little bit of getting used to, but reading smali isn't all too bad. If you have any concrete problems you'll find the answer with some googling. But <b>a good tip is to create some small very simple Java classes yourself and check out what they look like in the smali format.</b>\n\nIf you are having trouble navigating the smali code and understand the flow of an app you can use the following smali code. It will call <a href=\"https://developer.android.com/reference/java/lang/Thread.html#dumpStack()\"><span class=\"code\">Thread.dumpStack()</span></a> which logs the current thread's call stack.\n<pre class=\"prettyprint lang-bsh\"> invoke-static {}, Ljava/lang/Thread;->dumpStack()V</pre>\nIf you need to know the value of a string - e.g. a parameter - you can use <a href=\"https://developer.android.com/reference/android/util/Log.html#d(java.lang.String,%20java.lang.String)\"><span class=\"code\">Log.d(String tag, String message)</span></a> to log it to the system log.\n<pre class=\"prettyprint lang-bsh\"> const-string/jumbo v0, \"YourTag\"\n invoke-static {v0, p1}, Landroid/util/Log;->d(Ljava/lang/String;Ljava/lang/String;)I</pre>\n<h5>jadx - Dex to Java decompiler</h5><b><a href=\"https://github.com/skylot/jadx\">jadx</a> is a command-line and GUI tool for converting <a href=\"https://source.android.com/devices/tech/dalvik/dex-format\">dex</a> to Java.</b> Reading Java is after all easier than reading the smali format.\n\n<h5>Proguard</h5>Very often - but not in the case of my Developer Tools app - the code will be shrinked and obfuscated using <a href=\"https://developer.android.com/studio/build/shrink-code.html\">ProGuard</a>. This makes the code a lot harder do read and understand. There aren't really any good ways around it, but doing the thread dump trick and taking your time to follow the code will eventually get you where you want to be.\n\n<div style=\"white-space: normal;margin-bottom:20px;\" class=\"col s12\">\n    <div id=\"mc_embed_signup\" class=\"\">\n        <form action=\"https://roysolberg.us17.list-manage.com/subscribe/post?u=914df4966855c5c9ff1a2b5cb&amp;id=65ad1b4962\" method=\"post\" id=\"mc-embedded-subscribe-form\" name=\"mc-embedded-subscribe-form\" class=\"validate\" target=\"_blank\" novalidate>\n            <div id=\"mc_embed_signup_scroll\">\n                I'm writing an <em>e-book about cracking android apps</em>. Sign up now and be notified when it's done and <em>get 30% discount</em>!\n                <div class=\"mc-field-group\">\n                    <label for=\"mce-EMAIL\">E-mail address</label>\n                    <input type=\"email\" value=\"\" name=\"EMAIL\" class=\"required email\" id=\"mce-EMAIL\" placeholder=\"you@example.com\">\n                </div>\n                <div id=\"mce-responses\" class=\"clear\">\n                    <div class=\"response\" id=\"mce-error-response\" style=\"display:none\"></div>\n                    <div class=\"response\" id=\"mce-success-response\" style=\"display:none\"></div>\n                </div>\n                <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->\n                <div style=\"position: absolute; left: -5000px;\" aria-hidden=\"true\">\n                    <input type=\"text\" name=\"b_914df4966855c5c9ff1a2b5cb_65ad1b4962\" tabindex=\"-1\" value=\"\">\n                </div>\n                <div class=\"clear\">\n                    <input style=\"margin-top: 10px;\" type=\"submit\" value=\"Get notified\" name=\"subscribe\" id=\"mc-embedded-subscribe\" class=\"btn waves-effect waves-light\">\n                </div>\n            </div>\n        </form>\n    </div>\n</div>\n<h4>Wrapping it up</h4><img style=\"float:left;width:550px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"The regular Developer Tools app on the left and the cracked one on the right.\" data-caption=\"The regular Developer Tools app on the left and the cracked one on the right.\" alt=\"The regular Developer Tools app on the left and the cracked one on the right.\" src=\"/images/cracked_app.jpg\"/>If you have followed along the guide you would see the app change from the version on the left to something like the one on the right. One of the reasons I wrote this guide was for my own sake to have something to easily copy and paste from when doing some reverse engineering myself, but I thought this might be useful one for others as well. :)",
        "images": [
            "/images/cracked_app.jpg"
        ],
        "category": {
            "title": "Software development",
            "url": "/software-development"
        },
        "tags": [
            {
                "title": "Reverse engineering",
                "url": "/reverse-engineering"
            },
            {
                "title": "Cracking",
                "url": "/cracking"
            },
            {
                "title": "Android",
                "url": "/android"
            },
            {
                "title": "Guide",
                "url": "/guide"
            }
        ]
    },
    {
        "title": "Gator Watch revisited",
        "published": true,
        "publishDate": "2018-03-30T07:30:00.000Z",
        "updateDate": "2018-04-05T14:30:00.000Z",
        "summary": "Gator Watch had a complete lack of security which made it possible to track kids all over the world and listen to private voice messages. This is supposedly fixed, at least in Norway. But is it really?",
        "niceUrl": "/2018/03/gator-watch-revisited",
        "text": "<h4>tl;dr</h4><i>Gator Watch</i> had the worst security I've seen in an online service in a long time. Now, at least the company selling Gator Watch in Norway, has released new watch firmware and new mobile apps to tackle all the issues. And what they have done is actually really impressive.\n\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>Early August 2017 <a href=\"/2017/10/tracking-kids\">I found out that the Gator watches could be tracked, locations could be spoofed, and private voice messages was openly available on the Internet</a>.\n\nShortly after, <a href=\"https://www.forbrukerradet.no/side/significant-security-flaws-in-smartwatches-for-children/\">the Norwegian Consumer Council (NCC) also did a check on Gator Watch and a few other brands</a> and found the same issues + illegal or non-existent terms and conditions.\n\nThe whole so-called <i>#WatchOut</i> campaign led to a hectic and probably stressful few months for the companies Gator Norge, GPS for barn, Tinitell and PepCall (Xplora). <a href=\"https://www.datatilsynet.no/aktuelt/2017/palegger-stans-i-behandlingen-av-personopplysninger-i-smartklokker/\">The Norwegian Data Protection Authority (Datatilsynet) even forced Gator, PepCall and GPS for barn to stop all processing of personal information</a> (Norwegian link) until they had fixed issues regarding their information security.\n\nThe Norwegian company sellling Gator Watch - <b>Gator Norge - has since <a href=\"https://www.gatornorge.no/blog/2017/12/22/denne-gang-har-vi-gjort-alt-selv/\">released new watch firmware and created completely new client apps</a>. I wanted to know if the security was in order before using the watch for my own family.</b>\n\n<h4>Approach (technical stuff)</h4><h5>New firmware</h5>The old firmware for the Gator Watch was pretty bad. The communication between the watch and the server was in clear text with out any encryption at any level. Also, there was no authentication or verification of the user. There was no session identifier, only the always fixed IMEI number. You can't really make it much worse than that.\n\n<img style=\"float:left;width:480px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from the firmware flashing process.\" data-caption=\"Screenshot from the firmware flashing process.\" src=\"/images/gator-revisited03.png\"/><a href=\"https://www.gatornorge.no/encryption-of-gator-clocks-2/\">Gator Norge has released new watch firmware and a description on how to do the upgrade</a> (Norwegian link only, sorry). <b>The process for upgrading the firmware for Gator 2 and Gator 3 is pretty complex. It's 34 long steps that could scare most people.</b> Even me with some tech background met one issue due to me misunderstanding one of the steps. Also, the upgrade must be done using Windows. But one has do to do what one has to do, so I did the upgrade twice - once for a Gator 2 watch and once for a Gator 3 watch.\n\nUsing the old firmware I could just change the server the watch used to learn how the watch communicated. Then I could use that knowledge to try the communication with the server pretending to be a watch. With the new firmware I don't know how to do that. Also, reading or reverse engineer the firmware is out of my expertise. <b>This means I haven't been able to look at the communication between the server and watch. I have to trust Gator Norge when they say it now is encrypted. I also hope that it isn't possible to easily spoof other watches. Hopefully someone will take the time to analyze <a href=\"https://gatornorge.no/KrypteringGatorNorge.zip\">the new firmware that can be downloaded from Gator Norge</a>.</b>\n\n<h5>New apps</h5>The old apps and server APIs for the Gator Watch was some of the worst product I've seen in a long while - security wise.\n\nGator Norge trashed the old apps and server and replaced it with brand new software. I did an analysis of <a href=\"https://play.google.com/store/apps/details?id=com.teleg.iotapp\">the Android app</a> and also took a look at the server.\n\nWhat is interesting is that this new Gator watch app - called TeleGAPP -  isn't a new concept from Gator Norge. <b>They actually released this app in September 2017, but as a app-to-app-only way of tracking friends and family. I took a brief look at the security later that fall, and I found multiple security holes. However, I never got around finishing my work or even reporting them. Shortly after I learnt that this app would soon become the new Gator watch app. So I postponed the rest of the testing - and reporting - awaiting this new version of the app. In retrospect I see that I should have reported my findings - even though it was unfinished work - I had back then because of the delays of the new app. I will probably write another post on that matter as it does have some interesting points. They have now seem to have taken down the server used back then.</b>\n\n<b>TeleGAPP - utilizes a custom-made <a href=\"https://en.wikipedia.org/wiki/HTTP_Public_Key_Pinning\">certificate pinning</a>. This meant that I couldn't just use a regular HTTP proxy out of the box.</b> While I see the upside of having such pinning it sure makes it much harder to simply check if an app or service is secure. The chances that a good guy will skip testing is very high, while a bad guy would go ahead anyways. In total this typically leads makes Internet less secure.\n\nI recently posted a <a href=\"/2018/02/crack-android-apps\">guide on how to crack Android apps</a> which explains exactly what is needed for cases like this. A simple <a href=\"https://www.quora.com/What-is-smali-in-Android\">smali</a> one-liner like <span class=\"code\">return-void</span> was all that was needed to get around the pinning.\n\nAfter rebuilding the app I could use the HTTP proxy <a href=\"https://www.charlesproxy.com/\">Charles</a> to see what the encryption, authentication and data looked like. And I have to say; <b>this new app is a whole different ball game. This app has exactly the security measures I would've expected to find in the first place.</b>\n\nI could try to go through all security features and what makes the app less vulnerable, but I suppose I wouldn't be able to make a complete list. All HTTP calls are of course encrypted. The authentication ends up with a bearer authorization token. The token is short lived (though even as short lived as it makes the app a bit buggy with HTTP calls failing and without proper automatic re-authentication (which in ends up as a bad user experience with error messages popping up too often (though I actually think they now have fixed in a later version))). The authorization seems to be in order. I wasn't able to access to resources or data that I wasn't supposed to have. In general the API seemed clean, secure and made by people that know what they are doing.\n\n<b>What I did not test, was making <span class=\"code\">PUT</span> that I should not be authorized to do. Too often I see that developers properly secure getting data, but not checking if others are allowed to update it.</b> I typically do this if it's real quick and easy to create another user for me to test on or if I know someone else with an account that I'm allowed to test with. So I'll just assume that they have that in order as well. At least they have a good base here.\n\n<h4>The user experience</h4><img style=\"float:left;width:240px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from Gator Norge's new watch app - TeleGAPP.\" data-caption=\"Screenshot from Gator Norge's new watch app - TeleGAPP.\" src=\"/images/gator-revisited01.png\"/>If we look past the bad user experience it was to manually upgrade the firmware (which is not needed for people buying new watches today of course), the new app is pretty different from the old one. Since they started from scratch they haven't added all the features back in, but my understanding is that they are working on it.\n\nOne of the features that isn't in the new app is the mode where you could listen in on the watch without anyone knowing it. This made the old watch in to a listenting device. I really doubt that we will see that feature coming back.\n\nAnother one of the features not available is the one to - from parent to kid or the other way around - leave a voice message if you are unable to get hold of the other.\n\n<img style=\"float:left;width:240px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from the old Gator watch app that had geo-fencing.\" data-caption=\"Screenshot from the old Gator watch app that had geo-fencing.\" src=\"/images/gator-revisited02.png\"/>A third feature now missing is the one where you could set up <a href=\"https://en.wikipedia.org/wiki/Geo-fence\">geo-fences</a> for areas like home, school, football field.\n\nPersonally it annoys me that the map where you can see the watch now doesn't have a satellite mode.\n\nThe latter two features I hope to see back in a coming version of the app.\n\n<h4 style=\"clear:left;\">My verdict</h4>I will never understand how a company can buy a product like this from China and not offer data security one single thought before releasing it into the market. That being said, <b>from what I can see, Gator Norge now has put a lot of effort to make the watch, apps and server properly secure. I'm impressed by how they have handled the criticism, pressure and technical challenges.</b> This has not been cheap and have also cost a lot of time and effort.\n\nJudging from what Gator Norge has said they have had third party companies developing the app and doing security testing of it. As I understand it they will keep having regular audits of the products - and that is really the only serious way of handling security in such a product.\n\n<h4>Conclusion</h4>In Norway we are very fortunate to have watch dogs like the Norwegian Consumer Council (NCC) and Norwegian Data Protection Authority (Datatilsynet). I think they do a great job. It's so good to see them put the focus on IT security and to force through changes. It makes us all more safe and secure.\n\nAnd I'm also happy to see - at least the Norwegian version of - Gator taking this seriously, being humble and saying sorry, and to return with a much more secure product. I for one, will let my kids wear this watch now.\n",
        "images": [
            "/images/gator-revisited01.png",
            "/images/gator-revisited02.png",
            "/images/gator-revisited03.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "#WatchOut",
                "url": "/watchout"
            },
            {
                "title": "Follow-up",
                "url": "/follow-up"
            }
        ]
    },
    {
        "title": "Case #14: Power company leaking personal info and usage data",
        "published": true,
        "publishDate": "2018-04-10T06:25:00.000Z",
        "summary": "Information about thousands - theoretically maybe hundreds of thousands - of customers could be stolen.",
        "niceUrl": "/2018/04/power-company-leak",
        "text": "<h4>tl;dr</h4>The electric power company <i>Norgesnett</i> had a security vulnerability that made it possible to get access to thousands of customers' personal info + their usage data. This was probably also the case for quite a few of the hundreds of customers of the company <i>Enoro</i> - the creators behind the vulnerable software.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://norgesnett.no/\">Norgesnett</a> and <a href=\"http://enoro.no/\">Enoro</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>February 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with personal information, power usage data, audit reports, meter number</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>All electricity consumers in Norway will receive smart meters by January 1st 2019. There has been a little bit of controversy in regards of the meters. The most extreme skeptics are afraid of the radiation from the new meters as they typically communicate back to the so-called distribution system operators (DSO) via radio or the mobile network. Then you have the ones that are afraid that the electricity will become more expensive - at least for families that don't have that much flexibility in regards of when they need to use electricity. And then thirdly, <b>you have those concerned about data security and privacy because of the frequent readings done by the power companies.</b>\n\n<b><a href=\"https://www.datatilsynet.no/rettigheter-og-plikter/overvaking-og-sporing/strommaling/\">The Norwegian Data Protection Authority (Datatilsynet) has written a bit about the new smart meters</a> (Norwegian only) and how they can in theory be used to track individuals and both reveal and predict if people are and will be home at a certain point in time.</b>\n\nI also think the <a href=\"https://www.tu.no/artikler/norske-nettselskap-er-enige-ams-utgjor-en-risiko-for-datasikkerheten/275560\">article from tu.no about smart meter security</a> (Norwegian only) is pretty interesting in this context.\n\nThe new smart meters come with a <a href=\"https://en.wikipedia.org/wiki/Home_network\">Home Area Network</a> (HAN) interface where you can get more details about your power usage. <a href=\"https://blog.roysolberg.com/2017/08/my-dumb-smart-home\">My house is a smart home</a> and I want to integrate and use the data available through the HAN interface (which sends <a href=\"https://en.wikipedia.org/wiki/IEC_62056\">OBIS</a> messages via <a href=\"https://en.wikipedia.org/wiki/Meter-Bus\">M-Bus</a>). So, around the time I got the new meter I logged into Norgesnett's site to get more information and see what kind of meter data that was available. <b>I used this opportunity to check if Norgesnett protects my data..</b>\n                           \n<h4>Approach (technical stuff)</h4><img style=\"float:left;width:450px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Profile form at Norgesnett. For some reason the customer ID is posted as part of the data.\" data-caption=\"Profile form at Norgesnett. For some reason the customer ID is posted as part of the data.\" src=\"/images/norgesnett01.png\"/>When logged in to Norgesnett's site I had the <a href=\"https://help.vivaldi.com/article/developer-tools/\">Vivaldi developer tools</a> open and took the regular look at source code, network calls etc. Most of it looked pretty good.\n\n<b>Norgesnett has this feature where you can add other \"customer relationships\" to your main account.</b> Using that feature you can easily switch between your different accounts. <b>To add another customer you need their customer ID and 4 digit PIN. The customer IDs seem to be just an incremental integer.</b> Maybe one could get hold of other users' PIN?\n\nThey have also have this online form where one can change one's own personal data. For some reason the customer ID is posted as part of the form. I asked for a friend's customer ID and quickly found out that <b>I could post with his customer ID and an e-mail address of mine.</b>\n\n<img style=\"float:left;width:450px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"The automatic e-mail sent when changing the e-mail address - including the customer ID and PIN code.\" data-caption=\"The automatic e-mail sent when changing the e-mail address - including the customer ID and PIN code.\" src=\"/images/norgesnett02.png\"/><b>After that was done an e-mail was automatically sent with both my friend's PIN and a direct link to finish the connection between the e-mail address and customer ID. The link didn't work for some reason, but with the PIN I could add the account as a \"customer relationship\" to my own account.</b>\n\nIf the other user had specified the e-mail address for getting alerts, one could even change back the e-mail address and no one would ever notice that the account was accessed. Of course, one can hope there is some kind of logging in place that potentially could catch up on this.\n\n<b>Using some of the wordings and URLs used for the login page it's easy to find other of Enoro's customers who have the same customer system in place. And there's a quite a few.</b>\n\n<img style=\"float:left;width:450px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Overview and forms for customer relationships at Norgesnett.\" data-caption=\"Overview and forms for customer relationships at Norgesnett.\" src=\"/images/norgesnett03.png\"/>\n                           \n<h4 style=\"clear:left;\">Security issues</h4><b>One could systematically go through all customers and retrieve the following information:\n- Customer ID\n- Customer PIN\n- Meter number (\"målernummer\")\n- Meter ID (\"målepunkt-ID\")\n- Full name\n- Full address\n- Date of birth\n- Phone numbers\n- E-mail address\n- Historical power usage\n- Invoices\n- Audit reports</b>\n\nI hope they don't have unlisted and secret addresses available.\n\nThe power usage is not reported at near realtime on Norgesnett's customer faced website, but rather weekly + start of month. Hopefully they would have noticed that something was going on if this was to be taken advantage of in a large scale.\n\n<b>This is speculation as I have not tried to confirm the vulnerability for other Enoro customers than Norgesnett (and not more than one other customer), but a quick Google search makes me believe at least the following 14 power companies have the vulnerability:\n - Norgesnett (96,000 customers)\n - Agder Energi Nett? (195,000 customers)\n - Eidsiva Nett? (159,000 customers)\n - Los? (150,000 customers?)\n - Gudbrandsdal Energi? (&gt;100,000 customers)\n - Glitre Energi? (90,000 customers?)\n - Oppdal Everk?\n - Orkdal Energi?\n - Smart Energi?\n - Polar Kraft?\n - Akraft?\n - Hålogaland Kraft?\n - Agder Energi Nett?\n - Hjemkraft?</b>\n\nThere could absolutely be more companies than these as well.\n\nIn Norway we can have separate companies for electricity distribution (\"nettselskap\") and electricity retailing (\"kraftselskap\") which makes <b>some persons appear multiple times in those numbers</b>.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>I wrote an e-mail to Norgesnett's customer support in the evening telling about the issue. I immediately got an automatic response.\n\n<h5>Day 1</h5>Around noon I got a reply back thanking me and telling me they had relayed the message to their system vendor (Enoro) and that it should be fixed shortly.\n\n<b>I never heard back after that, not even when I told them I was going to post this, but I got a confirmation from a journalist that Enoro said the issue was fixed.</b>\n\n<h4>Conclusion</h4><b>I don't really want this to be a discussion about smart meter security. Unless someone hacks the firmware on your meter no one should externally be able to track individuals.</b> In the case of Norgesnett it also would be hard to track if someone in a house is on vacation.\n\n<b>I think of this as yet another case showing that your personal data is not safe; it's long gone. Close to all your personal information is already in the hands of anyone who wants it. But I do hope that power companies in general have their security in order.</b>\n",
        "images": [
            "/images/norgesnett01.png",
            "/images/norgesnett02.png",
            "/images/norgesnett03.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Smart meter",
                "url": "/smart-meter"
            },
            {
                "title": "Account takeover",
                "url": "/account-takeover"
            },
            {
                "title": "OWASP 2017 A5",
                "url": "/owasp-2017-a5"
            }
        ]
    },
    {
        "title": "Case #15: Leaked hotel reservations",
        "published": true,
        "publishDate": "2018-04-23T21:55:00.000Z",
        "summary": "Information about as many as maybe 1.5 million past, current and future hotel stays were openly accessible on the Internet.",
        "niceUrl": "/2018/04/hotel-leak",
        "text": "<h4>tl;dr</h4>The company <i>Ariane</i> had a leak in one of their newsletter software installations causing an exposure of something like 1.5 million hotel reservations with hotel name, reservation number, dates of stay, customer name, customer e-mail address and possibly room number. A number of hotels were affected and the data went for like two years back in time and also included future stays.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://ariane.com\">Ariane</a> (and therefore some of their customers)</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>April 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A gift card for 1 night for 2 persons at a Thon hotel (provided by Thon which was the hotel chain I reported the leak to)</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with personal information related to hotel reservations</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div><h4>Background</h4>I had a talk at <a href=\"https://www.meetup.com/OWASP-Norway/events/248655998/\">OWASP Norway's meetup</a> in Oslo and therefore stayed the night at <a href=\"https://www.thonhotels.no/hoteller/norge/oslo/thon-hotel-rosenkrantz-oslo/\">Thon Hotel Rosenkrantz Oslo</a>. \n\nI did the reservation online directly with the hotel as it was cheaper than via <a href=\"https://hotels.com/\">hotels.com</a>. And because of the direct booking the hotel started sending me different e-mails regarding my stay. Some of those e-mails led me to an unprotected website.\n\n<h4>Approach (technical stuff)</h4>All the e-mails from the hotel had links named <i>\"View in browser\"</i>. The e-mails directly regarding my stay linked to a <a href=\"https://azure.microsoft.com\">Microsoft Azure</a> application at some \"random\" <span class=\"code\">cloudapp.net</span> subdomain.\n\nWhat hit me first was that <b>the links were served over http and not https</b>. And instead of a nice shorter URL pointing to Thon, it was a long one with a path signaling that site was used for more than my hotel chain. <b>The query parameters contained a big integer as an ID and my e-mail address. So the natural thing to try was to remove the e-mail address from the query parameters. To my surprise I still got my details back.</b>\n\n<b>Then I tried my ID - 1 and got another person's booking.</b> I never download a lot of data as I don't want anyone to question my motives, but I do like to get an idea of the scope of a data leak, so I did a few tests to see if I could see how many bookings this was. My ID was past 2.37 million and the lowest that I saw working was around 865 thousand, so <b>I estimate that more than 1.5 million records were available.</b>\n\n<b>It was possible to traverse the URL path and get to a generator/preview function of a lot of different types of e-mail templates (for check-in details, receipts, room number reminder, etc.) for a long list of hotels.</b>\n\n<b>By changing the templates it was possible to retrieve different information about a booking.</b> E.g. one template would include the room number, while another would include dates and the customer's name and e-mail address. Judging from the e-mails I received it would in some cases be possible to check some people in or out.\n\nJust by doing a google search with the subdomain I got a page that looked like a login page for the whole system. That page was also served over http.\n\n<h4 style=\"clear:left;\">Security issues</h4><b>One could very easily iterate over - what I estimate to be - 1.5 million bookings and get some or all of the following information:\n- Customer's full name\n- Customer's e-mail address\n- Reservation number\n- Date of arrival\n- Date of departure\n- Hotel name\n- Room number</b>\n\n<b>The bookings seem to range back from 2016 and also include future stays.</b>\n\nAlso everything was served over an unencrypted connection so someone could potentially listen in and get the information.\n\nThe list of hotels affected by this security vulnerability in Ariane's system is longer, but as I only did a few tests so I only observed these:\n- <a href=\"https://www.radissonblu.com/en\">Radisson Blu</a> in England\n- <a href=\"https://www.lindner.de/en.html\">Lindner Hotels & Resorts</a> in Germany\n- <a href=\"https://www.mcdreamshotels.de/home-en.html\">McDreams</a> in Germany\n- <a href=\"https://www.nordicchoicehotels.com/\">Nordic Choice Hotels</a> in Norway\n- <a href=\"https://www.thonhotels.com/\">Thon Hotels</a> in Norway\n- <a href=\"https://www.radissonred.com/\">Radisson RED</a> in South Africa\n \nAriane has stated that <a href=\"https://nrkbeta.no/2018/04/19/gjester-ved-to-norske-hotellkjeder-kan-ha-fatt-sine-bookingdetaljer-eksponert/\">most affected hotels are in Germany and France</a> (Norwegian link). In the same article they are quoted saying that they cannot be sure that this issue has already been taken advantage of.\n\n<img style=\"float:left;width:450px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from one of the bookings.\" data-caption=\"Screenshot from one of the bookings.\" src=\"/images/hotel01.png\"/>\n\n<h4 style=\"clear:left;\">Reception and handling</h4><h5>Day zero</h5>I couldn't immediately see who was responsible for the whole system so in the afternoon I sent an e-mail to Thon Hotels' customer service. I got an automatic response giving me a hint that they would not read that e-mail until the day after, so I also sent them a direct message on Twitter saying that they probably wanted to check out the issue right away.\n\n<b>Just two hours later I got a reply thanking me and saying that the information was past on to the web development department.</b>\n\n<h5>Day 5ish</h5><b>I tested the URL in question and saw that they had fixed the issue where one could access anyone's booking without also knowing the e-mail address.</b>\n\n<h5>Day 7</h5>I got an e-mail from the chief of security in the group owning the Thon Hotels where he thanked me and asked for my details to send a reward - a gift card which I received just a few days after that.\n\n<h4>Media coverage</h4>For once I did things a bit differently and worked with the media before I published the case here myself. <a href=\"https://nrkbeta.no/2018/04/19/gjester-ved-to-norske-hotellkjeder-kan-ha-fatt-sine-bookingdetaljer-eksponert/\">NRKbeta covered the story less than a week ago</a> (Norwegian link only, sorry). NRK is the Norwegian government-owned radio and television public broadcasting company, and the largest media organisation in Norway. They also featured it as as the top story on <a href=\"https://nrk.no\">nrk.no</a> of their front page for some time. I'm happy to see that big media companies like NRK cares about online security and our personal data.\n\n<h4>Conclusion</h4>Is this leak so bad? Most people can handle having their name, e-mail address and reservation stolen or being open on the Internet forever. This is still a pretty bad leak. The number of reservations was pretty big. Maybe someone was already taking advantage of it? It would be possible to regularly check the bookings for public persons or other individuals. It could also be circumstantial evidence for some person being at a certain place at a certain time.\n\nAlso, with information like this it would be pretty easy to do some kind of <a href=\"https://en.wikipedia.org/wiki/Phishing#Spear_phishing\">spear phishing</a> - to use the information to target and deceive a hotel customer.\n\nI think we all expect our hotel to keep our personal details safe and secured.\n",
        "images": [
            "/images/hotel01.png",
            "/images/hotel02.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "OWASP 2017 A3",
                "url": "/owasp-2017-a3"
            },
            {
                "title": "OWASP 2017 A5",
                "url": "/owasp-2017-a5"
            },
            {
                "title": "OWASP 2017 A10",
                "url": "/owasp-2017-a10"
            }
        ]
    },
    {
        "title": "Millions of customer records exposed through unused API fields",
        "published": true,
        "publishDate": "2018-05-25T21:55:00.000Z",
        "updateDate": "2018-05-27T20:30:00.000Z",
        "author": "Hallvard Nygård",
        "summary": "<i>Guest blog post by <a href=\"https://twitter.com/hallny\">Hallvard Nygård</a></i>",
        "niceUrl": "/2018/05/postnord-api-leak",
        "text": "<h4>tl;dr</h4>Possibly millions of customer records (name, address, e-mail and phone number) from PostNord was exposed through unused API fields in a parcel tracking page used in Norway. The API has been online at least since 2013. The security issue was discovered after a parcel delivery from Komplett.no (Komplett Group AS, Norway) and the issue was also reported and handled through Komplett.no.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://www.postnord.no/en\">PostNord</a>. Confirmed, but maybe not limited to, PostNord Norway. Reported to <a href=\"https://www.komplett.no/\">Komplett.no</a>.</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>May 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>Thanks and a gift card at Komplett.no for 500 NOK (60 USD). Issue was reported to and handled by Komplett.no.</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Page showing tracking information about parcels was leaking name, full address, phone number and e-mail. Parcel tracking code was guessable. At least Norwegian parcels affected.</td>\n</tr>\n</table>\n\n<h4>Background</h4><img style=\"float:left;width:450px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from PostNord's website for tracking parcels.\" data-caption=\"Screenshot from PostNord's website for tracking parcels.\" src=\"/images/postnord02.png\"/>I had just bought a new phone from Komplett.no. The phone was sent with PostNord to my local store. When Komplett.no sent the package, I was e-mailed a link to a page with tracking information (minside.postnord.no, \"min side\" = \"my page\"). When it arrived at the local store, I was sent an SMS from PostNord with the pickup code and the same link to the tracking page. \n\nThe tracking page contained more information in the backend call to get parcel and tracking information than what was displayed on the page.\n\nPostNord delivers, among other postal and shipping services, parcels in the Nordics. Norway was affected. It is possible that the parcel service in Sweden, Denmark, Finland and Germany also was affected. Norwegian tracking number can be checked on other PostNord tracking pages (e.g. international and Swedish page) so I find it likely but unconfirmed.\n\nAccording to privacy policy of Komplett.no the client data is stored up to 36 months in PostNord's databases.\n\nPostNord AB had according to <a href=\"https://www.postnord.com/globalassets/global/sverige/dokument/rapporter/arsredovisningar/2017/postnord-2017-eng.pdf\">2017 numbers</a>, 17.2 million parcels delivered in Norway, 97.7 millions in Sweden, 47.2 millions in Denmark, 8.3 millions in Finland, 15.5 millions in Germany. 154 million parcels in 2017 and 142 million parcels in <a href=\"https://www.postnord.com/contentassets/28039a622d0c4dd0872fc57c7778ecd2/postnord-annual-report.pdf\">2016</a>. At least 450 millions parcels over 36 months. It's unknown to me how many of these have tracking numbers that can be viewed on the tracking page. At least Norwegian tracking numbers can. A good guess for number of parcels in Norway is around 50 million parcels within 36 months. Number of affected customers should be in the millions.\n\nKomplett.no is part of The Komplett Group and is the largest e-commerce player in the Nordic countries. Head quarters in Sandefjord, Norway. Reporting revenue was MNOK 8,100 in 2017. 1,600,000 active customers with one or more orders the last year. Numbers <a href=\"http://canica.no/investment/komplett/\">according to Canica</a> (owner). They pick and send packages 24/7 with a average of 3 per second i 2017. Should be around 95,000,000 (95 mill) packages per year. Komplett.no sends package with Posten Norge (state-owner company, owned by Norway) and the Norwegian parcel service of PostNord AB (state-owned company, owned Sweden and Denmark).\n\n<i>Small curiosity: No more information than Komplett.no have declared in their <a href=\"https://www.komplett.no/kundeservice/om-komplett/personvern/\">privacy policy</a> (Norwegian text) was exposed. I am confident that the privacy policy is telling the truth in the chapter about sharing information with PostNord. Thumbs up!</i>\n\n<h4>Approach (technical stuff)</h4><img style=\"float:left;width:450px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from Chrome Developer Tools showing the excess data returned by the API.\" data-caption=\"Screenshot from Chrome Developer Tools showing the excess data returned by the API.\" src=\"/images/postnord03.png\"/>The page had a <b>URL like https://minside.postnord.no/public-services/tracking/7070205547XXXXXXX</b> (where X was all digits in the tracking code). The tracking codes are GSIN tracking numbers. They have a prefix and a checksum as last digit. They are not far from auto increment. See update below for details. The tracking number is displayed on labels that are printed and put on the packages. They are also sent to the client by the shipping company or the e-commerce company.\n\nThe GUI on the tracking page contained information like city of origin, city of destination, opening hours of pick up point, weight, tracking information. It does not show name og the full address of origin or destination.\n\nInspecting this page in Chrome Developer Tools I found that the REST response contained more information than in GUI. In addition to more detailed information about the package, it contained name, full address, phone number and e-mail for the recipient. It also contained the name and address of origin.\n\nI looked at 3 IDs around the tracking ID I got from my Komplett.no package. They where all Komplett.no packages containing 6 identifiable names (e-mail/phone contained one name and name on package was a different one). On my phone I had an SMS for a package from the company Forbruksimport.no AS back in 2016. The link was still active and my full name, address, company e-mail and phone number was present in REST service. Changing tracking codes around this number I found another package from two other parties (a school and a printing company). <b>This confirmed that both old tracking codes was active</b> and that <b>other PostNord customers was affected</b> (not Komplett.no). I did not confirm any foreign tracking numbers (don't have any).\n\nAll checking of tracking numbers was done manually in the GUI in Chrome. Unless PostNord had mass download protection, I think <b>scripting a download of the whole database would be trivial.</b>\n\n<b>26th of May - Update regarding tracking number (Thanks, Jonas!):</b>\n\nThe tracking numbers are <a href=\"https://en.wikipedia.org/wiki/GS1\">G1</a> numbers and are detected as <a href=\"https://www.gs1.org/standards/id-keys/gsin\">Global Shipment Identification Number</a> [<a href=\"http://www.gs1.no/sites/gs1/files/user/Dokumenter/Brukerveiledninger/transportguiden.pdf\">Norway specific info</a>, in Norwegian] by <a href=\"https://www.gs1.org/services/check-digit-calculator\">GS1's check digit calculator</a>. They have a \"company\" prefix and shipper reference starting at variable positions and have variable length [<a href=\"https://www.gs1.org/docs/idkeys/GS1_GSIN_Executive_Summary.pdf\">ref executive summary</a>]. The last digit is a check sum.\n\nThese are some of my GSIN tracking numbers:\n- 70702055479245968, PostNord - Komplett.no (2018)\n- 70713750137378380, PostNord - Forbrukerimport.no (2016)\n- 70722150148854589, Posten Norge - Verktøy4u.no (2018)\n\nThe 707 prefix is Norway according to <a href=\"https://en.wikipedia.org/wiki/List_of_GS1_country_codes\">List of GS1 country codes on Wikipedia</a> (700-709 = Norway). Both my PostNord tracking codes and the one from Posten Norge have the same 707 prefix. Other tracking codes I have in e-mails from Posten Norge seems to have 707 prefix. I had one with 704 and Roy found one with 705 prefix.\n\nI have not been able to identify what prefixes PostNord uses, if large e-commerce companies like Komplett have their own prefix or what prefix Posten Norge have. I still believe the tracking number are largely auto increments.\n\n<b>27th of May - Update regarding time frame:</b>\n\nAfter a bit of searching on Google for keywords in the JSON output of the service, I was able to find <b>two paste bins from 2013 and 2014</b>. Both outputs had tracking information plus name and full address. They did not have e-mail and phone number. Both were packages from Komplett.no.\n\nThe URL was present in the one from 2013. It is still active on tollpost.no and I could check my on tracking numbers there:\n- http://www.tollpost.no/XMLServer/rest/trackandtrace?q=70702055479245968\n\nThe tollpost.no domain redirects to postnord.no, but not for this service. Tollpost Global AS was accuired by PostNord AB some years back. Testing the same thing on postnord.no, the same API service returned\n- http://www.postnord.no/XMLServer/rest/trackandtrace?q=70702055479245968\n\nI think it's fair to say that the <b>service has been online for above 5 years</b>.\n\n<h4>Security issues</h4><img style=\"float:left;width:450px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from Chrome showing the excess data returned by the API.\" data-caption=\"Screenshot from Chrome showing the excess data returned by the API.\" src=\"/images/postnord01.png\"/>- <b>Personal data secured by predictable tracking number (ID)</b>\n\nThe combination is a leak of estimated millions of customers name, full address, phone number and e-mail address.\n\nThe solution with guessable tracking numbers have both advantages and disadvantages. A number with a checksum is easier to write than something in the length and complexity of UUID. The guessable/predictable part of the number (autoincrement + checksum) makes it insecure. Everybody can find valid numbers.\n\nGiven that they don't switch to something more secure, they can't give out personal data based on this tracking number. PostNord seems to be aware of this, as they have texts like \"Due to security reasons we cannot show the recipient's full name and address. This is the postal code and city to where we will deliver the parcel.\" on <a href=\"https://tracking.postnord.com/\">another tracking solution</a> they provide.\n\n<h4>Reception and handling</h4>The handling was fast, so I'll give the numbers in hours instead of days. Komplett did exactly what they should when notified. They gave a preliminary reply within a short time frame and responding in more detail the morning after. The issue was fixed faster than I expected. The reception was also good as it seemed that they were happy to get the notification.\n\n<h5>Hour 0 (20:16) - Notification</h5><b>Notification was sent to PostNord</b> (Data Protection Officer), <b>Komplett.no</b> (CEO, Data Protection Officer and a contact e-mail regarding personal data) and a copy to The Norwegian Data Protection Authority. The notification contain details about me plus 3 identified Komplett.no customers as example. The 3 customer profiles identified 6 persons (name identified one, e-mail identified another). I also included my 2016 parcel and example which identified a school sending a package to a printing company. I felt that this was enough to get the attention of somebody at top management level to get it fixed in a rush.\n\nI did not think I had found good addresses to contact in PostNord, but I had a better feeling about addresses in Komplett. Smaller company, usually responsive to customers. I also asked the Komplett Chat for an address to notify about security issues. They had none. I did manage to find the name of and get the e-mail confirmed for the security chief, but the e-mail bounced.\n\nNeither PostNord or Komplett had <a href=\"https://securitytxt.org/\">security.txt</a> on the domains I looked at.\n\n<h5>Hour 1.5 (21:40) - Confirmation</h5><b>Komplett thanks for the notification and confirmed that the message was received. This is a good sign that the message was sharp enough that people read it in the evening and sent to the right people.</b> Really important to answer quickly, like Komplett did, if you get a message about security issues. Often the problem is that nobody answers.\n\n<h5>Hour 13 (09:49) - 2nd confirmation</h5>The next morning, I got a friendly call from Komplett. They thanked me again and <b>confirmed that they were in contact with PostNord and that they were on the case.</b>\n\nGDPR is launch in Europe on this day (25th of May 2018). Not active in Norway until 1st of July, but active for all EU citizens in our databases. A lot of privacy policies have already been updated i Norway. <b>Happy GDPR Day!</b>\n\n<h5>Hour 19 (15:03) - Fixed</h5>Phone call from Komplett again. Again thanking me for the notification. I was told that the <b>issue is fixed</b>. I quickly verify it after the conversation.\n\nJust a few minutes later, the Data Protection Officer from Komplett confirms <b>the mandatory incident report to The Norwegian Data Protection Authority was sent</b>. In Norway any unauthorized disclosure of personal data (e.g. data leak or client report sent to the wrong address) must be reported. The reports will be public (a few details might be withheld).\n\n<h4>Conclusion</h4>This is quite a large number of affected customers with their name, e-mail, phone number and full address neatly displayed along with their last parcel delivery. The leak is bad.\n\nPostNord know about the issue of displaying names and other information based on tracking number.",
        "images": [
            "/images/postnord02.png",
            "/images/postnord01.png",
            "/images/postnord03.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Information leak",
                "url": "/information-leak"
            }
        ]
    },
    {
        "title": "Linkifying robots.txt",
        "published": true,
        "publishDate": "2018-06-03T19:50:00.000Z",
        "updateDate": "2018-06-04T16:26:00.000Z",
        "summary": "Here's a simple bookmarklet to linkify <span class=\"code\">robots.txt</span>.",
        "niceUrl": "/2018/06/robots-txt-linkifier",
        "text": "<h4>tl;dr</h4><a href=\"https://en.wikipedia.org/wiki/Robots_exclusion_standard\"><span class=\"code\">robots.txt</span></a> is a unfortunately often a source for finding links to parts of websites that should not be publicly known (or even be on the Internet in the first place). I've written a few lines of JavaScript to make it quicker to visit all the links in this file.\n\n<h4>Bookmarklet</h4><p style=\"text-align:center;\"><a onclick=\"alert('No need to click this. :-) Just drag the link to your bookmark row or copy it and paste it into a new bookmark.');return false;\" href=\"javascript:(function()%7Bconsole.log(%27robots.txt%20linkifier%20v1.1%3B%20https%3A%2F%2Fblog.roysolberg.com%27)%3Bif(location.pathname!%3D%27%2Frobots.txt%27)%7Bif(confirm(%27Do%20you%20want%20to%20navigate%20to%20%2Frobots.txt%3F%20You%20need%20to%20run%20the%20bookmarklet%20again%20to%20linkify%20it.%27))%7Blocation.href%3D%27%2Frobots.txt%27%7D%3Breturn%7D%3Bfunction%20openLinks()%7Bvar%20links%3Ddocument.links%3Bif(links.length%3E20)%7Bif(!confirm(%27There%20are%20%27%2Blinks.length%2B%27%20links.%20Are%20you%20sure%20you%20want%20to%20open%20them%20all%20at%20once%3F%27))%7Breturn%7D%7D%3Bconsole.log(%27Some%20browsers%20will%20block%20opening%20links%20this%20way.%27)%3Bfor(var%20i%3D0%3Bi%3Clinks.length%3Bi%2B%2B)%7Bwindow.open(links%5Bi%5D.href%2C%27_blank%27)%7D%7D%3Bvar%20base%3Dlocation.protocol%2B%22%2F%2F%22%2Blocation.hostname%2B(location.port%26%26%22%3A%22%2Blocation.port)%3Bvar%20html%3D%27%3Cbody%20style%3D%22font-size%3A120%25%3B%22%3E%3Cscript%3E%27%2BopenLinks.toString()%2B%27%3C%2Fscript%3E%3Cbutton%20type%3D%22button%22%20style%3D%22width%3A200px%3Bheight%3A40px%3Bfont-size%3A120%25%3B%22%20onclick%3D%22openLinks()%3B%22%3EOpen%20all%20links%3C%2Fbutton%3E%3Cdiv%20style%3D%22font-family%3A%20monospace%3B%22%3E%27%3Bhtml%2B%3Ddocument.body.textContent.replace(%2F(Allow%7CDisallow)%3A%20(%5C%2F%5CS*)%2Fg%2C%27%241%3A%20%3Ca%20href%3D%22%27%2Bbase%2B%27%242%22%20target%3D%22_blank%22%3E%242%3C%2Fa%3E%27).replace(%2F%5Cn%2Fg%2C%27%3Cbr%2F%3E%27)%3Bvar%20win%3Dwindow.open()%3Bwin.document.write(html)%3Bwin.document.close()%7D)()%3B\" class=\"waves-effect waves-light btn-large\">robots.txt linkifier</a></p><b>Just drag the button to your bookmark row in your browser.</b> (In some browsers you might need to copy and paste the link of the button into a new bookmark.)\n\n<b>After that you can just click the bookmark when visiting websites' <a href=\"/robots.txt\"><span class=\"code\">robots.txt</span> (like my)</a> to get them linkified and even all their links opened with just one click of a button.</b>\n\n<h4>What's a bookmarklet?</h4>A <a href=\"https://en.wikipedia.org/wiki/Bookmarklet\">bookmarklet</a> is a bookmark stored in a web browser that contains JavaScript commands that add new features to the browser. Bookmarklets can be useful tools, e.g. for increasing the readability of web pages, do searches, create short urls, etc.\n\n<h4>Source code</h4>Here's the few lines of source code without <a href=\"https://en.wikipedia.org/wiki/Minification_(programming)\">minification</a> and without <a href=\"https://en.wikipedia.org/wiki/Percent-encoding\">URL encoding</a>.<pre class=\"prettyprint lang-js\">/*\n* ----------------------------------------------------------------------------\n* \"THE BEER-WARE LICENSE\" (Revision 42):\n* http://github.com/roys wrote this file.  As long as you retain this notice\n* you can do whatever you want with this stuff. If we meet some day, and you\n* think this stuff is worth it, you can buy me a beer in return.   Roy Solberg\n* ----------------------------------------------------------------------------\n*/\njavascript: (function () {\n    console.log('robots.txt linkifier v1.1; https://blog.roysolberg.com');\n    if(location.pathname != '/robots.txt'){\n        if(confirm('Do you want to navigate to /robots.txt? You need to run the bookmarklet again to linkify it.')){\n            location.href= '/robots.txt';\n        }\n        return;\n    }\n    function openLinks() {\n        var links = document.links;\n        if (links.length > 20) {\n            if (!confirm('There are ' + links.length + ' links. Are you sure you want to open them all at once?')) {\n                return;\n            }\n        }\n        console.log('Some browsers will block opening links this way.');\n        for (var i = 0; i < links.length; i++) {\n            window.open(links[i].href, '_blank');\n        };\n    }\n    var base = location.protocol + \"//\" + location.hostname + (location.port && \":\" + location.port);\n    var html = '&lt;body style=\"font-size:120%;\">&lt;script>' + openLinks.toString() + '&lt;/script>&lt;button type=\"button\" style=\"width:200px;height:40px;font-size:120%;\" onclick=\"openLinks();\">Open all links&lt;/button>&lt;div style=\"font-family: monospace;\">';\n    html += document.body.textContent.replace(/(Allow|Disallow): (\\/\\S*)/g, '$1: &lt;a href=\"' + base + '$2\" target=\"_blank\">$2&lt;/a>').replace(/\\n/g, '&lt;br/>');\n    var win = window.open();\n    win.document.write(html);\n    win.document.close();\n})();</pre>\nThe software and source code is released under the <a href=\"https://en.wikipedia.org/wiki/Beerware\">beer-ware licence</a> 🍻💻.\n\n<a href=\"https://github.com/roys/js-bookmarklet-robots\">The source code is also available at GitHub</a>.\n\n<h4>Want more bookmarklet fun?</h4>Why don't you try out my bookmarklet game <a href=\"/2017/10/dom2-bookmarklet\">DOM II: JavaScript Hell</a>? 😎\n",
        "images": [],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "JavaScript",
                "url": "/javascript"
            },
            {
                "title": "Bookmarklet",
                "url": "/bookmarklet"
            }
        ]
    },
    {
        "title": "Case #16: Free parking and personal data",
        "published": true,
        "publishDate": "2018-06-11T04:40:00.000Z",
        "summary": "It was possible to do systematic account takeover for one of Norway's biggest parking companies.",
        "niceUrl": "/2018/06/free-parking",
        "text": "<h4>tl;dr</h4>The parking company <i>OnePark</i> had a security issue that made it possible to systematically iterate through and change the username and password for all of their customers. By logging in afterwards one could collect personal data and even register your car's licence plate to be paid by that account.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://onepark.no/\">OnePark</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>November 2017</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"orange-text\">Fair</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with personal information</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4>OnePark is one of Norway's biggest parking companies. They have many parking lots where they use <a href=\"https://en.wikipedia.org/wiki/Automatic_number-plate_recognition\">automatic number-plate recognition (ANPR)</a>. You can just park your car, and then after picking it up you have 48 hours to go online to pay your bill. You don't even have to do any registration up front.\n\n<b>I got a tip that OnePark sends out the passwords for their accounts in clear text - and that is just never a good sign.</b> So I decided to take a quick peek at their site.\n\n<h4>Approach (technical stuff)</h4><!--a class=\"skip-link\" href=\"#security-issue\">Skip</a--><img style=\"width:500px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from source code of Onepark's profile page.\" data-caption=\"Screenshot from source code of Onepark's profile page.\" src=\"/images/onepark03.png\"/>I took a look at OnePark's site with <a href=\"https://help.vivaldi.com/article/developer-tools/\">Vivaldi developer tools</a> running. I created an account (you can create as many as you'd like using just an e-mail address) and looked at the communication with the server.\n\nMost stuff looked good, but <b>I hesitated when I saw that the web form for updating the user profile actually sent the user's ID back. The user ID was that classic integer that we so often see and therefore - when there's a vulnerability - opens up for an enumeration attack.</b>\n\nI didn't want to destroy anyone else's data so <b>I created myself a another new account and tested by passing that user ID in when doing a profile update with a third e-mail address and a new password. The site didn't complain, and voilà - I was able to log in to the other account with that e-mail address and password.</b> <span title=\"Hacker cat\">🐱‍💻</span>\n\nBut of course, now the data was all replaced by mine. So <b>I removed all other form fields than the username (e-mail address) and password from the profile update request. This worked just fine.</b>\n\nInside the other person's profile it was now possible to get hold of all the personal data, including any licence plate numbers and see if there was payment information added to the profile. The payment information was securely stored at a third-party site.\n\nSince the user ID was an integer one could easily have set up a script to steal all the data. And not only that, one could also of course do vandalism by updating/removing the data. What's more - if one's a bit bold - <b>one could register the licence plate of the car and remove it after the parking was paid for. I did not check if this would be easily spotted and trackable for either the customer or OnePark.</b>\n\n<h4 id=\"security-issues\">Security issues</h4><img style=\"width:500px;float:right;margin-left:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot of Onepark's profile page.\" data-caption=\"Screenshot of Onepark's profile page.\" src=\"/images/onepark02.png\"/><img style=\"width:500px;float:right;margin-left:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot of Onepark's profile page.\" data-caption=\"Screenshot of Onepark's profile page.\" src=\"/images/onepark01.png\"/><b>One could systematically go through all customers and retrieve the following information:\n - Full name\n - Full address\n - Phone number\n - Licence plate numbers\n</b>\nIt was also possible to register any car's licence plate to be paid for with any account. In addition initial and reset passwords were sent in clear text by e-mail.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>I found a contact form where I described the issue with the account takeover.\n\nI got an automatic reply that they had received the e-mail.\n\n<h5>Day 10</h5>I got a phone call (even though I didn't give them my phone number) from one of the chiefs of the company that apparently was responsible for OnePark's web solution.\n\n<b>He thanked me a lot and clearly was proud that they had fixed the issue in just three hours. Three hours? Well, my message took 9.5 days to reach the people that could actually fix the issue.</b>\n\nWhile the handling of this company was good, OnePark seems to have quite a way to go on how to receive and handle issues around their online security.\n\nJust after the phone call I also received an e-mail from the same chief - again thanking me and telling how they dealt with the issue.\n\n<h4>Conclusion</h4>Just like <a href=\"/2018/04/power-company-leak\">the security issue with the power company Norgesnett</a> this is a case where the authorization check for updating the profile fails. And because of the usage of an integer as user ID it was possibly to systematically exploit the issue.\n\nIt is quite common for software developers to trust the authentication, but then forgetting the authorization check and user input sanitization.\n\nAnd yet again we can see our personal data open for anyone to steal…\n",
        "images": [
            "/images/onepark01.png",
            "/images/onepark02.png",
            "/images/onepark03.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Account takeover",
                "url": "/account-takeover"
            },
            {
                "title": "OWASP 2017 A5",
                "url": "/owasp-2017-a5"
            }
        ]
    },
    {
        "title": "Case #17: Tracking dog owners",
        "published": true,
        "publishDate": "2018-06-25T04:57:00.000Z",
        "summary": "The tool for the owner to track its pet became a tool for tracking all the pet owners themselves. The hunters became the hunted.",
        "niceUrl": "/2018/07/tracking-dog-owners",
        "redirectUrls": [
            "/2018/07/tracking-dog-owners"
        ],
        "text": "<h4>tl;dr</h4>A tracking system was leaking information about all the users, pictures, and information and location data from all the trackers.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td>Anonymous, let's call them <a href=\"https://en.wikipedia.org/wiki/Fictional_company\">Acme4</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>May 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with pictures, personal information and location data</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4>Acme4 sells a tracking chip intended to be used for dogs. There's a companion mobile app which is used to see the tracker on the map and send commands to it. It was a bit of a coincident that I noticed this system and took a closer look at it.\n\n<h4>Approach (technical stuff)</h4><a class=\"skip-link\" href=\"#security-issues\"><u>Skip this part</u> 🙈</a><h5>The app</h5>I never had physical access to a tracker, so the only entry point for me was the app itself.\n\nI have <a href=\"/2018/02/crack-android-apps\">my guide on how to crack Android apps</a> which I take a quick glance at when doing this stuff. This was easy enough though. I downloaded the APK from <a href=\"https://apkmonk.com\">apkmonk.com</a> and decompiled it with <a href=\"http://www.javadecompilers.com/apk\">javadecompilers.com</a>. The end result was a an full access to the source code and resources.\n\n<span class=\"markup\">Normally I would probably just have used a HTTP proxy to intercept the traffic, but in this case where I didn't have the necessary hardware (the tracker) I wouldn't be able to use all functions, so I needed the source code to discover all possible HTTP calls. Also the source code sometimes include hidden gems like unused endpoints, test servers and more.</span>\n\nI was a bit surprised by the how clean the code was and how it used modern patterns and libraries. The UI isn't that nice and often I find there to be a correlation..\n\n<h5>The server API</h5>With the app's source code I could try out the server communication. <span class=\"markup\">This wasn't exactly your regular REST API. While the data returned from the server was JSON, all of the calls were GET calls for all kinds of actions with the data in query string parameters  - even the authentication.</span> Of course this just make it much easier to play around using a desktop browser.\n\n<em>The search for adding friends had the classic \"return everything\" when searching for <code>___</code>.</em> There's nothing inherently wrong with that, but it isn't ideal, and also <em>the search returned the ID, username, a display name, first name, last name and e-mail address of the users.</em>\n\n<h5>That open Amazon S3 bucket</h5><img style=\"width:400px;float:left;margin:0 20px 20px 0;\" class=\"materialboxed responsive-img\" title=\"Location data from one of the GPS trackers.\" data-caption=\"Location data from one of the GPS trackers.\" src=\"/images/acme402.png\"/><span class=\"markup\">I found all the pictures of the users in an open <a href=\"https://en.wikipedia.org/wiki/Amazon_S3#Design\">Amazon S3 bucket</a>. Luckily most of the users are dogs. 😅</span> But still, some owners might upload pictures of themselves with their pet. Surely the owners don't expect the pictures to be lying around on the Internet.\n\n<h5 style=\"clear:left;\">The web site</h5><img style=\"width:400px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Location data from one of the GPS trackers.\" data-caption=\"Location data from one of the GPS trackers.\" src=\"/images/acme401.png\"/>In addition to the app I found a \"my page\" at the service's website, and this is where I struck gold. Most of the site's PHP scripts were available when logged in, but the scripts were located in a directory with open directory listing.\n\n<em>Using the PHP scripts it was possible to iterate through all of the registered trackers as the ID was based on an incremental integer. The combined tracker information I got from the scripts was ID, phone number (to the tracker SIM card), <a href=\"https://en.wikipedia.org/wiki/International_Mobile_Equipment_Identity\">IMEI</a>, display name and historical location data (latitude, longitude, address, direction).</em>\n\n<em>The good news is that I didn't find any direct way of seeing which tracker belonged to which user. However, about 5% could be connected because of the display name of the tracker. Additionally, because of the incremental IDs, it was possible to pretty accurately estimate which tracker belonged to which user.</em>\n\n<h4 id=\"security-issues\">Security issues</h4><em>One could systematically go through all users and all trackers and retrieve the following information:\n - Users:\n   - Full name\n   - E-mail address\n   - Username\n   - Display name\n - Trackers:\n   - Display name\n   - Location (latitude, longitude, direction, address)\n   - IMEI\n   - Phone number\n</em>\nIt was only possible to either estimate the owner of the tracker (based on incremental IDs) or - for 5% av of the trackers - assume a match based on display names. <em>All pictures of the pets were available for download.</em>.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>Night time Friday I sent an e-mail to the support address. I like to keep it short, but this was probably the longest description I've had to write in such an e-mail.\n\n<h5>Day 3</h5>Before lunch on Monday I got an e-mail thanking me for the report.\n\n<h5>Day 4</h5>Again before lunch, I got an e-mail telling me that everything should be fixed. So this was all pretty quickly taken care of.\n\n<h5>Day X</h5>While doing this write-up I saw - and reported - that the search for adding friends within the app still also returns e-mail addresses and still returns all users if searching for a special character. I hope that'll be fixed. Imagine Facebook giving away all users and their e-mail addresses that easily.\n\n<h4>Anonymous you say?</h4>I looked into the financial and other public information of this company. I also checked out social media and did a little general due diligence. Though the person behind the company might not do all coding and support personally, it appeared to be a one-man show. <em>I don't want to use my blog to afflict individuals.</em> <a href=\"/2017/08/security-vulnerability-disclosures\">As stated before</a>, I want people to know that none of their data is secure, I want us developers to improve our data security skills, and I want companies to take more responsibility around data security and their customer data.\n\n<h4>Conclusion</h4>Maybe we as consumers should think twice when buying devices connected to the Internet. Think about what information you hand over to the vendor and what could be the worst case if everything's leaked. Would someone be able to live track you? Would someone be able to know when you're not at home? Would you be ok with anyone having the usage data for this system? Would you be fooled if anyone used this information in a clever way in a <a href=\"https://en.wikipedia.org/wiki/Phishing\">phising e-mail</a>?\n\n<em>I wish that there was some sort of certification to know that an IoT vendor at least fulfils some minimum standards in regards of computer security and have regularly third party audits.</em>\n",
        "images": [
            "/images/acme401.png",
            "/images/acme402.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Internet of Things",
                "url": "/iot"
            },
            {
                "title": "OWASP 2017 A5",
                "url": "/owasp-2017-a5"
            }
        ]
    },
    {
        "title": "Case #18: I know what you did last summer - and also what you will be doing this one",
        "published": true,
        "publishDate": "2018-07-09T04:50:00.000Z",
        "summary": "Thomas Cook Airlines was leaking passenger information about future og past flights. Information about tens of thousands - or maybe hundreds of thousands - of travels could be systematically downloaded.",
        "niceUrl": "/2018/07/airline-flights-leak",
        "text": "<h4>tl;dr</h4>It was possible to - partially very systematically - retrieve passenger information for travelers with Thomas Cook Airlines. Data as old as from 2013 and all the way to 2019 was available.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"http://www.thomascookairlines.no/\">Thomas Cook Airlines</a> (and especially travelers booking via <a href=\"https://www.ving.no/\">Ving</a>)</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span> to <span class=\"red-text\">high</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>June 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"orange-text\">Fair</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you from Thomas Cook Airlines, a \"thank you, but there are no issues\" from Ving</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with personal and travel information from at least 2013 including future travels</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from Thomas Cook Airlines' site Airshoppen.\" data-caption=\"Screenshot from Thomas Cook Airlines' site Airshoppen.\" src=\"/images/airshoppen02.png\"/>I had just paid for my vacation with Ving when I got an e-mail from Thomas Cook Airlines with a link to <a href=\"https://airshoppen.com\">airshoppen.com</a> where you can upgrade your flight (i.e. meals, seating, etc), buy duty free and do the online check-in. I got a bit curious when I saw that the links from the e-mail did an auto login of my user based on only very little data.\n\n<h4>Approach (technical stuff)</h4><a class=\"skip-link\" href=\"#affected\"><u>Skip this part</u> 🙈</a>\nThe links from all the e-mails from Thomas Cook Airlines to their domain airshoppen.com were click registration URLs also containing a redirect URL. The redirect URL was of the format\n<code style=\"font-size:smaller;\">https://no.airshoppen.com/autologin?ReturnUrl=/oppgrader-flyreisen-din&<em>bookingNo=&lt;integer booking number&gt;&tourOperatorTag=&lt;short name tour operator&gt;&depDate=&lt;departure date&gt;</em>&&lt;some <a href=\"https://en.wikipedia.org/wiki/UTM_parameters\">UTM parameters</a>&gt;</code>\n\nThat link did another redirect which made you end up as logged in and you could see some of your personal info. Of course, the only natural thing to do was to play with the parameters; change the dates, change the booking number and remove one or more parameters.\n\n<em>The first thing I discovered was that I could log in to my own booking using +-1 day in the URL. I'm sure this is done to avoid problems with timezones when people log in and pick their travel date manually. However, this means that guessing on a close by booking number one only needs 120 guesses to cover a full year of travel dates. To me this is not very assuring.</em>\n\nWhen you are logged in you are presented with a list of the names of everyone travelling on the same booking. You can then select who any orders will be registered on. Copying that call to <a href=\"https://curl.haxx.se/\">curl</a> would make it look something like this:<pre class=\"prettyprint\">\ncurl 'https://no.airshoppen.com/Account/SelectPassenger?locale=nb-NO' \\\n    -H 'Cookie: ASP.NET_SessionId=&lt;session ID&gt;; &lt;lotsa cookies 🍪&gt;; .AIRSHOPPENAUTH=&lt;some auth token&gt;' \\\n    -H 'Origin: https://no.airshoppen.com' \\\n    -H 'Accept-Encoding: gzip, deflate, br' \\\n    -H 'Accept-Language: nb-NO,nb;q=0.9,no;q=0.8,nn;q=0.7,en-US;q=0.6,en;q=0.5' \\\n    -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.183 Safari/537.36 Vivaldi/1.96.1147.42' \\\n    -H 'Content-Type: application/x-www-form-urlencoded; charset=UTF-8' \\\n    -H 'Accept: */*' \\\n    -H 'Referer: https://no.airshoppen.com/autologin?ReturnUrl=/oppgrader-flyreisen-din&bookingNo=&lt;integer booking number&gt;&tourOperatorTag=&lt;short name tour operator&gt;&depDate=&lt;departure date&gt;&&lt;some UTM parameters&gt;' \\\n    -H 'X-Requested-With: XMLHttpRequest' \\\n    -H 'Connection: keep-alive' \\\n    --data 'TravelDocumentsRequired=False\n        &Email=&lt;e-mail address&gt;\n        &ShowCanContact=False\n        &IsPersistant=false\n        &SignInModel.SelectedTourOperatorTag=&lt;short name tour operator&gt;\n        &SignInModel.DepartureDate.Day=&lt;departure day&gt;\n        &SignInModel.DepartureDate.Month=&lt;departure month&gt;\n        &SignInModel.DepartureDate.Year=&lt;departure year&gt;\n        &SignInModel.SigninMethodType=\n        &SignInModel.BookingNo=&lt;booking number&gt;\n        &SignInModel.ReturnUrl=%2F\n        &SignInModel.HashValue=' \\\n    --compressed</pre>\nThat call returned markup with personal and flight information. However, I quickly saw that this call could be shortened to this:<pre class=\"prettyprint\">\ncurl 'https://no.airshoppen.com/Account/SelectPassenger' \\\n    --data 'SignInModel.SelectedTourOperatorTag=&lt;short name tour operator&gt;\n        &SignInModel.BookingNo=&lt;booking number&gt;'</pre>\n\n<em>Now, this was an issue. Using only the three letter short name for Ving and booking information the server would return the same data about the booking.</em>\n\nAs this was a POST call I would guess there are no logs that really can tell if this vulnerability has been misused by anyone.\n\n<img style=\"float:left;width:450px;margin:0 20px 20px 0;\" class=\"materialboxed responsive-img\" title=\"Screenshot showing security vulnerability.\" data-caption=\"Screenshot showing security vulnerability.\" src=\"/images/airshoppen03.png\"/>\n\n<h4 id=\"affected\" style=\"clear:left;\">Which travel companies were affected?</h4>I never download a lot of data as I don't want anyone to question my motives, but I do like to get an idea of the scope of a data leak, so I did a few tests to see if I could see how many bookings this was affecting.\n\n<em>For Ving this was pretty serious as they use a booking number that is seemingly an incremental integer, which makes it possible to iterate through all bookings.</em> It's worth noting that not all Ving travels are using Thomas Cook Airlines, but quite a few of their 400,000 yearly travelers do.\n\n<em>For Ving the oldest bookings I saw were from 2013, and the most recent one from 2019. I suppose this means that data was leaking about <b>at least</b> tens of thousands of travels.</em>\n\nI asked friends and family for booking numbers to test with, and even found some more on Google. <em>It was possible - using only the booking number - to get the data for the travels from the travel companies <a href=\"https://ving.no\">Ving Norway</a>, <a href=\"https://www.ving.se/\">Ving Sweden</a>, <a href=\"https://spies.dk/\">Spies Denmark</a> and <a href=\"https://apollo.no/\">Apollo Norway</a>.</em>\n\nLuckily Apollo doesn't have that easily guessable booking numbers, so I couldn't find any other bookings from the one number I had. I never got any data from the travel company <a href=\"https://tui.no/\">TUI</a> (ex Star Tour), but I didn't have any recent or future booking numbers. (TUI do however seem like the company most concerned and in control in regards of <a href=\"https://en.wikipedia.org/wiki/General_Data_Protection_Regulation\">GDPR</a>, so maybe they don't have any old data available in Thomas Cook Airlines' systems?)\n\nOther than that it's only speculations, but <em>airshoppen.com do handle many, many travel companies from Norway, Sweden, Denmark, Finland, United Kingdom and Germany. I would expect at least some of them to be vulnerable through this leak.</em> airshoppen.com also serves travelers travelling with <a href=\"https://condor.com/\">Condor</a>, <a href=\"https://atlantic.fo/en/\">Atlantic Airways</a> and <a href=\"https://www.smallplanet.aero/en/\">Small Planet Airlines</a>, but please note that I never saw any actual data for these three airlines.\n\n<h4 id=\"security-issues\">Security issues</h4><em>It was possible to retrieve the following information from Thomas Cook Airlines using only a booking number:\n - Full name of all travelers on that booking\n - E-mail address of person registering the booking\n - Departure:\n   - Date\n   - Airport\n   - Flight number\n - Return:\n   - Date\n   - Airport\n   - Flight number\n\nIt was seemingly possible to iterate Ving's bookings with Thomas Cook Airlines from 2013 to 2019. At least data from Ving Norway, Ving Sweden, Spies Denmark and Apollo Norway was affected by this vulnerability.</em>\n\n<h4>Reception and handling</h4><h5>Day zero</h5>I really struggled to find a proper contact point for airshoppen.com, but I submitted a web form with the closest possible topic telling them about the issue. I got an automatic reply by e-mail.\n\n<h5>Day 1</h5>The morning after, not having heard back, I felt that this leak was too big to just slide. I asked Ving on their chat for an e-mail address where I wrote them and gave the issue ticket number from Thomas Cook Airlines.\n\n<em>Ving replied back in just a few hours. They thanked me, told me they would pass it on internally and contact Thomas Cook Airlines. They also told me that I would hear back from Thomas Cook and not Ving.</em>\n\n<h5>Day 8</h5><em>This was the first time Thomas Cook Airlines replied to my inquiry. And guess what? They just said that they needed my booking number to help me. What the ...</em> I tried to clarify that I was reporting a security hole and they probably wouldn't need my booking number for that.\n\n<h5>Day 11</h5><em>Ving actually wrote me back and told me Thomas Cook Airlines had looked at the issue. They told me that I couldn't log in without having both the booking number and the departure date. What the ...</em>\n\nI replied that this really was an issue and that data back as far as to 2013 was available.\n\n<em>Ving replied and told me I needed the date and it wasn't as easy as I said. I asked them to give me a booking number so I could prove it. I never heard back from them after that.</em>\n\n<em>Annoyed by their ignorance and unwillingness to fix the issue I contacted a journalist.</em>\n\n<h5>Day 14</h5><em>Like most days I checked if the issue was still there. It was suddenly fixed.</em> Though I hadn't heard a word back from them.\n\n<h5>Day 15</h5><em>I got an e-mail from a legal counsel in Thomas Cook Airlines verifying that they had identified and closed the vulnerability.</em> It wasn't the most grateful e-mail I've ever got, but they could tell me that they'll keep working to improve the security and that they take their customers' security very seriously.\n\n<h5>Day 19</h5><em>I got a phone call from the same legal counsel in Thomas Cook Airlines.</em> She wanted to thank me for informing them about the issue and apologized that it took so long before I heard back from them. They were going to follow GDPR in regards of handling of the incident, but <em>from my understanding they don't think it's worth reporting to the <a href=\"https://en.wikipedia.org/wiki/National_data_protection_authority\">data protection authority</a></em>.\n\n<h4>Is this leak a problem?</h4>Well, <em>you can try calling an airline or someone working at an airport and ask them for passenger information. You won't get it. You are not supposed to know that person X is currently or probably will be onboard on flight Y.</em>\n\nAlso, some people might not like that you can see who they travelled with on vacation maybe 5 years ago. (<i>\"Didn't you say you were going to that job conference in Stockholm? And who is this you were travelling with?\"</i>)\n\nAnother problem with this is how this opens up for <a href=\"https://en.wikipedia.org/wiki/Phishing#Spear_phishing\">spear phishing</a> - to use the information to target and deceive a traveler.\n\n<em>Who really knows how long someone can have taken advantage of this leak..?</em>\n\n<h4>Media coverage</h4>As in <a href=\"/2018/04/hotel-leak\">the case with the leaked hotel reservations</a> I decided to publish this through media first. <a href=\"https://svenska.yle.fi/artikel/2018/07/06/konstantins-resa-till-jamaica-inte-sa-privat-som-han-trodde-avslojades-via-stort\">Yle covered the story a few days ago</a> (Swedish link only, sorry). Yle is is Finland's national public broadcasting company. I'm glad to see that big media companies like Yle cares about online security and our personal data.\n\n<h4>Conclusion</h4>Another week, another leak. It's disappointing that so much of my personal information and usage data is available for anyone on the Internet. What I can find in just a couple of minutes on a website is surely just the tip of the iceberg.\n\nWhile we will continue to see leaks like this I hope that companies will get better at handling and dealing with information about security vulnerabilities. For me the whole process reporting this issue wasn't very pleasant. It could be a coincidence, but shortly after I contacted media the issue was fixed and I finally received a proper response. Only <em>after the phone call with Thomas Cook Airlines on day 19 I was more satisfied with how the whole incident in total was handled. The conversation made it clear to me that they really did take this seriously.</em>\n",
        "images": [
            "/images/airshoppen01.png",
            "/images/airshoppen02.png",
            "/images/airshoppen03.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "OWASP 2017 A5",
                "url": "/owasp-2017-a5"
            }
        ]
    },
    {
        "title": "Behind the news: Unresponsible disclosure",
        "published": true,
        "publishDate": "2018-08-03T09:40:00.000Z",
        "updateDate": "2018-08-04T08:40:00.000Z",
        "summary": "A newspaper published details about a newly discovered serious security vulnerability. Here are the details that the newspaper article did not give.",
        "niceUrl": "/2018/08/unresponsible-disclosure",
        "text": "<h4>Background</h4>Just hours after I warned Thomas Cook Airlines about <a href=\"/2018/07/airline-flights-leak\">a massive leak of flight data</a>, <em>the Norwegian newspaper VG <a href=\"https://www.vg.no/nyheter/innenriks/i/yvMvxJ/fikk-logget-seg-paa-reiseselskaps-bookingsystem\">reported about a person who accidentally got logged in as a booking agent on a travel agency's web site</a>. What surprised me was that the travel agency wasn't notified first and that the newspaper published the article without giving any chance to fix the issue.</em>\n\n<h4>Who was this?</h4>The travel agency with the affected system was the Norwegian <a href=\"https://amisol.no\">Amisol</a> (ex Pyramidene Reiser). They were using a booking system called <a href=\"https://www.adbutveckling.se/travelbook\">TravelBook</a> from a Swedish company called <a href=\"https://www.adbutveckling.se/\">adb utveckling</a>.\n\n<h4>Security issue</h4><img style=\"float:right;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"List of bookings found through a simple Google search.\" data-caption=\"List of bookings found through a simple Google search.\" src=\"/images/amisol01.png\"/><img style=\"float:right;width:400px;margin-right:20px;margin-top:20px;clear:right;\" class=\"materialboxed responsive-img\" title=\"Booking details found via a simple Google search.\" data-caption=\"Booking details found via a simple Google search.\" src=\"/images/amisol02.png\"/>The security issue here was <em>anyone on the Internet could log in as the booking agent</em> for the travel agency:\n- The <em>username and password for the booking agent was visible</em>\n- The following information about <em>travels from at least 2013 to 2018</em> was available:\n<em>  - Booking number\n  - Password for checking booking\n  - Info about all travelers on that booking:\n    - Full name\n    - Birthday\n    - Gender\n  - Additional info about person registering the booking:\n    - Customer number\n    - E-mail address \n    - Phone number(s)</em>\n  - Order date\n<em>  - Departure:\n    - Date\n    - Flight number</em>\n    - Airport\n    - Meal\n<em>  - Return:\n    - Date\n    - Flight number</em>\n    - Airport\n    - Meal\n  - Info about hotel:\n<em>    - Hotel name</em>\n    - Room type\n    - Meals\n  - Excursions\n  - Price\n  - Amount left to pay\n<em>- It seemed to be possible to change the above information and even cancel the trip\n- All personal information was sent unencrypted over the Internet\n- Agent username and password was sent unencrypted over the Internet\n- End user username and password was sent unencrypted over the Internet</em>\n\n<h4>Unethical disclosure</h4>The person discovering the security vulnerability was no IT person and I can kind of see how he decided to notify the newspaper after doing such a random discovery through Google. However, I cannot understand how the journalist or editor would publish the article the same day as they got the tip about the issue. The newspaper interviewed the CEO of Amisol, but they did not give them or the system vendor any time to actually look at the issue or left alone fix it.\n\nWhy is this bad? Well, <em>I read the news article shortly after it was published and I just googled for the term <i>\"amisol booking\"</i> and found the link with the agent login.</em> I could log in and see all the details about all the travels from at least 2013 to future ones. It would take minutes to make a script that could download all the personal data I listed and anyone could go in and do their best to ruin a future vacation.\n\nIn Norway the press have to follow the <a href=\"http://presse.no/pfu/etiske-regler/vaer-varsom-plakaten/vvpl-engelsk/\">Ethical Code of Practice for the Press</a>. I don't know if this is a breach of the publication rule 4.3 that says <i>\"Always respect a person’s character and identity, privacy, etnicity, nationality and belief.\"</i> But none the less, VG did indeed risk thousands of people's privacy when giving anyone the description on how to find all these personal data. I don't think that was the right thing to do.\n\n<h4>Technical details</h4><a class=\"skip-link\" href=\"#conclusion\"><u>Skip this part</u> 🙈</a>\nI wanted to add the technical details of this issue and what should have been in place to avoid it.\n\n<h5>1. Enforce SSL</h5>In 2018 you cannot create a system like this that does not use https. If your old legacy system is still using http you need to upgrade. And remember to check two things:\n - <em>Ensure that if you change a <code>https</code> link to <code>http</code> it does a redirect to <code>https</code> instead of returning any content over <code>http</code>.</em>\n - <em>Check that the cookie flag <a class=\"code\" href=\"https://en.wikipedia.org/wiki/HTTP_cookie#Secure_cookie\">Secure</a> is used</em> (or else the browser may send things like the session cookie over http (even if you do the mentioned redirect)).\n\nIf you are in doubt if you site needs <code>https</code> or why it's a good idea in general, please check out <a href=\"https://www.troyhunt.com/heres-why-your-static-website-needs-https/\">Troy Hunt's great article and video</a> on the subject. Also, <a href=\"https://www.wired.com/story/google-chrome-https-not-secure-label/\">from Chrome 68 Google now labels http sites as \"not secure\"</a>.\n\nIt's also a good idea to use <a href=\"https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security\">HTTP Strict Transport Security (HSTS)</a> to protect against protocol downgrade attacks.\n\n<h5>2. Don't accept login information as query parameters</h5>This is what gave away the Amisol security vulnerabilities. <em>Because the username and password was sent as <code>GET</code> (and with no redirects) instead of <code>POST</code> - and Google somehow got hold of the URL - it was indexed and available through search.</em> Just in case it's worth testing that even though your login form is using <code>POST</code> that it does not accept the credentials in a <code>GET</code> request.\n\n<h5>3. Avoid XSS</h5>I suppose some think of <a href=\"https://en.wikipedia.org/wiki/Cross-site_scripting\">XSS</a> as harmless fun, but I think that's a harmful view. <em>For this site it was - and still is - possible to endanger both administrators and customers. A successful attack would make it possible to steal usernames, passwords, session cookies, personal data, and also to alter and delete data.</em>\n\n<h5>4. Use robots.txt</h5>While some might argue that hiding stuff is <a href=\"https://en.wikipedia.org/wiki/Security_through_obscurity\">security by obscurity</a>, it's a good practice to not let your administrator pages show up in search. It's not what anyone (except for bad guys) want to find when searching for something related to your service. <em>Just remember to not specify direct URLs to your admin stuff in <code>robots.txt</code> or else it just makes it easier to try to find any ways into your system.</em>\n\n<h5>5. Keep your software up to date</h5>Looking at the server's response header it responded with <em><code>Server: Microsoft-IIS/6.0</code></em>. If that's right <em>that's pretty crazy. That is software from 2003 - 15 years ago.</em> <a href=\"https://www.cvedetails.com/vulnerability-list.php?vendor_id=26&product_id=3436&version_id=13492&order=3\">The list of bugs in the CVE security vulnerability database</a> is pretty long, and I would expect that the belonging Operating System, frameworks and libraries to be of the same age.\n\n<h5>6. Have a third party external audit</h5>The challenge with IT security is that the good guys need to find all vulnerabilities, while the bad guys only need to find one. Security is not easy, or everybody would get it right. Instead, we all get it wrong at some point to some degree. <em>IT security is not a <i>state</i>, it's a <i>process</i>.</em> Any sort of audit would surely discover the flaws in this case.\n\n<h5>7. Bonus: Use security.txt</h5><a href=\"/2017/11/security-txt\">I've written about <code>security.txt</code> before</a>. I would recommend everybody to include that file on their site. It can be so hard to find the right (or any) contact point at a web site. Often you have to really push through to get a customer support to deliver the right message to the right persons.\n\n<h4 id=\"conclusion\">Wrapping it up</h4>This security vulnerability and leak was really bad. Who knows who can have misused it for how long. I think the news article in VG qualifies as unresponsible disclosure as it gave anyone the opportunity to misuse the vulnerability. Though with no consequences for anyone we can just sit back and wait for this to happen again.\n",
        "images": [
            "/images/amisol01.png",
            "/images/amisol02.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Behind the news",
                "url": "/behind-the-news"
            },
            {
                "title": "OWASP 2017 A2",
                "url": "/owasp-2017-a2"
            },
            {
                "title": "OWASP 2017 A3",
                "url": "/owasp-2017-a3"
            },
            {
                "title": "OWASP 2017 A7",
                "url": "/owasp-2017-a7"
            },
            {
                "title": "OWASP 2017 A9",
                "url": "/owasp-2017-a9"
            },
            {
                "title": "OWASP 2017 A10",
                "url": "/owasp-2017-a10"
            }
        ]
    },
    {
        "title": "Case #19: Leak affecting half a million Norwegians",
        "published": true,
        "publishDate": "2018-09-03T21:40:00.000Z",
        "summary": "Looking for an easy way to find out when the garbage was being picked up ended up in discovering a data leak affecting half a million people.",
        "niceUrl": "/2018/08/norconsult-soap-leak",
        "text": "<h4>tl;dr</h4>An app that was supposed to contain only addresses and a garbage collection calendar was actually using services that was leaking personal information like names and Social Security numbers for many, many persons.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://nois.no/\">Norconsult Informasjonssystemer</a> (Nois)</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"green-text\">Low</span> to <span class=\"orange-text\">medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>April 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td>Response time good, but slow on fixing. Notification to clients was faulty.</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Information leak with personal data and usage data for up to 625,000 people. Data also contained waste disposal routes, sewage monitoring, and more. Likely that modification of some data was possible.</td>\n</tr>\n</table>\n                \n<h4>Background</h4><img style=\"float:right;width:240px;margin-left:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from BIR's app.\" data-caption=\"Screenshot from BIR's app.\" src=\"/images/norconsult01-app.png\"/>A friend came up with an idea of having an Alexa skill/Google Assistant app where one could ask for <i>\"when will the paper garbage be picked up\"</i>? He saw that the website for BIR - our local waste management company - did not provide an easy way to fetch that data. He said there also was an app with the same data. <em>Taking a look at the communication between the app and the server it quickly became clear that something was very wrong in regards of security.</em>\n\n<h4>Approach (technical stuff)</h4><h5>The app</h5><img style=\"float:left;width:350px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\".\" src=\"/images/norconsult02-charles.png\"/>Using the HTTP proxy application Charles it was easy to look at the traffic between the app and server. Surprisingly the app and server actually used SOAP for communication. SOAP is pretty painful to work with and not commonly observed in the world of apps (though it was used for <a href=\"/2017/08/get-your-ssn-here\">the case with Tryg and Infotorg</a>).\n                \n<em>All the SOAP calls used the same simple username and password and all data was transferred unencrypted over HTTP.</em>\n\nSurprisingly, doing a search for a street name actually returned a list of properties including the full name of the owner.\n\nThen, when selecting a property in the app there was a call getting more details about it. Even though the app did not show the data, the server response returned <em>full name, address and Social Security number of the property owner</em>.\n\n<h5>SOAP service with the full access</h5><table><tr style=\"border: 1px solid;\"><td>SOAP and related concepts</td></tr><tr style=\"border: 1px solid;\"><td>SOAP is a XML based messaging protocol. It can be used over HTTP, as in this case, or other protocols like JMS and SMTP. A SOAP server contains a lot over SOAP services. These are described in a WSDL file. With the WSDL (and corresponding XSDs) one can generate strongly typed classes for all endpoints that are easy to use. The WSDL/XSD files can contain comments that describe the parameters and possible values. This was not the case here. Using SoapUI or similar tool, one can easily execute different parameters for each service. SoapUI is like Swagger or Postman for REST.</td></tr></table>\nThe WSDL file for the service was accessible without any authentication or IP check. This means that all services that was available was listed with their parameters/definitions. Bringing up SoapUI from back in the days, we were able to create requests to services we did not know about from the app.\n\nUsing the username and password that was found in the app, we could do queries to the SOAP service. As we did not know the input values, some services was hard to use. \n\n<h5>The system overview page</h5><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\".\" src=\"/images/norconsult03-status_page.png\"/><a href=\"https://play.google.com/store/apps/developer?id=Norconsult+Informasjonssystemer+AS\">Nois has published quite a few apps</a>, and one of the calls that the app made was one to get the configuration of these apps. <em>Looking at the root of this URL revealed a public facing status page with URLs to many of Nois' web services. This page was even indexed by Google. The URLs gave out WSDL files for all services available.</em>\n\nBased on the copyright statements on the page and source code it looked like the system overview page was last maintained in 2012.\n<br style=\"clear:left;\"/>\n<h5>Many more SOAP services</h5>After dedusting SoapUI, we explored some of the \"<code>GetXYZ</code>\" services. We were able to get successful response on a subset of the once we tried. Main reason for failed requests was lack of examples of the input parameters. We did not try any write operations.\n\n<h6>Example - <code>GetRecycleStations</code> (BIR AS)</h6>\n<img  class=\"materialboxed responsive-img\" title=\"\" data-caption=\".\" src=\"/images/norconsult07.png\"/>\nA SOAP service that might be called by a web page or app. Data we should have access to, in some way.\n  \n<h6>Example - <code>GetKommune</code> (<code>GetMunicipalities</code>) - Envina</h6>\n<img  class=\"materialboxed responsive-img\" title=\"\" data-caption=\".\" src=\"/images/norconsult06.png\"/>\nThis service told which municipalities was available on the given server. We used it to create the below table of affected municipalities.\n  \n<h6>Example - <code>GetWaterGaugePoints</code> - Sandnes kommune</h6>\n<img  class=\"materialboxed responsive-img\" title=\"\" data-caption=\".\" src=\"/images/norconsult09.png\"/>\nSome municipalities like Sandnes are billing water based on usage. This endpoint returns information about where a water gauge is located and what the last measurements were.\n  \n<h6>Example - <code>SearchPropertiesWithPrincipalsAndZipCodes</code> - BIR AS</h6>\n<img  class=\"materialboxed responsive-img\" title=\"\" data-caption=\".\" src=\"/images/norconsult08.png\"/>\nSome services provided a search for customers. It should make it easy to get hold of all the customers.\n\n<h4>Data available</h4>Based on the list of SOAP services available, we figure the following data is available within the systems (given that they use that part of the system):\n\n - <em>Register of persons including Social Security number (used as customer id), name, address, e-mail, phone number, fax number, notes</em>, created time, last changed, etc.\n - Register of companies with the same data. Customer id is organization number.\n - Who owns a property. Who is paying for waste disposal/water/etc.\n - <em>Who made changes (e.g. municipal employee, customer via Internet) and their IP address.</em>\n - <em>Invoices including the contents of the invoice.</em>\n - <em>Invoices not paid in time.</em>\n - Pick up spots for waste. Driving routes, work orders, etc.\n - <em>Water gauge usage data</em> including description on where you can find it, history (timestamps, amount of water, measurement type, who did the reading).\n - Register of both internal users and external users.\n\n<h4>Verification</h4>We created a list of servers we found on the system overview page. We also manage to find some using search engine (Googling for phrases from the application). From the overview page we identified some of the owners and it was also clear that some servers were offline.\n\nTo exclude those that were not affected by this huge security flaw, <em>we verified each and every server</em>. Mainly <em>two SOAP services were called</em>, one that returned all municipalities on that server and one with the <em>latest changes in customer data</em>. The service with customer data revealed that our user (<code>nois/nois</code>) had <em>access to customer data</em> on that particular server AND that the server was currently being used (somebody edited some customer in the past week/month or so).\n\nThe servers were verified manually using SoapUI and we took screenshots as proof. The screenshots were edited to censor any personal data (we don't want to have that saved).\n\nA few servers on the overview page did not work even if they showed status “green\". One example of this is Gjesdal kommune. According to the overview page, the service was running but we could not reach it. This could be that they had firewalls that blocked our HTTP requests.\n\nThe owners were either a municipality or a cooperation of municipalities (Norwegian: IKS - interkommunalt selskap). \n\n<table style=\"font-size:75%;\" class=\"striped\"><tr>\n<th style=\"width:25%;\">Municipality / company</th>\n<th style=\"width:25%;\">Municipalities</th>\n<th style=\"width:25%;\">Inhabitants</th>\n<th style=\"width:25%;\">Screenshot</th>\n</tr>\n<tr>\n<td>Avfall Sør AS</td>\n<td>Kristiansand, Songdalen, Søgne, Vennesla</td>\n<td>120,403\nCustomer estimate: 45-65,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-AvfallSor.png\"/></td>\n</tr>\n<tr>\n<td>Remiks</td>\n<td>Tromsø, Karlsøy</td>\n<td>76,814\nCustomer estimate: 30-40,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Remiks.png\"/></td>\n</tr>\n<tr>\n<td>Regiondata</td>\n<td>Dovre, Lesja, Sel, Vågå</td>\n<td>14,820\nCustomer estimate: 5-8,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Regiondata.png\"/></td>\n</tr>\n<tr>\n<td>Haugaland Interkommunale Miljøverk (HIM)</td>\n<td>Haugesund, Bokn, Tysvær, Vindafjord, Etne</td>\n<td>62,026\nCustomers: <a href=\"https://2017.him.as/\">33,052</a></td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-HaugesundIM.png\"/></td>\n</tr>\n<tr>\n<td>Shmil</td>\n<td>Hemnes\n\n* Server is responding with \"Hemnes kommune\", Shmil also responsible for Alstahaug, Brønnøy, Dønna, Grane, Hattfjelldal, Herøy, Leirfjord, Sømna, Vefsn, Vega, Vevelstad. Only Hemnes counted.</td>\n<td>4,524\nCustomer estimate: 2,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Shmil.png\"/></td>\n</tr>\n<tr>\n<td>Retura Val-Hall AS / Hallingdal renovasjon / Valdres Kommunale renovasjon</td>\n<td>Hol, Ål, Gol, Hemsedal, Nesbyen, Flå, Krødsherad, Nord-Aurdal, Sør-Aurdal, Øystre Slidre, Vestre Slidre, Etnedal, Vang\n\n* Server is also responding with Gjøvik, Søndre Land and Sigdal. These are not counted.</td>\n<td>40,915\nCustomer estimate: 15-22,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-HallingdalValdres.png\"/></td>\n</tr>\n<tr> \n<td>BIR AS</td>\n<td>Askøy, Bergen, Fusa, Kvam, Os, Osterøy, Samnanger, Sund, Vaksdal</td>\n<td>359,364\nCustomer estimate: 140-190,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPACustomers-Bir.png\"/></td>\n</tr>\n<tr>\n<td>Innherred Renovasjon</td>\n<td>Selbu, Malvik, Meråker, Stjørdal, Frosta, Levanger, Verdal, Inderøy, Leksvik\n\n* Server is also responding with Moss, Oslo, Tolga, Bergen, Sula, Trondheim, Rissa, Bjugn, Orkdal, Melhus, Tydal, Steinkjer, Verran, Høylandet, Overhalla, Flatanger, Nærøy, Vefsn, Tydal, Indre Fosen, Innherred. These are not counted in the number of inhabitants.</td>\n<td>92,563\nCustomers: 35,671</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Innherred.png\"/></td>\n</tr>\n<tr>\n<td>Hamos Forvaltning IKS</td>\n<td>Hemne, Agdenes, Meldal, Orkdal, Snillfjord, Skaun, Rindal, Hitra, Frøya, Rennebu, Surnadal</td>\n<td>50,967\nCustomer estimate: 20-27,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Hamos.png\"/></td>\n</tr>\n<tr>\n<td>Stavanger kommune (own server)</td>\n<td>Stavanger\n\n* Server also responded with Sandnes, Hå, Klepp, Time, Gjesdal, Sola, Randaberg, Finnøy after we notified Nois about the issue. Not counted.</td>\n<td>132,729\nCustomer estimate: 50-70,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Stavanger.png\"/></td>\n</tr>\n<tr>\n<td>Sandnes kommune (own server)</td>\n<td>Sandnes</td>\n<td>76,328\nCustomer estimate: 30-40,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Sandnes.png\"/></td>\n</tr>\n<tr>\n<td>Nordfjord Miljøverk IKS (NoMil)</td>\n<td>Bremanger, Vågsøy, Selje, Eid, Hornindal, Gloppen, Stryn</td>\n<td>32,932\nCustomer estimate: 12-18,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Nomil.png\"/></td>\n</tr>\n<tr>\n<td>Envina IKS</td>\n<td>Klæbu, Melhus, Midtre Gauldal\n\n* Server also responded with Meldal, Holtålen, Soknedal, Skaun. Not counted.</td>\n<td>28,582\nCustomer estimate: 10-15,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Envina.png\"/></td>\n</tr>\n<tr>\n<td>Movar (Mosseregionen Vann, Avløp og Renovasjon)</td>\n<td>Moss, Rygge, Råde, Vestby, Våler</td>\n<td>76,391\nCustomer estimate: 30-40,000</td>\n<td><img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult-verification-GetPAContractsChangedDate-Movar.png\"/></td>\n</tr>\n</table>    \n<em>Total number of inhabitants in the municipalities: 1,169,358</em>\n\nIt was hard to find good numbers of the amount of customers that are in the databases of the different municipalities. Innherred Renovasjon and Haugaland Interkommunale Miljøverk did have numbers on customers (Innherred)/waste disposal customers (HIM). They were respectively 2.6 inhabitants per customer and 1.87 inhabitant per customer. Based on those numbers <em>we estimate 450,000 to 625,000 private persons possibly exposed with full name, address, Social Security number, contact information, etc.</em>\n\n<h4>Data from one municipal spans the whole country and more</h5>Since people owns properties across the country, we checked one of the response (Regiondata) to check if that was true. An example is owning a cabin in Dovre kommune and paying the municipal a fee for waste disposal. This is mandatory and not possible to opt out of.\n\n<b>Some ZIP codes from a <code>GetEiendom</code> request to the server <code>Regiondata</code>:</b>\n - 0274 Oslo\n - 0378 Oslo\n - 0382 Oslo\n - 0465 Oslo\n - 0594 Oslo\n - 0775 Oslo\n - 1348 Rykkinn, Bærum kommune\n - 1363 Høvik, Bærum kommune\n - 1407 Vinterbro, Ås kommune\n - 1555 Son, Vestby kommune\n - 1816 Skiptvet\n - 2013 Skjetten, Skedsmo kommune\n - 2056 Algarheim, Ullensaker kommune\n - 2319 Hamar\n - 2322 Ridabu, Hamar kommune\n - 2615 Lillehammer\n - 2624 Lillehammer\n - 2663 Dovreskogen, Dovre kommune\n - 2670 Otta, Sel kommune\n - 2672 Sel\n - 2675 Otta, Sel kommune\n - 2676 Heidal, Sel kommune\n - 2677 Nedre Heidal, Sel kommune\n - 2682 Lalm, Vågå kommune\n - 2816 Gjøvik\n - 6040 Vigra, Giske kommune (Møre og Romsdal)\n - Danmark\n - Sweden\n\nThis is not a complete list. We manually picked out some from the response in SoapUI to get a feeling for the data set.\n\n<h5>ISY ProActive servers with no/minor issues found</h5>\n<b>Municipalities listed, but with a different service exposed:</b>\n - Dalane Miljøverk IKS, DIM (Eigersund, Sokndal, Bjerkreim)\n - Ryfylke Miljøverk IKS, Rymi (Forsand, Finnøy, Strand, Hjelmeland, Suldal)\n - Hadeland og Ringerike Avfallsselskap AS, HRA (Gran, Lunner og Jevnaker)\n - Indre Hordaland Miljøverk, IHM (Eidfjord, Granvin, Jondal, Ullensvang, Ulvik, Voss)\n - Iris Salten\n\nWe did not have a username/password that worked for this service. It doesn't seem wise to have these on the Internet. They should all add a firewall blocking access.\n\n<b>Municipalities listed, where our requests did not work:</b>\n - Agder Renovasjon IKS (Arendal, Froland og Grimstad)\n - Hå kommune\n - Steinkjær kommune\n - Sykkylven Energi\n - Ålesund kommune\n\nWe believe we shouldn't have been able to reach the servers of these municipalities. It doesn't seem wise to have these on the Internet. They probably should all add a firewall blocking access.\n\n<b>Municipalities listed where firewall blocked our request:</b>\n - Gjesdal kommune\n - Fet kommune\n - Skaun kommune\n - Mandal kommune\n - Kristiansund kommune\n\nWe consider all these secure.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>Sunday night we sent an e-mail to the director of Nois and the head of department of the department responsible for the software in question.\n\nA few hours later we got a pretty cold <i>\"We confirm that the e-mail has been received.\"</i> back.\n\n<h5>Day 1</h5>Just before midnight we sent an e-mail with some questions and information about another 7 municipalities affected by the issue.\n\n<h5>Day 5</h5>Not having heard back we sent a new e-mail asking for a status.\n\nWe soon got a response telling that they had established a working group for the issue. They had fixed a couple of the issues and they had informed the The Norwegian Data Protection Authority (Datatilsynet) and the municipalities in question.\n\nWe used the freedom of information law to get a hold of the alerts and communication with the municipalities. The alert was a letter sent on day 5.\n\n<img style=\"float:right;width:300px;margin-left:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/norconsult10.png\"/>In addition to general information, this is was what the letter told:\n<i>\"It has been discovered that it is technically possible for 3rd party to extract information from this service if you have the deep technical insight required. </i><em><i>It is important to emphasize that this has not happened, but that we have implemented preventive measures.</i></em><i>\"</i>\nThey also said a new version would be rolled out during the next days.\n\n - BIR: Alerted by letter. ISY ProAktiv Mobil Tømmeplan affected.\n   - No further follow up by BIR. They thougth the letter was clear and that no data was leaked.\n   - Server was accessible about 2 months after the letter was sent.\n - Stavanger kommune: Alerted by letter. Same as BIR but with ISY ProAktiv WebPortal also affected. Was also told to add firewall in front of the service.\n\n<h5>Day 55</h5>We saw that the issue still was open for many of the municipalities and asked for an ETA of a fix.\n\n<h5>Day 58</h5>Tuesday morning Nois said they expected everything to be OK by the end of the week.\n\n<h5>Day 61</h5>Friday night we asked if really was the case that everything was fixed.\n\nWe got a reply that they would work through the weekend to get it fixed.\n\n<h5>Day 65</h5>We informed that not everything was fixed yet. We sent an example query that returned a <em>list of 1208 customers that had changed the last couple of months. The details returned from server included full name, social security number, property identifier and lots of other fields.</em>\n\nNois told they were working on getting access to the necessary serves to fix it.\n\n<em>In the afternoon we got another response telling us that everything should be OK and they thanked us for informing them about it.\n\nWe replied that we still were getting personal data from one of their services.\n\nThey looked into the issue and they thought it could have been a service being restarted by an automatic scheduled job...</em>\n\n<h5>Day 66</h5><em>We got another e-mail telling us that they had even more services automatically restarting during the night.</em>\n\n<h5>Day 112</h5><em>We noticed that a service was back up running, and it returned information about more than 6,000 persons.</em>\n\n<h5>Day 113</h5>The day after, a Sunday, we got a response that they would contact the customer the day after to make sure it was fixed.\n\n<h5>Day 114</h5>We got another response that the service in question now was removed.\n\n<h4>Inaccurate report to the Data Protection Authority</h4>We reported the incident to The Norwegian Data Protection Authority (DPA). After Nois gave their version of it, the DPA closed the case and said they were satisfied by the countermeasures implemented by Nois. <em>We believe the report sent from Nois to the DPA to be inaccurate.</em>\n\n<em>Nois claimed that it was not possible to get lists (supposedly one would have to ask for one at the time) of Social Security numbers or of properties that had not made their payments.</em> Several services returned lists of SSN/customers/properties. (Property addresses are anyways public knowledge and one could easily just as for each property, one by one.)\n\n<em>Nois claimed that the issue was caused by a \"technical failure\".</em> Not using encryption on any of their services, using both username and password \"<code>nois</code>\" and returning Social Security numbers when asking for which days the garbage is picked up is not a technical failure. The cause is ignorance by developers and lack of knowledge by any managers above them. Quite a few people must have been aware of this.\n\n<em>Nois claimed that the \"deviation\" was open from January 31st 2018 until April 16th 2018.</em> The issue was not closed until the later part of June 2018 and start of August 2018 - and not at all when the report to the DPA was sent. While we discovered this mid April, Nois published BIR's \"garbage collection calendar\" app in August 2017. Looking at that exact version of the app reveals that the same services without encryption, with the same login and the fields for Social Security numbers, names and addresses were being used. <em>Looking at Innherred Renovasjon's app we found the same to be true in a version released in October 2015.</em> We don't understand why they would specify January 31st 2018 as the start date. If they will want to claim this, they should provide some evidence for the date being January 31st.\n\n<em>Nois claims that no personal information was leaked when looking at the logs.</em> This claim is a bit hard to understand as Nois did not have operational responsibility of many of the servers and they have had a hard time getting access to the servers to do updates. At the time of the report they had not closed the issue on all servers. Also, as mentioned, the issue was seemingly open for much longer than they claim. And finally, <em>the services were indeed leaking personal information for every request being made.</em> It's impossible to know if a request came from the \"garbage collection calendar\" apps or from someone faking it and looking up a person's Social Security number. And for how long do they have logs for?\n\n<h4>Timeline of fixed services</h4>During the period from we notified the vendor to the time it was fixed, we monitored the servers from time to time using a small script. The monitoring was done by calling one of the SOAP services. We choose the <code>GetMunicipalities</code> (Norwegian: <code>GetKommune</code>) as this did not contain the personal information, required authentication and returned some data.\n\nThe smilies and colors below indicate if the service responded or not. There are two versions of this data set, one with just the days we tested and one with empty cells for days we did not test.\n\n<img class=\"materialboxed responsive-img\" title=\"\" data-caption=\".\" src=\"/images/norconsult05.png\"/>\n<img class=\"materialboxed responsive-img\" title=\"\" data-caption=\".\" src=\"/images/norconsult04.png\"/>\n  \n<h4>Media</h4>We sent this security issue out to the local media since there was 14 different corporations/municipalities involved. The main take away from it is that information security is higher on the agenda for a lot of these. We also got to know that the corporations (customers of Nois) did not view this as a security issue/breach of personal data. Norwegian headlines translated below.\n - Remiks:\n   - iTromsø - <a href=\"https://www.itromso.no/pluss/2018/08/28/Avsl%C3%B8rte-sikkerhetshull-30,000-40,000-Remiks-kunders-personnummer-l%C3%A5-tilgjengelig-p%C3%A5-nettet-17415170.ece\">\"Disclosed security hole: 30,000-40,000 Remiks customers social security numbers available online\"</a>\n - Haugaland Interkommunale Miljøverk (HIM):\n   - Haugesunds Avis - <a href=\"https://www.h-avis.no/nyheter/haugaland-interkommunale-miljoverk-him/soppel/oppdaget-lekkasje-i-informasjonssikkerheten-hos-him/s/5-62-675393\">\"Discovered leakage in information security at HIM\"</a>\n - Hallingdal renovasjon / Retura Val-Hall AS / Valdres Kommunale renovasjon:\n   - Hallingdølen\n     - <a href=\"http://www.hallingdolen.no/nyheiter/svikt-i-datatryggleiken-personnummer-lag-opne-1.2477740\">\"Data security failure: Social security number in the open\"</a>\n     - <a href=\"http://www.hallingdolen.no/nyheiter/norconsult-avviser-at-data-har-kome-pa-avvege-1.2478350 \">\"Norconsult denies data being in the wrong hands.\"</a>\n     - <a href=\"http://www.hallingdolen.no/nyheiter/fullt-mogleg-a-prove-a-narre-datatilsynet-1.2480118\">\"-Possible to fool the DPA\"</a>\n   - Avisa Valdres - <a href=\"https://www.avisa-valdres.no/teknologi/datasikkerhet/it/avdekket-svakhet-i-systemene-til-interkommunale-renovasjonsselskap/s/5-54-250962\">\"Detected weakness in the systems of renovation company\"</a>\n- BIR:\n  - Bergens Tidende - <a href=\"https://www.bt.no/nyheter/lokalt/i/zLjq5w/Avslorte-sikkerhetshull-Personnummer-til-bosskunder-la-tilgjengelig-pa-nett-i-maneder\">\"Disclosed security hole - Social security number of waste customers available online for months\"</a>\n- Innherred Renovasjon:\n   - Innherred - <a href=\"https://www.innherred.no/nyheter/2018/08/27/Kundenes-personnummer-l%C3%A5-tilgjengelig-17407631.ece\">\"Customers social security number available\"</a> \n- Sandnes kommune, Stavanger kommune:\n   - Stavanger Aftenblad - <a href=\"https://www.aftenbladet.no/lokalt/i/Qlkvr8/Avslorte-datasvikt-i-Sandnes-og-Stavanger\">\"Disclosed security issue in Sandnes and Stavanger\"</a>\n\ndigi.no wrote a summary on a national level: <a href=\"https://www.digi.no/artikler/renovasjonsforetak-i-mange-norske-kommuner-lekket-personopplysninger/444627\">\"Renovation companies in many Norwegian municipalities leak personal data\"</a>\n\nNo media reported on these:\n- Avfall Sør AS\n- Movar\n- Regiondata\n- Shmil\n- Hamos Forvaltning IKS\n- Nordfjord Miljøverk IKS (Nomil)\n- Envina IKS\n\n<h4>Questions we still have</h4>What is clear is that the municipality is responsible for the protection of the personal data they have. They are responsible for their database. It seems like Nois have full access to the system for upgrades and checking logs. <em>We still wonder about who is responsible for the running of the systems.</em> Who is responsible for not changing default configuration (default username and password with full access)? Who is responsible for not configuring the firewalls? Who is responsible for building apps on top of SOAP and using a user with full access for the communications?\n \nAfter the media asked the municipalities responsible for the personal data and after we got to see the letter from Nois notifying their customer about the security issue, most of them did not react to this as a system leaking information. <em>Why did Nois send such a vague letter to the customers and DPA (Datatilsynet)?</em>\n\nNois claimed they checked the logs and that no data was actually leaked. They also claim the security issue was just present for 4 months. <em>How was the access logs checked? Did they check back in time to at least 2015? Where is the report to their customers about this?</em>\n\n<h4>Conclusion</h4>Who checks the security of an app that doesn't contain a login or any personal data at all? No one, because it just doesn't make sense to do that. It was just a coincidence that we discovered this one.\n\nWhat sticks out in the end for us is that the reception and handling of the issue wasn't very good. Usually IT companies responds more quickly and are more open about the issue and handling of it. Here the customers got a vague description not telling much about what was going on.\n\nIt would be interesting to know if anyone really digged into how long the data was available for, because it seems like they have been there for quite a few years.\n\nFinally, if you as a developer are told to use a service that returns much more data than what's intended to be used, <b>you should speak up</b>. Quite a few people have known about these personal data being transferred unencrypted over the wire.\n",
        "hot": false,
        "author": "Hallvard Nygård & Roy Solberg",
        "images": [
            "/images/norconsult00-preview.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Social Security numbers",
                "url": "/ssn"
            },
            {
                "title": "OWASP 2013 A2",
                "url": "/owasp-2013-a2"
            },
            {
                "title": "OWASP 2013 A3",
                "url": "/owasp-2013-a3"
            },
            {
                "title": "OWASP 2013 A6",
                "url": "/owasp-2013-a6"
            },
            {
                "title": "OWASP 2013 A10",
                "url": "/owasp-2013-a10"
            }
        ]
    },
    {
        "title": "Behind the news: Authentication gone wrong",
        "published": true,
        "publishDate": "2018-09-10T04:55:00.000Z",
        "summary": "Personal - and in some cases sensitive - information about 63,000 students could be accessed. Here are the details that the newspaper article did not give.",
        "niceUrl": "/2018/09/osloskolen-leak",
        "text": "<h4>Background</h4><img style=\"float:left;width:180px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot of the app from Play Store.\" data-caption=\"Screenshot of the app from Play Store.\" src=\"/images/skolemelding03.png\"/>I got in contact with a parent concerned about the security in a <a href=\"https://aktuelt.osloskolen.no/larerik-bruk-av-laringsteknologi/digital-skolehverdag/skolemelding/\">new messaging app used for communication between pupils, teachers and parents</a> (Norwegian link) in the schools of <a href=\"https://www.oslo.kommune.no/\">Oslo</a>. The app - which is called <i>Skolemelding</i> - was released this summer and is developed by <a href=\"https://www.cginorge.no/\">CGI Norge</a>. Unfortunately the concerns turned out to be justified. <em>Please note that I was not the one to discover any of these issues.</em>\n\nThe Norwegian newspaper Aftenposten <a href=\"https://www.aftenposten.no/osloby/i/G1L3oQ/Alvorlig-sikkerhetshull-Private-meldinger-om-elevene-i-Oslo-skolen-la-tilgjengelige-pa-nettet\">broke the news about the vulnerabilities September 6th</a> (<a href=\"https://www.aftenposten.no/norge/politikk/i/jPElAw/Private-meldinger-om-elever-var-pa-avveie-i-Oslo-skolen---Tenker-det-er-trygt-med-MinID\">follow-up article</a>) and the system was temporarily shut down.\n<br style=\"clear:left;\"/><h4>Security issues</h4>The security vulnerabilities were really bad. The system is designed for sending messages between school and home, including messages related to student absence. According to Norwegian law health information is regarded as sensitive personal information, and therefore I would assume that the system should be designed with the appropriate security level to prevent unauthorized access.\n\n<em>Anyone with either a valid login or anyone who got hold of a guardian's <a href=\"https://en.wikipedia.org/wiki/National_identification_number#Norway\">Social Security number</a> could access any and all messages across all 63,000 pupils + guardians and teachers.</em> This includes not only communication between guardians and school, but also communication between teachers was accessible through these vulnerabilities.\n\n<em>Anyone who got hold of a guardian's Social Security number could access details about a pupil's family (full names, Social Security Numbers, usernames, e-mail addresses, phone numbers) (in addition to the guardian's messages).</em> I have published <a href=\"/tag/ssn\">a couple of cases</a> where one easily could get a specific person's Social Security number.\n\n<h4>Technical details</h4><a class=\"skip-link\" href=\"#responsible_disclosure\"><u>Skip this part</u> 🙈</a>\n<h5>The apps</h5>There are two apps - one for parents and one for teachers + students. Looking at <a href=\"https://play.google.com/store/apps/developer?id=Osloskolen\">the Android apps</a> they are pretty much the same app with just <a href=\"https://developer.android.com/studio/build/build-variants#product-flavors\">different build variant (flavors)</a>. Parents use a different login than the teachers and students.\n\nThe apps are built using <a href=\"https://en.wikipedia.org/wiki/React_(JavaScript_library)#React_Native\">React Native</a> with all the functionality bundled in a JavaScript file. Seemingly you get the same functionality by logging in on the web as in the apps.\n\n<h5>Reading anyone's messages</h5>To fetch a message the app calls <code>/api/message/GetMessageWithId?messageId=[ID1]&threadId=[ID2]&isReplyAllowed=[true|false]&onBehalfOf=[pupil's username]</code>.\n\n<em>This is where we find the first failure. The server did not do an authorization check on the <code>messageId</code> and therefore let one read any other message in the system. And to make this a huge problem; the IDs were a sequential number that let one go through all messages available.</em>\n\n<h5>Log in as someone else</h5><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"&quot;I promise, authentication is done and I'm the user with this SSN!&quot;\" data-caption=\"&quot;I promise, authentication is done and I'm the user with this SSN!&quot;\" src=\"/images/skolemelding01.png\"/>The parent/guardian version of the app uses a common log-in solution by the Agency for Public Management and eGovernment (Difi) called <a href=\"https://eid.difi.no/en/id-porten\">ID-porten</a>. The teacher + student version of the app uses a log-in solution called <a href=\"https://www.feide.no/introducing-feide\">Feide</a> - a pretty common solution among schools. <em>It's important to emphasize that there were no weaknesses in these two solutions in this case. However, the usage and implementation in the apps was horrible.</em>\n\nIn the parent version of the app, when pressing the <i>Log in</i> button, the user is taken through the log-in flow of ID-porten as expected. However, <em>there was a big flaw in the logic of the authentication server (called midporten) used by this system. The \"token\" returned from that server was just the user ID - the parent's Social Security number. One could intercept the call at this stage and replace the user ID/SSN with another one and get full access.</em>\n\n<h5>Log in by just skipping the authentication system</h5>Reading the last sentence you might ask what the client really did with the user ID. Well, <em>the client sent the user's SSN to the school portal (the app's API) to generate an access token. This means that it was possible to just skip the whole flow of midporten and ID-porten and just ask the app's backend to get an access token for any valid user ID. Wow.</em>\n\nSo the flow was like this (with optional faking of user ID in either step 5 or 6):<pre class=\"prettyprint lang-html\">\n1. Tell midporten you want to log in \n2. Tell ID-porten which electronic id you want to use\n3. Do the log-in process with ID-porten\n4. Get authentication response from ID-porten and forward to midporten\n5. Tell midporten which user ID/SSN just logged in\n6. Tell app's API which user ID/SSN you want to log in as and get an access token for</pre>\n<h5>LDAP to the people</h5><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"LDAP test data bundled in the app.\" data-caption=\"LDAP test data bundled in the app.\" src=\"/images/skolemelding02.png\"/>While not a direct flaw, it is interesting to look at the structure of the data from the server. There's a call going to <code>/api/settings</code> which returns information about the logged in user and the belonging student(s). <em>The JSON returned is actually <a href=\"https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol\">LDAP</a> data. And it contains full names, usernames, e-mails, Social Security numbers, possibly phone numbers of guardians and belonging student(s). It looks like a dump of the LDAP. Why would one need this information in the app? And why are Social Security numbers stored in a way like this in a directory where an app has access?</em> We're talking about hundreds - maybe thousands - of lines of LDAP data.\n<br style=\"clear:left;\"/><h5>Is that a good fix?</h5><img style=\"float:left;width:400px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot showing the log-in flow and how the JWT is sent back with lower case.\" data-caption=\"Screenshot showing the log-in flow and how the JWT is sent back with lower case.\" src=\"/images/skolemelding04.png\"/>The fix for the login vulnerability was - instead of sending the user ID to generate the access token - to send a <a href=\"https://en.wikipedia.org/wiki/JSON_Web_Token\">JSON Web Token</a> (JWT). The JWT does not contain any user information, meaning that it has be checked on the server side to see which user is asking for an access token.\n\n<em>What is surprising is that the JWT does not contain some internal user ID (like a <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier\">UUID</a>), but rather a timestamp. And the JWT cannot actually be verified on the backend (other than string comparison) as it is sent back as lower-case.</em>\n\nWhat happens if two users log in at the exact same time? Is it possible that the timestamps (and therefore JWT) can end up being the same? Would one user get access to the other?\n\n<h5>Could there be more?</h5>With these vulnerabilities you can start to wonder if there are other problems here. I have not tested any of these things, but it is something for the vendor to look into.\n\n<h6>Injection?</h6>It looks like the messages in the app support HTML markup. Does the server and clients handle data escaping properly?\n\n<h6>File storage</h6>It's interesting to take a look at the file names and directory structure of the server. It really makes you wonder if there could be weaknesses and vulnerabilities related to naming of files.\n\n<h6>Logs with SSN?</h6>Some of the requests contained Social Security numbers in the query parameters. This means that there probably are logs with many SSN. Is this okay?\n\n<h4 id=\"responsible_disclosure\">Responsible disclosure?</h4>I understand how Aftenposten wanted to get out the news about this as fast as they could. And they did indeed warn the City of Oslo before publishing it to give them a heads-up and chance to shut down the system. They only right thing to do here was to shut down the system immediately as someone might soon find the issues or maybe already was abusing them. So this wasn't too bad, but I would have liked to see CGI Norge and the City of Oslo get some more time to look at the issues and confirm that they had fixed them before publishing the article.\n\n<h4>Conclusion</h4>It's easy to make mistakes when programming, and not all programmers will have a good enough understanding of security (though I think we should try to improve this!). <em>What really sticks out here is how both CGI Norge and the City of Oslo could release a product like this without testing the security.</em> I do not believe this is a case where a <a href=\"https://en.wikipedia.org/wiki/Penetration_test\">pen tester</a> overlooked something. This must be a case where there has been no external testing of the system. And that's a shame.\n",
        "images": [
            "/images/skolemelding04.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "Social Security numbers",
                "url": "/ssn"
            },
            {
                "title": "Behind the news",
                "url": "/behind-the-news"
            },
            {
                "title": "OWASP 2013 A2",
                "url": "/owasp-2013-a2"
            },
            {
                "title": "OWASP 2013 A3",
                "url": "/owasp-2013-a3"
            },
            {
                "title": "OWASP 2013 A5",
                "url": "/owasp-2013-a5"
            }
        ]
    },
    {
        "title": "885,086 customer records exposed in search engine",
        "published": true,
        "publishDate": "2018-09-24T19:20:00.000Z",
        "author": "Hallvard Nygård",
        "summary": "<i>Guest blog post by <a href=\"https://twitter.com/hallny\">Hallvard Nygård (@hallny)</a></i>",
        "niceUrl": "/2018/09/postnord-leak-2",
        "text": "<h4>tl;dr</h4>PostNord put all customers (name, phone and address) into a search database that was publicly available (known API key and referer). The database was used for easy selection of name and address when returning items. It was possible to opt out (mark address as secret). The customers had to register on the PostNord site, but was not told that the address would be publicly available. Previously PostNord had a dark UX pattern that tricked users into registering when they really wanted to track their package.\n                \n<table class=\"summary\">\n<tbody><tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://www.postnord.no/en\">PostNord</a>. Also reported to <a href=\"https://www.netonnet.no/\">NetOnNet</a>.</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"green-text\">Low</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>September 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>No reward. Thanks for the feedback.</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>The return package to web shop had a inline search field where you could search for name, address and phone for registered PostNord customers. Easy to download the whole database.</td>\n</tr>\n</tbody></table>\n<h4>Background</h4><img style=\"float:left;width:50%;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/postnord12-return_page.png\"/><img style=\"float:left;width:50%;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/postnord10-fuzzy_search.png\"/>A friend of mine - <a href=\"https://tkalve.no/\">Thomas Kalve</a> -  sent me a tip about a interesting fuzzy search when trying to return a package to the online shop NetOnNet. When entering a phone number it was searching for a match and was also showing close matches. Not knowing that he had signed up for this search service, he sent me a tip.\n\nThe \"return to web shop\" page was backed by a search <b>database containing 885,086 customer records</b>. It used the search service Algolia which is a \"search as a service\" (SaaS) that is mainly branded towards product search. PostNord had added all customers to this search engine and made them searchable. It was possible opt out of this use of personal data.\n\nPostNord told me they had 1.1 million users. I found 885,086 customers in the database. So around 200,000 had opted out.\n\nThe main issue with this database was that it was open and that <b>PostNord did not declare this use and exposure of personal data.</b> According to <a href=\"https://en.wikipedia.org/wiki/General_Data_Protection_Regulation\">GDPR</a> one should declare all uses of personal data. One should also make sure that the customer understands what he or she is accepting.\n\nThe form where you could say that an address is secret (\"hemmelig adresse\"), meaning opt out of the search database:\n<img style=\"float:left;width:500px;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/postnord11-opt_out.png\"/><br style=\"clear:left;\"/>\n\n<h4>Approach (technical stuff)</h4>The easiest way to use this leakage was to search for people in the form. One would need a return code (e.g. \"netonnet\") and knowledge where to find this page. Search could then be done in Chrome or another browser. If you had ha partial name or partial phone number, the search engine would help with the rest.\n\n<b>If you wanted a copy of the database, you could download the data over time.</b> According to PostNord the service was protected by the following <a href=\"https://www.algolia.com/doc/guides/security/api-keys/\">Algolia security features</a>: HTTP referer restriction, rate limit and number of records retrieved limit. The first is, of course, super easy to spoof. The settings they used for the IP rate limit and number of records retrieved per result is not known to me. So how long this would take is also unknown. I did not test any limits on this system. Using my browser and <a href=\"https://curl.haxx.se/\">Curl</a> I would guess I saw around 100-200 customer records.\n\nAfter doing a <i>\"copy to curl\"</i> in Chrome, I got a working and reproducible Curl command that I could run from a terminal. Stripping away unneeded headers I saw that the <code>Referer</code> header was required. I did not strip the query or change the JSON data.\n<pre class=\"prettyprint\">curl 'https://swstrzr7ig-3.algolianet.com/1/indexes/address_books/query?x-algolia-agent=Algolia%20for%20vanilla%20JavaScript%203.28.0&x-algolia-application-id=SWSTRZR7IG&x-algolia-api-key=35b1d443b661ed9e65aa4e6c439030f1' \\\n    -H 'Referer: https://my.postnord.no/return/show' \\\n    --data '{\"params\":\"query=45442095&hitsPerPage=5\"}'</pre>\nThe request the following data (personal information has been changed):\n<pre class=\"prettyprint lang-js\">{\n    \"hits\":[\n        {\n            \"id\":775007,\n            \"name\":\"John Johnsen\",\n            \"mobile\":\"45445095\",\n            \"street_name\":\"John street 3\",\n            \"additional_street_name\":null,\n            \"city_name\":\"John town\",\n            \"postal_zone\":\"4000\",\n            \"country\":\"NO\",\n            \"external_id\":\"808007\",\n            \"source\":\"contacts\",\n            \"user_id\":1378007,\n            \"created_at\":\"2018-07-20 10:03:39\",\n            \"updated_at\":\"2018-07-20 10:03:39\",\n            \"objectID\":\"775007\",\n            \"_highlightResult\":{\n            \"name\":{\n                \"value\":\"John Johnsen\",\n                \"matchLevel\":\"none\",\n                \"matchedWords\":[\n\n                ]\n            },\n            \"mobile\":{\n                \"value\":\"<em>45445095</em>\",\n                \"matchLevel\":\"full\",\n                \"fullyHighlighted\":true,\n                \"matchedWords\":[\n                    \"45442095\"\n                ]\n            },\n            \"street_name\":{\n                \"value\":\"John street 3\",\n                \"matchLevel\":\"none\",\n                \"matchedWords\":[\n\n                ]\n            },\n            // (.... More highlights without match ....)\n            }\n        },\n        {...},\n        {...},\n        {...},\n        {...}\n    ],\n    \"nbHits\":270,\n    \"page\":0,\n    \"nbPages\":54,\n    \"hitsPerPage\":5,\n    \"processingTimeMS\":8,\n    \"exhaustiveNbHits\":true,\n    \"query\":\"45442095\",\n    \"params\":\"query=45442095&hitsPerPage=5\"\n}</pre>\nThe documentation for the Algolia API is <a href=\"https://www.algolia.com/doc/rest-api/search/\">available online</a>. By using the API I could see a other indices and tried a query without parameters. The query returned 30 results. The first results were created <code>2018-04-13 14:35:54</code>. The <code>nbHits</code> was <code>885086</code>, meaning there were 885,086 customer records in the database. Querying for indices I got the same number of records but a different created date. <b>I'm guessing this system was set up between November 2017 and April 2018.</b>\n\n<pre class=\"prettyprint lang-js\">{\n    \"items\":[\n        {\n            \"name\":\"address_books\",\n            \"createdAt\":\"2017-11-16T08:23:33.157Z\",\n            \"updatedAt\":\"2018-09-19T19:23:17.094Z\",\n            \"entries\":885093,\n            \"dataSize\":225565146,\n            \"fileSize\":691313817,\n            \"lastBuildTimeS\":87,\n            \"numberOfPendingTasks\":1,\n            \"pendingTask\":true\n        },\n        {\"name\":\"biggest_decline\",   \"createdAt\":\"2017-12-15T10:32:32.897Z\", \"updatedAt\":\"2018-09-19T19:23:35.868Z\", (...)},\n        {\"name\":\"biggest_incline\",   \"createdAt\":\"2017-12-15T10:32:32.897Z\", \"updatedAt\":\"2018-09-19T19:23:35.868Z\", (...)},\n        {\"name\":\"popular\",           \"createdAt\":\"2017-12-15T10:32:32.897Z\", \"updatedAt\":\"2018-09-19T19:23:35.868Z\", (...)},\n        {\"name\":\"price_amount_asc\",  \"createdAt\":\"2017-12-15T10:32:32.897Z\", \"updatedAt\":\"2018-09-19T19:25:15.172Z\", (...)},\n        {\"name\":\"price_amount_desc\", \"createdAt\":\"2017-12-15T10:32:32.897Z\", \"updatedAt\":\"2018-09-19T19:25:15.172Z\", (...)},\n        {\"name\":\"products\",          \"createdAt\":\"2017-12-15T10:32:32.897Z\", \"updatedAt\":\"2018-09-19T19:23:35.868Z\", (...)},\n        {\"name\":\"rating_desc\",       \"createdAt\":\"2017-12-15T10:32:32.897Z\", \"updatedAt\":\"2018-09-19T19:23:35.868Z\", (...)},\n        {\"name\":\"review_score_desc\", \"createdAt\":\"2017-12-15T10:32:32.897Z\", \"updatedAt\":\"2018-09-19T19:23:35.868Z\", (...)}\n    ],\n    \"nbPages\":1\n}</pre>\n<h5>Dark UX pattern</h5>I do not have screenshot proof of this, but a previous version of the \"track package\" page (which was <a href=\"/2018/05/postnord-api-leak\">leaking personal data back in May 2018</a>) applied a <a href=\"https://en.wikipedia.org/wiki/Dark_pattern\">dark UX pattern</a> where the user was shown a registration form instead before the tracking information. A link to this page was sent in an SMS to the recipient of a package. There was a small skip registration link or button (E.g. <i>\"No thanks, I just want to see where my package is\"</i>).\n\n<b>A user would typically do like this:</b>\n1. Click on \"track package link\" in SMS.\n2. Get PostNord registration form.\n3. <b>Register user profile.</b>\n4. See package status / pick up code.\n\nWhen I saw this last, I did the following:\n1. Click on \"track package link\" in SMS.\n2. Get PostNord registration form.\n3. <b>Skip registration by clicking a link.</b>\n4. See package status / pick up code.\n\n<h4>Security issues</h4>This is was not a security issue the way Roy and I normally find and write about. The issue here was mainly that the customers did not accept this. PostNord did not have consent to make the customer records available for download. Customers did accept some terms and conditions and PostNord did have a privacy policy. None of them said anything about putting the records online.\n\nThe use of the search API was intentionally as part of their solution. It did not have any security issues in the normal sense, but this usage with personal data constitutes a leak of personal information. \n\n<h4>Reception and handling</h4>As <a href=\"/2018/05/postnord-api-leak\">last time</a> the issue was quickly resolved. \n\n<h5>Day 0</h5>I reported the issue to NetOnNet and PostNord. A copy was also sent to The Norwegian Data Protection Authority (DPA, Datatilsynet). It was reported to NetOnNet since the return code used to access the page was from them. The report e-mail was title as \"Whole NetOnNet customer database available\" as that was the first assumption and that it was something that would get attention. It later showed that it was not their customer database, but a separate PostNord database.\n\n<h5>Day 1</h5>I talked to PostNord on the phone and got an e-mail summarizing the handling during following day. According to PostNord, the service was temporality taken down at 08:50. Taking the service down was the right response. My friend confirmed that the service was offline at 10:13.\n\n<b>PostNord will give the Data Protection Authority their version of the leak as part of the mandatory deviation notification.</b>",
        "images": [
            "/images/postnord12-return_page.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Information leak",
                "url": "/information-leak"
            }
        ]
    },
    {
        "title": "Advent calendars debugged",
        "published": true,
        "publishDate": "2018-12-31T09:00:00.000Z",
        "summary": "A Christmas story on how to cheat in advent calendars and of course some personal information leaks.",
        "niceUrl": "/2018/12/advent-calendars-debugged",
        "text": "<h4>Background 📅</h4>At least here in Norway we have long traditions with <a href=\"https://en.wikipedia.org/wiki/Advent_calendar\">advent calendars</a> - both as gift calendars for kids and TV shows with one new episode from December 1st until Christmas Eve. In the last couple of decades this tradition has also extended online with businesses having gift calendars where you can typically give away some personal information with a chance to win some prize.\n\nI usually end up answering a few calendars hoping to win something cool, but this year I signed up on quite a few calendars to see if I could find anything interesting security wise. <em>Most of the stuff presented in this post is no big deal. Companies just want as many people as possible to sign up and don't really care about if it's possible to get an advantage. Still I think it's interesting to see how the calendars are built. And then there are the big leaks of personal information.</em>\n\n<h4>Circle K - cheat in pre-Christmas competition ☕</h4><a href=\"https://en.wikipedia.org/wiki/Circle_K\">Circle K</a> Norge runs quite a few gas stations in Norway. They had a \"pre-Christmas game\" in the second half of November where you could win a <a href=\"https://koppen2019.no/\">\"coffee deal\"</a> worth 34 USD (299 NOK). With that deal you get a cup that you can refill with any hot liquids on any of their stations throughout 2019.\n\nThe game was easy enough; you had to catch as many as possible of the falling Christmas themed items. You had three chances to play every day and there was a top score list where the top 10 single game scores would win the prize.\n\nSo, how could one cheat in this game? Well, that seemed pretty easy. <em>The whole game was run in the user's browser and when the game was over the browser posted back the score to the server.</em>\n\n<img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"The game's JavaScript is paused just before sending the request to the server.\" data-caption=\"The game's JavaScript is paused just before sending the request to the server.\" src=\"/images/calendar01.png\">Technically it wasn't all bad news. I mean, the JavaScript was <a href=\"https://en.wikipedia.org/wiki/Minification_(programming)\">minified</a>, you had to be identified with your phone number and the requests containing the score was signed by the mentioned minified JavaScript. Of course, the concept of a client telling the score kind of breaks all other efforts. The easiest way to cheat here would be to play one round with the web developer tools open, watch the request and then search for related parameters in the source code. Then one could just set a <a href=\"https://en.wikipedia.org/wiki/Breakpoint\">breakpoint</a> before the request was signed, play another round and then when the game was paused, change what was obviously the points, before letting the script run on.\n\n<img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"They have even made a dedicated chatbot just for the coffee deal!\" data-caption=\"They have even made a dedicated chatbot just for the coffee deal!\" src=\"/images/calendar03.png\">But is it a big deal? Circle K just wants as many as possible to play and as many as possible to know about their coffee deal. Any cups sold/given away will most probably end up in sales that'll give more profit than cost. Just me writing this post gives them some more free advertisement. <em>But I think it's pretty unfair to the hundreds of people who really tried to play their best day after day for a chance to win this cup. They are the ones that are cheated.</em>\n\n<h4>Circle K - cheat in advent calendar ⛽</h4>December came and the pre-Christmas game closed. The next competition in line for Circle K was a pretty cool \"name that tune\" type of game where you got more points the quicker you were able to identify and pick the song playing.\n\n<img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Name the tune game with JavaScript paused just before sending points back to the server.\" data-caption=\"Name the tune game with JavaScript paused just before sending points back to the server.\" src=\"/images/calendar02.png\">The concepts surrounding this game were pretty much the same as the previous one. The game was run in the contestant's browser and then the score was reported back to the server. The way to cheat would be the same as described in the previous game.\n\nThere's some mismatch between the invitations to the games, the terms and the in-game text in regards of the actual prizes, but from my understanding the awards were like this: The daily top 10 scores of the game would be awarded the coffee deals (so 240 thermo cups were given away in total), the next 10 best daily scores would get a gift card for a coffee and bun. There's also some talk about a main prize, and my understanding is that that's usually 113 USD (1000 NOK) worth of gas. It's unclear to me if there's a draw and/or if it's related to the total points across all days.\n\n<em>Is it acceptable to cheat in competitions like this? Terms and conditions most often doesn't allow for any kind of fraud, but on the other hand they don't take any precautions trying to stop cheating and let anyone just tell them their score.</em>\n\n<h4>Leaking all e-mail addresses 📧</h4>There was this web site with another smaller advent calendar with a daily challenge. I happened to surf by their front page early in December when they <b>just</b> had published an article telling about the new leaderboard that they had made. <em>The leaderboard was loaded in an iframe. And going to the root of that website revealed the usernames and e-mails of all 1000+ contestants.</em>\n\nI quickly wrote an e-mail to them and they responded within minutes and took down the whole webapp in question. They told me that the article telling about the leaderboard was published too early by a mistake. Probably the leak didn't last for many minutes. Because of the short duration of the leak and the small amount of e-mail addresses I don't feel very comfortable naming them. (But it's probably a good idea to not expose webapps with personal information to the Internet even during development.)\n\n<h4>The biggest leaks 💧</h4><em>There were some advent calendars that used a third party system that I have reported several security issues to. We're talking about millions of names, e-mail addresses, phone numbers, and in some cases addresses, names and birthdays of kids, purchase history, national identity numbers and passwords. I will wait until they have fixed everything before doing a write-up or two about them.</em>\n\n<h4>Fjordkraft - exposing their admin UI 🖥️</h4>The power company <a href=\"https://en.wikipedia.org/wiki/Fjordkraft\">Fjordkraft</a> and their subsidiary TrøndelagKraft had their own advent calendar with a daily prize of 568 USD (5000 NOK) in cash.\n\n<img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Now, that's some interesting names on those services.\" data-caption=\"Now, that's some interesting names on those services.\" src=\"/images/calendar05.png\">What they also had was a good old <a href=\"https://en.wikipedia.org/wiki/AngularJS\">AngularJS</a> app which had a \"flaw\" often seen on the web: The JavaScript revealed the path to other parts of the application. And <em>what it revealed was the path to the admin interface used for getting statistics and draw a winner. There was even a frightful function that was called <i>Reset database</i>.</em> The admin UI was so in the open that I have a small hope that it could be a <a href=\"https://en.wikipedia.org/wiki/Honeypot_(computing)\">honeypot</a>, but I doubt it.\n\n<img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Calendar's admin user interface.\" data-caption=\"Calendar's admin user interface.\" src=\"/images/calendar04.png\">Luckily there was some sort of code needed to use any of the functionality. And that's really why I didn't bother to report it to them. I just hope they didn't use a simple code word like <i>\"santa\"</i> or <i>\"xmas2018\"</i>.\n\n<h4 style=\"clear:left;\">Others - giving advantage to web developers 👩‍💻</h4>Most of the online advent calendars have a daily question with a few alternatives. Many of the calendars are so nice as giving the correct solution of a question - either in the JSON or markup alongside the question. Of course the companies with the calendars don't care too much about this as they just want people to join in. \n\nFor me this is different from the Circle K competitions where you were guaranteed to get a physical prize if you just give a high enough score back. In these other cases you are at max given an advantage when there's a draw in the daily or final lottery.\n\n<h5>Mester Grønn</h5><img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"Very practical with the answers alongside the questions. 🌹\" data-caption=\"Very practical with the answers alongside the questions. 🌹\" src=\"/images/calendar06.png\">The florist <a href=\"https://mestergronn.no/\">Mester Grønn</a> had one of the calendars giving a little advantage to a web developer. <em>The JSON clearly stated which answer was the correct one</em>, and in many cases that would be a quicker way of finding the answer than googling, or looking at their web site. Of course, it's no big deal.\n\n<h5>Kiwi</h5><img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"&quot;Hey server, I answered all your questions correctly.&quot;\" data-caption=\"&quot;Hey server, I answered all your questions correctly.&quot;\" src=\"/images/calendar07.png\">The supermarket chain <a href=\"https://en.wikipedia.org/wiki/Kiwi_(store)\">Kiwi</a> had an interesting twist technology wise. <em>Also in this case the JSON clearly stated which answer was the correct one. But what's more, it gave the opportunity to just return <code>true</code> for the answer for a given day so you didn't really have to look at what was the correct answer. And - while I haven't got it confirmed - it looked like you could just fill in the answer for all weeks at once.</em>\n\n<h5>kode24</h5>The news site for coders <a href=\"https://kode24.no\">kode24.no</a> had an <a href=\"https://www.kode24.no/nedetid/bli-med-pa-kode24-sin-kodekalender/70504275\">entertaining calendar</a>. Every day it gave a new small puzzle - typically involving some use of the browser's developer tools. <em>While this didn't directly give a big advantage, it let you stay ahead of the game by letting you solve the puzzles for the following days by directly requesting the contents of the puzzle \"file\"</em> (which was practical if you were short on time some days). A simple <a href=\"https://curl.haxx.se/\">Curl</a> command made it all very easy to use:<pre class=\"prettyprint lang-js\">\nfor i in {20..24}; do\n  echo '\\n'$i:\n  curl 'https://kode24-jul2018.herokuapp.com/api/files' \\\n  -H 'Content-Type: application/json' \\\n  -H 'Cookie: id=[valid user id hash]' \\\n  --data-binary '{\"path\":\"\\'$i'-DES\",\"fileName\":\"HINT.TXT\"}'\n  sleep 1\ndone\n\n20:\n{\"content\":[\"To legender, fra Porsgrunn den ene.\",\"Slår etternavnene sine sammen,\",\"og skaper en kode av glede.\"],\"type\":\"txt\",\"name\":\"hint.txt\",\"size\":256}\n21:\n{\"content\":[\"Når jeg dobler dette tallet,\",\"og plotter det inn der artiklene deres bor,\",\"finner jeg en spillmaskin,\",\"som er dagens kodeord:\",\"35262282,5\"],\"type\":\"txt\",\"name\":\"hint.txt\",\"size\":8}\n22:\n{\"type\":\"error\",\"content\":\"Fant ikke fila di.\"}\n23:\n{\"content\":[\"mine to favorittfolk,\",\"fra min favorittserie.\",\"slå dem sammen,\",\"så løser du kodens mysterie.\"],\"type\":\"txt\",\"name\":\"hint.txt\",\"size\":256}\n24:\n{\"content\":[\"Siste innspurt, du har vært flittig som bien.\",\"Denne her blir ekstra vrien.\",\"Reisens start, er per e-brev.\",\"Send meg et pling, få tilbake et stev.\"],\"type\":\"txt\",\"name\":\"hint.txt\",\"size\":256}</pre>\nAnd even though you couldn't actually answer the puzzle for a future day, it was possible to verify that you had the right solution:<pre class=\"prettyprint lang-js\">\ncurl 'https://kode24-jul2018.herokuapp.com/api/code' \\\n-H 'Content-Type: application/json' \\\n-H 'Cookie: id=[valid user id hash]' \\\n--data-binary '{\"path\":\"\\24-DES\",\"code\":\"julekos\"}'\n\n{\"type\":\"txt\",\"content\":\n  [\"** Passord korrekt: Server er allerede autorisert. **\",\n   \"Trekningen for denne dagen er over. Gå til dagens konkurransemappe, 22. desember\",\n   \"** OBS! Du får kun poeng for å svare på dagens konkurranse.\"]\n}</pre>\n\n<h4>Privacy 🔏</h4>It's interesting to see the different information the different calendars ask for. What is really needed to draw a winner and/or send any desired information to the end user? E-mail or phone number should be sufficient I suppose. Maybe a (first) name is ok?\n\nThe different types of information the calendars asked for were these:\n - First name\n - Last name\n - E-mail address\n - Phone number\n - <em>Postal code</em>\n - Membership number\n - Favourite store\n - <em>Gender</em>\n - <em>Full address</em>\n\n<em>Why on Earth would you ask for the gender and address to be part of a draw?</em> Even worse - user experience wise - was that you in some calendars had to fill in all the information every single day.\n\n<em>A few calendars even forced you to sign up for a newsletter to able to participate in the competition.</em> I must say I liked <a href=\"https://en.wikipedia.org/wiki/Vipps\">Vipps'</a> Messenger calendar where they used Microsoft Forms to collect names and e-mail addresses and clearly stated in one line that the information would only be used to contact the winners and that all information would be deleted when the contest is done. It doesn't have to be harder than that.\n\n<h4>Some observations and user experiences 🔭</h4>I did some more observations I wanted to add at the end here.\n\n<h5>Dark pattern</h5>The alarm company <a href=\"https://www.sectoralarm.no/\">Sector Alarm</a> had a very interesting feature which can't be described as anything but a <a href=\"https://en.wikipedia.org/wiki/Dark_pattern\">dark pattern</a>. From Wikipedia: <i>'A dark pattern is \"a user interface that has been carefully crafted to trick users into doing things, such as buying insurance with their purchase or signing up for recurring bills.\"'</i>\n\nOf all the calendars that I tried out this year Sector Alarm was the only one who had a checkbox with inverted logic. <em>One of the checkboxes you had to take a stand on every day said <i>\"I don't want to receive a security alarm offer\"</i>. While this seems to be formulated to trick people to sign up for something they don't want, they made it worse by suddenly one day rephrase the checkbox to <i>\"I want to receive a security alarm offer\"</i>.</em> So if you were used to tick the box you suddenly had to re-read it and take a new stand on whether to check it or not. I wonder what they do if you in the middle of December say you want to be contacted, but the rest of the month say no.\n\n<h5>E-mail to Facebook post to Facebook app to iframe</h5><a href=\"https://en.wikipedia.org/wiki/Intersport\">Intersport's</a> reminder e-mail for the calendar linked to a URL that redirected to a Facebook post which was just a link and post telling that the calendar for that day was opened. Then you had to click that and have a new browser tab opened and go to a Facebook app which again was an iframe to a Fanbooster application which was the actual calendar. Were they trying to make the user experience worse on purpose?\n\n<h5>Dropdown from hell</h5><img style=\"width:300px;float:left;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Not very fun to use this drop down 24 times.\" data-caption=\"Not very fun to use this drop down 24 times.\" src=\"/images/calendar08.png\">Intersport's not-so-good user experience went from a little annoying to bad when they <i>a)</i> forced you to fill out a lot of fields every day (while most calendars would use a cookie to remember the little info they wanted you to fill in), and <i>b)</i> every single day make you search for and select your favourite store from the 100+ elements drop down.\n\n<h5 style=\"clear:left;\">\"no reply\"</h5>I got like 20 calendar reminder e-mails every day (😱), and the e-mail subjects and sender names made sense - except for one. <a href=\"https://kitchn.no/\">Kitch'n</a> used a <i>\"no reply\"</i> sender, so it was the only e-mail you wouldn't know who was from.\n\n(Gotta love their name btw. Using an apostrophe in their name (<a href=\"https://en.wikipedia.org/wiki/Apostrophe\">'</a>) means that most people will spell/type their name incorrectly. And guess what, they even do it themselves. In their e-mails they use acute accent (<a href=\"https://en.wikipedia.org/wiki/Acute_accent\">´</a>).)\n\n<h5>Leaving the user with that bad feeling</h5><img style=\"width:300px;float:left;margin-right:20px;\" class=\"materialboxed responsive-img\" title=\"&quot;Nice! Unfortunately, one cannot win every time.&quot; 🤔\" data-caption=\"&quot;Nice! Unfortunately, one cannot win every time.&quot; 🤔\" src=\"/images/calendar09.png\">Skoringen had a special twist on their calendar. They had a scratch calendar where you got X tickets for the lottery, and then they typically had a simple game you could try. <em>When you finally managed to win the game you got this message with <i>\"Unfortunately, one cannot win every time\"</i>. I don't know what it was, but you had this feeling for 2 seconds where you were satisfied and happy for winning the game, but then they just finished you off by saying you didn't win.</em>\n\n<h5>Session expired</h5><img style=\"width:300px;float:left;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Session expired, try again.\" data-caption=\"Session expired, try again.\" src=\"/images/calendar10.png\">I had this case with Mester Grønn's calendar where it suddenly said <i>\"Your session expired. For your own security you need to refresh the browser window.\"</i> Really? For a calendar? If you can just refresh the browser to continue, I'm sure you could've have solved this in a better way. 😀\n\n<h5 style=\"clear:left;\">julekalender.no won Christmas</h5>Most calendars I tried out was using <a href=\"https://julekalender.no/\">julekalender.no</a>'s platform for their calendar. They really seem to serve more advent calendars than all other platforms combined. And it looks like a good platform - at least from an end user's standpoint. It's easy to use with no fuzz and they remember your personal details from one day to another. Also they don't - at least out of the box - ask for too much of personal information.\n\n<h5>410 Gone</h5>The developer in me was fascinated by Fjordkraft's API endpoint <code>/api/calendar/<b>isbeforedecember</b></code> which returned the HTTP status code <code>200 OK</code> before December and then <code><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/410\">410 Gone</a></code> in December. 😃\n\n<h4>Wrapping it up 🎁</h4>These were my observations of testing out quite a few online advent calendars. It was pretty much as expected; mostly ok, and then a few ways to cheat your way to prizes and some small and big leaks of personal information. Stay tuned for details on the biggest leak of them all.\n",
        "images": [
            "/images/calendar02.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Information leak",
                "url": "/information-leak"
            }
        ]
    },
    {
        "title": "How to get a job interview with the Norwegian Police Security Service",
        "published": true,
        "hot": true,
        "publishDate": "2019-01-14T05:45:00.000Z",
        "summary": "The Norwegian Police Security Service had a job posting with a \"digital riddle\" to find the right candidates for a job. Here's (hopefully) the solution.",
        "niceUrl": "/2019/01/pst-challenge",
        "text": "<h4>Background</h4>The <a href=\"https://en.wikipedia.org/wiki/Norwegian_Police_Security_Service\">Norwegian Police Security Service</a> (with the Norwegian abbreviation <a href=\"https://www.pst.no/\">PST</a> which I'll use for this write-up) is the police <a href=\"https://en.wikipedia.org/wiki/Security_agency\">security agency</a> of Norway. In December 2018 they <a href=\"https://1005007.webcruiter.no/Main/Recruit/Public/4001069401\">posted a job listing</a> seeking a \"curious solution-oriented digital forensics specialist\".\n                \nIn the job listing they included a <a href=\"https://en.wikipedia.org/wiki/Limerick_(poetry)\">limerick</a> which was a riddle that they wanted people to solve. I didn't hear of the job posting until it suddenly in January was on the front page of most Norwegian newspapers. The titles were typically something like <i>\"if you solve this puzzle the job could be yours\"</i>.\n\n<h4>The shark theme 🦈</h4>Almost every part of the whole mystery had a shark theme. The background for that was a bit embarrassing episode from October 2018 where suddenly <em>PST tweeted a picture of a shark. It was the 7-year-old child of one of the PST employees that had accidentally clicked the share button while playing the game <a href=\"https://en.wikipedia.org/wiki/Hungry_Shark#Hungry_Shark_Evolution_(2014)\">Hungry Shark Evolution</a> on his father's iPad. This of course sparked speculations of their Twitter account being hacked.</em> (It was not an iPad with any classified information, but an iPad used for updating Twitter from home. (Their Twitter account is also closed for direct messages.))\n\nOh, and <i>\"hai\"</i> is the Norwegian word for <i>\"shark\"</i>.\n\n<h4>Step 1 - the limerick</h4>The limerick in the job posting was as follows:\n<i>    En oktobermorgen fikk vi pulsen til å øke \n    var det en hackeR som hadde lykkes med forsøkeT \n    men en HAI I en TWeeT \n    er ikke særlig 1337. \n    løser du gåtEn bør dU vurdere å søke</i>\n\nThe direct meaning of it the limerick doesn't matter itself, but there's a pattern in it:\n<i>    <em>E</em>n oktobermorgen fikk vi pulsen til å øke\n    var det en hacke<em>R</em> som hadde lykkes med forsøke<em>T</em>\n    men en <em>HAI</em> <em>I</em> en <em>TW</em>ee<em>T</em>\n    er ikke særlig 1337.\n    løser du gåt<em>E</em>n bør d<em>U</em> vurdere å søke</i>\n\nThe upper case letters are <code>ERTHAIITWTEU</code>. As you might know, <a href=\"https://en.wikipedia.org/wiki/.eu\">.eu</a> is a top-level domain, and you might've noticed there's also one single period in the limerick. This makes it <code>ERTHAIITWT.EU</code>. If you're quicker than me (and Norwegian) you might already see that the first part can be re-ordered to <code>TWITTERHAI</code> (Twitter shark).\n\n<h5>Detour 1</h5>I didn't see the re-ordering opportunity, so I visited <code><a href=\"http://erthaiitwt.eu\">http://erthaiitwt.eu</a></code>. That site shows a <a href=\"https://en.wikipedia.org/wiki/Hangman_(game)\">hangman</a> saying that the order is incorrect.\n\n<h5>Solution 1</h5><em>The right solution for the first step was to visit <code><a href=\"http://twitterhai.eu\">http://twitterhai.eu</a></code>.</em>\n\n<h4>Step 2 - the HTML page</h4><code><a href=\"http://twitterhai.eu\">http://twitterhai.eu</a></code> shows an image of a shark and gives another poem telling you to look around. Now, I would always look at the source code, but I saw that there was this strange spacing in the middle of the word <i>være</i>. This is a sign that there's something going on with the HTML source code.\n<img style=\"width:300px;float:right;margin:20px\" class=\"materialboxed responsive-img\" title=\"Shark.html\" data-caption=\"Shark.html\" src=\"/images/pst01.png\">\nDo you see the odd line breaks and what the first column says? <code>Shark.html</code>\n\n<h5>Detour 2a</h5>I tend do look closer at <code>robots.txt</code> and have even made <a href=\"/2018/06/robots-txt-linkifier\">a nice robots.txt linkifier bookmarklet</a> to easily visit and open links from exactly that file. Visiting <code><a href=\"http://twitterhai.eu/robots.txt\">http://twitterhai.eu/robots.txt</a></code> you get a helpful hint saying <i>Use the source, Luke!</i>.\n\n<h5>Detour 2b</h5>I'm used to files being lower case so I went straight to <code><a href=\"http://twitterhai.eu/shark.html\">http://twitterhai.eu/shark.html</a></code>. There you get the helpful hint that <i>Case matters. Watch your characters.</i>\n\n<h5>Solution 2</h5><em>The solution for the second step was to visit <code><a href=\"http://twitterhai.eu/Shark.html\">http://twitterhai.eu/Shark.html</a></code>.</em>\n\n<h4>Step 3 - the image</h4>While I suppose some people stopped looking when they found <code><a href=\"http://twitterhai.eu/Shark.html\">http://twitterhai.eu/Shark.html</a></code> which gives a tip about taking the time to write a good job application. <em>However, there's a HTML comment telling that they have more puzzles if you look more closely</em>.\n\nI couldn't see any other clues or directions to go other than <a href=\"http://twitterhai.eu/\">the image from step 2</a>. What made this one hard for me was that the tools I used to look for <a href=\"https://en.wikipedia.org/wiki/Exif\">Exif metadata</a> didn't reveal anything. As I understand it the solution wasn't hiding in Exif at all, but rather a (JPEG) file comment. There are online tools out there that gives much more than just Exif, and if you're on a Unix-like system you could use a variant of the <a href=\"https://en.wikipedia.org/wiki/File_(command)\"><code>file</code> command</a> to get the info needed:\n\n<code>file 1337_shrk.jpg\n\n1337_shrk.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 72x72, segment length 16, \nExif Standard: [TIFF image data, big-endian, direntries=3, PhotometricIntepretation=RGB, orientation=upper-left], \n<em>comment: \"/haitech_secure.html\"</em>, baseline, precision 8, 851x514, frames 3</code>\n\n<h5>Solution 3</h5><em>The solution for the second step was to visit <code><a href=\"http://twitterhai.eu/haitech_secure.html\">http://twitterhai.eu/haitech_secure.html</a></code>.</em>\n\n<h4>Step 4 - the JavaScript</h4><code><a href=\"http://twitterhai.eu/haitech_secure.html\">http://twitterhai.eu/haitech_secure.html</a></code> contained some general text with some \"tips\" for when applying for a job. More importantly it contained a password field and a login button.\n\nThe source code revealed a client side validation of the password by first verifying the password and then using the password as a key to decipher a <a href=\"https://en.wikipedia.org/wiki/Ciphertext\">ciphertext</a>.\n\nThe JavaScript doing the actual verification of the key was as follows:<pre class=\"prettyprint lang-js\">password.charCodeAt(0) == 8 * 8 + 8 && \npassword.charCodeAt(1) == Math.pow(9, 2) - 29 && \npassword.charCodeAt(2) == Math.pow(10, 2) + Math.pow(3, 2) && \npassword.charCodeAt(3) == password.charCodeAt(2) && \npassword.substring(4, 5) == 3 && \npassword.charCodeAt(5) == 7 * 17 - 5 && \npassword.charCodeAt(6) == password.charCodeAt(0) && \npassword.charCodeAt(7) == password.charCodeAt(1) && \npassword.charCodeAt(8) == 0x69</pre>\nObviously the password was 9 characters long and it was just a matter of calculating each char. I just copied and pasted a bit and used the following quick and dirty JavaScript in the console to print out the password and run the login function which gave an alert box with the next clue.<pre class=\"prettyprint lang-js\">var password = [];\npassword[password.length] = 8 * 8 + 8;\npassword[password.length] = Math.pow(9, 2) - 29;\npassword[password.length] = Math.pow(10, 2) + Math.pow(3, 2);\npassword[password.length] = password[password.length - 1];\npassword[password.length] = '3'.charCodeAt(0);\npassword[password.length] = 7 * 17 - 5;\npassword[password.length] = password[0];\npassword[password.length] = password[1];\npassword[password.length] = 0x69\nfor (var i = 0; i < password.length; i++) {\n    password[i] = String.fromCharCode(password[i]);\n}\npassword = password.join('');\ndocument.getElementById(\"password\").value = password;\nconsole.log(password);\nlogin();</pre>\n<h5>Solution 4</h5><em>The password needed to proceed was <code>H4mm3rH4i</code></em> (hammerhead shark).\n\n<h4>Step 5 - the Caesar cipher</h4>The alert box outputted the text <i>Caesar synes at du skal ta turen hit: uggc://gjvggreunv.grpu/unv_gurer.ugzy</i> meaning <i>Caesar thinks you should go here: uggc://gjvggreunv.grpu/unv_gurer.ugzy</i>.\n\nJust by looking at the last part itself it seemed pretty obvious that this was a <a href=\"https://en.wikipedia.org/wiki/Caesar_cipher\">Caesar cipher</a>. This had to be <code>http://somethingsomething.html</code>. There are plenty of places to solve these kinds of code, but a quick JavaScript also does the trick: <pre class=\"prettyprint lang-js\">var cipher = 'uggc://gjvggreunv.grpu/unv_gurer.ugzy';\nvar shift = cipher.charCodeAt(0) - 'h'.charCodeAt(); // Char we suspect to know\nvar charDistance = 'a'.charCodeAt();\nvar cleartext = '';\nfor (var i = 0; i < cipher.length; i++) {\n    var charCode = cipher.charCodeAt(i) - charDistance;\n    if (charCode >= 0 && charCode <= 25) { // a-z\n        cleartext += String.fromCharCode((((charCode + shift) % 26) + charDistance));\n    } else {\n        cleartext += cipher[i];\n    }\n}\nconsole.log(shift, charDistance, cleartext);</pre>\n<h5>Solution 5</h5><em>The plaintext for this one was <code><a href=\"http://twitterhai.tech/hai_there.html\">http://twitterhai.tech/hai_there.html</a></code>.</em>\n\n<h4>Step 6 - the ASCII art and secret folder</h4><code><a href=\"http://twitterhai.tech/hai_there.html\">http://twitterhai.tech/hai_there.html</a></code> just told that you should follow <a href=\"https://twitter.com/twitt3rhai\">the Twitter user <code>twitt3rhai</code></a> (Twitter shark).\n\nThe latest tweet was the text <i>\"#justdoit, or make your ROBOTS do it. Transfer teXt to an ediTor\"</i>. I suppose this was a double hint; another trip to <code>robots.txt</code> and transferring the rest of the tweets to a text editor.\n\n<a href=\"http://twitterhai.tech/robots.txt\">The <code>robots.txt</code></a> pointed to the path <code>/min_hemmelige_mappe/</code> (\"my secret folder\").\n\nThere were 65 other tweets containing shark and fish related words. It looked like some kind of cipher. The best thing to do was to just copy all the tweets into a text editor:<pre class=\"prettyprint lang-html\">Tigerhai HvithaiHammerhaiHvalhai Oksehai Domenehai Brugde\nBrugde DomenehaiTigerhaiHvithai Hvalhai Hammerhai Oksehai\nHammerhaiJaws   Fish   Hvalhai Oksehai Domenehai Tigerhai\nHvithaiHaiene   Tail   Tigerhai DomenehaiBrugde Hammerhai\nHåbrannBrugde   Fins   HammerhaiBrugde HvithaiHvalhaiJaws\nHvithaiHammer          Domenehai Tigerhai Oksehai Hvalhai\nDomenehaiJaws   Mako   HåbrannHvithai HvalhaiTigerhaiMako\nBrugdeOksehai   Apex   Tigerhai HvalhaiDomenehaiHammerhai\nHvithaiBrugde   Jaws   HammerhaiOksehai BrugdeTigerhaiHai\nBrugde HvalhaiHvithaiDomenehai Oksehai Tigerhai Hammerhai\nTigerhaiHvithaiOksehai BrugdeHammerhaiHvalhaiDomenehaiHai\nHvithaiHvalhai   BrugdeOksehaiDomenehai HammerhaiTigerhai\nHvithaiSjøen   H   TigerhaiOksehai DomenehaiHvalhaiBrugde\nHammerhaien   Hai   Domenehai HvalhaiBrugdeHvithaiOksehai\nHvithaiHai           DomenehaiHvalhai Hammerhai Oksehaien\nHvithaiHai   Havet   Oksehai TigerhaiHvalhaiDomenehaiApex\nOksehaiHai   Sjøen   HvalhaiBrugde HvithaiHammerhaiBrugde\nBrugdeJaws   Finne   Brugde HvithaiHvalhaiTigerhai Haiene\nHammerhaiDomenehaiBrugdeOksehaiTigerhai HvalhaiHvithaiHai\nHvalhaiBrugdeTigerhaiHammerhaiHvithai Oksehai Domenehaien\nDomenehaier           OksehaiHvithai HammerhaiHvalhai Hai\nOksehaiTigerhai   HvalhaiDomenehaiHammerhai BrugdeHvithai\nDomenehaiBrugde   TigerhaiHammerhai HvithaiHvalhaiOksehai\nBrugdeHvithaien   HammerhaiDomenehaiHvalhai Tigerhai Mako\nTigerhaiHvalhai   BrugdeDomenehaiHvithai OksehaiHammerhai\nBrugdeOksehaien   HammerhaiHvalhaiDomenehai HvithaiBrugde\nHvithaiJaws           HaiHvalhaiHammerhai BrugdeDomenehai\nDomenehaiTigerhaiHammerhaiHvithaiBrugdeOksehai HvalhaiHai\nTigerhaiHvithaiBrugdeHvalhaiOksehai Domenehai Hammerhaien\nBrugdeTigerhaiHammerhai   DomenehaiHvalhai OksehaiHvithai\nDomenehaiOksehaiSjøen     HammerhaiHvalhaiTigerhaiHåbrann\nHammerhai HvithaiBrugde   OksehaiHvalhai BrugdeTigerhaien\nHvithaiBrugdeOksehaiHai   TigerhaiDomenehai HvalhaiBrugde\nHvalhaiOksehaiDomenehai   TigerhaiBrugde HammerhaiHvithai\nTigerhai HvithaiOksehai   HammerhaiDomenehaiBrugdeHvalhai\nHvithaiOksehaiBrugde         Hammerhai Tigerhai Domenehai\nHvalhaiHammerhaiHvithaiBrugdeTigerhai OksehaiDomenehaiHai\nDomenehaiHvithaiBrugdeTigerhaiHammerhai Hvalhai Oksehaien\nOksehaiBrugdeBrugde         Hvithai DomenehaiTigerhaiApex\nHvalhaiHvithaiJaws   Haier   DomenehaiHammerhaiTigerhaien\nTigerhaiBrugdeOksehaiSjøen   Domenehai HvalhaiHammerhaien\nDomenehaiHammerhaiHavet     BrugdeOksehai HvithaiTigerhai\nHvalhaiHammerhaiHvithaiHai   Brugde Oksehaien Domenehaien\nDomenehaiBrugdeHai   Havet   Hammerhai Hvalhai Tigerhaien\nHvalhaiOksehaiBrugde        BrugdeDomenehaiTigerhaiBrugde\nHvithai DomenehaiBrugdeHammerhaiTigerhaiHvalhai Oksehaien\nHvalhaiBrugdeHvithaiDomenehaiOksehai Tigerhai Hammerhaien\nBrugdeHvithaiBrugde         HammerhaiTigerhaiHvalhaiSjøen\nDomenehai Tigerhai   Sjøen   HvithaiHammerhai Brugde Jaws\nOksehaiBrugdeHvalhaiHvitha   Domenehai Tigerhai Hammerhai\nTigerhaiHammerhaiHavet     HvalhaiHvithai BrugdeDomenehai\nTigerhaiDomenehaiHammerhai   Hvalhai HvithaiOksehaiBrugde\nHvithaiDomenehaien   Finne   HammerhaiHvalhaiBrugdeBrugde\nBrugdeOksehaiBrugden        Hammerhai Hvithai Domenehaien\nHvithaiBrugde TigerhaiOksehaiDomenehaiHammerhai Hvalhaien\nDomenehaiHammerhaiOksehaiHvithaiHvalhai Brugde Tigerhaien\nHammerhaiTigerhai           DomenehaiHvithaiBrugdeHvalhai\nHvalhaiBrugdeHvit   Haier   OksehaiTigerhai Domenehai Hai\nOksehaiBrugdeHvithaiJaws   HavetDomenehai TigerhaiHvalhai\nDomenehaiHvithaiHåbrann   Hammerhai Brugde OksehaiHvalhai\nDomenehaiHvalhaiBrugde   OksehaiBrugdeHammerhai Hvithaien\nDomenehaiTigerhaiApex   Hammerhai Hvithai Hvalhai Oksehai\nOksehaiHammerhaiJaws   DomenehaiTigerhaiBrugdeHvalhaiJaws\nHvalhai HvithaiTigerhaiDomenehaiBrugdeHammerhai Oksehaien\nHåbrann TigerhaiOksehaiHvithaiBrugdeHvalhaiHammerhaiHavet</pre>\n<h5>Solution 6</h6>There were two things to draw from this step. <em>The first was the URL to <code><a href=\"http://twitterhai.tech/min_hemmelige_mappe/\">http://twitterhai.tech/min_hemmelige_mappe/</a></code>, and the second was the word <code>HAI1337</code> (shark 1337) hiding in all the tweets.</em>\n\n<h4>Step 7 - the Wireshark dump</h4><img style=\"width:400px;float:left;margin:20px\" class=\"materialboxed responsive-img\" title=\"Screenshot from Wireshark.\" data-caption=\"Screenshot from Wireshark.\" src=\"/images/pst03.png\"/>The mentioned URL <code style=\"word-break:break-all;\"><a href=\"http://twitterhai.tech/min_hemmelige_mappe/\">http://twitterhai.tech/min_hemmelige_mappe/</a></code> was the URL to a directory containing a file called just <code>haimat</code> (shark food), and it was indeed shark food. Again the <a href=\"https://en.wikipedia.org/wiki/File_(command)\"><code>file</code> command</a> proved a quick and simple way of determining the file type:\n<code>file haimat\nhaimat: <em>pcap-ng capture file</em> - version 1.0</code>\n\nA pcap-ng capture file is a file with a packet capture format that contains a \"dump\" of data packets captured over a network - a file typically seen from the good old packet analyzer <a href=\"https://en.wikipedia.org/wiki/Wireshark\">Wireshark</a>.\n\nNow, I'm no expert in Wireshark, but I have used it now and then to listen in on network traffic. I used it extensively while building the app for my HDL Buspro smart home - to see how the different components were talking together. Luckily this dump only contained 400+ packets.\n\nI might very well have missed stuff in the dump, but I did find two things. The first was a web browser visiting the root of a server and getting back the following HTML:<pre class=\"prettyprint lang-html\">&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;Sharky Secret Distributor&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    Her er dataene dine. Passordet har du allerede... &lt;a href=\"/secret_data.zip\"&gt;secret_data.zip&lt;/a&gt;\n&lt;/body&gt;\n&lt;/html&gt;</pre>\nThe page said <i>Here's your data. You already have the password...</i> and linked to ZIP file.\n\nThe second thing of interest was the response to the the request for the actual ZIP file. Wireshark lets you easily save files that been transferred over the wire.\n\n<h5>Solution 7</h5><em>The solution was to extract the ZIP file from the packet capture file.</em>\n\n<h4>Step 8 - the ZIP file</h4>Trying to unzip the ZIP file it asks for the password for the file <code>insignificant_shark.png</code>.\n\n<h5>Solution 8</h5>As hinted, you were already supposed to have the password. Yes, <em>the password was <code>HAI1337</code></em>.\n\n<h4>Step 9 - runes and steganography</h4>Of course the image was of a shark. The shark had what looked like <a href=\"https://en.wikipedia.org/wiki/Runes\">runes</a> on its side. Looking at a <a href=\"https://snl.no/runer\">table of a runic alphabet</a> <em>the three runes can be transliterated to <code>l s b</code></em>.\n\nWhat could the letters <code>LSB</code> mean in context of an image? <a href=\"https://en.wikipedia.org/wiki/Bit_numbering#Least_significant_bit\">Least significant bit</a>. That matches the file name of <code>insignificant_shark.png</code>. <a href=\"https://en.wikipedia.org/wiki/Steganography\">Steganography</a> is the practice of concealing a file, message, image, or video within another file, message, image, or video.\n\nThere are many online tools for looking for secret messages in images.\n\n<h5>Detour 9</h5><img style=\"width:300px;float:left;margin:20px\" class=\"materialboxed responsive-img\" title=\"Decoding the image incorrectly the image would reveal a QR code.\" data-caption=\"Decoding the image incorrectly the image would reveal a QR code.\" src=\"/images/pst02.png\"/>If you decoded the image incorrectly the image would reveal a QR code which was encoded with the helpful text <i>You thought we would hide anything of SIGNIFICANCE? Not the LEAST...</i>.\n\n<h5 style=\"clear:left;\">Solution 9</h5><em>Decoding the image looking at the LSB reveals the URL <code><a href=\"http://twitterhai.tech/u_are_th3_winrar.jpg\">http://twitterhai.tech/u_are_th3_winrar.jpg</a></code>.</em>\n\n<h4>Step 10 - Winrar</h4>The image at <code><a href=\"http://twitterhai.tech/u_are_th3_winrar.jpg\">http://twitterhai.tech/u_are_th3_winrar.jpg</a></code> has the text <i>\"Do we we have a winner?\"</i>.\n\nThe puzzle can't end with a question. What should we be looking for here? The URL says <i>\"winrar\"</i> and not <i>\"winner\"</i>. The simple image is a stunning 9 MB. It is possible to hide files at the end of images. <a href=\"https://en.wikipedia.org/wiki/WinRAR\">WinRAR</a> is a file archiver utility for ZIP files and <a href=\"https://en.wikipedia.org/wiki/RAR_(file_format)\">RAR files</a>.\n\n<h5>Solution 10</h5><em>The solution was to e.g. use WinRAR to extract the files <code>gratulerer.txt</code> and <code>gratulerer.gif</code> from the \"image\".</em>\n\n<h4>We have a winner</h4>I wouldn't be very surprised if there was another level of puzzles and solutions hidden here somewhere, but who knows. The file <code>gratulerer.txt</code> (congratulations.txt) contained a greeting telling that all the puzzles have been solved and included a (shark related, of course) code word that could be used as a proof of challenge completion. <code>gratulerer.gif</code> is GIF from the movie <a href=\"https://en.wikipedia.org/wiki/The_Great_Gatsby\">The Great Gatsby</a>.\n\n<em>So does all this prove that you are ready for working as a digital forensics specialist for a national security agency?</em> Of course not in itself. But I suppose <em>it's a good starting baseline for applicants. Solving all the pieces shows a basic understanding of a wide area of topics like knowing a little bit of code, some basic cryptography, a bit networking and have some general smartness.</em> Of course, if you applied on January 8th or later you might expect some extra questions in regards of the solution as <em><a href=\"https://www.reddit.com/r/norge/comments/advuc7/la_oss_løse_gåten_sammen/\">someone solved the challenge on Reddit</a></em> and there's also <a href=\"https://gist.github.com/BobuSumisu/501dafd4d7166d2a295a68c20bc3eb41\">a write-up on GitHub</a>. 😀 I wanted to wait to publish this until after the application deadline.\n\nGiving a challenge like this also helps spread the word about the job opening, especially when it ends up on so many news paper front pages. I hope PST got some good candidates. :)\n",
        "images": [
            "/images/pst03.png",
            "/images/pst01.png",
            "/images/pst02.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Behind the news",
                "url": "/behind-the-news"
            },
            {
                "title": "Challenge",
                "url": "/challenge"
            }
        ]
    },
    {
        "title": "Case #20: It's getting hot in here",
        "published": true,
        "publishDate": "2019-01-16T14:00:00.000Z",
        "summary": "It was possible to control Internet connected Mill heaters worldwide.",
        "niceUrl": "/2019/01/mill-heat",
        "text": "<h4>tl;dr</h4>It was possible to control what seems to be all Internet connected Mill heaters worldwide.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://www.millheat.com/\">Mill</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>October 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Very good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>It was possible to control all Internet connected heaters</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4><img style=\"float:left;width:350px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/mill02.png\"/>Mill is a company selling different heaters. If you've ever seen a heater that actually looks good it was probably a Mill heater. <em>Some of the heaters can be controlled with their app via the Internet. They also have Wi-Fi socket product that can be connected to good old \"dumb\" heaters.</em>\n\nPlease note that this was originally not my finding. A friend of mine have a few Mill heaters and let me access what was needed to check out this issue.\n\n<h4 style=\"clear:left;\">Approach (technical stuff)</h4><a class=\"skip-link\" href=\"#security-issues\"><u>Skip this part</u> 🙈</a>\n<img style=\"float:left;width:400px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/mill04.png\"/>I downloaded <a href=\"https://play.google.com/store/apps/details?id=com.millheat.heater\">Mill's Android app</a> and used the HTTP proxy <a href=\"https://www.charlesproxy.com/\">Charles</a> to listen in on the traffic.\n\nThe first thing that surprised me was that the app connected to a hostname that belongs to a Chinese \"IoT platform\" (Mill is Norwegian). The IP seems to belong to a machine running <a href=\"https://aws.amazon.com/ec2/\">Amazon Elastic Compute Cloud (EC2)</a> in Germany.\n\n<em>The first thing that scared me was that they only used https for the authentication. All other communication was unencrypted.</em>\n\nDuring authentication the server gave the client an access token. The token seemed to be valid for a 24+ hours.\n\nWhen receiving information and sending commands the app sent some headers to prove the authenticity. There was a signature based on a nonce, a timestamp, the user id and the authentication token. The timestamp and nonce was also sent in the request. <em>There was one problem with the request headers. The exact same headers could be used again and again for both <a href=\"https://en.wikipedia.org/wiki/Replay_attack\">replay attacks</a> and for any other different command or information retrieval. This was not the app you wanted to use from your sunbed on vacation while connected to the nearest open Wi-Fi network.</em>\n\nBut then there was the real issue. I got an ID of an oven from my friend, with his blessing to try to adjust the temperature of it. And guess what, it was possible to do just that. <em>First one could get the status of the oven and check if the oven was online, then one could change the status it - including setting the temperature.</em>\n\n<em>The ovens were assigned an ID that seemed to be an incremental number. So once this issue was present it became a large scale one. It seemed like one could set the temperature of any and all online Mill ovens worldwide.</em>\n<pre class=\"prettyprint\">curl -H 'Content-Type: application/x-zc-object' \\\n-H 'X-Zc-Content-Length: 85' \\\n-H 'X-Zc-Major-Domain: seanywell' \\\n-H 'X-Zc-Sub-Domain: milltype' \\\n-H 'X-Zc-Timestamp: 1939713271' \\\n-H 'X-Zc-Timeout: 300' \\\n-H 'X-Zc-Nonce: [some nounce]' \\\n-H 'X-Zc-User-Id: [your own user id]' \\\n-H 'X-Zc-User-Signature: [sha1 of time params, nounce and auth token]' \\\n-H 'Host: [Mill server]' \\\n--data-binary '{\"homeType\":0,\"timeZoneNum\":\"+02:00\",\"deviceId\":[some oven id],\"value\":28,\"key\":\"holidayTemp\"}' \\\n'http://[Mill server]/millService/v1/changeDeviceInfo'</pre>\n<h4 id=\"security-issues\">Security issues</h4>It was possible to get the status of up to 50,000 Internet connected Mill ovens and get data like the following:\n - Online/offline status\n - Current and target temperature\n - User selected device name (could they reveal addresses/people?)\n - Other status information\n\nIt was possible to change the status - aka set the temperature - of the ovens. <em>What if someone had turned off the oven because they were e.g. temporarily storing something close to the oven, and then someone turned the oven to full via the Internet? Could that potentially cause a fire? Their user manuals specify minimum distances for the ovens and that they need to be kept away from flammable materials.</em>\n\n<h4>Reception and handling</h4><h5>Day zero</h5>At night I sent an e-mail to both their specified contact and Play Store e-mail address.\n\n<h5>Day 1</h5>The morning after, they responded thanking me for telling them about the issue and that they had started working on fixing it.\n\nAt night - after business hours - I got a response that they had a solution that they were running some final tests on. They also asked for my opinion on some of the changes they were going to do.\n\nNot everything was fixed overnight at once, but <em>they showed they were on the ball, taking it serious and fixed the worst parts first</em>.\n\n<h4>Conclusion</h4>I live in a smart home, and I like the ease of being able to see the temperature of every room and control the heating from anywhere. I can understand why people use Mill's and other's solutions. And imagine having a cabin in the cold snowy mountains where you can adjust the heat so that it's pre-heated just before you arrive. It's perfect. On the other hand, I have so much respect for those not wanting to connect their lives or homes to the Internet, because it will fail at one or another point. It doesn't have to be a specific case like this, but we're also talking about privacy issues in regards of big companies and governments, and we're talking about surveillance from anything from burglars to jealous partners to governments.\n\nThis was yet another one of many, many incidents of IoT security failing. <em>We must come up with up with some kind of labelling of IoT devices that can work as a statement that the vendors can use to say they have at least gone through some minimum efforts checklist and that they actively uses third-party companies to check their security. If some big companies in the industry get together and work out a simple framework for this we could start going down the right path.</em> I don't think we have time to wait for laws and regulations around the world.\n",
        "images": [
            "/images/mill02.png",
            "/images/mill01.png",
            "/images/mill03.png",
            "/images/mill04.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Internet of Things",
                "url": "/iot"
            },
            {
                "title": "OWASP 2017 A5",
                "url": "/owasp-2017-a5"
            }
        ]
    },
    {
        "title": "Game *inside* browser developer tools",
        "published": true,
        "publishDate": "2019-03-07T20:20:00.000Z",
        "summary": "This one is for you developers out there: Play a game inside local storage!",
        "niceUrl": "/2019/03/devtools-game",
        "text": "<h4>tl;dr</h4><img style=\"float:left;width:400px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Screenshot from playing Cookie Defender inside Developer Tools of Vivaldi (Image: CC BY 4.0)\" data-caption=\"Screenshot from playing Cookie Defender inside Developer Tools of Vivaldi (Image: CC BY 4.0)\" src=\"/images/cookiedefender01.png\"/>I created a simple JavaScript space invaders like game using the browser's <a href=\"https://en.wikipedia.org/wiki/Web_storage#Local_and_session_storage\">local storage</a> as \"canvas\". You need to open your <a href=\"https://en.wikipedia.org/wiki/Web_development_tools\">developer tools</a> to be able to play it.\n\n<h4 style=\"clear:left;\">Try it yourself...</h4><em>Open your developer tools, go to the local storage tab, click the button below</em>, position your windows and follow the instructions. :) <b>If you are on your mobile you will have to come back here once you are on your desktop computer.</b>\n\n<script src=\"/stuff/cookiedefender/cookiedefender.js\"></script>\n<script>\nfunction updateSoundAndMusicSettings(){\n    if(window.cookieDefenderGame){\n        cookieDefenderGame.setPlaySounds(document.getElementById('cookiedefender-sound').checked);\n        //cookieDefenderGame.setPlayMusic(document.getElementById('cookiedefender-music').checked);\n    }\n}\nfunction startGame(){\n    try{\n        console.log('Launching game...');\n        window.cookieDefenderGame = new CookieDefenderGame();\n        cookieDefenderGame.start();\n        //cookieDefenderGame.setPlayerName('ROY 🇳🇴');\n        Materialize.toast('Launched! Now open that local storage of yours.<br/>(Typically by pressing F12 or CMD + OPT + I.)', 7000);\n        updateSoundAndMusicSettings();\n        console.log('Launched. Find that local storage of yours. :)');\n    }catch(error){\n        console.error('Got error trying to launch game:');\n        console.error(error.stack);\n    }\n}\n</script>\n<a onclick=\"ga('send','event','game','play','cookiedefender',1);return true;\" href=\"javascript:startGame%28%29%3B;\" class=\"waves-effect waves-light btn-large\">Launch Cookie defender</a>\n<input type=\"checkbox\" id=\"cookiedefender-sound\" onchange=\"updateSoundAndMusicSettings();\"/><label for=\"cookiedefender-sound\">Sound</label>\n<!--input type=\"checkbox\" id=\"cookiedefender-music\" onchange=\"updateSoundAndMusicSettings();\" /><label for=\"cookiedefender-music\">Music</label-->\n\n<h5>Controls</h5>Control your player with your arrow keys or WASD.\n\n<h5>Browser support</h5>I've run the game <em>successfully on Chrome</em> 72 @ Mac + Windows 10, <em>Firefox</em> 65 @ Mac + Linux Mint, Firefox X @ Windows 7, <em>Vivaldi</em> 2.3 @ Mac and <em>Opera</em> 58 on Mac + Windows 10.\n\nIt <em>does <b>not</b> work on Microsoft Edge 42</em> @ Windows 10 as their DevTools doesn't auto-refresh any of their web storages. Internet Explorer 11 (at least on Windows 7) doesn't have a proper <code>localStorage</code> viewer.\n\n<h4>...or just watch the video</h4><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/qjb7ABrlHow\" frameborder=\"0\" allow=\"autoplay; encrypted-media\" allowfullscreen></iframe>\n\n<h4>Fake Asked Questions (FAQ)</h4><h5>Why would anyone make this?</h5>Are you kidding me? Because it could be done, because it's something I haven't seen before, and because programming is tons of fun. When I got the idea I had to finish it.\n\nIt is a bit annoying to play the game in Firefox's devtools as they have a (probably normally useful) feature of blinking every time the <code>localStorage</code> is updated.\n\n<h5>Where did you get the inspiration from?</h5>From somewhere completely elsewhere. I recently saw a <a href=\"https://news.ycombinator.com/item?id=19262529\">Hacker News post</a> about an 11 year old <a href=\"https://en.wikipedia.org/wiki/Favicon\">favicon</a> game called <a href=\"http://www.p01.org/defender_of_the_favicon/\">Defender of the favicon</a>. I was a bit annoyed that I didn't come up with that idea (either before 2008 or any of the 11 following years..), so I wanted to create something nerdy and fun I hadn't seen before. Pretty quickly I came up with the idea of using the browser developer tools as the game \"screen\". First I thought about running the game in the cookies, but the JavaScript API for handling cookies is almost non-existing. Using the <code>localStorage</code> is so much simpler, and to my surprise all the browsers I first tested immediately updated the developer tools to show the contents of the local storage.\n\n<h5>Is the game open source?</h5>Yes! Just head over to <a href=\"https://github.com/roys/js-devtools-cookiedefender\">my GitHub repository for the game</a>. Please note that while my game code is licensed under MIT License, the sound and music assets have their own licenses.\n\n<h5>Do you have any other fun stuff to try out?</h5>Why don't you try out my bookmarklet game <a href=\"/2017/10/dom2-bookmarklet\">DOM II: JavaScript Hell</a>? 😎\n\n<h5>What's next?</h5>I hope that you will make Tetris or a car game for the browser devtools. That would be so cool. 😀\n\n<h4>Today I Learned (TIL)</h4>1. None of the developer tools I tried used a <a href=\"https://en.wikipedia.org/wiki/Monospaced_font\">monospaced font</a> for the <code>localStorage</code>, making it really hard to make the game at all.\n\n2. Emojis might not be of the same width, but they are *almost* of the same width, making it easier to make the game.\n\n3. There's a <a href=\"https://en.wikipedia.org/wiki/Whitespace_character\">whitespace character</a> called <a href=\"https://en.wiktionary.org/wiki/ideographic_space\">ideographic space</a> that are about the same width as many emojis. Without that I don't think I could have made this game.\n\n4. Mozilla has a really nice <a href=\"https://hacks.mozilla.org/2017/03/internationalize-your-keyboard-controls/\">description on how internationalize your keyboard controls</a> so that <a href=\"https://en.wikipedia.org/wiki/Arrow_keys#WASD_keys\"><code>WASD</code></a> magically becomes <code>ZQSD</code> for people with <a href=\"https://en.wikipedia.org/wiki/AZERTY\"><code>AZERTY</code></a> keyboards. (Hello 🇫🇷.)\n\n5. The world isn't ready for <a href=\"https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_-_ECMAScript_2015\">ES6</a>. This is no surprise I suppose. I started out going all classes, fields (ok, that's <a href=\"https://github.com/tc39/proposal-class-fields\">TC39</a>), arrow functions, computed property names, various String functions, etc., but had to go back to good old days to make the code run everywhere.\n\n",
        "images": [
            "/images/cookiedefender01.png"
        ],
        "category": {
            "title": "Software development",
            "url": "/software-development"
        },
        "tags": [
            {
                "title": "JavaScript",
                "url": "/javascript"
            },
            {
                "title": "Game",
                "url": "/game"
            }
        ]
    },
    {
        "title": "Case #21: Leaving backup in the public",
        "published": true,
        "publishDate": "2019-03-11T05:40:00.000Z",
        "summary": "A web shop left their backup of all shopping data and their site in a publicly available directory - indexed by Google.",
        "niceUrl": "/2019/03/decentralized-backup",
        "text": "<h4>tl;dr</h4>An e-commerce site had misconfigured their site which led to their backup of their entire site + database with all shopping and personal data to be available on the Internet. And you could find it with a simple Google search.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td>Anonymous, let's call them <a href=\"https://en.wikipedia.org/wiki/Fictional_company\">Acme5</a></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"red-text\">High</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>September 2018</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Very good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Website backup and database backup accessible by a simple Google search</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4>Acme5 is a Norwegian physical specialist store that also have an online web store.\n\nI briefly mentioned this case in the presentation I gave in October 2018 at <a href=\"https://event.dnd.no/siksymp/program-18-oktober-18/\">the security conference <i>Sikkerhetssymposiet</i></a>, but I never got around to writing about it. I have been wanting to do one or more write-ups on <a href=\"https://en.wikipedia.org/wiki/Google_hacking\">Google dorking</a>, that is, how to use Google to find security vulnerabilities. A good starting point for checking your own security is googling yourself. There are just endless and endless of vulnerabilities and secret stuff indexed by Google available for anyone using a simple Google search. While doing research for this kind of write-up I found the issue presented here.\n\n<h4 style=\"clear:left;\">Approach</h4><em>I searched for something along the lines of <code>intitle:\"index of\" intext:backup</code>.</em> <i>\"Index of\"</i> in the title is used by at least the <a href=\"https://httpd.apache.org/\">Apache web server</a> when a displaying directory listing. <i>\"backup\"</i> is an interesting name to see in a directory listing.\n\nEspecially one of the search results caught my attention. I clicked it and was a bit like <i>\"can this really be what it looks like?\"</i> Could it be a <a href=\"https://en.wikipedia.org/wiki/Honeypot_(computing)\">honeypot</a>? If I were to leave some fake data on the Internet I would leave it just like that.\n\nI clicked the files and took a quick peek. This was the real deal.\n\n<h4 id=\"security-issues\">Security issues</h4>The database backup of the web shop contained among other things <em>the following information about all their customers - approximately 1,000 persons:\n - Full name\n - Full address\n - E-mail address\n - Phone number\n - Hashed password\n - Password salt\n - Browser version\n - Full purchase history</em>\n\nThe website backup contained the <em>source code and configuration of the full site</em>. I don't think Acme5 could have much more to leak. At least the passwords were <a href=\"https://en.wikipedia.org/wiki/Cryptographic_hash_function\">hashed</a> with individual <a href=\"https://en.wikipedia.org/wiki/Salt_(cryptography)\">salt</a> defending against pre-computed <a href=\"https://en.wikipedia.org/wiki/Rainbow_table\">rainbow table attacks</a>, but having the database the hashes would still be open against <a href=\"https://en.wikipedia.org/wiki/Dictionary_attack\">dictionary attacks</a> and making it easier to <a href=\"https://en.wikipedia.org/wiki/Brute-force_attack\">brute force</a> them.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>I was a bit amazed with this finding and considered a second if this was a case for <a href=\"https://en.wikipedia.org/wiki/Troy_Hunt\">Troy Hunt</a> and his service <a href=\"https://haveibeenpwned.com/\">Have I Been Pwned</a>. However, I ended up at just contacting the web shop by e-mail.\n\n1.5 hour later I received a reply from the IT company Acme5 was using, thanking me for alerting them and asking for confirmation that I had deleted the files. <em>They claimed to have web server access logs pre-dating the 3 months old backups and that the files were only downloaded once.</em> I confirmed that I no longer had the files. They said they would \"take the appropriate action in accordance Acme5's GDPR routines\". And that was it.\n\nNow, I have no idea if they did follow up the incident, if they reported anything to the Data Protection Authority or not. Maybe they felt like they didn't have to since they claimed that no one else had accessed the files.\n\n<h4>Anonymous you say?</h4>I have been in doubt if this is a case where the company should be named. I suppose this is the biggest leak where I haven't named the company. The reasons for not doing so are that Acme5 isn't that big, their IT vendor is a small company, and supposedly they can tell for sure that no one previously had accessed the data.\n\n<h4>Conclusion</h4>Technically it's incredible simple for a system administrator to do a mistake like this, but you just can't do it. (Sometimes you have to wonder if some leaks are intentional.)\n\nAs an IT company; please Google yourself. And please hire an external company to do penetration tests and regular security audits. And stay tuned for that blog post about Google hacking.\n",
        "images": [
            "/images/acme501.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "OWASP 2017 A3",
                "url": "/owasp-2017-a3"
            },
            {
                "title": "OWASP 2017 A6",
                "url": "/owasp-2017-a6"
            }
        ]
    },
    {
        "title": "Case #22: Another booking leak",
        "published": true,
        "publishDate": "2019-03-18T05:45:00.000Z",
        "summary": "Personal info like Social Security numbers and personal documents were available. While I mostly hail the City of Bergen's handling of this issue, here are also the details they didn't tell you.",
        "niceUrl": "/2019/03/aktiv-kommune-booking",
        "text": "<h4>tl;dr</h4>Personal information and documents from thousands of individuals were leaked in a government booking system.\n\n<h4>Summary</h4><table class=\"summary\">\n<tr>\n    <td style=\"width:30%\">Who:</td>\n    <td><a href=\"https://www.aktiv-kommune.no/\">Aktiv kommune</a> (<a href=\"https://www.bergen.kommune.no/english\">City of Bergen</a>, <a href=\"https://www.stavanger.kommune.no/en/\">City of Stavanger</a>, <a href=\"https://www.alesund.kommune.no/english\">City of Ålesund</a>, <a href=\"https://www.fjell.kommune.no/\">Fjell municipality</a>)</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Severity level:</td>\n    <td><span class=\"orange-text\">Medium</span> to <span class=\"red-text\">High</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reported:</td>\n    <td>March 2019</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reception and handling:</td>\n    <td><span class=\"green-text\">Very good</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Status:</td>\n    <td><span class=\"green-text\">Fixed</span></td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Reward:</td>\n    <td>A thank you</td>\n</tr>\n<tr>\n    <td style=\"width:30%\">Issue:</td>\n    <td>Leak of personal information</td>\n</tr>\n</table>\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1\"><span style=\"text-decoration:underline;\" class=\"white-text\"><a class=\"white-text\" href=\"/2017/08/security-vulnerability-disclosures\">Background: The purpose of these posts</a></span></div></div>\n<h4>Background</h4><a href=\"https://www.youtube.com/watch?v=hxSCyOeW0Gc&t=31\">Bergen is one the most beautiful cities in Norway.</a> And the City of Bergen offers this <a href=\"https://www.bergen.kommune.no/portico/bookingfrontend/?menuaction=bookingfrontend.uiresource.show&id=452\">really cool \"cabin\" with a great view on its mount Fløyen</a> where families can spend a night for free. I was asked if we should try to book a night there. But when I saw the URL of the site the curious developer in me immediately got sidetracked...\n\n<img style=\"float:right;width:400px;margin-left:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/aktivkommune05.png\"/>The booking site is run by a system shared between the municipalities Bergen, Stavanger, Ålesund and Fjell. <a href=\"https://www.aktiv-kommune.no/\">Aktiv kommune</a> is some sort of collective site for this cooperation. <em>The booking system is used by organizations and individuals to book all kinds of facilities and equipment like sport courts, venues, meeting rooms, music instruments, etc. There are thousands of such \"resources\" that can be booked.</em>\n\n<h4 style=\"clear:left;\">Approach (technical stuff)</h4><a class=\"skip-link\" href=\"#security-issues\"><u>Skip this part</u> 🙈</a>\n<h5>Problem 1</h5><img style=\"float:left;width:400px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/aktivkommune01.png\"/>I opened <a href=\"https://help.vivaldi.com/article/developer-tools/\">Vivaldi developer tools</a> while browsing the site. There's a calendar on the site showing the availability of all a selected resource. The calendar data is loaded as JSON via <a href=\"https://en.wikipedia.org/wiki/Ajax_(programming)\">Ajax</a>. <em>I took me like 30 seconds to see that the server returned way too much data - including names, phone numbers, e-mail addresses, Social Security numbers etc.</em>\n\nThis just so common - the server returns some kind of serialized data structure that contains much more information than what is used for the user interface. This reminded me of <a href=\"/2018/08/norconsult-soap-leak\">the case where the garbage collection calendar app leaked personal data</a>.\n\n<h5>Problem 2 + 3</h5><img style=\"float:left;width:400px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/aktivkommune02.png\"/>Days after I reported the issue I was still curious of the site would be safe to use when that issue was fixed. I filled out the application form and uploaded an attachment. The URL to the finished application contained a \"secret\" so that no one should be able to guess the URL to your application. Other than that the ID seemed to be an incremental integer. But did the URL to the attached document in the application contain some kind of secret? Guess what, it didn't. <em>The URL to all documents uploaded by users was based on an incremental integer ID. One could systematically go through and download all the documents.</em>\n\nI just checked a few, but <em>to my surprise and horror the documents included photos of ID cards, passports, family photos and e-mails</em>. Now this was not the kind of data I wanted stored on my computer even though it was available openly on the Internet. Luckily I found <em>another unprotected URL which \"just\" listed the file names of all the uploaded documents</em>. This made it easier to document the vulnerability without actually downloading stuff. <em>The file list contained \"interesting names\" like full names, images with identifiers clearly pointing back to Facebook, words like <i>\"passport\"</i>, <i>\"visa\"</i>, <i>\"e-mail\"</i>, <i>\"rental agreement\"</i>, <i>\"ticket\"</i> etc.</em>\n\n<h4 id=\"security-issues\">Security issues</h4>For years (City of Bergen estimates <em>8+ years</em>) it was possible to retrieve a variation of the following information about persons booking resources:\n<em> - Full name\n - Phone number\n - E-mail address\n - Full address\n - <a href=\"https://en.wikipedia.org/wiki/National_identification_number#Norway\">Social Security number</a></em>\n - Comment\n <em> - Attached documents</em>\n - Gender and age groups (0-12, 13-19, 20+) of attendees</em>\n\nAmong the available documents there were a few <em>ID cards, passports, tickets, visa, family photos, contracts and e-mails.</em>\n\nFor the mentioned cabin you could see who were to stay there a given night - including age group and gender of each family member.\n\nAccording to the municipalities themselves there were leaked information about <em>3,142 individuals in City of Bergen, 628 in Fjell municipality and 16 in City of Ålesund. City of Stavanger seems to have \"forgotten\" to tell the number of persons of affected.</em> I suppose that in addition there were documents and other information about organizations available.\n\n<h4>Reception and handling</h4><h5>Day zero</h5>As the booking system was used by several municipalities on different URLs I wasn't sure what would be the best contact point. I sent an e-mail to Norwegian National Security Authority's (NSM) <a href=\"https://www.nsm.stat.no/norcert\">NorCERT</a> (<a href=\"https://en.wikipedia.org/wiki/Computer_emergency_response_team\">Computer Emergency Response Team</a>) and they said they could contact the right persons. The few times I have talked with NorCERT they have always been very helpful, responsive and effective.\n\n<h5>Day 2</h5>Two days later I got responses from NorCERT, Aktiv kommune (City of Stavanger) and City of Bergen. A project manager from Aktiv kommune thanked me and told me that they had fixed the issue and reported it to The Norwegian Data Protection Authority (DPA) - <a href=\"https://www.datatilsynet.no/en/\">Datatilsynet</a>.\n\n<h5>Day 5</h5><em>I noticed the other issue</em> with documents being downloadable and at night reported that to Aktiv kommune and City of Bergen.\n\n<h5>Day 6</h5>Some e-mailing back and forth and the issue was fixed. Then <a href=\"https://www.bergen.kommune.no/hvaskjer/sistenytt/article-160810\">City of Bergen</a>, <a href=\"https://www.stavanger.kommune.no/nyheter/sikkerhetshull-i-bestillingslosning/\">City of Stavanger</a>, <a href=\"https://www.alesund.kommune.no/aktuelt/nyhetsarkiv/9956-sikkerhetshull-funnet-i-bookinglosning\">City of Ålesund</a> and <a href=\"https://www.fjell.kommune.no/aktuelt/tryggleiksbrot-funne-i-bookingloysning/\">Fjell municipality</a> posted each own news article describing the issue.\n\n<h5>What they didn't tell</h5>The problem with the news articles posted by the municipalities was that they seemed geared towards the issue reported initially. <em>They don't mention any of the leaked documents. No passports, no ID cards, no e-mails, no contracts, no nothing. I asked the City of Bergen about this, and that is actually the only e-mail they have not responded to.</em>\n\nThe report from City of Bergen to the DPA is one of the most honest and best ones I have read. They mention 5 passports, but I believe that number to be incorrect. Yes, if you look quickly at the filenames (and assume equal filenames in a row are duplicates) you will see 5 files containing the word <i>\"pass\"</i>. But the ID cards and passport I saw had other types of filenames. They also say the quality on the images were low. Well, that cannot be said about the ones I saw. <em>In addition there were filenames with <i>\"pasaporte\"</i>, <i>\"visa\"</i>, <i>\"flights\"</i>, <i>\"itinerary\"</i> ,<i>\"paszport\"</i>, <i>\"ticket\"</i> and quite a few full names and what seems to be e-mails and contracts</em>. I hope they will report that as well.\n\nThe report also doesn't say that someone externally reported the issue with the documents. And it doesn't say that this happened days after. The report starts out so honest, but then it becomes the questionable text that the DPA usually receives.\n\n<h5>Handling summary</h5> ✅ The issues were fixed quickly\n ✅ The DPA was alerted\n ✅ The individuals affected were informed by e-mail\n ☑️ Mostly open about number of persons affected\n ❌ City of Bergen's report to DPA seems lacking\n ❌ Not mentioning document leak in news articles or e-mails\n ❌ Not mentioning anywhere that one could also see the gender and age groups of the people accommodated\n\n<h4>Conclusion</h4>As we all know by now, leaks like this happen constantly. This is why I started publishing the issues that I trip over when I'm online. We need more focus on IT security in IT education, in IT projects and in IT companies. And people should be cautious about what information is left where.\n\nOn a positive note, the handling of this issue on City of Bergen's hand was quite a few steps up from the last time they where in the media in regards of security issues.\n",
        "images": [
            "/images/aktivkommune01.png",
            "/images/aktivkommune02.png",
            "/images/aktivkommune03.png",
            "/images/aktivkommune04.png",
            "/images/aktivkommune05.png",
            "/images/aktivkommune06.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            },
            {
                "title": "Information leak",
                "url": "/information-leak"
            },
            {
                "title": "PHP",
                "url": "/php"
            },
            {
                "title": "Social Security numbers",
                "url": "/ssn"
            },
            {
                "title": "OWASP 2017 A3",
                "url": "/owasp-2017-a3"
            },
            {
                "title": "OWASP 2017 A5",
                "url": "/owasp-2017-a5"
            }
        ]
    },
    {
        "title": "Smart meter part 1: Getting the meter data",
        "published": true,
        "publishDate": "2019-07-22T08:30:00.000Z",
        "summary": "Tag along while I show you how I got access to my realtime electricity usage connecting to my smart meter's HAN port.",
        "niceUrl": "/2019/07/smart-meter-1",
        "text": "By now <a href=\"https://www.nve.no/energy-market-and-regulation/retail-market/smart-metering-ams\">all electricity consumers in Norway are supposed to have got their electricity meters replaced</a> with new <a href=\"https://en.wikipedia.org/wiki/Smart_meter\">smart meters</a>. (The smart meters are often referred to as AMS (Advanced Metering System)). The new smart meters register electricity consumption at least every hour and automatically sends it to the power company. There's no more use for manually reporting the usage.\n\nWhat's interesting is that <em>the new smart meters all come with a so-called HAN port (short for <a href=\"https://en.wikipedia.org/wiki/Home_network\">Home Area Network</a>). Using that port it's possible to get full access to your own electricity usage realtime</em>. While I'm sure great services (and APIs) for using this data will be provided by both my energy company and third party vendors I didn't want to sit back and wait. (You can today get access to a bit of delayed hourly usage if you log in to <a href=\"https://plugin.elhub.no/\">https://plugin.elhub.no/</a>. They also have some nice Ajax calls which are easy to understand and tweak.)\n\n<h4>Step 1 - opening the HAN port</h4><img style=\"float:left;width:400px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Smart meter with RJ-45 HAN port.\" data-caption=\"Smart meter with RJ-45 HAN port.\" src=\"/images/ams01.jpg\"/>By default the physical HAN ports of the smart meters are closed off and not sending any data. <em>All you need to do is to contact customer support at your power company and they'll quickly open it remotely.</em>\n\nMy power company - Norgesnett - used almost a month to open it up as they said the newly installed meter had to first be registered in some computer system. Of course <a href=\"https://blog.roysolberg.com/2018/04/power-company-leak\">I also noticed a pretty bad security vulnerability</a> while at it.\n\n<h4>Step 2 - getting the hardware</h4>The smart meters use the <a href=\"https://en.wikipedia.org/wiki/Meter-Bus\">M-Bus</a> standard for the physical data transfer. So to read the data stream you need to get some kind of M-Bus converter. The smart meters act as a so-called <i>master</i> and the receiver must be a <i>slave</i>. The master gives enough power to run a slave.\n\n<h5>Hardware - first try</h5>From what I read from the forums a lot of people are using - successfully - <a href=\"https://www.aliexpress.com/item/32814808312.html\">this (or similar) M-Bus to USB master/slave found on AliExpress</a>, but for me and others it didn't work. I received shorter packages than expected and only the first part of it was readable for me.\n\nNot being an electrical engineer and not knowing how to debug or resolve this I just threw money at the problem and bought another converter.\n\n<h5>Hardware - second try</h5><img style=\"float:left;width:400px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Raspberry Pi with M-Bus to USB converter connected to HAN port.\" data-caption=\"Raspberry Pi with M-Bus to USB converter connected to HAN port.\" src=\"/images/ams02.jpg\"/>Another commonly used <a href=\"https://www.ebay.com/sch/i.html?_nkw=USB+MBUS+Slave+Module\">M-Bus to USB master/slave from eBay</a>  (the exact same product from the same seller no longer exists, but it looks like <a href=\"https://i.ebayimg.com/00/s/ODAwWDgwMA==/z/ywgAAOSwfTlcHF5u/$_12.JPG\">this</a> and can be found doing a <a href=\"https://www.ebay.com/sch/i.html?_nkw=USB+MBUS+Slave+Module\">search</a>) did the trick for me. I connected it to my good old <a href=\"https://www.komplett.no/product/774016\">Raspberry Pi (Model B Rev 2)</a>. <em>The HAN port in the smart meters has a <a href=\"https://en.wikipedia.org/wiki/Modular_connector#8P8C\">RJ-45</a> connector with the signal being transmitted on pin 1 + 2.</em> So I just used an old network cable to connect the smart meter and converter.\n\n<h4>Step 3 - reading raw data</h4><a href=\"https://en.wikipedia.org/wiki/Python_(programming_language)\">Python</a> is not my mother tongue, but it's a language I really like and enjoy writing. It's almost always available on whatever system you're on, and the standard library is pretty extensive. Do a simple <code><a href=\"https://packaging.python.org/guides/tool-recommendations/#installation-tool-recommendations\">pip</a> install <a href=\"https://pythonhosted.org/pyserial/\">pyserial</a></code> and you're ready to read data from the USB port.\n\nThe <a href=\"https://en.wikipedia.org/wiki/Serial_port#Settings\">serial port settings</a> for the data stream for me was 2400 baud, parity bit none and byte size 8 bits.\n\nSo doing something similar to this I got the raw data stream (code works in both Python version 2.7 and 3.4):\n<pre class=\"prettyprint lang-py\">import serial\nimport codecs\nimport sys\n\nser = serial.Serial(\n    port='/dev/ttyUSB0',\n    baudrate=2400,\n    parity=serial.PARITY_NONE,\n    stopbits=serial.STOPBITS_ONE,\n    bytesize=serial.EIGHTBITS,\n    timeout=4)\nprint(\"Connected to: \" + ser.portstr)\n\nwhile True:\n    bytes = ser.read(1024)\n    if bytes:\n        print('Got %d bytes:' % len(bytes))\n        bytes = ('%02x' % int(codecs.encode(bytes, 'hex'), 16)).upper()\n        bytes = ' '.join(bytes[i:i+2] for i in range(0, len(bytes), 2))\n        print(bytes)\n    else:\n        print('Got nothing')</pre>\nIt would output something similar to this (I have anonymized the data a bit):\n<pre class=\"prettyprint lang-html\">Connected to: /dev/ttyUSB0\nGot 228 bytes:\n7E A0 E2 2B 21 13 23 9A E6 E7 00 0F 00 00 00 00 0C 07 E3 06 12 02 14\n2F 32 FF 80 00 80 02 19 0A 0E 4B 61 6D 73 74 72 75 70 5F 56 30 30 30\n31 09 06 01 01 00 00 05 FF 0A 10 32 32 30 30 35 36 37 32 32 33 31 39\n37 37 31 34 09 06 01 01 60 01 01 FF 0A 12 36 38 34 31 31 33 31 42 4E\n32 34 33 31 30 31 30 34 30 09 06 01 01 01 07 00 FF 06 00 00 06 A7 09\n06 01 01 02 07 00 FF 06 00 00 00 00 09 06 01 01 03 07 00 FF 06 00 00\n00 00 09 06 01 01 04 07 00 FF 06 00 00 01 E0 09 06 01 01 1F 07 00 FF\n06 00 00 00 88 09 06 01 01 33 07 00 FF 06 00 00 02 36 09 06 01 01 47\n07 00 FF 06 00 00 00 6D 09 06 01 01 20 07 00 FF 12 00 EB 09 06 01 01\n34 07 00 FF 12 00 EB 09 06 01 01 48 07 00 FF 12 00 EB 83 77 7E</pre>\n<h4>Step 4 - understanding OBIS</h4>So what are those bytes coming from the HAN port? They are following the DLMS (Device Language Message Specification) protocol and are sent inside HDLC frames and contains OBIS (Object Identification System) codes that describes the electricity usage. Everything is part of <a href=\"https://en.wikipedia.org/wiki/IEC_62056\">IEC 62056</a> which is a set of standards for electricity metering data exchange.\n\nHow often the messages arrives varies from one meter vendor to another. The same goes for the actual format of the messages. I don't know if there are any other vendors, but at least Aidon, Kaifa and Kamstrup have made smart meters for the Norwegian market, and they all provide documentation for their own OBIS messages.\n\n<em>On my Kamstrup meter I get the current power used every 10 second + the total kWh usage every hour.</em>\n\nTo really understand the HDLC and OBIS codes you need dig into different sources around the Internet, but the Norwegian forums at <a href=\"https://www.hjemmeautomasjon.no/forums/forum/12-strømsparing-og-strøm-overvåkning/\">hjemmeautomasjon.no</a> is a great source of information. There are so many knowledgeable people sharing their work and helping each other out.\n\n<h5>Realtime usage - every 10 second</h5>I assume I haven't got everything figured out and there are likely some errors, but this is my interpretation of the message:\n<pre class=\"prettyprint lang-html\">\nHeader:\n7E                                                        <-- Frame start flag\nA                                                         <-- 4 bits, A = 0b1010 = frame format type 3\n0E2                                                       <-- 1 bit, segmentation bit + 11 bits, frame length sub-field, 0xE2 = 226 bytes (excluding opening and closing frame flags)\n2B                                                        <-- Destination address, 1 bit, 0b1 = unicast + 6 bit, node address, 0b010101 = 21 + 1 bit, address size, 0b1 = 1 byte\n21                                                        <-- Source address, 1 bit, 0b1 = unicast + 6bit, node address, 0b010000 = 16 + 1 bit, address size, 0b1 = 1 byte\n13                                                        <-- Control field\n23 9A                                                     <-- Header check sequence (HCS) field, CRC-16/X-25\n\n\nInformation:\n\nE6                                                        <-- Destination LSAP\nE7                                                        <-- Source LSAP, LSB = 0b1 = command\n00                                                        <-- LLC Quality\n0F                                                        <-- LLC Service Data Unit\n00 00 00 00                                               <-- \"Long-Invoke-Id-And-Priority\"?\n0C                                                        <-- string length?, 0C = 12\n   07 E3                                                  <-- Full year, 0x07E3 = 2019\n   06                                                     <-- Month, June\n   12                                                     <-- Day of month, 0x12 = 18\n   02                                                     <-- Day of week, Tuesday\n   14                                                     <-- Hour of day, 0x14 = 20\n   2F                                                     <-- Minute of hour, 0x2F = 47\n   32                                                     <-- Second of minute, 0x32 = 50\n   FF                                                     <-- Hundredths of second, 0xFF = not specified\n   80 00                                                  <-- Deviation (offset from UTC), 0x8000 = not specified\n   80                                                     <-- Clock status, 0x80 = 0b10000000, <a href=\"https://en.wikipedia.org/wiki/Bit_numbering#Most_significant_bit\">MSB</a> 1 = <a href=\"https://en.wikipedia.org/wiki/Daylight_saving_time\">summer time</a>\n   \n02                                                        <-- struct\n   19                                                     <-- 0x19 = 25 elements\n\n0A                                                        <-- visible-string\n   0E                                                     <-- string length 0x0E = 14 bytes\n       4B 61 6D 73 74 72 75 70 5F 56 30 30 30 31          <-- OBIS List Version Identifier, Kamstrup_V0001\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 00 00 05 FF                                   <-- OBIS for Meter ID, 1.1.0.0.5.255\n0A                                                        <-- visible-string\n   10                                                     <-- string length, 10 = 16 bytes  \n       32 32 30 30 35 36 37 32 32 33 31 39 37 37 31 34    <-- Meter ID, altered\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 60 01 01 FF                                   <-- OBIS for meter type, 1.1.96.1.1.255\n0A                                                        <-- visible-string\n   12                                                     <-- string lenth, 0x12 = 18 bytes\n   36 38 34 31 31 33 31 42 4E 32 34 33 31 30 31 30 34 30  <-- Meter type, 6841131BN243101040)\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 01 07 00 FF                                   <-- OBIS for Active Power +, 1.1.1.7.0.255\n06                                                        <-- unsigned, 4 bytes\n   00 00 06 A7                                            <-- 0x06A7 = 1703 Watt\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 02 07 00 FF                                   <-- OBIS for Active Power -, 1.1.2.7.0.255\n06                                                        <-- unsigned, 4 bytes\n    00 00 00 00                                           <-- 0 Watt\n    \n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 03 07 00 FF                                   <-- OBIS for Reactive Power +, 1.1.3.7.0.255\n06                                                        <-- unsigned, 4 bytes\n    00 00 00 00                                           <-- 0 Watt\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 04 07 00 FF                                   <-- OBIS for Reactive Power -, 1.1.4.7.0.255\n06                                                        <-- unsigned, 4 bytes\n   00 00 01 E0                                            <-- 0x01E0 = 480 Watt\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 1F 07 00 FF                                   <-- OBIS for L1 Current, 1.1.31.7.0.255\n06                                                        <-- unsigned, 4 bytes\n   00 00 00 88                                            <-- 1.36 Ampere\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 33 07 00 FF                                   <-- OBIS for L2 Current, 1.1.51.7.0.255\n06                                                        <-- unsigned, 4 bytes\n   00 00 02 36                                            <-- 5.66 Ampere\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 47 07 00 FF                                   <-- OBIS for L3 Current, 1.1.71.7.0.255\n06                                                        <-- unsigned, 4 bytes\n   00 00 00 6D                                            <-- 1.09 Ampere\n   \n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 20 07 00 FF                                   <-- OBIS for L1 Voltage, 1.1.32.7.0.255\n12                                                        <-- unsigned, 2 bytes\n   00 EB                                                  <-- 235 Volt\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 34 07 00 FF                                   <-- OBIS for L2 Voltage, 1.1.52.7.0.255\n12                                                        <-- unsigned, 2 bytes\n   00 EB                                                  <-- 235 Volt\n\n09                                                        <-- octet-string\n   06                                                     <-- string length, 0x06 = 6 bytes\n      01 01 48 07 00 FF                                   <-- OBIS for L3 Voltage, 1.1.72.7.0.255\n12                                                        <-- unsigned, 2 bytes\n   00 EB                                                  <-- 235 Volt\n\n\nEnd:\n\n83 77                                                     <-- Frame check sequence (FCS) field, CRC-16/X-25, altered\n7E                                                        <-- Frame end flag\n</pre>\n\n<em>For me the most interesting part of this message is the OBIS for <i>Active Power +</i> (1.1.1.7.0.255) which tells how much power - in Watt - that is currently being used. If you have a house that produces electricity and exports it to the grid (e.g. if you have solar cells) the exported power would appear as the OBIS for <i>Active Power -</i> (1.1.2.7.0.255).</em>\n\n<h5>Total usage - every hour</h5>The message appearing hourly is similar to the one that comes every 10 second, but contains a bit more information:\n<pre class=\"prettyprint lang-html\">Connected to: /dev/ttyUSB0\nGot 302 bytes:\n7E A1 2C 2B 21 13 FC 04 E6 E7 00 0F 00 00 00 00 0C 07 E3 07 09 02 14\n00 05 FF 80 00 80 02 23 0A 0E 4B 61 6D 73 74 72 75 70 5F 56 30 30 30\n31 09 06 01 01 00 00 05 FF 0A 10 32 32 30 30 35 36 37 32 32 33 31 39\n37 37 31 34 09 06 01 01 60 01 01 FF 0A 12 36 38 34 31 31 33 31 42 4E\n32 34 33 31 30 31 30 34 30 09 06 01 01 01 07 00 FF 06 00 00 01 6C 09\n06 01 01 02 07 00 FF 06 00 00 00 00 09 06 01 01 03 07 00 FF 06 00 00\n00 00 09 06 01 01 04 07 00 FF 06 00 00 01 42 09 06 01 01 1F 07 00 FF\n06 00 00 00 85 09 06 01 01 33 07 00 FF 06 00 00 00 5C 09 06 01 01 47\n07 00 FF 06 00 00 00 3F 09 06 01 01 20 07 00 FF 12 00 EB 09 06 01 01\n34 07 00 FF 12 00 EB 09 06 01 01 48 07 00 FF 12 00 EB 09 06 00 01 01\n00 00 FF 09 0C 07 E3 07 09 02 14 00 05 FF 80 00 80 09 06 01 01 01 08\n00 FF 06 00 38 DE 2A 09 06 01 01 02 08 00 FF 06 00 00 00 00 09 06 01\n01 03 08 00 FF 06 00 00 00 1F 09 06 01 01 04 08 00 FF 06 00 09 00 85\n83 77 7E</pre>\nI've left out the identical parts of the message:\n<pre class=\"prettyprint lang-html\">\nHeader:\n[...same as first message...]\n\nInformation:\n[...same as first message...]\n02                                                        <-- struct\n   23                                                     <-- 0x23 = 35 elements\n[...]\n      4B 61 6D 73 74 72 75 70 5F 56 30 30 30 31           <-- OBIS List Version Identifier, Kamstrup_V0001\n[...]\n      01 01 00 00 05 FF                                   <-- OBIS for Meter ID, 1.1.0.0.5.255\n[...]\n      01 01 60 01 01 FF                                   <-- OBIS for meter type, 1.1.96.1.1.255\n[...]\n      01 01 01 07 00 FF                                   <-- OBIS for Active Power +, 1.1.1.7.0.255\n[...]\n      01 01 02 07 00 FF                                   <-- OBIS for Active Power -, 1.1.2.7.0.255\n[...]\n      01 01 03 07 00 FF                                   <-- OBIS for Reactive Power +, 1.1.3.7.0.255\n[...]\n      01 01 04 07 00 FF                                   <-- OBIS for Reactive Power -, 1.1.4.7.0.255\n[...]\n      01 01 1F 07 00 FF                                   <-- OBIS for L1 Current, 1.1.31.7.0.255\n[...]\n      01 01 33 07 00 FF                                   <-- OBIS for L2 Current, 1.1.51.7.0.255\n[...]\n      01 01 47 07 00 FF                                   <-- OBIS for L3 Current, 1.1.71.7.0.255\n[...]\n      01 01 20 07 00 FF                                   <-- OBIS for L1 Voltage, 1.1.32.7.0.255\n[...]\n      01 01 34 07 00 FF                                   <-- OBIS for L2 Voltage, 1.1.52.7.0.255\n[...]\n      01 01 48 07 00 FF                                   <-- OBIS for L3 Voltage, 1.1.72.7.0.255\n[...]\n09                                                        <-- octet-string\n  06                                                      <-- string length, 0x06 = 6 bytes\n    00 01 01 00 00 FF                                     <-- OBIS for Real Time Clock (RTC), 0.1.1.0.0.255\n09                                                        <-- octet-string\n  0C                                                      <-- string length, 0x0C = 12 bytes\n    07 E3                                                 <-- Full year, 0x07E3 = 2019\n    07                                                    <-- Month, July\n    09                                                    <-- Day of month, 9\n    02                                                    <-- Day of week, Tuesday\n    14                                                    <-- Hour of day, 0x14 = 20\n    00                                                    <-- Minute of hour, 0\n    05                                                    <-- Second of minute, 5\n    FF                                                    <-- Hundredths of second, 0xFF = not specified\n    80 00                                                 <-- Deviation (offset from UTC), 0x8000 = not specified\n    80                                                    <-- Clock status, 0x80 = 0b10000000, <a href=\"https://en.wikipedia.org/wiki/Bit_numbering#Most_significant_bit\">MSB</a> 1 = <a href=\"https://en.wikipedia.org/wiki/Daylight_saving_time\">summer time</a>\n\n09                                                        <-- octet-string\n  06                                                      <-- string length, 0x06 = 6 bytes\n    01 01 01 08 00 FF                                     <-- OBIS for Active energy A+, 1.1.1.8.0.255\n06                                                        <-- unsigned, 4 bytes\n  00 38 DE 2A                                             <-- 0x38DE2A = 3,726,890 = 37,268.90 kWh\n\n09                                                        <-- octet-string\n  06                                                      <-- string length, 0x06 = 6 bytes\n    01 01 02 08 00 FF                                     <-- OBIS for Active energy A-, 1.1.2.8.0.255\n06                                                        <-- unsigned, 4 bytes\n  00 00 00 00                                             <-- 0 kWh\n\n09                                                        <-- octet-string\n  06                                                      <-- string length, 0x06 = 6 bytes\n    01 01 03 08 00 FF                                     <-- OBIS for Reactive energy R+, 1.1.3.8.0.255\n06                                                        <-- unsigned, 4 bytes\n  00 00 00 1F                                             <-- 0x1F = 31 = 0.31 kWh?\n\n09                                                        <-- octet-string\n  06                                                      <-- string length, 0x06 = 6 bytes\n    01 01 04 08 00 FF                                     <-- OBIS for Reactive energy R-, 1.1.4.8.0.255\n06                                                        <-- unsigned, 4 bytes\n  00 09 00 85                                             <-- 0x090085 = 589957 = 5,899.57 kWh?\n\nEnd:\n[...same as first message...]\n</pre>\n<em>The only part that I really care about is the <i>Active energy A+</i> (OBIS code 1.1.1.8.0.255), which is total power usage - in kilowatt hour (kWh) - since the installation of the smart meter. Keeping track of this value one knows the hourly power consumption.</em> This is the value you have to pay for. If you produce and exports power it would appear as <i>Active energy A-</i> (1.1.2.8.0.255).\n\n<h5>Error detection</h5>Error detection is supported through <a href=\"https://en.wikipedia.org/wiki/Cyclic_redundancy_check\">cyclic redundancy check (CRC)</a> in both the header and footer of the frame. In the start there is a <a href=\"https://en.wikipedia.org/wiki/Header_check_sequence\">header check sequence (HCS)</a>, and in the end there is a <a href=\"https://en.wikipedia.org/wiki/Frame_check_sequence\">frame check sequence (FCS)</a>. <em>The checksum algorithm used is the CRC-16/X-25.</em> There are libraries for all kinds of programming languages implementing all sorts of checksum calculations. I have used the Python library <a href=\"https://pypi.org/project/crccheck\">crccheck</a> which provides the class <code>CrcX25</code> which takes care of this.\n\n<h5>Links to more information</h5>Here are some of the sources of information I've used for deciphering the messages. I'll leave them here for anyone wanting to dive deeper:\n- <a href=\"https://www.dlms.com/files/Green-Book-Ed-83-Excerpt.pdf\">https://www.dlms.com/files/Green-Book-Ed-83-Excerpt.pdf</a>\n- <a href=\"https://www.dlms.com/files/Blue-Book-Ed-122-Excerpt.pdf\">https://www.dlms.com/files/Blue-Book-Ed-122-Excerpt.pdf</a>\n- <a href=\"https://github.com/roarfred/AmsToMqttBridge/blob/master/Samples/Kaifa/readme.md\">https://github.com/roarfred/AmsToMqttBridge/blob/master/Samples/Kaifa/readme.md</a>\n- <a href=\"https://github.com/roarfred/AmsToMqttBridge/blob/master/Samples/Kamstrup/obisdata.md\">https://github.com/roarfred/AmsToMqttBridge/blob/master/Samples/Kamstrup/obisdata.md</a>\n- <a href=\"http://www.interfacebus.com/HDLC_Protocol_Description.html\">http://www.interfacebus.com/HDLC_Protocol_Description.html</a>\n- <a href=\"https://www.hjemmeautomasjon.no/forums/topic/390-ny-strømmåler-med-han-interface/?page=4\">https://www.hjemmeautomasjon.no/forums/topic/390-ny-strømmåler-med-han-interface/?page=4</a>\n- <a href=\"https://www.nek.no/wp-content/uploads/2018/10/Kamstrup-HAN-NVE-interface-description_rev_3_1.pdf\">https://www.nek.no/wp-content/uploads/2018/10/Kamstrup-HAN-NVE-interface-description_rev_3_1.pdf</a>\n- <a href=\"https://byggebolig.no/imageoriginals/88b3d1774ecb41e6a3fe067ae9e6a893.pdf\">https://byggebolig.no/imageoriginals/88b3d1774ecb41e6a3fe067ae9e6a893.pdf</a>\n\n<h4>Rounding it up</h4>That's it. In this post I've shown how I connected to the HAN port of my smart meter, how I read the data and how to transform the byte arrays into meaningful information. <em>In the next post I'll discuss how I store the data and calculate the price of the electricity usage.</em>",
        "images": [
            "/images/ams02.jpg",
            "/images/ams01.jpg"
        ],
        "category": {
            "title": "Software development",
            "url": "/software-development"
        },
        "tags": [
            {
                "title": "Smart meter",
                "url": "/smart-meter"
            }
        ]
    },
    {
        "title": "Smart meter part 2: Data storage and price info",
        "published": true,
        "publishDate": "2019-07-29T06:55:00.000Z",
        "summary": "To present the electricity usage in a nice way we first need store the data somewhere and get hold of the price information.",
        "niceUrl": "/2019/07/smart-meter-2",
        "text": "In the <a href=\"/2019/07/smart-meter-1\">previous post</a> I showed how I fetch and decode the power usage from my smart meter. Before the grand final I'll go through the middle step where I upload the data and make it available for querying. Also, usage in itself doesn't paint the whole picture, so the price information is also fetched and stored.\n\n<h4>Electricity price</h4><h5>Price structure</h5>In Norway we have to pay for both the electricity usage itself and a network tariff. The latter has two components; a fixed price and a cost per kWh. The price is different from power company to power company.\n\nAt the time of writing the price for me was as follows:\n\n<table class=\"summary\">\n<tr><td style=\"width:30%\"><b>Tariff (🇳🇴: Nettleie)</b></td></tr>\n<tr>\n<td style=\"width:30%\"> - Fixed component (Fastledd)</td>\n<td>NOK 2,615 per year</t>\n</tr>\n<tr>\n<td style=\"width:30%\"> - Energy component (Energiledd)</td>\n<td>NOK 0.4202 per kWh</td>\n</tr>\n<tr>\n<td style=\"width:30%\"><b>Electricity price</b></td>\n<td>NOK 0.4663 per kWh</td>\n</tr>\n<tr>\n</table>\nMost of the time I'm paying some variant of <a href=\"https://en.wikipedia.org/wiki/Spot_contract\">spot price</a> for the electricity. It varies from day to day. The tariff is set yearly with its energy component being a bit cheaper in the summer than in the winter.\n\n<h5>Fetching the price info</h5>I didn't find a publicly available free API for the electricity spot price, so I used some power company website's <a href=\"https://en.wikipedia.org/wiki/Ajax_(programming)\">Ajax</a> call to get the updated price.\n\nUsing <a href=\"https://pypi.org/project/requests/\"><code>requests</code></a>, the Python script I have that uploads the usage also checks for the current price with a call to this <a href=\"https://en.wikipedia.org/wiki/Representational_state_transfer\">REST</a> endpoint every hour.\n\nI haven't looked that hard, but I haven't seen any APIs at all for the tariff at all. But being set once a year it doesn't take much time or energy to set it manually.\n\n<h4>Storing the data</h4>As I'm pretty familiar with <a href=\"https://firebase.google.com/products\">Google's Firebase tech stack</a> I landed on using the NoSQL <a href=\"https://firebase.google.com/products/firestore/\">Cloud Firestore</a> for storing the usage data.\n\nTo my surprise I would have to recompile Python on my Raspberry Pi to be able to use the <a href=\"https://github.com/firebase/firebase-admin-python\"><code>firebase-admin</code> client library</a> directly in my code. I didn't want to do that, so I decided to use <a href=\"https://firebase.google.com/products/functions/\">Cloud Functions</a> for an endpoint that could receive the data from my Raspberry Pi.\n\n<h5>Function for storing data</h5>I've tweaked the code a bit here, but generally this is what the function does. Remember to add some level of authentication to not leave it wide open.\n<pre class=\"prettyprint lang-js\">const functions = require('firebase-functions');\nconst admin = require('firebase-admin');\nadmin.initializeApp(functions.config().firebase);\n\nexports.registerReading = functions.https.onRequest((request, response) => {\n    try {\n        let incomingReadings = request.body;\n        let db = admin.firestore();\n        let dbReadings = [];\n        for (const incomingReading of incomingReadings) {\n            if (isValid(incomingReading)) {\n                let dbReading = {\n                    \"meterId\": incomingReading[\"meterId\"],\n                    \"parseTimeUtc\": incomingReading[\"parseTimeUtc\"],\n                    \"dataTimeLocal\": incomingReading[\"dataTimeLocal\"],\n                    \"meterType\": incomingReading[\"meterType\"],\n                    \"activePower+\": incomingReading[\"activePower+\"],\n                    \"activePower-\": incomingReading[\"activePower-\"],\n                    \"l1Voltage\": incomingReading[\"l1Voltage\"],\n                    \"l2Voltage\": incomingReading[\"l2Voltage\"],\n                    \"l3Voltage\": incomingReading[\"l3Voltage\"],\n                    \"price\": incomingReading[\"price\"],\n                    \"priceTimeUtc\": incomingReading[\"priceTimeUtc\"],\n                    \"raw\": incomingReading[\"raw\"] // The raw bytes coming from the meter\n                }\n                var collectionId = incomingReading.meterId; // We use the meter id as the collection ID\n                if (incomingReading[\"activeEnergy+\"] || incomingReading[\"activeEnergy-\"]) { // Hourly reading\n                    dbReading[\"activeEnergy+\"] = incomingReading[\"activeEnergy+\"];\n                    dbReading[\"activeEnergy-\"] = incomingReading[\"activeEnergy-\"];\n                    collectionId += '-energy'; // We use a different collection for when having the hourly energy readings\n                }\n                let docRef = db.collection(collectionId).doc();\n                docRef.set(dbReading);\n                dbReadings.push(dbReading);\n            } else {\n                // [...error handling...]\n            }\n        }\n    } catch (e) {\n        // [...error handling...]\n    }\n    // [...]\n});\n</pre>\nI soon discovered that uploading the usage every 10 second blew the daily free <a href=\"https://cloud.google.com/functions/quotas\">Functions quota</a> of 5,000 function invocations. So I changed to uploading two readings in one go - ending up on ~4,300 invocations a day.\n\n<h4>Querying the data</h4>Now that the data is safely stored in Firestore it's ready to be queried and presented in any way desired. For me it was easiest to Cloud Functions for reading the data back out as well.\n\n<h5>Function for querying data</h5>Here's a very basic quick and dirty example of doing some querying of the data.\n<pre class=\"prettyprint lang-js\">\nconst functions = require('firebase-functions');\nconst admin = require('firebase-admin');\n\nadmin.initializeApp(functions.config().firebase);\n\nexports.getReadings = functions.https.onRequest((request, response) => {\n    try {\n        let db = admin.firestore();\n        var meterRef = db.collection('2200567223197714-energy');\n        var responseStr = \"Today's first reading: \\n\";\n        var queryRef = meterRef.where('dataTimeLocal', '>=', '2019-07-29T00:00:00')\n            .where('dataTimeLocal', '<', '2019-07-30T00:00:00')\n            .orderBy('dataTimeLocal')\n            .limit(1);\n        queryRef.get().then(snapshot => {\n            if (snapshot.empty) {\n                responseStr += 'No matches\\n';\n            } else {\n                snapshot.forEach(doc => {\n                    responseStr += JSON.stringify(doc.data(), null, 4) + '\\n';\n                });\n            }\n            return true;\n        }).then(() => {\n            responseStr += \"Today's latest reading: \\n\";\n            queryRef = meterRef.where('dataTimeLocal', '>=', '2019-07-29T00:00:00')\n                .where('dataTimeLocal', '<', '2019-07-30T00:00:00')\n                .orderBy('dataTimeLocal', 'desc')\n                .limit(1);\n            queryRef.get()\n                .then(snapshot => {\n                    if (snapshot.empty) {\n                        responseStr += 'No matches\\n';\n                    } else {\n                        snapshot.forEach(doc => {\n                            responseStr += JSON.stringify(doc.data(), null, 4) + '\\n';\n                        });\n                    }\n                    response.send(responseStr);\n                    return true;\n                })\n                .catch(err => {\n                    responseStr += 'Error: ' + err + '\\n';\n                    response.send(responseStr);\n                    console.error(err.stack);\n                });\n            return true;\n        }).catch(err => {\n            responseStr += 'Error: ' + err + '\\n';\n            response.send(responseStr);\n            console.error(err.stack);\n        });\n    } catch (e) {\n        responseStr += 'Error: ' + err + '\\n';\n        response.send(responseStr);\n        console.error(err.stack);\n    }\n});</pre>\n<h4>The final part</h4>So now we have of reading, decoding, storing and querying the power usage data. That's all nice and well, but it doesn't give much value in itself. <em>In the next post I'll show the end product - how I chose to present the data in what I felt was a meaningful and valuable way. For me that is the most interesting and fun part.</em>\n",
        "images": [
            "/images/ams03.png"
        ],
        "category": {
            "title": "Software development",
            "url": "/software-development"
        },
        "tags": [
            {
                "title": "Smart meter",
                "url": "/smart-meter"
            }
        ]
    },
    {
        "title": "Smart meter part 3: Hey Google, how much electricity am I using?",
        "published": true,
        "publishDate": "2019-08-05T21:10:00.000Z",
        "updateDate": "2019-08-06T05:40:00.000Z",
        "summary": "I can ask Google about my power consumption and what my next electricity bill will be.",
        "niceUrl": "/2019/08/smart-meter-3",
        "text": "In the two previous posts I showed how I <a href=\"/2019/07/smart-meter-1\">read and decode the power usage from my smart meter</a> and also <a href=\"/2019/07/smart-meter-1\">fetch the price info and upload it all to the cloud</a>.\n<div style=\"padding-top:98px;font-size:smaller;\" class=\"col s12 pull-m3 m9 pull-l6 l6 xl4 right\"><div class=\"card-panel light-blue darken-1 white-text\">Smart meter series:\n- <span style=\"text-decoration:underline;\" class=\"\"><a class=\"white-text\" href=\"/2019/07/smart-meter-1\">Part 1: Getting the meter data</a></span>\n- <span style=\"text-decoration:underline;\" class=\"\"><a class=\"white-text\" href=\"/2019/07/smart-meter-2\">Part 2: Storage and price info</a></span>\n- <span style=\"text-decoration:underline;\" class=\"\"><a class=\"white-text\" href=\"/2019/08/smart-meter-3\">Part 3: Google Home integration</a></span></div></div>\n<h4 title=\"Too long; didn't read\">tl;dr</h4><iframe width=\"560\" height=\"315\" src=\"https://www.youtube-nocookie.com/embed/bjRufJndgsg\" frameborder=\"0\" allow=\"autoplay; encrypted-media\" allowfullscreen></iframe>\nI have published a <a href=\"https://www.youtube.com/watch?v=bjRufJndgsg\">YouTube demo (in Norwegian) showing off the Google Assistant integration</a> on my 10\" <a href=\"https://www.lenovo.com/us/en/smart-display\">Lenovo Smart Display</a> and on my phone. There are also some screenshots in the end of this post.\n\n<h4>Turning data into information</h4>Many - maybe most - of the smart meter integrations I've seen have been focusing on showing a lot of data in some kind of dashboard. While that's powerful and often useful I want to have all the data transformed into meaningful information.\n\nI think <a href=\"https://assistant.google.com/\">Google Assistant</a> on <a href=\"https://assistant.google.com/intl/no_no/platforms/speakers/\">Google Home</a> and <a href=\"https://assistant.google.com/intl/no_no/platforms/phones/\">phones</a> can be a great platform for that. You can get the important information extracted and query the data with human language.\n\n<h4>Learning the Google Assistant platform</h4>It's not very straight forward to make \"actions\" (apps) for the Google Assistant, but <a href=\"https://developers.google.com/actions/\">the documentation</a> is pretty good so it isn't hard to at least get started. It's impossible for me to describe the whole process here, but I'll give an overview.\n\nI have made a few actions so far; a simple way of <a href=\"https://assistant.google.com/services/a/uid/0000006c18c886e8?hl=en\">getting the latest Premier League team news from FotMob</a>, <a href=\"https://assistant.google.com/services/a/uid/000000d00fb80fe8?hl=no\">the game hangman</a>, and a <a href=\"https://sbanken.no/aktuelt/info/lanserer-talestyrt-bank/\">voice-controlled bank</a> (to be published in September). This experience means that it's relatively quick for me to create an action for this purpose.\n\n<h4>Step 0 - getting an overview</h4>If you want to create something for yourself and you haven't done anything with the Google Assistant platform before you really should <a href=\"https://developers.google.com/actions/overview\">get an overview</a> and in this case especially of the <a href=\"https://developers.google.com/actions/conversational/overview\">custom conversational actions</a>. Also knowing a bit of <a href=\"https://designguidelines.withgoogle.com/conversation/\">conversation design</a> will help you make better user experiences.\n\n<h4>Step 1 - creating the action</h4><img style=\"float:left;width:250px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Actions on Google console\" data-caption=\"Actions on Google console\" src=\"/images/ams05.png\"/>The first step is to create a new project at the <a href=\"https://console.actions.google.com/\">Actions on Google console</a>. The project type you want is <i>conversional</i>. Then you only have to add some basic information about the action, like the name you want to use.\n\n<h4 style=\"clear:left;\">Step 2 - creating the Dialogflow agent</h4><img style=\"float:left;width:250px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Actions on Google console\" data-caption=\"Actions on Google console\" src=\"/images/ams06.png\"/>Just following the flow you'll be asked to create your first action; a <i>custom intent</i>. That'll send you to Dialogflow. That is where the fun part starts.\n\n<a href=\"https://dialogflow.com/\">Dialogflow</a> is a Google-owned platform for <a href=\"https://en.wikipedia.org/wiki/Natural-language_understanding\">Natural-language understanding (NLU)</a> and it provides great tools creating the <a href=\"https://en.wikipedia.org/wiki/Conversational_user_interfaces\">conversational user interfaces</a> for the action.\n\n<h5>Intents</h5><img style=\"float:left;width:400px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"Much of the work in Dialogflow is done within the 'Intents' menu.\" data-caption=\"Much of the work in Dialogflow is done within the 'Intents' menu.\" src=\"/images/ams08.png\"/>Most of the Dialogflow part is about <i>intents</i>. Intents can be seen as commands that the user can give to the action. <i>\"How much power am I consuming now?\"</i> and <i>\"What is the electricity price?\"</i> would be routed to two different intents.\n\nYou'll be able to train the Dialog agent by giving it some example phrases it should recognize. With the combination of NLU and machine learning it'll magically understand the intention of the user.\n\n<img style=\"float:right;width:400px;margin-left:20px;margin-bottom:20px;clear:left;\" class=\"materialboxed responsive-img\" title=\"Adding training data to the 'Usage' intent.\" data-caption=\"Adding training data to the 'Usage' intent.\" src=\"/images/ams09.png\"/>The intents I started out with were these:\n - Current usage\n - Usage/cost (at a give time or period)\n - Price (at a give time or period)\n - Estimate (of the next electricity bill)\n - Records (lowest/highest usages/costs)\n \n<h4 style=\"clear:left;\">Step 3 - coding the backend webhook</h4>You can't do much advanced functionality for the responses back to the user inside Dialogflow. For that you want to use a so-called <i>fulfillment</i>, i.e. a HTTP endpoint.\n\nIt wasn't a coincidence that I <a href=\"/2019/07/smart-meter-2\">in the previous post</a> showed how to query the data using <a href=\"https://firebase.google.com/products/functions/\">Cloud Functions</a>. That function can now be tweaked to handle the Dialogflow intents and return a response to the user.\n\nHere's how I route the different intents Dialogflow have figured out that the user meant:\n<pre class=\"prettyprint lang-js\">const functions = require('firebase-functions');\nconst admin = require('firebase-admin');\nconst { dialogflow } = require('actions-on-google');\n\nadmin.initializeApp(functions.config().firebase);\n\nconst app = dialogflow({ debug: false });\n\napp.intent('Default Welcome Intent', (conv) => require('./intent_welcome')(conv));\napp.intent('Current usage', (conv) => require('./intent_current_usage')(conv));\napp.intent('Usage', (conv, { time }) => require('./intent_usage')(conv, time));\napp.intent('Estimate', (conv) => require('./intent_estimate')(conv));\napp.intent('Price', (conv, { time }) => require('./intent_price')(conv, time));\n\nexports.dialogflowFulfillment = functions.https.onRequest(app);</pre>\nAlso notice how Dialogflow have parsed the <code>time</code> parameter. The time can be unspecified, a specific timestamp or a time period. For for example the <code>Usage</code> intent, I take the parameter and query the database for the usage for the specified time.\n\n<img style=\"float:right;width:400px;margin-left:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"'How much will my next electricity bill be?'\" data-caption=\"'How much will my next electricity bill be?'\" src=\"/images/ams12.png\"/>I utilize different <a href=\"https://developers.google.com/actions/assistant/responses\">response types</a> depending on the intent. I use a little bit of <a href=\"https://developers.google.com/actions/reference/ssml\">SSML</a> (Speech Synthesis Markup Language) and if the user has a screen available I often show graphs for details. I landed on using the <a href=\"https://www.image-charts.com/\">imagecharts</a> service for creating the charts I wanted to display.\n\n<b>And that's really it.</b> That's how I've made my Google Assistant app.\n\n<h4 style=\"clear:left;\">Next steps</h4>As more data become available it'll be easier to tell if the usage in a given period is high/expensive and it'll be possible to give a heads up if the usage/price is estimated to be higher than desired or expected.\n\nActions can <a href=\"https://developers.google.com/actions/assistant/updates/notifications\">push notifications to users</a>. I would like to be notified by Google Assistant whenever the power consumption is a bit too high or if the electricity becomes expensive.\n\n<a href=\"/2017/08/my-dumb-smart-home\">Living in a smart home</a> I have the current temperature for both outside and every room in my house. I also have a few <a href=\"https://en.wikipedia.org/wiki/Lux\">lux</a> sensors which will tell if the sun is shining or not. It would be interesting to add some of that data when uploading the power usage and price information.\n\n<h4>Final reflection</h4><img style=\"float:left;width:200px;margin-right:20px;margin-bottom:20px;\" class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" src=\"/images/ams14.jpg\"/>Earlier when I lived in a house built in 1981 I had a mechanical power meter in the kitchen that was connected to the power cabinet. It showed the current power consumption. With just a glance you always knew if you were consuming too much energy. There was no need for the Internet, Ebay parts, Raspberry Pi, Python, Firebase, Google Home, etc. It sure was simpler times...\n<div class=\"carousel\"><a class=\"carousel-item\" href=\"#1\" onclick=\"return false;\"><img src=\"https://blog.roysolberg.com/images/ams10.png\"></a><a class=\"carousel-item\" href=\"#2\" onclick=\"return false;\"><img src=\"https://blog.roysolberg.com/images/ams11.png\"></a><a class=\"carousel-item\" href=\"#3\" onclick=\"return false;\"><img src=\"https://blog.roysolberg.com/images/ams12.png\"></a><a class=\"carousel-item\" href=\"#4\" onclick=\"return false;\"><img src=\"https://blog.roysolberg.com/images/ams13.png\"></a></div><script>\n$(document).ready(function(){\n    $('.carousel').carousel({indicators:true,noWrap:true});\n});\n</script>\n",
        "images": [
            "/images/ams10.png"
        ],
        "category": {
            "title": "Software development",
            "url": "/software-development"
        },
        "tags": [
            {
                "title": "Smart meter",
                "url": "/smart-meter"
            },
            {
                "title": "Internet of Things",
                "url": "/iot"
            }
        ]
    },
    {
        "title": "Another job opportunity at the Police Security Service",
        "published": true,
        "publishDate": "2019-10-14T04:25:00.000Z",
        "summary": "Here's a walk-through of the Norwegian Police Security Service's latest job ad riddle. Were you able to crack the code?",
        "niceUrl": "/2019/10/pst-challenge-2",
        "text": "\n<h4>Background 👮</h4>The <a href=\"https://en.wikipedia.org/wiki/Norwegian_Police_Security_Service\">Norwegian Police Security Service</a> (with the Norwegian abbreviation <a href=\"https://www.pst.no/\">PST</a> which I'll use for this write-up) is the police <a href=\"https://en.wikipedia.org/wiki/Security_agency\">security agency</a> of Norway. Once in a while they have job ads with some more or less hidden challenges - almost <a href=\"https://en.wikipedia.org/wiki/Capture_the_flag#Computer_security\">Capture the Flag</a> style.\n\n<h5>Previous shark sighting 🦈</h5>In December 2018 they posted a job listing were they included a riddle that they wanted people to solve. I didn't hear of the job posting until it suddenly in January was on the front page of most Norwegian newspapers. <a href=\"/2019/01/pst-challenge\">I published my version of the solution</a> just after the application deadline. The solution was also translated to Norwegian and <a href=\"https://www.kode24.no/kodenytt/losningen-pa-pst-sin-jobbannonse-gate/70660113\">published at kode24.no</a> - a site for Norwegian developers.\n\nPST themselves approved the walk-through:\n<blockquote class=\"twitter-tweet\" data-lang=\"en\" data-dnt=\"true\"><p lang=\"en\" dir=\"ltr\">The solution to PSTs shark riddle advert perfectly explained by <a href=\"https://twitter.com/roysolberg?ref_src=twsrc%5Etfw\">@roysolberg</a> <a href=\"https://t.co/Fsejj3NWgi\">https://t.co/Fsejj3NWgi</a> <a href=\"https://twitter.com/LeoDiCaprio?ref_src=twsrc%5Etfw\">@LeoDiCaprio</a> <a href=\"https://twitter.com/hashtag/hungryshark?src=hash&amp;ref_src=twsrc%5Etfw\">#hungryshark</a> <a href=\"https://t.co/1qNImmhQms\">pic.twitter.com/1qNImmhQms</a></p>&mdash; PST (@PSTnorge) <a href=\"https://twitter.com/PSTnorge/status/1085138559722536960?ref_src=twsrc%5Etfw\">January 15, 2019</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\nTo my surprise and amusement, screenshots from that <a href=\"https://kode24.no\">kode24.no</a> post was shown for some seconds on a show on the Norwegian TV channel <a href=\"https://en.wikipedia.org/wiki/NRK\">NRK</a>:\n<blockquote class=\"twitter-tweet\" data-lang=\"en\" data-dnt=\"true\"><p lang=\"en\" dir=\"ltr\">Things I did not expect: Seeing my own JavaScript code live on the TV channel <a href=\"https://twitter.com/NRKno?ref_src=twsrc%5Etfw\">@NRKno</a> a Saturday night. Achievement unlocked. 😂 CC: <a href=\"https://twitter.com/kode24no?ref_src=twsrc%5Etfw\">@kode24no</a> <a href=\"https://twitter.com/PSTnorge?ref_src=twsrc%5Etfw\">@PSTnorge</a> <a href=\"https://t.co/FIN0afWgYW\">pic.twitter.com/FIN0afWgYW</a></p>&mdash; Roy Solberg (@roysolberg) <a href=\"https://twitter.com/roysolberg/status/1091807598951706624?ref_src=twsrc%5Etfw\">February 2, 2019</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\nNow, I didn't expect to do another one of these walk-throughs this soon, but all of the sudden the interesting Twitter handle <a href=\"https://twitter.com/twitt3rhai\"><code>twitt3rhai</code></a> (=Twitter shark) tweeted what might appear as random characters. <code>Twitt3rhai</code> was part of <a href=\"/2019/01/pst-challenge\">the challenge in December</a>. Of course I had to try to figure what the tweet was all about..\n\nLuckily this turned out to be less of a challenge than the previous one.\n\n<h4>The job ad</h4>It all starts with PST's <a href=\"https://1005007.webcruiter.no/Main/Recruit/Public/4134047982\">job ad where they want both digital forensics specialists and a system developer</a>. The text in the job advertisement doesn't hint about any challenges as I could see, but there is an interesting header image:\n<img class=\"materialboxed responsive-img\" title=\"The header image from the job ad containing the challenge. (Source: webcruiter.no)\" data-caption=\"The header image from the job ad containing the challenge. (Source: webcruiter.no)\" alt=\"Screenshot with challenge\" src=\"/images/pst201.jpg\">\nIt's got all the nerdy details you'd want: A <a href=\"https://en.wikipedia.org/wiki/pcap\">pcap</a> (packet capture) hat, lotsa computer screens, some file dump or something, some code, and more.\n\n<h4>Step 1 - understanding the code</h4>While the image doesn't have the world's highest resolution you can see that the person in the image (possibly nicknamed <i><a href=\"https://knowyourmeme.com/memes/hackerman\">HackerMan</a></i>) has got the following <a href=\"https://en.wikipedia.org/wiki/Python_(programming_language)\">Python</a> 3 code file named <code>encrypt.py</code> open:\n<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nfrom base64 import b64encode\nfrom Crypto.Cipher import AES\nfrom Crypto.Util.Padding import pad, unpad\n\ndef get_primes(count):\n    primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61]\n    return(primes[0:count])\n\nwith open('plain.txt', 'rb') as f:\n    plaintext = f.read()\n\niv = \"\"\nfor i in get_primes(16):\n    iv += chr(plaintext[i + 16])\n\nkey = b'\\xba\\xda\\x55 HackerMan \\x13\\x37'  # <----- DESTROY AFTER USE\n\ncipher = AES.new(key, AES.MODE_CBC, IV=iv)\nciphertext_b64 = b64encode(cipher.encrypt(pad(plaintext, AES.block_size))).decode('utf-8')\nprint(ciphertext_b64)\n\n#TODO: automate posting of ciphertext to twitter.com/twitt3rhai</pre>\nNow, this is some interesting code. Let's follow the flow of it:\n1. It reads the contents of the file <code>plain.txt</code> (aka <a href=\"https://en.wikipedia.org/wiki/Plaintext\">unencrypted information</a>) into a variable <code>plaintext</code>.\n2. It creates a variable <code>iv</code> by using 16 characters from <code>plaintext</code> offset by 16 + a <a href=\"https://en.wikipedia.org/wiki/Prime_number\">prime number</a>.\n3. It defines a variable <code>key</code> (nerd bonus for using the hex numbers <a href=\"https://en.wiktionary.org/wiki/badass\">BA, DA, 55</a>, <a href=\"https://en.wikipedia.org/wiki/Leet\">13, 37</a>) which is indicated that should be deleted later on.\n4. It creates an <a href=\"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard\">AES</a> <a href=\"https://en.wikipedia.org/wiki/Cipher\">cipher</a> with <a href=\"https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_Block_Chaining_(CBC)\">CBC</a> mode using the <code>key</code> variable as key and the <code>iv</code> variable as <a href=\"https://en.wikipedia.org/wiki/Initialization_vector\">initialization vector</a>.\n5. The cipher is then used to encrypt the <a href=\"https://en.wikipedia.org/wiki/Padding_(cryptography)\">padded</a> plaintext before the <a href=\"https://en.wikipedia.org/wiki/Ciphertext\">ciphertext</a> is <a href=\"https://en.wikipedia.org/wiki/Base64\">Base64</a> encoded.\n6. Notingly there is a <a href=\"https://en.wikipedia.org/wiki/Time_management#Implementation_of_goals\">TODO</a> about posting the ciphertext to <a href=\"https://twitter.com/twitt3rhai\"><code>twitt3rhai</code></a>. (And what do you know, the same Twitter handle is also in that header image.)\n\n<h4>Step 2 - getting the ciphertext</h4>Our ultimate goal seems to be to get the plaintext to see what it says. So lets start by heading over to Twitter:\n<blockquote class=\"twitter-tweet\" data-dnt=\"true\"><p lang=\"pl\" dir=\"ltr\">/lb0WZDpaIDJVJwy+Q04LCqERqVj7AUItWGREJuXJeWtZN77yP6grehn1gRif31hjTEjLNFyxESweea81/QluWUyhZV9vmabm8NYkkSc6JJWuylGJKQJzA/wC2cM2ScrQQ8gV7GcnVyBCh7eq/N0jUm/L4xrX6IUIDi5CAkVZ9xSS5Tb4o01onOTbGWLd1EZwzZOMlq88wsTPZ6zY7dqj+LKq3Pj6SKlZfaR9eo6PXrRUOARCe9sQVtWVKc5DJfI</p>&mdash; twitt3rhai (@twitt3rhai) <a href=\"https://twitter.com/twitt3rhai/status/1175023446696386560?ref_src=twsrc%5Etfw\">September 20, 2019</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\nThis does indeed seem like it could be some Base64 encoded text and can be assumed to be the ciphertext. Now we've got quite a few pieces of the puzzle.\n\n<h4>Step 3 - decrypting the ciphertext</h4>So, how can we decrypt the ciphertext in the tweet? Let's just tweak the <code>encrypt.py</code> to make our own <code>decrypt.py</code>:\n<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nfrom base64 import b64encode, b64decode\nfrom Crypto.Cipher import AES\nfrom Crypto.Util.Padding import pad, unpad\n\ndef get_primes(count):\n    primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61]\n    return(primes[0:count])\n\n# TODO: automate reading of ciphertext from twitter.com/twitt3rhai ;)\nciphertext_b64 = '/lb0WZDpaIDJVJwy+Q04LCqERqVj7AUItWGREJuXJeWtZN77yP6grehn1gRif31hjTEjLNFyxESweea81/QluWUyhZV9vmabm8NYkkSc6JJWuylGJKQJzA/wC2cM2ScrQQ8gV7GcnVyBCh7eq/N0jUm/L4xrX6IUIDi5CAkVZ9xSS5Tb4o01onOTbGWLd1EZwzZOMlq88wsTPZ6zY7dqj+LKq3Pj6SKlZfaR9eo6PXrRUOARCe9sQVtWVKc5DJfI'\nciphertext = b64decode(ciphertext_b64.encode('utf-8'))\n\niv = \" \" * 16  # Must be 16 bytes\n\nkey = b'\\xba\\xda\\x55 HackerMan \\x13\\x37'\n\ncipher = AES.new(key, AES.MODE_CBC, IV=bytes(iv, 'utf-8'))\nplaintext = unpad(cipher.decrypt(ciphertext), AES.block_size)\n\nprint(plaintext)  # Output: b'\\x15\\x01Tx)5,d%,*<&:u%erer! Du klarte det! Beklager, men denne gangen har vi ikke laget flere oppgaver. H\\xc3\\xa5per du vil s\\xc3\\xb8ke jobben. Hvis du blir ansatt kan vi love deg mange utfordrende oppgaver.'</pre>\nHere's what the script does:\n1. Decodes the Base64 encoded cipertext.\n2. Creates just an empty initialization vector as we don't have the plaintext to create it.\n3. Decrypts the ciphertext and unpads the output again.\n4. Prints the plaintext.\n\nThe output is the following:<blockquote><code>b'\\x15\\x01Tx)5,d%,*<&:u%erer! Du klarte det! Beklager, men denne gangen har vi ikke laget flere oppgaver. H\\xc3\\xa5per du vil s\\xc3\\xb8ke jobben. Hvis du blir ansatt kan vi love deg mange utfordrende oppgaver.'</code></blockquote>\nSuccess, right? Well, almost!\n\n<h5>Creating the initialization vector</h5>When I did the challenge I was at first happy with getting most of the plaintext. And I was thinking that the first part missing probably was the start of the word <i>\"Gratulerer\"</i> (=congratulations).\n\nBut what is an \"initialization vector\" and why is it used here? AES (Advanced Encryption Standard) is a <a href=\"https://en.wikipedia.org/wiki/Block_cipher\">block cipher</a>, meaning that the algorithm is operating on a fixed-length groups of bits (blocks). To avoid equal plaintext blocks to become equal ciphertext blocks many of the \"modes of operation\" of the encryption algrithms use some part of the previous block part of the input to the following one. The mode used here is <a href=\"https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#CBC\">Cipher Block Chaining (CBC)</a>. In this mode each block of plaintext is <a href=\"https://en.wikipedia.org/wiki/Exclusive_or\">XORed</a> with the previous ciphertext block before being encrypted. To produce distinct ciphertexts even if the same plaintext is encrypted multiple times - and to protect the first block - there must be some be some unique input to the first block; an initialization vector.\n\nLooking at the output there are actually 16 bytes that are \"garbage\" (the AES' block size). That means that the first word can't just be <i>\"Gratulerer\"</i>.\n\nBut how can we get hold of that initialization vector? The answer lies in the code. It is generated from the plaintext - and luckily for us it only uses plaintext above character number 16, meaning that we have everyhting we need. So let's tweak the script:\n<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nfrom base64 import b64encode, b64decode\nfrom Crypto.Cipher import AES\nfrom Crypto.Util.Padding import pad, unpad\n\ndef get_primes(count):\n    primes = [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61]\n    return(primes[0:count])\n\n# TODO: automate reading of ciphertext from twitter.com/twitt3rhai ;)\nciphertext_b64 = '/lb0WZDpaIDJVJwy+Q04LCqERqVj7AUItWGREJuXJeWtZN77yP6grehn1gRif31hjTEjLNFyxESweea81/QluWUyhZV9vmabm8NYkkSc6JJWuylGJKQJzA/wC2cM2ScrQQ8gV7GcnVyBCh7eq/N0jUm/L4xrX6IUIDi5CAkVZ9xSS5Tb4o01onOTbGWLd1EZwzZOMlq88wsTPZ6zY7dqj+LKq3Pj6SKlZfaR9eo6PXrRUOARCe9sQVtWVKc5DJfI'\nciphertext = b64decode(ciphertext_b64.encode('utf-8'))\n\niv = \" \" * 16  # Must be 16 bytes\n\nkey = b'\\xba\\xda\\x55 HackerMan \\x13\\x37'\n\ncipher = AES.new(key, AES.MODE_CBC, IV=bytes(iv, 'utf-8'))\nplaintext = unpad(cipher.decrypt(ciphertext), AES.block_size)\n\niv = \"\"\nfor i in get_primes(16):\n    iv += chr(plaintext[i + 16])\n\ncipher = AES.new(key, AES.MODE_CBC, IV=bytes(iv, 'utf-8'))\nplaintext = unpad(cipher.decrypt(ciphertext), AES.block_size).decode('utf-8')\n\nprint(iv)  # Output: er uate!k,mngn i\nprint(plaintext)  # Output: PST-haien gratulerer! Du klarte det! Beklager, men denne gangen har vi ikke laget flere oppgaver. Håper du vil søke jobben. Hvis du blir ansatt kan vi love deg mange utfordrende oppgaver.</pre>\nThe script now does the decryption in two rounds; first without knowing the init vector, and then again with it correctly initialized.\n\nSuccess!\n\n<h4>The solution</h4>The solution to the challenge is this:<blockquote>PST-haien gratulerer! Du klarte det! Beklager, men denne gangen har vi ikke laget flere oppgaver. Håper du vil søke jobben. Hvis du blir ansatt kan vi love deg mange utfordrende oppgaver.</blockquote>\nEnglish:<blockquote>The PST shark congratulates you! You made it! Sorry, but this time we haven't created any more challenges. Hope you will apply for the job. If you get hired we can promise you many challenging assignments.</blockquote>\nSo that's it. Not as much work to do as <a href=\"/2019/01/pst-challenge\">the previous challenge</a>, but still a fun challenge I personally enjoyed a lot. 🙂 I hope PST got the candidates they need. 🕵️‍\n                ",
        "images": [
            "/images/pst202.png",
            "/images/pst201.jpg"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Behind the news",
                "url": "/behind-the-news"
            },
            {
                "title": "Challenge",
                "url": "/challenge"
            }
        ]
    },
    {
        "title": "Capture the flag with the Norwegian Police Security Service",
        "published": true,
        "publishDate": "2020-01-02T15:10:00.000Z",
        "updateDate": "2020-01-02T16:45:00.000Z",
        "summary": "Here's a write-up showing how to solve the challenges of the Norwegian Police Security Service's CTF advent calendar.",
        "niceUrl": "/2020/01/pst-challenge-3",
        "text": "\n<h4>Background 👮</h4>The <a href=\"https://en.wikipedia.org/wiki/Norwegian_Police_Security_Service\">Norwegian Police Security Service</a> (with the Norwegian abbreviation <a href=\"https://www.pst.no/\">PST</a> which I'll use for this write-up) is the police <a href=\"https://en.wikipedia.org/wiki/Security_agency\">security agency</a> of Norway. Once in a while they have job ads with some more or less hidden challenges - almost <a href=\"https://en.wikipedia.org/wiki/Capture_the_flag#Computer_security\">Capture the Flag (CTF)</a> style. I've done posts on them back <a href=\"/2019/01/pst-challenge\">in January</a> and <a href=\"/2019/01/pst-challenge-2\">in October</a> 2019. This time they went all in with a CTF advent calendar.\n\n<h4>The theme 🎅</h4>PST added an N in front of their name and created the imaginary <i>Northern Polar Security Service</i> (Nordpolar sikkerhetstjeneste = NPST). NPST's role is supposedly to protect Santa Claus, his elfs and Christmas itself. PST posted a <a href=\"https://finn.no/163738125\">fake job ad</a> where they said to be looking for elf officers (=\"alvebetjent\") for a temporary position to help out NPST. Of course big and small media sites took notice and published stories on this (<a href=\"https://www.nrk.no/troms/pst-la-ut-annonse-pa-finn.no-om-ledig-jobb-som-snikende-alvebetjent-1.14794574\">NRK</a>, <a href=\"https://www.tv2.no/a/11017666/\">TV 2</a>, <a href=\"https://www.vg.no/nyheter/innenriks/i/JowQQb/pst-soeker-snikende-alvebetjent-paa-svalbard\">VG</a>, <a href=\"https://www.politiforum.no/artikler/pst-med-ny-kreativ-stillingsannonse-soker-snikende-alvebetjent-br/479744\">Politiforum</a>). Everything went down on <a href=\"https://npst.no/\">npst.no</a> from December 1st to December 24th.\n\n<h4>Challenges and solutions</h4>Let's jump straight in. Click on a challenge to expand it.\n<a class=\"skip-link\" href=\"#\" aria-hidden=\"true\" onclick=\"var c=$('.collapsible');var shouldOpen=c.children('.active').length === 0;for(var i=0;i<c.children().length;i++){c.collapsible(shouldOpen ? 'open' : 'close', i);}return false;\"><u>Expand/collapse all</u></a><ul class=\"collapsible expandable\" data-collapsible=\"expandable\"><li><div class=\"collapsible-header\">December 1st - Welcome to NPST - 10 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The first challenge was not much of a challenge. It just lets you get started by telling you to log in at the system running at <a href=\"https://login.npst.no\">https://login.npst.no</a> using username <code>bruker</code> and password <code>Advent2019</code>.\n\n<h6>Solution</h6>There was not much to do here other than entering the login information. The flag you'd get back was <code>PST{a7966bf58e23583c9a5a4059383ff850}</code>. I'd script it, but it would mostly have been about extracting the returned token with the step information and posting it back. Fun fact: <code>a7966bf58e23583c9a5a4059383ff850</code> is the <a href=\"https://en.wikipedia.org/wiki/MD5\">MD5</a> hash of <code><a href=\"https://en.wikipedia.org/wiki/%22Hello,_World!%22_program\">Hello, world</a></code>.</span>\n</div></li><li><div class=\"collapsible-header\">December 1st - Change password - 15 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The first real challenge is to change the password from the previous task. The new password needs to have at least one character from each of the following groups:\n - <code>[a-z]</code>\n - <code>[A-Z]</code>\n - <code>[0-9]</code>\n - <code>[*@!#%&()^~{}]</code>\nThe characters must be sorted by its ASCII values, and the sum of ASCII values <a href=\"https://en.wikipedia.org/wiki/Modular_arithmetic\">modulo</a> 128 must equal 24.\n\n<h6>Solution</h6>If you take a look at the <a href=\"https://en.wikipedia.org/wiki/ASCII#Character_set\">ASCII table</a> you'll notice that the character groups themselves are not in incremental order and the last group's characters are not in order and also actually split into values before and after the other groups.\n\nTo generate a valid password you could do something like this: <pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport string\n\n# The char groups we have to use:\ngroup1 = string.ascii_lowercase\ngroup2 = string.ascii_uppercase\ngroup3 = string.digits\ngroup4 = '*@!#%&()^~{}'\n\nfor a1 in group1:\n    for a2 in group2:\n        for a3 in group3:\n            for a4 in group4:\n                sum = ord(a1) + ord(a2) + ord(a3) + ord(a4) # Sum of integer values of code points\n                if sum % 128 == 24:\n                    password = a1 + a2 + a3 + a4\n                    password = ''.join(sorted(password)) # Sorts the string\n                    print(password) # Prints '6@Aa'\n                    exit(0)\n</pre>\nOne of the valid passwords is <code>6@Aa</code>. The flag returned was <code>PST{6a0f0731d84afa4082031e3a72354991}</code> (MD5 hash of <code><a href=\"https://knowyourmeme.com/memes/hunter2\">hunter2</a></code>).\n</span></div></li><li><div class=\"collapsible-header\">December 1st - Password recovery - 20 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge is to log in at <a href=\"https://login.npst.no\">https://login.npst.no</a> with a user we have this information about:\nUsername: <code>admin</code>\n???: <code>42f82ae6e57626768c5f525f03085decfdc5c6fe</code>\n\n<h6>Solution</h6>The unknown part above looks a lot like output from a <a href=\"https://en.wikipedia.org/wiki/Hash_function\">hash function</a>. What kind of cryptographic hash function produces 40 hex characters (20 bytes) output? The good old no-longer-considerd-secure <a href=\"https://en.wikipedia.org/wiki/SHA-1\">SHA-1</a>. You could find this hash value's input from a <a href=\"https://en.wikipedia.org/wiki/Rainbow_table\">rainbow table</a> or a tool like <a href=\"https://en.wikipedia.org/wiki/Hashcat\">hashcat</a>. Luckily we don't face any <a href=\"https://en.wikipedia.org/wiki/Salt_(cryptography)\">salt</a> in this case.\n\nSince the password is on a system where we know the current password rules we can take advantage of that and try <a href=\"https://en.wikipedia.org/wiki/Brute-force_attack\">brute force</a> to find the password. If we are luky the password is as short as the one in the previous challenge and we can tweak the script we just used: <pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport string\nfrom hashlib import sha1\nfrom time import time\n\n# The char groups we have to use:\ngroup1 = string.ascii_lowercase\ngroup2 = string.ascii_uppercase\ngroup3 = string.digits\ngroup4 = '*@!#%&()^~{}'\n\nhash_to_find = '42f82ae6e57626768c5f525f03085decfdc5c6fe'\n\ncounter = 0\ntime_start = time()\nfor a1 in group1:\n    for a2 in group2:\n        for a3 in group3:\n            for a4 in group4:\n                sum = ord(a1) + ord(a2) + ord(a3) + ord(a4)\n                if sum % 128 == 24:\n                    counter += 1\n                    password = (a1 + a2 + a3 + a4)\n                    password = ''.join(sorted(password))\n                    hash = sha1(password.encode('utf-8')).hexdigest()\n                    if(hash == hash_to_find):\n                        time_spent = round(1000 * (time() - time_start))\n                        # Prints something like 'Found password )9Fp in 42 millis after 856 trials.':\n                        print('Found password %s in %s millis after %d trials.' % (password, time_spent, counter))\n                        exit(0)\n</pre>\nThe password for the admin account is <code>)9Fp</code>. The flag returned was <code>PST{36044221cd3e991ffc56eb2f1e368ca0}</code> (MD5 hash of <code>CastleKeys</code> (<a href=\"https://www.mariowiki.com/Castle_Key\">Mario reference?</a>)).\n</span></div></li><li><div class=\"collapsible-header\">December 3rd - Pen and paper encryption - 0 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge is to crack the code <code>KNO fmwggkymyioån 30å6ø8432æå54710a9æ09a305å7z9829 fmwggkymyioån ngpoo</code>.\n\n<h6>Solution</h6>This is a 0 points challenge saying that the encryption is meant for pen and paper and there's no entering of data at <code>login.npst.no</code>. This means that we should get the flag directly and that it should be a fairly simple task.\n\nKnowing that the flag should usually start with <code>PST</code> and the <a href=\"https://en.wikipedia.org/wiki/Ciphertext\">ciphertext</a> starts with <code>KNO</code> it's easy to see that this is a some <a href=\"https://en.wikipedia.org/wiki/Substitution_cipher\">substitution cipher</a> variant of <a href=\"https://en.wikipedia.org/wiki/Caesar_cipher\">Caesar cipher</a>. What's interesting is the usage of Norwegian letters and repeated letters.\n\nAgain we can solve this easily using an online tool, but it's much more fun to use code: <pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport string\n\nlowercase_alphabet = string.ascii_lowercase + 'æøå'  # Norwegian alphabet\nciphertext = 'KNO fmwggkymyioån 30å6ø8432æå54710a9æ09a305å7z9829 fmwggkymyioån ngpoo'\nshift = ord('P') - ord('K')  # ASCII shift between K and P as we assume KNO=PST\nplaintext = ''\n\nfor c in ciphertext:\n    index = lowercase_alphabet.find(c.lower())\n    if index != -1:\n        isupper = c.isupper()\n        c = lowercase_alphabet[(shift + index) % len(lowercase_alphabet)]\n        if isupper:\n            c = c.upper()\n    plaintext += c\n\nplaintext = plaintext.replace('krøllparantes slutt', '}').replace('krøllparantes', '{').replace(' ', '')\nprint(plaintext)  # Prints 'PST{30e6d8432ce54710f9c09f305e7b9829}'\n</pre>\nThe flag printed is <code>PST{30e6d8432ce54710f9c09f305e7b9829}</code> (MD5 hash of <code>Julius</code> (as in Caesar)).\n</span></div></li><li><div class=\"collapsible-header\">December 5th - Emoji API - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge is to send commands to a crazy emoji API to get out the flag. The available emojis/commands are <code>✨, ⚡, 🔑, 🤷</code> and you can send in a combination of those.\n\n<h6>Solution</h6>This one annoyed me quite a bit, because I never fully understood the pattern here or what the rules are. But here's what I did figure out:\n🤷 = Lists out available commands. Not intended to be used in combination with other commands.\n🔑 = Should be used at the end of commands. Makes the <code>message</code> field return the current active <code>state</code>.\n⚡✨ = These two are the main switches/commands that determines the <code>state</code>.\n\nThis is how I interpret the JSON fields returned from the API:\n<code>error</code> = <code>boolean</code> telling if there's an error (like if you send more than 20 emojis or several 🔑 emojis).\n<code>state</code> = <code>String</code> list with some kind of selector telling the current state. I have no idea why the order changes. The emojis used are 🐴, 🚩, 🍉, 🐟, 🚀 and 🍕.\n<code>message</code> = <code>String</code> with extra info. Returns the current state.\n\nOur goal is to make the active <code>state</code> be the flag (🚩). Then the <code>message</code> will be the flag (as in <code>PST{...}</code>).\n\nI didn't find any other sensible way to do this other than brute forcing the commands. What I didn't look at was if e.g. the API really does some kind of bitwise operation or something on the emojis. There are several combinations of ⚡ and ✨ that returns the flag.\n\nHere's some code that can be used to get the flag. Remember to always be careful not flooding the server with requests when doing this sort of thing.<pre class=\"prettyprint lang-py\">import requests\nimport itertools\nimport re\nimport time\n\nli = ['✨', '⚡']\npattern = re.compile(\"PST{.*}\") # Regex for our flag\nfor i in range(1, 20):\n    combs = [''.join(comb) for comb in itertools.product(li, repeat=i)]  # Gives us all combinations of the emojis\n    for command in combs:\n        response = requests.get('https://npst.no/api/🙃.js?commands=' + command + '🔑')\n        json = response.json()\n        print(command + ': ' + str(json)) # Prints out stuff like ⚡⚡⚡⚡✨: {'error': False, 'state': '[🐟, 🚀, 🍉, 🐴, >🚩<, 🍕]', 'message': 'PST{ba323c3f5b3f1b536461d41cc7f1ba60}'}\n        if pattern.match(json['message']):\n            exit(0)\n        time.sleep(.300)\n</pre>\nIt seems like every combination of 4 ⚡ and that the command ends with ⚡✨ gives out the flag. Anyways, the flag printed is <code>PST{ba323c3f5b3f1b536461d41cc7f1ba60}</code> (MD5 hash of <code>emoji</code>).\n</span></div></li><li><div class=\"collapsible-header\">December 6th - Pen and paper encryption version 2 - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>We're back for another round of Caesar cipher, but this time it's worth 5 and not 0 points, and there are strong hints that <a href=\"https://en.wikipedia.org/wiki/Leet\">leetspeak</a> is involved.\n\nThe challenge is to crack the \"version 2\" of the pen an paper encryption, represented by the ciphertext <code>KNO fmw55k8m7i179 z98øyåz8æy67aåy0å6æ7aø1å1438åa5a fmw55k8m7i179 95p11</code>.\n\n<h6>Solution</h6>Here we have the to keep in mind that we have already solved a similar challenge. Again we know that the flag usually starts with <code>PST</code> and the <a href=\"https://en.wikipedia.org/wiki/Ciphertext\">ciphertext</a> starts with <code>KNO</code>. It should be also be some <a href=\"https://en.wikipedia.org/wiki/Substitution_cipher\">substitution cipher</a> variant of <a href=\"https://en.wikipedia.org/wiki/Caesar_cipher\">Caesar cipher</a>. Again there is the usage of Norwegian letters and repeated letters.\n\n(It's worth mentioning that for this challenge there was a time frame of maybe 18 hours where the cipertext was slightly incorrect, and also that they misspelt the word <i>parentes</i> (=parenthesis) in the previous Caesar cipher challenge's ciphertext.)\n\nWhat's new in this challenge is that what earlier became the output <code>krøllparentes</code> (=curly bracket) and <code>krøllparentes slutt</code> (=curly bracket end) now contains some numbers: <code>fmw55k8m7i179 95p11</code> vs <code>fmwggkymyioån ngpoo</code>. If we mix both letters and numbers in the alphabet things don't add up. So it's best to split it into two rounds of decryption.\n\nFor me it was a good help to use <a href=\"https://cryptii.com/pipes/caesar-cipher\">Caesar cipher tool at Cryptii</a>. It makes things so visual and easier to grasp and to play around with the encryption.\n\nWe can reuse the code we had earlier to get the flag for this one: <pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport string\n\nlowercase_alphabet = string.ascii_lowercase + 'æøå'  # Norwegian alphabet\nciphertext = 'KNO fmw55k8m7i179 z98øyåz8æy67aåy0å6æ7aø1å1038åa5a fmw55k8m7i179 95p11'\nshift = ord('P') - ord('K')  # ASCII shift between K and P as we assume KNO=PST\nciphertext2 = ''\n\nfor c in ciphertext:\n    index = lowercase_alphabet.find(c.lower())\n    if index != -1:\n        isupper = c.isupper()\n        c = lowercase_alphabet[(shift + index) % len(lowercase_alphabet)]\n        if isupper:\n            c = c.upper()\n    ciphertext2 += c\nprint(ciphertext2)  # Prints 'PST krø55p8r7n179 b98daeb8ca67fea0e6c7fd1e1038ef5f krø55p8r7n179 95u11'\n\ndigits = string.digits  # It's time for a round of digits\nshift = ord('1') - ord('5')  # ASCII shift between 5 and 1 as we assume krø55p8r7n179 = leet krø11p4r3n735\nplaintext = ''\n\nfor c in ciphertext2:\n    index = digits.find(c.lower())\n    if index != -1:\n        isupper = c.isupper()\n        c = digits[(shift + index) % len(digits)]\n        if isupper:\n            c = c.upper()\n    plaintext += c\nprint(plaintext)  # Prints 'PST krø11p4r3n735 b54daeb4ca23fea6e2c3fd7e7694ef1f krø11p4r3n735 51u77'\n\nplaintext = plaintext.replace('krø11p4r3n735 51u77', '}').replace('krø11p4r3n735', '{').replace(' ', '')\nprint(plaintext)  # Prints 'PST{b54daeb4ca23fea6e2c3fd7e7694ef1f}'\n</pre>\nThe flag printed is <code>PST{b54daeb4ca23fea6e2c3fd7e7094ef1f}</code> (MD5 hash of <code>jul1u5</code> (as in Julius (Caesar))).\n</span></div></li><li><div class=\"collapsible-header\">December 7th - Santa's workshop - 2 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>Santa's workshop has become digital - represented by the webpage <a href=\"https://verksted.npst.no\">https://verksted.npst.no</a>. The goal here is to spot the flag among many, many images. Every image has it's own MD5 hash filename which is the flag, so we just need to find the right image.\n\n<h6>Solution</h6>This challenge can be solved by scrolling through 12,202 images and spotting the image of the flag. Of course, it's more fun to make the computer do the job for us. There's a <a href=\"https://verksted.npst.no/verksted.npst.no.2c3ecc69.js\">JavaScript file with an array of all the image filenames</a>. Many images - even though they have different filenames - are of the same item. And luckily they have the same <a href=\"https://en.wikipedia.org/wiki/Checksum\">file checksum</a>.\n\nKnowing that we can easily just run this script to get the flag: <pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport requests\nimport os\nfrom time import sleep\nimport hashlib\n\nprefix = 'https://verksted.npst.no/images/'\npostfix = '.png'\nimages = [\n    \"ad4702626c8a8ce8386a2f59d9b45f0e\",\n    \"3f6cfe9ad6220c32868d931d70f0cd7d\",\n    \"88fd8baf0e91d6d109ea6559e684ff43\",\n    \"09fa082d154fbcc8132d9758d625a6b1\",\n    # ...\n    # The array has been shortened a bit as it originally contains 12,202 images\n    # ...\n    \"b30b4add25b97721ebf0e7ad2eb26eb9\",\n    \"e5b5c486f20f06798a94a6b16aef5f2f\",\n    \"8798e1f0a271b09750a6531686fc621b\",\n    \"7254408c81470abdbabd40e850b5274d\"\n]\n\n\ndef get_hash(url):\n    ''' Requests URL and returns MD5 hash of data downloaded. '''\n    m = hashlib.md5()\n    try:\n        r = requests.get(url)\n    except Exception as e:\n        # It's handy to just swallow the error here so we can just retry the URL manually instead of stopping the script in case of temp. network issues.\n        print('Unexpected error while trying to load image %s. Returning empty hash. Error: %s' % (url, e))\n        return ''\n    for data in r.iter_content(8192):\n        m.update(data)\n    return m.hexdigest()\n\n\nhashes = {}\n\nfor image in images:\n    url = prefix + image + postfix\n    hash = get_hash(url)\n    if hash not in hashes:\n        # Prints something like 'Found new checksum 4aacc09b8f52fd1b6f2bfbe18d4f17b6 for url https://verksted.npst.no/images/b30b4add25b97721ebf0e7ad2eb26eb9.png':\n        print('Found new checksum %s for url %s' % (hash, url)) \n        # Not necessary, but nice to keep an eye on while the script is running:\n        os.system('open ' + url)  # Opens the image (command will differ depending on OS)\n        flag = 'PST{%s}' % image\n        hashes[hash] = {\n            'url': url,\n            'flag': flag,\n            'seen': 1\n        }\n    else:\n        hashes[hash]['seen'] = hashes[hash]['seen'] + 1\n    sleep(0.3)\n\n# Prints something like 'Found 63 different checksums among 12202 images.':\nprint('Found %d different checksums among %d images.' % (len(hashes), len(images)))\nprint('Following images were only seen once:')\nfor hash in hashes:\n    if hashes[hash]['seen'] == 1:\n        # Prints something like 'PST{8798e1f0a271b09750a6531686fc621b} - https://verksted.npst.no/images/8798e1f0a271b09750a6531686fc621b.png'\n        print('%s - %s' % (hashes[hash]['flag'], hashes[hash]['url']))\n</pre>\nThe flag that has been <code>PST{8798e1f0a271b09750a6531686fc621b}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 7th - Industrial espionage - 2 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The only info we get for this challenge is that there's suspicion of ongoing espionage in Santa's workshop that we should take a look at.\n\n<h6>Solution</h6>Again we're looking at the images at <a href=\"https://verksted.npst.no\">https://verksted.npst.no</a>. Is there something that doesn't belong at the North Pole?\n\nWell, luckily for us - if we let the script in the previous solution finish - we already have the answer. It's the penguin that doesn't belong. The flag for that image is <code>PST{b30b4add25b97721ebf0e7ad2eb26eb9}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 8th - Polar bear sighting - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>We're told that <a href=\"https://en.wikipedia.org/wiki/Rudolph_the_Red-Nosed_Reindeer\">Rudolph the Red-Nosed Reindeer</a> observed a suspicious polar bear when he took a detour while out jogging with Santa. The challenge is to report the location of this sighting.\n\n<h6>Solution</h6>The text doesn't leave much clue as to where to look, but the image above the text shows Santa's smart phone with the app <a href=\"https://strava.com\">Strava</a> open. Strava is a social fitness network, primarily used to track cycling and running exercises. It doesn't take long to find both <a href=\"https://www.strava.com/athletes/48179976\">Santa's profile</a> and <a href=\"https://www.strava.com/athletes/48180031\">Rudolph's profile</a>.\n\nThey have been out running and it's possible to do a <a href=\"https://labs.strava.com/flyby/viewer/#2910407508,nDN5rQ==\">\"flyby\" of their workout</a>. If you follow their track you can see that Rudolph did take a detour. And cross checking Strava's map with e.g. Google Maps you can see that the place he is closest by is the <a href=\"http://www.northpolemuseum.com/\">North Pole Expedition Museum</a> (and the museum actually has got a figure of a polar bear outside). That is also the flag and solution we need: <code>PST{NORTH POLE EXPEDITION MUSEUM}</code>\n</span></div></li><li><div class=\"collapsible-header\">December 8th - Spy activity - 15 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>There's information about possible spy activity from <a href=\"https://spst.no\">Southern Polar Security Service</a> (Sydpolar sikkerhetstjeneste = SPST) agents on Svalbard in same time period as Santa and Rudolph's run. The challenge is identify one of the agents.\n\n<h6>Solution</h6>Going back to the <a href=\"https://labs.strava.com/flyby/viewer/#2910407508,nDN5rQ==\">\"flyby\" of the workout</a> in the previous challenge you can see that there's another person in the area. Someone is out on a <a href=\"https://www.strava.com/activities/2910413144\">afternoon stalk</a>, and that person is someone named Pen Gwyn. <a href=\"https://www.strava.com/athletes/48201643\">His profile</a> is pretty open about his affiliation and it also shows the flag we're after: <code>PST{69d26031ea5dbbeb56f22d9647f7c98e}</code>\n</span></div></li><li><div class=\"collapsible-header\">December 8th - Mysterious profiles - 20 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>NPST's analysts suspect that Pen Gwyn has reported home to his contacts at the South Pole. The challenge is to decode some of that communication.\n\n<h6>Solution</h6>We're still on Pen Gwyn's Strava profile. He's got <a href=\"https://www.strava.com/activities/2910553320\">one activity that contains an image</a>. This image contains data that we want to decode. I looked long and hard at the bars as binary ASCII data and then <a href=\"https://en.wikipedia.org/wiki/Barcode#Types_of_barcodes\">all sorts of barcodes</a>, but this is actually <a href=\"https://en.wikipedia.org/wiki/Morse_code\">morse code</a>.\n\nWhile I did initially decode the image with pen and paper it's cooler to do so with code. It's a bit challenging because of the <a href=\"https://en.wikipedia.org/wiki/Compression_artifact\">compression artifcats</a> in the image, but at the same time, binary's strength is that it can handle quite a bit of noise:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nfrom PIL import Image  # pip3 install pillow\n\nMORSE_CODE = {'▄ ▄▄▄': 'A', '▄▄▄ ▄ ▄ ▄': 'B', '▄▄▄ ▄ ▄▄▄ ▄': 'C', '▄▄▄ ▄ ▄': 'D',\n              '▄': 'E', '▄ ▄ ▄▄▄ ▄': 'F', '▄▄▄ ▄▄▄ ▄': 'G', '▄ ▄ ▄ ▄': 'H',\n              '▄ ▄': 'I', '▄ ▄▄▄ ▄▄▄ ▄▄▄': 'J', '▄▄▄ ▄ ▄▄▄': 'K', '▄ ▄▄▄ ▄ ▄': 'L',\n              '▄▄▄ ▄▄▄': 'M', '▄▄▄ ▄': 'N', '▄▄▄ ▄▄▄ ▄▄▄': 'O', '▄ ▄▄▄ ▄▄▄ ▄': 'P',\n              '▄▄▄ ▄▄▄ ▄ ▄▄▄': 'Q', '▄ ▄▄▄ ▄': 'R', '▄ ▄ ▄': 'S', '▄▄▄': 'T',\n              '▄ ▄ ▄▄▄': 'U', '▄ ▄ ▄ ▄▄▄': 'V', '▄ ▄▄▄ ▄▄▄': 'W', '▄▄▄ ▄ ▄ ▄▄▄': 'X',\n              '▄▄▄ ▄ ▄▄▄ ▄▄▄': 'Y', '▄▄▄ ▄▄▄ ▄ ▄': 'Z', '▄ ▄▄▄ ▄▄▄ ▄▄▄ ▄▄▄': '1',\n              '▄ ▄ ▄▄▄ ▄▄▄ ▄▄▄': '2', '▄ ▄ ▄ ▄▄▄ ▄▄▄': '3', '▄ ▄ ▄ ▄ ▄▄▄': '4',\n              '▄ ▄ ▄ ▄ ▄': '5', '▄▄▄ ▄ ▄ ▄ ▄': '6', '▄▄▄ ▄▄▄ ▄ ▄ ▄': '7',\n              '▄▄▄ ▄▄▄ ▄▄▄ ▄ ▄': '8', '▄▄▄ ▄▄▄ ▄▄▄ ▄▄▄ ▄': '9', '▄▄▄ ▄▄▄ ▄▄▄ ▄▄▄ ▄▄▄': '0',\n              '▄▄▄ ▄▄▄ ▄ ▄ ▄▄▄ ▄▄▄, ': ',', '▄ ▄▄▄ ▄ ▄▄▄ ▄ ▄▄▄': '.',\n              '▄ ▄ ▄▄▄ ▄▄▄ ▄ ▄': '?', '▄▄▄ ▄ ▄ ▄▄▄ ▄': '/', '▄▄▄ ▄ ▄ ▄ ▄ ▄▄▄': '-',\n              '▄▄▄ ▄ ▄▄▄ ▄▄▄ ▄': '(', '▄▄▄ ▄ ▄▄▄ ▄▄▄ ▄ ▄▄▄': ')'}\n\nim = Image.open('report.jpg')\npix = im.load()\n\nbinary_string = ''\nfor i in range(0, im.size[0]):  # Runs through all pixels on top row\n    t = pix[i, 0]  # Colour tuple\n    if t[0] < 200 and t[1] < 200 and t[2] < 200:  # Relatively dark colour\n        binary_string += '1'\n    else:  # Relatively white colour\n        binary_string += '0'\nprint(binary_string, '\\n')\n\n\ndef replace(input, old, new, count_from, count_to):\n    for i in reversed(range(count_from, count_to + 1)):\n        input = input.replace(old * i, new)\n    return input\n\n\nmorse_string = binary_string\n\nmorse_string = replace(morse_string, '1', '▄▄▄', 5, 10)  # Replace wide bars with dash\nmorse_string = replace(morse_string, '1', '▄', 1, 4)  # Replace narrow bars with dot\nmorse_string = replace(morse_string, '0', '       ', 15, 30)  # Replace very wide whitespaces with word separator\nmorse_string = replace(morse_string, '0', '   ', 5, 15)  # Replace medium wide whitespaces with letter separator\nmorse_string = replace(morse_string, '0', ' ', 1, 4)  # Replace narrow whitespaces with in-letter separator\n\nprint(morse_string, '\\n')\n\nplaintext = ''\nfor morse_word in morse_string.split('       '):\n    for morse_letter in morse_word.split('   '):\n        try:\n            plaintext += MORSE_CODE[morse_letter.strip()]  # Stripping in case of leading or trailing spaces\n        except KeyError:\n            print('Unknown morse code [%s]' % morse_letter)\n    plaintext += ' '\n\nprint(plaintext, '\\n')\n\nplaintext = plaintext.replace('KROLLPARENTES SLUTT', '}').replace('KROLLPARENTES', '{').replace(' ', '')\n\nprint(plaintext, '\\n')  # Prints PST{E06531D19FF020A479520EF28C8D1E2C}\n</pre>\nThe flag printed is <code>PST{E06531D19FF020A479520EF28C8D1E2C}</code> (MD5 hash of <code>christmasrun</code>).\n</span></div></li><li><div class=\"collapsible-header\">December 10th - Vige vs. Nere - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>There's a polar chess championship going on at the North Pole. We're given the following <a href=\"https://en.wikipedia.org/wiki/Portable_Game_Notation\">PGN (Portable Game Notation)</a> for a chess game between two South Pole players called Vige and Nere:\n<pre class=\"prettyprint\">1. a3 e6 2. b3 Ke7 3. Ra2 d5 4. h3 h6 5. f4 Qd6 6. Nc3 Qa6 7. Nf3 g5 8. Nb1 b5\n9. d4 Qa5+ 10. Bd2 Kd6 11. g4 Bg7 12. Bc3 f5 13. Nh2 Ba6 14. Qd2 Bc8 15. Qc1 Qb6 16. Ba1 b4\n17. Nd2 Ke7 18. Ndf3 Nd7 19. axb4 Ngf6 20. gxf5 Ne5 21. Ng4 c5 22. Nh4 Qd6 23. Nf2 Ng8 24. Bg2 a5\n25. Ra4 Qd8 26. Be4 Qe8 27. Ra3 Kf7 28. b5 Qe7 29. O-O exf5 30. Nxf5 Ba6 31. Ng3 Qf6 32. Nd1 Ra7\n33. Kg2 Nc4 34. bxa6 Qb6 35. Nb2 Nxa3 36. Nh5 Qxb3 37. Nxg7 Nb5 38. Nd1 Qe3 39. Rh1 Qa3 40. Re1 Rc7\n41. Ne8 Kxe8 42. Qb1 Rhh7 43. dxc5 Rce7 44. Rg1 Re5 45. fxg5 Nf6 46. gxh6 Kf8 47. a7 Ng4 48. Kh1 Nc7\n49. Bxd5 Qb4 50. Kg2 Qa3 51. c6 Qc5 52. Qb8+ Re8 53. Be5 Ne6 54. Nc3 Rf7 55. Qxe8+ Kxe8 56. Bf4 Rf6\n57. Bg3 Kf7 58. Be1 1-0</pre>\nWe're also given the link to <a href=\"https://lichess.org/yDDc9bR0\">https://lichess.org/yDDc9bR0</a> where the same game is set up.\n\n<h6>Solution</h6>Because we got a square and the players were called Vige and Nere I was so sure this was just a step up from the Caesar cipher with a relatively simple <a href=\"https://en.wikipedia.org/wiki/Vigenère_cipher\">Vigenère cipher</a> challenge. That cost me a lot time.\n\n<a href=\"https://incoherency.co.uk/blog/stories/chess-steg.html\">Hiding messages in a chess game</a> is actually a thing. You can take a message and encode it into a valid chess game and get valid PGN out on the other end. As James Stanley says in that blog post he's got a  <a href=\"https://incoherency.co.uk/chess-steg/\">nice online tool for this</a>. Decoding the PGN actually gives a relatively meaningful output: <code>HHL DJDWEDESKWCLXK u02s104y2s665t5v3w2619v6184su50t CGGXDAHTJTFMWH KEMIL</code>\n\nThe output is pretty close to the format of the flags from previous challenges. And remembering the players' names, this is where the Vigenère cipher comes in. Knowing that we want the flag to start with <code>PST</code> it isn't very hard to crack the code.\n\nConveniently Jonas Enge has made a <a href=\"https://github.com/Alheimsins/chess-steg-cli\">command-line implementation</a> which we can use in combination with e.g. <a href=\"https://blog.npmjs.org/post/162869356040/introducing-npx-an-npm-package-runner\">npx</a> and a small Python script:\n<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport string\nimport subprocess\n\npgn = \"\"\"1. a3 e6 2. b3 Ke7 3. Ra2 d5 4. h3 h6 5. f4 Qd6 6. Nc3 Qa6 7. Nf3 g5 8. Nb1 b5 \\\n9. d4 Qa5+ 10. Bd2 Kd6 11. g4 Bg7 12. Bc3 f5 13. Nh2 Ba6 14. Qd2 Bc8 15. Qc1 Qb6 16. Ba1 b4 \\\n17. Nd2 Ke7 18. Ndf3 Nd7 19. axb4 Ngf6 20. gxf5 Ne5 21. Ng4 c5 22. Nh4 Qd6 23. Nf2 Ng8 24. Bg2 a5 \\\n25. Ra4 Qd8 26. Be4 Qe8 27. Ra3 Kf7 28. b5 Qe7 29. O-O exf5 30. Nxf5 Ba6 31. Ng3 Qf6 32. Nd1 Ra7 \\\n33. Kg2 Nc4 34. bxa6 Qb6 35. Nb2 Nxa3 36. Nh5 Qxb3 37. Nxg7 Nb5 38. Nd1 Qe3 39. Rh1 Qa3 40. Re1 Rc7 \\\n41. Ne8 Kxe8 42. Qb1 Rhh7 43. dxc5 Rce7 44. Rg1 Re5 45. fxg5 Nf6 46. gxh6 Kf8 47. a7 Ng4 48. Kh1 Nc7 \\\n49. Bxd5 Qb4 50. Kg2 Qa3 51. c6 Qc5 52. Qb8+ Re8 53. Be5 Ne6 54. Nc3 Rf7 55. Qxe8+ Kxe8 56. Bf4 Rf6 \\\n57. Bg3 Kf7 58. Be1 1-0\"\"\"\n\nciphertext = subprocess.check_output('npx --quiet chess-steg-cli --unsteg \"%s\"' % pgn, encoding='UTF-8', shell=True).strip()\n\nprint('Ciphertext:', ciphertext)  # Prints 'Ciphertext: HHL DJDWEDESKWCLXK u02s104y2s665t5v3w2619v6184su50t CGGXDAHTJTFMWH KEMIL'\n\nsuspected_plaintext = 'PST KROELLPARENTES'\nplaintext = ''\nkey = ''\n\nfor i, s in enumerate(suspected_plaintext):\n    index = string.ascii_lowercase.find(s.lower())\n    if index != -1:  # Char in alphabet\n        key += chr(((ord(ciphertext[i]) - ord(s)) % len(string.ascii_lowercase)) + ord('A'))\n        if len(key) % 2 == 0 and key[:len(key)//2] == key[len(key)//2:]:  # Key is probably repeating itself\n            key = key[:len(key)//2]\n            break\nprint('Key:', key)  # Prints 'Key: SPST'\n\ni = 0\nfor c in ciphertext:\n    index = string.ascii_lowercase.find(c.lower())\n    if index != -1:\n        islower = c.islower()\n        c = chr(((ord(c.upper()) - ord(key[i % len(key)])) % len(string.ascii_lowercase)) + ord('A'))\n        if islower:\n            c = c.lower()\n        i += 1\n    plaintext += c\nprint('Plaintext:', plaintext)  # Prints 'Plaintext: PST KROELLPARENTES f02a104f2a665e5d3d2619d6184dc50a KROELLPARENTES SLUTT'\nprint('Flag:', plaintext.replace('KROELLPARENTES SLUTT', '}').replace('KROELLPARENTES', '{').replace(' ', ''))  # Prints 'Flag: PST{f02a104f2a665e5d3d2619d6184dc50a}'\n</pre>\nThe key is <code><a href=\"https://spst.no/\">SPST</a></code>. The flag is <code>PST{f02a104f2a665e5d3d2619d6184dc50a}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 11th - 1337 - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge is to decode <a href=\"https://kalender.npst.no/melding.txt\">a message sent to a spy</a>.\n\n<h6>Solution</h6>The title and text of the challenge hints a lot about <a href=\"https://en.wikipedia.org/wiki/Prime_number\">prime numbers</a> and <a href=\"https://en.wikipedia.org/wiki/Factorization\">factorization</a>. The message has 1337 bits (just like the title). <code>1337</code> is a prime number and can be factorized by the prime numbers <code>7</code> and <code>191</code>. Because of that the bits can't be divided into bytes of 8 bits. But that's fine as e.g. <a href=\"https://en.wikipedia.org/wiki/ASCII\">ASCII</a> used to originally only have 7 bits per character.\n\nThis is where I dug in the wrong direction. I spent quite a bit of time thinking that the prime number and factorization hints meant that this text was <a href=\"https://en.wikipedia.org/wiki/RSA_(cryptosystem)\">RSA encrypted</a> (<code>n=1337, p=7, r=191</code>).\n\nBut the text is supposed to be divided into 191 columns and 7 lines. Then a pattern emerges. 🤦 I have changed the zeros to spaces to make it more readable:<pre class=\"prettyprint lang-py\">111   11  11111    1  1     111 1   1 11111 1111  1111  11111   1   1   1       1 11111       11111 1 1     1           1   1  111  1   1       1   1   1   1   1 11111       1 11111 1  1    \n1  1 1  1   1     1   1      1  11  1 1     1   1 1   1 1      1 1  1  1        1   1           1   1 1     1           1   1 1   1 1   1       11 11  1 1  1  1  1           1   1   1   1   \n1  1 1      1     1   1      1  1 1 1 1     1   1 1   1 1     1   1 1 1         1   1           1   1 1     1            1 1  1   1 1   1       1 1 1 1   1 1 1   1           1   1   1   1   \n111   11    1    1    1      1  1 1 1 1111  1111  1111  1111  1   1 11          1   1           1   1 1     1             1   1   1 1   1       1   1 1   1 11    1111        1   1   1    1  \n1       1   1     1   1      1  1  11 1     1   1 1 1   1     11111 1 1         1   1           1   1 1     1             1   1   1 1   1       1   1 11111 1 1   1           1   1   1   1   \n1    1  1   1     1   1      1  1   1 1     1   1 1  1  1     1   1 1  1        1   1           1   1 1     1             1   1   1 1   1       1   1 1   1 1  1  1           1   1       1   \n1     11    1      1  11111 111 1   1 11111 1111  1   1 11111 1   1 1   1 11111 1   1   11111   1   1 11111 11111 11111   1    111   111  11111 1   1 1   1 1   1 11111 11111 1   1   1  1    \n</pre>\nI have to admit this was not my favourite challenge. It's hard to relate this to anything IT security really.\n\nThe flag was <code>PST{LINEBREAK_IT_TILL_YOU_MAKE_IT!}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 12th - Arbitrary code - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>We're told there's <a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7BgetFlag()%7D%3C%2Fpre%3E%60\">public available API endpoint at SPST's site</a> that seems to be vulnerable to <a href=\"https://en.wikipedia.org/wiki/Arbitrary_code_execution\">arbitrary code execution</a>. We're asked to look at it and report back any flags.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Arbitrær kode\">Challenge</a>\n - <a href=\"https://kalender.npst.no/12/\">Daily brief</a>\n - <a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7BgetFlag()%7D%3C%2Fpre%3E%60\">API endpoint</a>\n\n<h6>Solution</h6>I found this challenge quite entertaining. The &lt;pre&gt; tag in the given URL isn't a coincident as it makes the output more readable in the browser as we progress. It's possible to solve this either by just using the API endpoint all the time or by running the code locally.\n\nThe first step is to find the source code of the <code>getFlag()</code> method. As this turns out to be plain JavaScript we are able to get the source code of the functions when they are printed. A clue to solve this challenge is to take note of the comments in the code.\n\nIf we start out with <a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7BgetFlag%7D%3C%2Fpre%3E%60\">https://api.spst.no/eval?eval=&#96;&lt;pre&gt;&#36;{getFlag}&lt;/pre&gt;&#96;</a>:<pre class=\"prettyprint lang-js\">function getFlag() {\n    // Det er sikkert smartere å kryptere flagget først, og bare skrive inn det\n    // krypterte resultatet her, enn å kryptere på serveren hver gang.\n    // 11.12.19: Kryptert flagget nå. Vi kan sikkert slette encrypt-funksjonen?\n    return \"e5a8aadb885cd0db6c98140745daa3acf2d06edc17b08f1aff6daaca93017db9dc8d7ce7579214a92ca103129d0efcdd\";\n  }\n</pre>\nWe can see that the flag returned is encrypted and is the ciphertext <code style=\"overflow-wrap: break-word;\">e5a8aadb885cd0db6c98140745daa3acf2d06edc17b08f1aff6daaca93017db9dc8d7ce7579214a92ca103129d0efcdd</code>.\n\nThe comments refer to <a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7Bencrypt%7D%3C%2Fpre%3E%60\">https://api.spst.no/eval?eval=&#96;&lt;pre&gt;&#36;{encrypt}&lt;/pre&gt;&#96;</a>:<pre class=\"prettyprint lang-js\">function encrypt(input) {\n    // Bruk &#96decrypt&#96 for å dekryptere\n  \n    const algorithm = \"aes-192-cbc\";\n    // 06.12.19: husk å oppdatere denne hver dag!!!\n    // 09.12.19: dette var sykt slitsomt. kan vi finne en bedre løsning?\n    // 11.12.19: Krypteres permanent med dagens passord nå.\n    // Denne funksjonen trengs vel ikke lenger?\n    const password = getPassword(\"10.12.19\");\n  \n    // 09.12.19: pepper er ikke et salt. Når vi på sikt krypterer utenfor serveren\n    // burde vi oppdatere dette til noe mer vitenskapelig korrekt.\n    // Natriumhydrogensulfat?\n    // 11.12.19: Oppdatert med den kjemiske formelen ;)\n    const key = crypto.scryptSync(password, formatSalt(\"pepper\"), 24);\n  \n    const iv = Buffer.alloc(16, 0);\n    const cipher = crypto.createCipheriv(algorithm, key, iv);\n    \n    let encrypted = cipher.update(input, \"utf8\", \"hex\");\n    encrypted += cipher.final(\"hex\");\n  \n    return encrypted;\n}\n</pre>\nReading the comments we see that the salt used for the encryption of the flag is <code><a href=\"https://en.wikipedia.org/wiki/Sodium_bisulfate\">NaHSO4</a></code>.\n\nThe comments also refer to <a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7BgetPassword%7D%3C%2Fpre%3E%60\">https://api.spst.no/eval?eval=&#96;&lt;pre&gt;&#36;{getPassword}&lt;/pre&gt;&#96;</a>:<pre class=\"prettyprint lang-js\">function getPassword(date) {\n    const passwords = {\n      \"06.12.19\": \"passord-\" + getSecretPasswordNumber(3),\n      \"07.12.19\": \"passord-\" + getSecretPasswordNumber(5),\n      \"08.12.19\": \"passord-\" + getSecretPasswordNumber(8),\n      \"09.12.19\": \"passord-\" + getSecretPasswordNumber(13),\n      \"10.12.19\": \"passord-\" + getSecretPasswordNumber(21)\n    };\n    // 06.12.19: vi har ikke flere passord etter 10. Burde vurdere alternative\n    // løsninger.\n    return passwords[date] || &#96;fant ikke passord for &#36;{date}&#96;;\n}\n</pre>\nNotice how the method uses the <a href=\"https://en.wikipedia.org/wiki/Fibonacci_number\">Fibonacci sequence</a> when calling <code>getSecretPasswordNumber()</code>.\n\nIf we want to run the code locally we need the <code>getSecretPasswordNumber()</code>, <code>decrypt()</code> and <code>formatSalt()</code> functions too.\n\n<a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7BgetSecretPasswordNumber%7D%3C%2Fpre%3E%60\">https://api.spst.no/eval?eval=&#96;&lt;pre&gt;&#36;{getSecretPasswordNumber}&lt;/pre&gt;&#96;</a>:<pre class=\"prettyprint lang-js\">function getSecretPasswordNumber(n) {\n    return Math.PI.toFixed(48).toString().split(\".\")[1].slice(n, n+2);\n}\n</pre>\n<a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7Bdecrypt%7D%3C%2Fpre%3E%60\">https://api.spst.no/eval?eval=&#96;&lt;pre&gt;&#36;{decrypt}&lt;/pre&gt;&#96;</a>:<pre class=\"prettyprint lang-js\">function decrypt(password, salt, input) {\n    const algorithm = \"aes-192-cbc\";\n    \n    const key = crypto.scryptSync(password, formatSalt(salt), 24);\n    \n    const iv = Buffer.alloc(16, 0);\n    const decipher = crypto.createDecipheriv(algorithm, key, iv);\n    \n    let decrypted = decipher.update(input, 'hex','utf8');\n    decrypted += decipher.final('utf8');\n    \n    return decrypted;\n}\n</pre>\n<a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7BformatSalt%7D%3C%2Fpre%3E%60\">https://api.spst.no/eval?eval=&#96;&lt;pre&gt;&#36;{formatSalt}&lt;/pre&gt;&#96;</a>:<pre class=\"prettyprint lang-js\">function formatSalt(salt) {\n    return salt.toLowerCase();\n}\n</pre>\nWith all this information and pasting in the code from the server we can run the following code: <pre class=\"prettyprint lang-js\">const crypto = require('crypto');\nconst password = 'passord-' + getSecretPasswordNumber(34); // Ref. Fibonacci numbers and getPassword()\nconst salt = 'NaHSO4'\nconst ciphertext = getFlag();\nconst plaintext = decrypt(password, salt, ciphertext);\n\nconsole.log('Password:', password);\nconsole.log('Salt:', salt);\nconsole.log('Ciphertext:', ciphertext);\nconsole.log('Plaintext:', plaintext);\n</pre>\nThe output is as follows:<pre class=\"prettyprint lang-js\">Password: passord-61\nSalt: NaHSO4\nCiphertext: e5a8aadb885cd0db6c98140745daa3acf2d06edc17b08f1aff6daaca93017db9dc8d7ce7579214a92ca103129d0efcdd\nPlaintext: PST{24e592de8b20fe09938916d79b08854e}\n</pre>\nInstead of running the code locally we can just visit <a style=\"overflow-wrap: break-word;\" href=\"https://api.spst.no/eval?eval=%60%24%7Bdecrypt(%27passord-61%27%2C%27NaHSO4%27%2C%27e5a8aadb885cd0db6c98140745daa3acf2d06edc17b08f1aff6daaca93017db9dc8d7ce7579214a92ca103129d0efcdd%27)%7D%60\">https://api.spst.no/eval?eval=&#96;&#36;{decrypt('passord-61','NaHSO4','e5a8aadb885cd0db6c98140745daa3acf2d06edc17b08f1aff6daaca93017db9dc8d7ce7579214a92ca103129d0efcdd')}&#96;</a>\n\nSince this is real <code>eval()</code> it is also possible solving this challenge a bit more effectively by going to e.g. <a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7Brequire(%27fs%27).readdirSync(%27.%27).toString()%7D%3C%2Fpre%3E%60\">https://api.spst.no/eval?eval=&#96;&lt;pre&gt;&#36;{require('fs').readdirSync('.').toString()}&lt;/pre&gt;&#96;</a> and <a href=\"https://api.spst.no/eval?eval=%60%3Cpre%3E%24%7Brequire(%27fs%27).readFileSync(%27eval.js%27).toString()%7D%3C%2Fpre%3E%60\">https://api.spst.no/eval?eval=&#96;&lt;pre&gt;&#36;{require('fs').readFileSync('eval.js').toString()}&lt;/pre&gt;&#96;</a>\n\nAs seen, the flag is <code>PST{24e592de8b20fe09938916d79b08854e}</code> (MD5 hash of <code>passord123</code>).\n</span></div></li><li><div class=\"collapsible-header\">December 13th - Token effort - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>Another entertaining challenge. Santa has an online naughty and nice list. Seemingly one of the API keys have been compromised and we're given <a href=\"https://en.wikipedia.org/wiki/7z\">7z</a> archive files with access logs to investigate the issue. The elf that has archived the files is not very technical and also has forgotten the password of the archive files. However, the password should be mentioned as one of the technologies in one of PST's job ads. The challenge is to find out which of the API keys that have been compromised.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Token effort\">Challenge</a>\n - <a href=\"https://kalender.npst.no/13/\">Daily brief</a>\n - <a href=\"https://www.finn.no/165416216\">Job ad</a>\n - <a href=\"https://kalender.npst.no/logger.7z.001\">https://kalender.npst.no/logger.7z.001</a>\n - <a href=\"https://kalender.npst.no/logger.7z.002\">https://kalender.npst.no/logger.7z.002</a>\n - <a href=\"https://kalender.npst.no/logger.7z.003\">https://kalender.npst.no/logger.7z.003</a>\n - <a href=\"https://kalender.npst.no/logger.7z.004\">https://kalender.npst.no/logger.7z.004</a>\n\n<h6>Solution</h6>The challenge can be solved like this:\n1. Unzip the 7z files using tech words mentioned in job ad\n2. Continue to unzip stuff (no worries, it actually isn't a <a href=\"https://en.wikipedia.org/wiki/Zip_bomb\">zip bomb</a>) until you have all four log files (I spent a bit too long when I only had one log file available)\n3. Look for entries that stands out among the 1,031,074 log lines to find the compromised API key.\n\nEasy right? Let's try to script it:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport os\nimport subprocess\nimport re\nimport glob\n\n\ndef unzip(filename):\n    print('\\nTrying to unzip [%s].' % filename)\n    try:\n        output = subprocess.check_output('jar xvf ' + filename, encoding='UTF-8', shell=True).strip()\n        print(output)\n        if output:\n            for line in output.split('\\n'):\n                filename = line.split(': ')[1]\n                if filename.endswith('.zip'):\n                    unzip(filename)\n                    if DELETE_ZIP_FILES:\n                        os.remove(filename)\n                elif filename.endswith('.gz'):\n                    gunzip(filename)\n                else:\n                    print('Unknown file type for file named [%s]. Skipping.' % filename)\n    except subprocess.CalledProcessError as e:\n        print(e)\n\n\ndef gunzip(filename):\n    print('\\nTrying to gunzip [%s].' % filename)\n    try:\n        output = subprocess.check_output('gunzip --force ' + filename, encoding='UTF-8', shell=True).strip()\n        print(output)\n    except subprocess.CalledProcessError as e:\n        print(e)\n\n\ndef get_wordlist(filename):\n    with open(filename, 'r') as f:\n        return set(f.read().split())\n\n\ndef unar(filename, wordlist):\n    print('\\nTrying to unar [%s].' % filename)\n    for word in wordlist:\n        word = word.replace('(', '').replace(')', '').replace('.', '').replace(',', '').replace(':', '').replace('?', '').replace('\"', '')\n        print('Trying password: [%s]' % word)\n        try:\n            # Using https://theunarchiver.com/command-line\n            output = subprocess.check_output('./unar -force-overwrite -password \"' + word + '\" ' + filename, encoding='UTF-8', shell=True).strip()\n            print(output)\n        except subprocess.CalledProcessError:\n            continue\n        else:\n            print('Password [%s] was correct.' % word)  # Prints 'Password [Graylog] was correct.'\n            return\n\n\ndef update_data(name, matcher):\n    if name not in counts:\n        counts[name] = {}\n        lengths[name] = {}\n\n    group = matcher.group(name)\n    if not group in counts[name]:\n        counts[name][group] = {'count': 1, 'line': matcher.string}\n    else:\n        counts[name][group]['count'] = counts[name][group]['count'] + 1\n\n    length = 0 if group is None else len(group)\n    if not length in lengths[name]:\n        lengths[name][length] = {'count': 1, 'line': matcher.string}\n    else:\n        lengths[name][length]['count'] = lengths[name][length]['count'] + 1\n\n\ndef parse(filename):\n    print('\\nParsing [%s]' % filename)\n    with open(filename) as file:\n        for line in file:\n            line = line.strip()\n            m = re.search(r'(?P<ip>.*?) - - [(?P<date>.*?)] \"(?P<method>.*?) (?P<url>.*?)(?)?(jw_token=(?P<token>.*?))?(&)?(id=(?P<id>.*?))?(&)?(page=(.*?))? (?P<http>.*?) (?P<status>.*?) (?P<size>.*?) \"-\" \"(?P<ua>.*?)\"', line)\n            if not m:\n                print(line)\n                print(m)\n                exit(0)\n            update_data('ua', m)\n            update_data('url', m)\n            update_data('status', m)\n            update_data('size', m)\n            update_data('http', m)\n            update_data('method', m)\n            update_data('id', m)\n            update_data('token', m)\n\n\ndef analyze_counts():\n    \"\"\"\n    Looks for lines query param values that stand out\n    \"\"\"\n    for name in counts:\n        print('\\nAnalyzing counts of %s' % name)\n        interesting = []\n        for group in counts[name]:\n            if counts[name][group]['count'] < 10:\n                line = counts[name][group]['line']\n                interesting.append(line)\n        if len(interesting) == 0:\n            print('  Found nothing of interest.')\n        elif len(interesting) < 10:\n            for line in interesting:\n                # Prints lines like '10.80.116.24 - - [2019-12-07T07:00:00.000Z] \"BREW /brew/coffee HTCPCP/1.0\" 418 0 \"-\" \"polarbucks/9000.1\"'\n                print('  Found interesting log line:\\n    %s' % line)\n        else:\n            print('  Found too many unique items. Not printing any.')\n\n\ndef analyze_lengths():\n    \"\"\"\n    Looks for lines query param value lengths that stand out\n    \"\"\"\n    for name in lengths:\n        print('\\nAnalyzing string lengths of %s' % name)\n        interesting = []\n        for group in lengths[name]:\n            length = 0 if group is None else group\n            if lengths[name][length]['count'] < 10:\n                line = lengths[name][length]['line']\n                interesting.append(line)\n        if len(interesting) == 0:\n            print('  Found nothing of interest.')\n        elif len(interesting) < 10:\n            for line in interesting:\n                # Prints lines like '10.87.113.12 - - [2019-12-09T11:51:19.031Z] \"DELETE /lister/snille.php?id=jule_nissen&jw_token=67e49727affdee991ec58180ee657b28 HTTP/1.1\" 403 24 \"-\" \"curl/7.61.1\"'\n                print('  Found interesting log line:\\n    %s' % line)\n        else:\n            print('  Found too many unique items. Not printing any.')\n\n\nDELETE_ZIP_FILES = False\n\n# job_ad.txt contains the text from the job ad\nunar('logger.7z.001', get_wordlist('job_ad.txt'))\n\nunzip('access.log.zip')\n\nfor filename in glob.glob('*.access.log'):\n    counts = {}\n    lengths = {}\n    parse(filename)\n    analyze_counts()\n    analyze_lengths()\n</pre>\nFrom this we get some interesting log lines:<pre class=\"prettyprint lang-bsh\">Trying to unar [logger.7z.001].\nTrying password: [oppgaver]\n...\nTrying password: [Graylog]\nlogger.7z.001: 7-Zip\n  access.log.zip  (34231284 B)... OK.\nSuccessfully extracted to \"./access.log.zip\".\nPassword [Graylog] was correct.\n\n...\n\nTrying to unzip [access.log.zip].\ninflated: 2019-12-07.access.log.11.zip\n\n...\n\nParsing [2019-12-07.access.log]\n\nAnalyzing counts of ua\n  Found interesting log line:\n    10.80.116.24 - - [2019-12-07T07:00:00.000Z] \"BREW /brew/coffee HTCPCP/1.0\" 418 0 \"-\" \"polarbucks/9000.1\"\n...\nAnalyzing string lengths of id\n  Found interesting log line:\n    10.87.113.12 - - [2019-12-09T11:41:07.197Z] \"DELETE /lister/slemme.php?id=gwyn HTTP/1.1\" 401 275 \"-\" \"curl/7.61.1\"\n  Found interesting log line:\n    10.87.113.12 - - [2019-12-09T11:42:13.574Z] \"DELETE /lister/slemme.php?id=gwyn&jw_token=f6d1ab9cebe6c5d734989151ec073bfe HTTP/1.1\" 401 275 \"-\" \"curl/7.61.1\"\n  Found interesting log line:\n    10.87.113.12 - - [2019-12-09T11:51:19.031Z] \"DELETE /lister/snille.php?id=jule_nissen&jw_token=67e49727affdee991ec58180ee657b28 HTTP/1.1\" 403 24 \"-\" \"curl/7.61.1\"\n...\n</pre>\n\nWe are actually able to get out the log lines we need (and it's also always nice to see a reference to <code><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/418\">418 I'm a teapot</a></code>). If you look closer at the log lines from that same IP address 10.87.113.12 you'll see someone (probably good old Pen Gwyn) do this:\n1. Delete himself from the naughty list without a API key and get 401 back\n2. Delete himself from the naughty list with an invalid API key and get 401 back\n3. Delete himself from the naughty list with a valid API key (the flag) and get 200 back\n4. Add himself to the nice list with a valid API key and get 200 back\n5. Delete Santa from the nice list with a valid API key and get 403 back\n\nThe flag is <code>PST{67e49727affdee991ec58180ee657b28}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 14th - Data leak - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>NPST has been able to get their hands on a hard drive marked with <code>U+2295/U+22BB</code>. The hard drive contains contains the following document and the text also hints about <a href=\"https://en.wikipedia.org/wiki/Hamming_distance\">hamming distance</a>:\n<code style=\"font-size:60%;overflow-wrap: break-word;\">GSU/MWR0QXpUW1p7TGZvITUXJgQaHiUbCRdONxcgEQwAahgDEU4LIgcxYyclGEwODysBPw8MVCcUAgILZRoxF0kdaiY8NjplGjUXSRKvARhFAyAWdBYME2oGiUUGJAB0NjknHlUKChwgBjURHVQlBQkXDzYYOwsMBmoFiUUgKgAwFQYYKwcfDgtlBjEXGx0+Gh4MGyhSPUUNESRVHwwdMRd0EQAQLxtCRTsrFjEXSRKyGQsAHGUXOkUGBDoGGQgDIAA9Cw5UKwNMAQc2ATFFBgQvBw0WBCocMQsMWkA5CQELNxc6RQgCajs8NjppUh4QBRFqOwUWHSAceEUBETgQGBELN1I7CB0VJgFMFgEoUh8pKCEZVQQEHGUEshcdVCUXBgAFMVIyChtULBkJFwtlEyJFDR05BglFATUXJgQaHiUbCQsLa3heSEkgIwcfAQ8iUmRWR0V4W11cTi4eNRcdEWoDiRcLZRYtDh0dLRBMDQ8mGTEXDFSvVQgABTcLJBEMBi9VlAsdLhc4DBoALwdMFgEoUiIEG1Q5EAIBGmUGPQlJPwY0OTZAZSQ9RQMbKBcJF04jHSYRGhU+AUwNDzcWIEUEES5ViUUPKxM4HBoROBBMDAArGjsJDRE+VQVFCiwBJwBJjCQGBwACLAEgAAcRZH9BRSErATAEDlR6QUJUXGtDbUUPGzgQGAoFZRc6RQgTLxsYRQsxUiIABRgzHgcAGmUBJAQHHSQSHwoeNRYmBA5UJxoYRSUJMwE2RVQmEAgAHCAcdAQfVAQlPzFAZTkYJDwnagMNF04wBjFFGZFqHwMCCSAGIRdJACMZTBUBNgY/CgcAJQcJEU4oFzBFDBpqFBpFBiQcJ0UbESMbHwEXN1x0IB0ALwdMBAIxUrFFDYwnGAlFHaBSNgAHDT4BCRZONR0nEQIbJAEDFwsxUjIKG1SvVR8AACEXdJ0HByEQAAwdMRcmRQ8GK1VOFgAsHjgAS1QoFB4LQGU2MRFJAiMHBwAcZQE7CEkbJ1UiNT0RUj0OAhFqHQ0XTisdMQtJFSQQABYLZR05RQgAahEJERogUjIKGxEtkB5FHqBSMAAbETlVGAAcNxsgChsdL1tmSE4DADEBCBNqRVpLX3dcZVxJB69VHw4HIwYxEUk6GiY4RRosHnQAB1QkDEwOHDwCIAAbHSQSHwQCIh0mDB0ZL1UfCgNlFT4KGxAvVQ0RTjMbdAwCHy9VAAAAIhcmRQ+ROFUYDAIiEzoCSQAjGUwMACsaOwkNET5VBUWWKwE/AAUdOQEJCwtrUgKAGxFqHQ0GBSAAMUUDGygXCRdONZd0FhkGLxsLRQgqAHSASRIjGwIATiAcdBMMHWoHGQsKMVIwAAcaL1UCHAtlGSYcGQAvBwULCSAcem9EVAaNHgEPIlJkUkdFeFtdXE4sHDIMBQA4EB4RC2UXOkUIEy8bGEUlCTMBNkkHIwEYRRggAD8WHREuVQMCTjcdIAAdVCwaHkWLZQE1BwYALwcJRQQwHjEDBgYoEB4ACiAeJwAHEWZVAQAAZQQxFwIHPhAIABplBDUXSRUmGQkXCyEXdBMMGC4cC0UcKgYxEQxaajMDFwagAjELHRgjEhoMHWUUOxcaHSQeCRdOIRcgEQxULBoeBws3FzAABQcvGwlFACoZdBEAGGoUGEUMIBQ7CQIaIxsLAABlEDgMG1Q/BgUOBSAAdBWMVCUYTAELMVI2CQAGahACRQkqFnQPHBhkf0FFOiwAJwEIE2pEXEtfd1xlXEkYLwMJFxogUjELSRUtEAIRTiAGdBUIBj4cTA8bKRc2FxwHagEFCU4gHHQVBgAvGx8MCykedA4AGC4QTAxOCyIHMUdUDhAYEQtlEDgASRMgGh4RTiAGIAAbVCsBTBOLN1IgDA0YIxIJFwtlGT0JDRFqBYlFByscJwwNESRVCgwFLlInFQgGIRACRQsxBjEXSRU+VQQEAGUQOABJGzoFCAQJIAZ6RT8dahAeRRs2Gz8XDFQ6kEwKA2UBOZ0bHSQSHwMBNwGsDgwAah0NF04jBzoCDAY+VQkRGiAAJwoEVCsZGgAAZQExF0kBPlUYDAJll3QNCFQnEAABGmUWMREdEWocAhELNxwgS2NZaiEDFx0hEzNFWEZkRF5LX3xSJwsIBDoQGEUYLFI7FRlULxtMCAspFj0LDlQlGEwEGmU5GCQ8J2odDRdOJx49ER1UOQwHS04DHSYNjAQvGxgJByIEPRZJAiMZTAELMQYxRQsRPgxMBBplBDEXAgc+EAgAGmUGPQlJPwY0OTZOLRMiCwwGahACAQ9lHjELDgYvVQ4EBWUCsUUPGzgXCRcLIRc4FgwaL1UfDAAgUiAMBVQgAABLZE94EAQdFSsbCxcLNVI5Ch1UGSU/MWQWBjsXDRU+FAEEHS4bOgAHVDyQHkUGJAB0BwUdPgFMEBo2EyARSRIlB0wAGmUWNREIFSQSHgAeZRt0CwgAPlUfCgNlATEXSQE+VRgMAmWXdBYdFScYCUUINxN0AAdULQcZFR4gUjIXAAIjGQAMCSBSJwoEVCAaDgcLN1IyChtUBCU/MUBlJD1FCxE4VQ0JAiBSNQsaFT4BCUUbKxwzgEmRahcJCxcxBjFFGhEtVQ0TTjEYMQsMBz4QAgBOIwA1RRoAJQcIBBokHzUWAh0kEAJFCDcXOUUdHSZVDQEDLBw9Fh0GKwYGCgA2BjEEBBE+VQQEHGUUsREdVDkcBxcLMVI4nRoaIxsLAABreF5vPB8vGx9FDysBNREdfhoQAkUpMgs6RQ8bOFUZEQMgAD8AHVQ/GwgAHCYdIgAbVCsHDgAHIVI5Ch1UBCU/MUBPeF4xCB8hVRgMAmUTOAkMVCwaHkUbMR8xFwIRPlUNFwwgGzBFDREkVR8MHTEXdBEAEC8bQm89LxcyRTokGSFARSUgGycAGwQjGwsTBysXOm9jOghPZi4PKwY9CwwaagMFCU4zlCYASQc+EAICGmUWMUUHETkBCUUaKlIwBA4RJBBMABoxFyZFAhgrEgkXTjWXdAGMBiYcC0UFMxM4DB0RPlUcgE4jGycODBpkVToMTikXIAAbVC8BGAAcZRc6RQcNahkJEws3EzoBkQZqBgMITi4TOkUFETwQHgBOJxcwFwxUOJAaBBwgAHpvOSceDg1WV3dLYlVdRntMXVZfc0dlXF5MfkAKVlonFGEBWBVyCA==</code>\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Lekket data\">Challenge</a>\n - <a href=\"https://kalender.npst.no/14/\">Daily brief</a>\n\n<h6>Solution</h6>The unicode characters <code>U+2295/U+22BB</code> or <code><a href=\"https://en.wikipedia.org/wiki/⊕\">⊕</a>/<a href=\"https://en.wiktionary.org/wiki/⊻\">⊻</a></code> are often used to symbolize <a href=\"https://en.wikipedia.org/wiki/Exclusive_or\">exclusive or</a>, strongly hinting to <a href=\"https://en.wikipedia.org/wiki/XOR_cipher\">XOR cipher</a> in our case.\n\nThe document is Base64 encoded. So we can assume we should decode it and then we can try to brute force the the key we to find the plaintext. It only takes a few lines of Python. The way I did it was to check the number of proper/expected plaintext chars I got for different keys:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport base64\nimport string\nfrom time import time\n\ncipher_base64 = 'GSU/MWR0QXpUW1p7TGZvITUXJgQaHiUbCRdONxcgEQwAahgDEU4LIgcxYyclGEwODysBPw8MVCcUAgILZRoxF0kdaiY8NjplGjUXSRKvARhFAyAWdBYME2oGiUUGJAB0NjknHlUKChwgBjURHVQlBQkXDzYYOwsMBmoFiUUgKgAwFQYYKwcfDgtlBjEXGx0+Gh4MGyhSPUUNESRVHwwdMRd0EQAQLxtCRTsrFjEXSRKyGQsAHGUXOkUGBDoGGQgDIAA9Cw5UKwNMAQc2ATFFBgQvBw0WBCocMQsMWkA5CQELNxc6RQgCajs8NjppUh4QBRFqOwUWHSAceEUBETgQGBELN1I7CB0VJgFMFgEoUh8pKCEZVQQEHGUEshcdVCUXBgAFMVIyChtULBkJFwtlEyJFDR05BglFATUXJgQaHiUbCQsLa3heSEkgIwcfAQ8iUmRWR0V4W11cTi4eNRcdEWoDiRcLZRYtDh0dLRBMDQ8mGTEXDFSvVQgABTcLJBEMBi9VlAsdLhc4DBoALwdMFgEoUiIEG1Q5EAIBGmUGPQlJPwY0OTZAZSQ9RQMbKBcJF04jHSYRGhU+AUwNDzcWIEUEES5ViUUPKxM4HBoROBBMDAArGjsJDRE+VQVFCiwBJwBJjCQGBwACLAEgAAcRZH9BRSErATAEDlR6QUJUXGtDbUUPGzgQGAoFZRc6RQgTLxsYRQsxUiIABRgzHgcAGmUBJAQHHSQSHwoeNRYmBA5UJxoYRSUJMwE2RVQmEAgAHCAcdAQfVAQlPzFAZTkYJDwnagMNF04wBjFFGZFqHwMCCSAGIRdJACMZTBUBNgY/CgcAJQcJEU4oFzBFDBpqFBpFBiQcJ0UbESMbHwEXN1x0IB0ALwdMBAIxUrFFDYwnGAlFHaBSNgAHDT4BCRZONR0nEQIbJAEDFwsxUjIKG1SvVR8AACEXdJ0HByEQAAwdMRcmRQ8GK1VOFgAsHjgAS1QoFB4LQGU2MRFJAiMHBwAcZQE7CEkbJ1UiNT0RUj0OAhFqHQ0XTisdMQtJFSQQABYLZR05RQgAahEJERogUjIKGxEtkB5FHqBSMAAbETlVGAAcNxsgChsdL1tmSE4DADEBCBNqRVpLX3dcZVxJB69VHw4HIwYxEUk6GiY4RRosHnQAB1QkDEwOHDwCIAAbHSQSHwQCIh0mDB0ZL1UfCgNlFT4KGxAvVQ0RTjMbdAwCHy9VAAAAIhcmRQ+ROFUYDAIiEzoCSQAjGUwMACsaOwkNET5VBUWWKwE/AAUdOQEJCwtrUgKAGxFqHQ0GBSAAMUUDGygXCRdONZd0FhkGLxsLRQgqAHSASRIjGwIATiAcdBMMHWoHGQsKMVIwAAcaL1UCHAtlGSYcGQAvBwULCSAcem9EVAaNHgEPIlJkUkdFeFtdXE4sHDIMBQA4EB4RC2UXOkUIEy8bGEUlCTMBNkkHIwEYRRggAD8WHREuVQMCTjcdIAAdVCwaHkWLZQE1BwYALwcJRQQwHjEDBgYoEB4ACiAeJwAHEWZVAQAAZQQxFwIHPhAIABplBDUXSRUmGQkXCyEXdBMMGC4cC0UcKgYxEQxaajMDFwagAjELHRgjEhoMHWUUOxcaHSQeCRdOIRcgEQxULBoeBws3FzAABQcvGwlFACoZdBEAGGoUGEUMIBQ7CQIaIxsLAABlEDgMG1Q/BgUOBSAAdBWMVCUYTAELMVI2CQAGahACRQkqFnQPHBhkf0FFOiwAJwEIE2pEXEtfd1xlXEkYLwMJFxogUjELSRUtEAIRTiAGdBUIBj4cTA8bKRc2FxwHagEFCU4gHHQVBgAvGx8MCykedA4AGC4QTAxOCyIHMUdUDhAYEQtlEDgASRMgGh4RTiAGIAAbVCsBTBOLN1IgDA0YIxIJFwtlGT0JDRFqBYlFByscJwwNESRVCgwFLlInFQgGIRACRQsxBjEXSRU+VQQEAGUQOABJGzoFCAQJIAZ6RT8dahAeRRs2Gz8XDFQ6kEwKA2UBOZ0bHSQSHwMBNwGsDgwAah0NF04jBzoCDAY+VQkRGiAAJwoEVCsZGgAAZQExF0kBPlUYDAJll3QNCFQnEAABGmUWMREdEWocAhELNxwgS2NZaiEDFx0hEzNFWEZkRF5LX3xSJwsIBDoQGEUYLFI7FRlULxtMCAspFj0LDlQlGEwEGmU5GCQ8J2odDRdOJx49ER1UOQwHS04DHSYNjAQvGxgJByIEPRZJAiMZTAELMQYxRQsRPgxMBBplBDEXAgc+EAgAGmUGPQlJPwY0OTZOLRMiCwwGahACAQ9lHjELDgYvVQ4EBWUCsUUPGzgXCRcLIRc4FgwaL1UfDAAgUiAMBVQgAABLZE94EAQdFSsbCxcLNVI5Ch1UGSU/MWQWBjsXDRU+FAEEHS4bOgAHVDyQHkUGJAB0BwUdPgFMEBo2EyARSRIlB0wAGmUWNREIFSQSHgAeZRt0CwgAPlUfCgNlATEXSQE+VRgMAmWXdBYdFScYCUUINxN0AAdULQcZFR4gUjIXAAIjGQAMCSBSJwoEVCAaDgcLN1IyChtUBCU/MUBlJD1FCxE4VQ0JAiBSNQsaFT4BCUUbKxwzgEmRahcJCxcxBjFFGhEtVQ0TTjEYMQsMBz4QAgBOIwA1RRoAJQcIBBokHzUWAh0kEAJFCDcXOUUdHSZVDQEDLBw9Fh0GKwYGCgA2BjEEBBE+VQQEHGUUsREdVDkcBxcLMVI4nRoaIxsLAABreF5vPB8vGx9FDysBNREdfhoQAkUpMgs6RQ8bOFUZEQMgAD8AHVQ/GwgAHCYdIgAbVCsHDgAHIVI5Ch1UBCU/MUBPeF4xCB8hVRgMAmUTOAkMVCwaHkUbMR8xFwIRPlUNFwwgGzBFDREkVR8MHTEXdBEAEC8bQm89LxcyRTokGSFARSUgGycAGwQjGwsTBysXOm9jOghPZi4PKwY9CwwaagMFCU4zlCYASQc+EAICGmUWMUUHETkBCUUaKlIwBA4RJBBMABoxFyZFAhgrEgkXTjWXdAGMBiYcC0UFMxM4DB0RPlUcgE4jGycODBpkVToMTikXIAAbVC8BGAAcZRc6RQcNahkJEws3EzoBkQZqBgMITi4TOkUFETwQHgBOJxcwFwxUOJAaBBwgAHpvOSceDg1WV3dLYlVdRntMXVZfc0dlXF5MfkAKVlonFGEBWBVyCA=='\ncipher_hex = base64.b64decode(cipher_base64)\n\n\ndef xor(data, key):\n    key = bytes(key * (len(data) // len(key) + 1), encoding='utf8')\n    return bytearray(a ^ b for a, b in zip(*map(bytearray, [data, key])))\n\n\ndef count_chars(s, chars):\n    return sum(s.count(ord(c)) for c in chars)\n\n\ntime_start = time()\nmax_key_length = 16  # Assuming that key length won't be longer than 16 chars\nalphabet = string.ascii_letters + 'æøåÆØÅ .,{}' + string.whitespace + string.digits  # Assuming these should be most of the chars in the text\n\nbest_key = None\nbest_key_score = 0\nfor key_length in range(1, max_key_length + 1):  # Trying key lengths 1-max\n    print('Checking key size %d.' % key_length)\n    key = 'a' * key_length  # Default starting key\n    for i in range(1, key_length + 1):\n        best_letter_score = 0\n        best_letter = None\n        for l in alphabet:\n            key = key[0:i - 1] + l + key[i: len(key)]\n            score = count_chars(xor(cipher_hex, key), alphabet)  # Scoring the key by the number of expected chars the plaintext contains\n            if score >= best_letter_score:\n                best_letter_score = score\n                best_letter = l\n        key = key[0:i - 1] + best_letter + key[i: len(key)]  # Keeping the best letter for each position\n    score = count_chars(xor(cipher_hex, key), alphabet)\n    if score >= best_key_score:\n        best_key_score = score\n        best_key = key\n        # Prints stuff like 'Found new best key [lelTeeerle] (score: 1931).':\n        print('Found new best key [%s] (score: %d).' % (best_key, best_key_score))\n\ntime_spent = round(time() - time_start)\n\n# Prints stuff like 'Found key [JulenErTeit] in 38 seconds:'\nprint('\\nFound key [%s] in %d seconds:' % (best_key, time_spent))\nprint(xor(cipher_hex, best_key).decode(\"latin-1\"))\n</pre>\n\nThe key we get is <code>JulenErTeit</code> and plaintext is an internal daily brief from SPST:\n<code style=\"font-size:60%;\">SPST\n13.12.19\n\nOperasjoner rettet mot NPST\nSom kanskje mange her i SPST har fått med seg så har SPST foretatt operasjoner på Nordpolarske territorium i den siste tiden. Under følger en oppsummering av disse operasjonene.\nLederen av NPST, Jule Nissen, heretter omtalt som KLAUS har vært objekt for flere av disse operasjonene.\n\n- Tirsdag 03.12.19 klarte våre dyktige hackere å dekryptere ønskelister som var sendt til KLAUS. Vi jobber fortsatt hardt med å analysere innholdet i disse ønskelistene.\n- Onsdag 04.12.19 foretok en agent et vellykket spaningsoppdrag mot KLAUS, lederen av NPST. KLAUS var ute på joggetur til postkontoret med en av hans reinsdyr. Etter alt å dømme så benyttes postkontoret for å sende ønskelister fra \"snille\" barn. Det virker som om NPST ikke har noen anelse om at dette foregår på deres territorie.\n- Fredag 06.12.19 så skiftet NPST til en ny krypteringsalgoritme som gjorde at vi ikke lenger får tilgang til innholdet i ønskelistene. Våre hackere jobber på spreng for å finne en vei rundt denne nye krypteringen.\n- Lørdag 07.12.19 infiltrerte en agent KLAUS sitt verksted og rotet for å sabotere juleforberedelsene, men verkstedet var allerede veldig rotete. Forhåpentligvis forsinker dette forberedelsene nok til at befolkningen blir usikker på om det blir en god jul.\n- Tirsdag 10.12.19 leverte en agent et parti julebrus til en potensiell kilde i NPST. Dette ble gjort etter at vår tidligere kilde på innsiden fikk sparken etter at han ble oppdaget. Vi er usikre på om smøringsforsøket har fungert ettersom alven ser ut til å ha meldt dette internt.\n- Torsdag 12.12.19 snappet vi opp en melding om at KLAUS har blitt syk. Forhåpentligvis vil dette bety at verkstedet til KLAUS havner enda lengre bak på forberedelsene sine til jul.\n\n\nDataangrep mot SPST\nStordatamaskinen vår har blitt utsatt for et dataangrep i natt som ser ut til å stamme fra en gruppe frivillige som jobber for NPST. Vi ber alle ansatte unngå å benytte seg av tjenestene fra stordatamaskinen frem til administrasjonsteamet har fått sikret løsningen.\n\n\nUkens ansatt\nPen Gwyn for utmerket undercover arbeid mot NPST.\n\n\nTakk til alle for utmerket arbeid den siste tiden.\nSjef SPST, Keiserpingvinen\n\nNB:\nKantinen vil være stengt de neste to dagene etter klager på dårlig kvalitet på fisken. Vi leter etter en ny leverandør som kan levere bedre råvarer.\nPST{a392960421913165197845f34bf5d1a8}</code>\n\nThe flag is <code>PST{a392960421913165197845f34bf5d1a8}</code> (MD5 hash of <code>xor</code>).\n</span></div></li><li><div class=\"collapsible-header\">December 15th - Flash drive - 10 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>NPST has gotten their hands on a flash drive originally belonging to SPST's Pen Gwyn. It seems to be private and contain vacation pictures, but they are stored in a password protected ZIP file. The challenge is to find the flag on the flash drive.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#15. desember\">Challenge</a>\n - <a href=\"https://kalender.npst.no/15/\">Daily brief</a>\n - <a href=\"https://kalender.npst.no/spst_minnepinne.tar.gz\">Flash drive image file</a>\n\n<h6>Solution</h6>There are probably cooler ways to go about it, but I just retrieved the flag by using the <code><a href=\"https://en.wikipedia.org/wiki/Strings_(Unix)\">strings</a></code> command. One string stood out and looked like Base64:<pre class=\"prettyprint lang-bsh\">$ strings spst_minnepinne.dd\n# ...\n\"RXQga2plbXBlbGFuZ3QgcGFzc29yZCBzb20gYWxkcmkgdmlsIGt1bm5lIGdqZXR0ZXMgYXYgTlBTVCEgOik=\"\n\n$ echo RXQga2plbXBlbGFuZ3QgcGFzc29yZCBzb20gYWxkcmkgdmlsIGt1bm5lIGdqZXR0ZXMgYXYgTlBTVCEgOik= | base64 --decode\nEt kjempelangt passord som aldri vil kunne gjettes av NPST! :)\n</pre>\nThe flag is <code>PST{Et kjempelangt passord som aldri vil kunne gjettes av NPST! :)}</code> (=<i>A very long password NPST will never be able to guess! :)</i>).\n</span></div></li><li><div class=\"collapsible-header\">December 15th - Alternatives - 15 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge is to find the one letter character where the password from the previous challenge was found. It's only possible to guess the flag 20 times.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Alternativer\">Challenge</a>\n - <a href=\"https://kalender.npst.no/15/\">Daily brief</a>\n - <a href=\"https://kalender.npst.no/spst_minnepinne.tar.gz\">Flash drive image file</a>\n\n<h6>Solution</h6>Because of the way I solved the previous challenge this was pretty hard. There was no way (I think) I would get the answer to this one using <code>strings</code> or even a hex editor or by looking in the mounted disk drive.\n\nWhat I finally did was to use <a href=\"https://en.wikipedia.org/wiki/Autopsy_(software)\">Autopsy</a> and <a href=\"https://en.wikipedia.org/wiki/The_Sleuth_Kit\">The Sleuth Kit</a> in a <a href=\"https://www.kali.org/\">Kali</a> image.\n\nNow it was pretty easy to see that the Base64 encoded flag was located in a file called <code>C:/feriebilder.zip:_</code>:\n\n<img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" alt=\"\" src=\"/images/pst301-autopsy.png\"/>\n<img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" alt=\"\" src=\"/images/pst302-autopsy.png\"/>\n\nThe character that was needed was <code>_</code>. The full flag after getting the md5 sum of it was <code>PST{b14a7b8059d9c055954c92674ce60032}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 15th - Vacation photos - 20 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge is to find a flag from one of the three vacation photos located inside the ZIP file on the disk image.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Feriebilder\">Challenge</a>\n - <a href=\"https://kalender.npst.no/15/\">Daily brief</a>\n - <a href=\"https://kalender.npst.no/spst_minnepinne.tar.gz\">Flash drive image file</a>\n\n<h6>Solution</h6>We have the password for the ZIP file containing the photos from the previous challenge. We just have to mount the disk and extract the files first: \n<pre class=\"prettyprint lang-bsh\">$ hdiutil attach -imagekey diskimage-class=CRawDiskImage -nomount spst_minnepinne.dd\n/dev/disk3          \tFDisk_partition_scheme         \t\n/dev/disk3s1        \tWindows_NTFS                   \t\n\n$ hdiutil mount /dev/disk3s1 \n/dev/disk3s1        \tWindows_NTFS                   \t/Volumes/SPST\n\n$ unar -password \"Et kjempelangt passord som aldri vil kunne gjettes av NPST! :)\" /Volumes/SPST/feriebilder.zip \n/Volumes/SPST/feriebilder.zip: Zip\n  huskelapp.png  (1418810 B)... OK.\n  måltid.png  (2534140 B)... OK.\n  varm dag på stranda.png  (1722473 B)... OK.\nSuccessfully extracted to \"feriebilder\".\n</pre>\nIn one of the pictures - <code>måltid.png</code> - there's what appears to be a red <a href=\"https://en.wikipedia.org/wiki/Herring\">herring</a>, and that's not just a <a href=\"https://en.wikipedia.org/wiki/Red_herring\">red herring</a> actually. The base for the flag could be found using e.g. an <a href=\"https://incoherency.co.uk/image-steganography/\">online tool for image steganography</a>. The file <code>strand.png</code> hid an image with the text <code>PST{md5(red_herring)}</code>. The solution was to get the md5 sum of the file itself: <code>md5 måltid.png</code> = <code>07385aacc9264738cd7c32e76f3b81a5</code>. The flag was <code>PST{07385aacc9264738cd7c32e76f3b81a5}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 17th - Password database - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The elfs working in the canteen uses a home made password database. The problem is that they seem to have forgotten the password to it. The challenge is to find that password.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Passorddatabase\">Challenge</a>\n - <a href=\"https://kalender.npst.no/17/\">Daily brief</a>\n - <a href=\"https://kalender.npst.no/p2w\">Database executable</a>\n\n<h6>Solution</h6>Instead of just disassembling the executable and make sense of that I went for using the <a href=\"https://www.gnu.org/software/gdb/\">GNU Debugger (GDB)</a>/<a href=\"https://github.com/longld/peda\">peda</a> (Python Exploit Development Assistance for GDB). This was my first time using GDB (<a href=\"https://blog.roysolberg.com/2018/02/crack-android-apps\">I have more experience cracking Android apps</a>), but it wasn't very hard to make sense of what was happening in this small application.\n\nMy approach was this:\n1. Trying out the application\n2. Disassembling the executable and get a feel for the flow\n3. Adding a breakpoint where I thought the password was checked\n4. Making sense of the strings in memory\n\n<pre class=\"prettyprint lang-bsh\">$ wget https://kalender.npst.no/p2w\n\n$ file p2w\np2w: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=758ae2fdb3384d82e1c697e0977354612bce94bf, not stripped\n\n$ chmod u+x p2w\n\n$ ./p2w\nPassord: npst\nFeil, pigg av!\n\n$ gdb ./p2w\nGNU gdb (Debian 7.12-6+b1) 7.12.0.20161007-git\n# [...]\nReading symbols from ./p2w...(no debugging symbols found)...done.\n\ngdb-peda$ r\nStarting program: /root/p2w \n# [...]\nPassord: test\nFeil, pigg av!\n[Inferior 1 (process 17124) exited normally]\nWarning: not running\n\ngdb-peda$ disas main\nDump of assembler code for function main:\n   0x00005555555547c0 <+0>:\tpush   rbp\n   0x00005555555547c1 <+1>:\tmov    rbp,rsp\n   0x00005555555547c4 <+4>:\tsub    rsp,0x90\n   0x00005555555547cb <+11>:\tmov    BYTE PTR [rbp-0x60],0xfd\n# [...]\n   0x00005555555558b1 <+4337>:\tcall   0x555555554650 <printf@plt>\n   0x00005555555558b6 <+4342>:\tmov    rdx,QWORD PTR [rip+0x200793]        # 0x555555756050 <stdin@@GLIBC_2.2.5>\n   0x00005555555558bd <+4349>:\tlea    rax,[rbp-0x30]\n   0x00005555555558c1 <+4353>:\tmov    esi,0x21\n   0x00005555555558c6 <+4358>:\tmov    rdi,rax\n   0x00005555555558c9 <+4361>:\tcall   0x555555554660 <fgets@plt>\n   0x00005555555558ce <+4366>:\tlea    rdx,[rbp-0x90]\n   0x00005555555558d5 <+4373>:\tlea    rax,[rbp-0x30]\n   0x00005555555558d9 <+4377>:\tmov    rsi,rdx\n   0x00005555555558dc <+4380>:\tmov    rdi,rax\n   0x00005555555558df <+4383>:\tcall   0x555555554670 <strcmp@plt>\n   0x00005555555558e4 <+4388>:\ttest   eax,eax\n   0x00005555555558e6 <+4390>:\tjne    0x5555555558f6 <main+4406>\n   0x00005555555558e8 <+4392>:\tlea    rax,[rbp-0x60]\n   0x00005555555558ec <+4396>:\tmov    rdi,rax\n   0x00005555555558ef <+4399>:\tcall   0x555555554640 <puts@plt>\n   0x00005555555558f4 <+4404>:\tjmp    0x555555555902 <main+4418>\n   0x00005555555558f6 <+4406>:\tlea    rdi,[rip+0xa1]        # 0x55555555599e\n   0x00005555555558fd <+4413>:\tcall   0x555555554640 <puts@plt>\n   0x0000555555555902 <+4418>:\tmov    eax,0x0\n   0x0000555555555907 <+4423>:\tleave  \n   0x0000555555555908 <+4424>:\tret    \nEnd of assembler dump.\n\ngdb-peda$ b *0x00005555555558b6\nBreakpoint 1 at 0x5555555558b6\n\ngdb-peda$ r\nStarting program: /root/p2w \n#[...]\n[----------------------------------registers-----------------------------------]\nRAX: 0x9 ('\t')\nRBX: 0x0 \nRCX: 0x0 \nRDX: 0x0 \nRSI: 0x20 (' ')\nRDI: 0x555555757269 --> 0x0 \nRBP: 0x7fffffffe200 --> 0x555555555910 (<__libc_csu_init>:\tpush   r15)\nRSP: 0x7fffffffe170 (\"625b2055fe2dcda72e418940599b881d\")\nRIP: 0x5555555558b6 (<main+4342>:\tmov    rdx,QWORD PTR [rip+0x200793]        # 0x555555756050 <stdin@@GLIBC_2.2.5>)\nR8 : 0x555555757260 (\"Passord: \")\nR9 : 0x9 ('\t')\nR10: 0x410 \nR11: 0x3f ('?')\nR12: 0x555555554690 (<_start>:\txor    ebp,ebp)\nR13: 0x7fffffffe2e0 --> 0x1 \nR14: 0x0 \nR15: 0x0\nEFLAGS: 0x202 (carry parity adjust zero sign trap INTERRUPT direction overflow)\n[-------------------------------------code-------------------------------------]\n   0x5555555558a5 <main+4325>:\tlea    rdi,[rip+0xe8]        # 0x555555555994\n   0x5555555558ac <main+4332>:\tmov    eax,0x0\n   0x5555555558b1 <main+4337>:\tcall   0x555555554650 <printf@plt>\n=> 0x5555555558b6 <main+4342>:\tmov    rdx,QWORD PTR [rip+0x200793]        # 0x555555756050 <stdin@@GLIBC_2.2.5>\n   0x5555555558bd <main+4349>:\tlea    rax,[rbp-0x30]\n   0x5555555558c1 <main+4353>:\tmov    esi,0x21\n   0x5555555558c6 <main+4358>:\tmov    rdi,rax\n   0x5555555558c9 <main+4361>:\tcall   0x555555554660 <fgets@plt>\n[------------------------------------stack-------------------------------------]\n0000| 0x7fffffffe170 (\"625b2055fe2dcda72e418940599b881d\")\n0008| 0x7fffffffe178 (\"fe2dcda72e418940599b881d\")\n0016| 0x7fffffffe180 (\"2e418940599b881d\")\n0024| 0x7fffffffe188 (\"599b881d\")\n0032| 0x7fffffffe190 --> 0x0 \n0040| 0x7fffffffe198 --> 0xf0b5ff \n0048| 0x7fffffffe1a0 (\"PST{f3ad88918fd18414cc773271f586f6a9}\")\n0056| 0x7fffffffe1a8 (\"88918fd18414cc773271f586f6a9}\")\n[------------------------------------------------------------------------------]\nLegend: code, data, rodata, value\n\nBreakpoint 1, 0x00005555555558b6 in main ()\ngdb-peda$ continue\nContinuing.\nPassord: 625b2055fe2dcda72e418940599b881d\nPST{f3ad88918fd18414cc773271f586f6a9}\n# [...]\n</pre>\nThe password for the program is <code>625b2055fe2dcda72e418940599b881d</code>. The is <code>PST{f3ad88918fd18414cc773271f586f6a9}</code> (MD5 hash of <code>rudolf2</code>).\n</span></div></li><li><div class=\"collapsible-header\">December 19th - Pen and paper encryption version 3 - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>A new version of the \"pen and paper\" encryption has been developed. The challenge is to check if all previous weaknesses are fixed. (Oh well, the real challenge is to break it and get the flag.) We are given some ciphertext and its plaintext: <code>PPKv3(\"Pompøst og metodisk\") → øMSijrt Mc SÅtMZPrU</code>\n\nThe ciphertext to break is this: <code>ømQ UæjEEi4æÅktÅr i4æÅktÅr SZG tWM tPSÅ i4Z i4æÅktÅr rE0tt UæjEEi4æÅktÅr rE0tt</code>\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#PPKv3\">Challenge</a>\n - <a href=\"https://kalender.npst.no/19/\">Daily brief</a>\n\n<h6>Solution</h6>It's best to just work with what we've got and map the known cipher and plain texts. That in addition to knowing a bit about typical formulations in these text we can build on that first iteration. Here's my script:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport string\n\nciphertext = 'ømQ UæjEEi4æÅktÅr i4æÅktÅr SZG tWM tPSÅ i4Z i4æÅktÅr rE0tt UæjEEi4æÅktÅr rE0tt'\ntranslation_map = {}\n\n\ndef update_translation_map(known_ciphertext, known_plaintext):\n    for i in range(len(known_ciphertext)):\n        translation_map[known_ciphertext[i]] = known_plaintext[i]\n\n\ndef decrypt(ciphertext):\n    plaintext = ''\n    for l in ciphertext:\n        if l in translation_map:\n            plaintext += translation_map[l]\n        else:\n            plaintext += '?'\n    return plaintext.replace(' krøllparentes slutt', '}').replace(' krøllparentes', '{').replace(' parentes slutt', ')').replace(' parentes ', '(')\n\n\n# The known plaintext from the challenge:\nupdate_translation_map('øMSijrt Mc SÅtMZPrU', 'Pompøst og metodisk')\n\n# Prints 'P?? k?ø??p??e?tes p??e?tes md? t?o time p?d p??e?tes s??tt k?ø??p??e?tes s??tt':\nprint(decrypt(ciphertext))\n\n# Assumptions after first iteration of decryption:\nupdate_translation_map('ømQ UæjEEi4æÅktÅr rE0tt G W', 'PST krøllparentes slutt 5 w')\n\n# Prints 'PST{(md5 two time pad)}'\nprint(decrypt(ciphertext))\n</pre>\nAnd since they mention two-time pad: This encryption would have been good if this was an <a href=\"https://en.wikipedia.org/wiki/Substitution_cipher#The_one-time_pad\">one-time pad</a>, but the key has been reused for at least two ciphertexts and the key is not random as the letters seem to use a simple substitution.\n\nThe text printed is <code>PST{(md5 two time pad)}</code>. That makes the flag <code>PST{4a0fc5f3c88874cab11c64e965dff58d}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 20th - Mysterious card - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>NPST has intercepted a postcard with source code that needs to be decoded. The card is marked with <code>360</code>.\n\nThe code we are given is this:\n<code>1020 2020 0010 2012 2001 2200 1020 0000 0800 0200 0001 200A 2001 2200 1020 0C00 0300 0008 0800 1012</code>\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Mystisk kort\">Challenge</a>\n - <a href=\"https://kalender.npst.no/20/\">Daily brief</a>\n\n<h6>Solution</h6>The text strongly hints about old hardware and <a href=\"https://en.wikipedia.org/wiki/Punched_card\">punch cards</a>. It doesn't take much investigation to figure out that the system in question is the <a href=\"https://en.wikipedia.org/wiki/IBM_System/360\">IBM System/360</a> dating all the way back to 1964. That system had the <a href=\"https://en.wikipedia.org/wiki/EBCDIC\">EBCDIC charset</a> which is an eight-bit character encoding. It descended from the code used with punched cards and corresponding six-bit binary-coded decimal code. Knowing that and looking at the relatively low hex numbers we can decode the hex into a good old punched card and see what it says.\n\nI found <a href=\"https://www.masswerk.at/keypunch/\">https://www.masswerk.at/keypunch/</a> to be a good source to learn more of the encoding of punch cards. It also lets you enter the hex numbers we have to translate, but there's a bug (or feature I don't understand) that makes the punched card not display the letters we need to solve the challenge.\n\nWhile I mostly did the mapping from holes to letters manually I have since also added a binary to alphabet mapping to the script I used for this challenge:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\n# Sources:\n# https://stackoverflow.com/a/52616459/467650\n# http://www.jwdp.com/colbin1.html\n# https://www.masswerk.at/keypunch/\n\ninput = '1020 2020 0010 2012 2001 2200 1020 0000 0800 0200 0001 200A 2001 2200 1020 0C00 0300 0008 0800 1012'\ncols_count = 80\nrows_count = 12\n\n\ndef get_row(row_num):\n    row = ''\n    for cols in card:\n        row += cols[row_num]\n    return row\n\n\nLETTERS = {\n    0b100000000000: '&',    0b010000000000: '-',    0b001000000000: '0',\n    0b000100000000: '1',    0b000010000000: '2',    0b000001000000: '3',\n    0b000000100000: '4',    0b000000010000: '5',    0b000000001000: '6',\n    0b000000000100: '7',    0b000000000010: '8',    0b000000000001: '9',\n    0b000000000000: ' ',    0b100100000000: 'A',    0b100010000000: 'B',\n    0b100001000000: 'C',    0b100000100000: 'D',    0b100000010000: 'E',\n    0b100000001000: 'F',    0b100000000100: 'G',    0b100000000010: 'H',\n    0b100000000001: 'I',    0b010100000000: 'J',    0b010010000000: 'K',\n    0b010001000000: 'L',    0b010000100000: 'M',    0b010000010000: 'N',\n    0b010000001000: 'O',    0b010000000100: 'P',    0b010000000010: 'Q',\n    0b010000000001: 'R',    0b001100000000: '/',    0b001010000000: 'S',\n    0b001001000000: 'T',    0b001000100000: 'U',    0b001000010000: 'V',\n    0b001000001000: 'W',    0b001000000100: 'X',    0b001000000010: 'Y',\n    0b001000000001: 'Z',    0b100010000010: '¢',    0b100001000010: '.',\n    0b100000100010: '<',    0b100000010010: '(',    0b100000001010: '+',\n    0b100000000110: '|',    0b010010000010: '!',    0b010001000010: '$',\n    0b010000100010: '*',    0b010000010010: ')',    0b010000001010: ';',\n    0b010000000110: '¬',    0b001001000010: ',',    0b001000100010: '%',\n    0b001000010010: '_',    0b001000001010: '>',    0b001000000110: '?',\n    0b000010000010: ':',    0b000001000010: '#',    0b000000100010: '@',\n    0b000000010010: '\\'',   0b000000001010: '=',    0b000000000110: '\"'\n}\n\n\ndef get_letter(b):\n    try:\n        return LETTERS[b]\n    except KeyError:\n        print('Missing letter for value %s. Returning [?].' % bin(int(b)))\n    return '?'\n\n\nletters = ''\n\ncard = [[' ' for x in range(rows_count)] for x in range(cols_count)]\nfor col_num, b in enumerate(int(b, 16) for b in input.split(' ')):\n    rows = card[col_num]\n    b = (b & 0b111111) | ((b >> 2) & 0b111111000000)  # Converting 8 bit bytes to 6 bits\n    for i in range(0, rows_count):\n        bit_offset = i  # if i < rows_count // 2 else i + 2\n        rows[i] = 'O' if b & (1 << bit_offset) else ' '\n    letters += get_letter(b)\n\nprint('       ________________________________________________________________')\nprint('      /%s' % letters)\nprint('12/Y | %s' % get_row(11))\nprint('11/X | %s' % get_row(10))\nprint(' 0   | %s' % get_row(9))\nprint(' 1   | %s' % get_row(8))\nprint(' 2   | %s' % get_row(7))\nprint(' 3   | %s' % get_row(6))\nprint(' 4   | %s' % get_row(5))\nprint(' 5   | %s' % get_row(4))\nprint(' 6   | %s' % get_row(3))\nprint(' 7   | %s' % get_row(2))\nprint(' 8   | %s' % get_row(1))\nprint(' 9   | %s' % get_row(0))\nprint('     |_________________________________________________________________')\n</pre>\nThere's one character that seems off in the challenge, so the output from the script is this:\n<pre class=\"prettyprint\">       ________________________________________________________________\n      /MD5(IBM 029+IBM/?60)\n12/Y |  O OOO     OOO                                                                  \n11/X | O     O       O    O                                                            \n 0   |         O      O  O                                                             \n 1   |                O                                                                \n 2   |      O   O   O  O                                                               \n 3   |                 O                                                               \n 4   | OO    O       O                                                                 \n 5   |   OO               O                                                            \n 6   |            O     O                                                              \n 7   |                                                                                 \n 8   |    O       O       O                                                            \n 9   |     O     O O                                                                   \n     |_________________________________________________________________</pre>\nBut I must admit that it looks a bit cooler by using the image generated by <a href=\"https://www.masswerk.at/keypunch/?b=bWQ1KElCTSAwMjkraWJtLzM2MCk=\">https://www.masswerk.at/keypunch/?b=bWQ1KElCTSAwMjkraWJtLzM2MCk=</a>:\n<img class=\"materialboxed responsive-img\" title=\"\" data-caption=\"\" alt=\"\" src=\"/images/pst303-punched_card.png\"/>\nWith the MD5 hash of the output the flag we need for this challenge is <code>PST{2d0330aeddd7a66612b328b06324e3b9}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 21st - New cryptosystem - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>SPST has got a new <a href=\"https://en.wikipedia.org/wiki/Cryptosystem\">cryptosystem</a> and NPST has intercepted a ciphertext that needs to be decoded.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Nytt kryptosystem\">Challenge</a>\n - <a href=\"https://kalender.npst.no/21/\">Daily brief</a>\n - <a href=\"https://kalender.npst.no/melding.json\">Message</a>\n\n<h6>Solution</h6>The challenge text hints about an encryption key that doesn't seem to work. They intercepted key is named <code>recovered_key</code> and there's a field called <code>uncertain_bits_count</code> with the value of <code>2</code>.\n\nTo decrypt the ciphertext we need to tweak two of the bits in the recovered key. Personally this was my first idea, but because of a bad <a href=\"https://en.wikipedia.org/wiki/%3F:#Python\">shorthand if</a> I spent too much time looking for bit changes in other parts of the intercepted data. The Python package <a href=\"https://pycryptodome.readthedocs.io/en/latest/src/cipher/aes.html\">PyCryptodome</a> offers support for the <a href=\"https://en.wikipedia.org/wiki/Advanced_Encryption_Standard\">AES</a>-256-<a href=\"https://en.wikipedia.org/wiki/Galois/Counter_Mode\">GCM</a> used in this challenge. With a few lines of code we can get the solution:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nfrom Crypto.Cipher import AES\nfrom time import time\n\nciphertext = bytearray.fromhex('69cf99390e143fbab3ea8326c05b2fde58c964555bd673de10ff4cf2bf49586454b0466afd01c36b0e4dc1e3361d8ffec8998d88c13b6ff83798a4607b86f3d14f20f63486d256e65d2164ac90a931d7c36fed071321298ce6eb4206bbc31dbdbd08d72dca0f5ce486e68979f083e0e4f46d1f0eee0fec2aa48de030cb2f2069eb719563443c324b052a913e5007f114de4ed7ae44044c03278e2392b46e7815626424d735196f93adc446c4a4a30373e936fa7164112d0867e63e63a4d809d10e90e805130eb7114422ae17fddd3a272cee6100087fb37eb0268ab187721fc7e8dc8b2b79e91a1d9e276a16bcb79c36a7c91b127ea3b08fe57a33ba7d0767e35508b4ab2127aa0a2948cd2a1aace305a49cf63d03a41ca110e9d04636a85956aa1b9eac89bc4091ab59bd1ea9d9cd1c225422a7a40ef56d4b65d1e56f138df24dcf74557a72ba055160f82bf39470f785b12633584ae9639a4352ef08fe5c7f788b0f83021ccf13d7a99a0c088abf72ccc36a30e2447ce10157113a56461bfafd68be40f6f79dbdf2c901028cfe06a96e5ab9a1121c7e2d8b91e495c9722b2cd97d378844328bfba9870b814df60282fec98f70d1639d35205d399d0a858a5cf7210cd9110faecc55c79ae7fe963d908aaa8a34d68b4c0556aeaa4db1ec74cd321b249602c24dabc961b30ae456199fb1deca09f36cdf8a5d9b0b492e42f7f841cb4627880f9fdd4b2e2d94a553c61c5c9a0a253a4616af93310eb7a55a74316d595c017cd2953e505d893f85f324a50fecd459e6bce60294aef9e34b7d57c98f4e9dc5e09a9a6fe620865308d807d767e4c9fec6041b58d003b152d18473e8ce5a9bfe5203b748945a8f4c4683177b09c6b97603d37451a6220c7cf94fa4cb2f8c26331e08f8b8035acebdeaba4cec24bbdacad448b332ba67d355a91363d13a4030a7f4e5b3e0d12a5cca08d6431e356a1bf5050c9bb6373a375a58909cb59d851c0da4905a62389aef2809e354fb2d6b672071ded673f50a3ca475b229999d5a8566e3d7742a271c91f97d8182cb6dcbd3811276cea2386e66b10f047f5cfd0628e3a55ed420412a4fd1b568ef4a62384694dc6b966defe4226afcc545ff10cd61c181d5df9ce6011995df72a219f45ac44eccc63450989df746edbc7165ae008caa158c9298e6c8f8907be02c89313ec55be8eef3521a251518e394071b9deb5af8d2273cf7fe2ed9ddc96609a8057ca50e5a5c1b0a9b9e4dfa04e58be60feee17632dd713257916416471560c82da72e49962d1bfcda8db174948765bfc51159e98d38cad9a7ba51a7c8658af998534a6b223d25ba4805c4a12bf0807e043abc0b47e4562a800b6f79fca703bbd93b1c617d3a8b9244ebfcaffd7f8e44440a20ce1ed7ab8039d5cf182c7c16e7be51856ac8a516ca25acf79001af3612d7b4d304c2a5b9671620b80db4fedca8df2ec6b57ddbcf4fe9ece3da44bf47e0f3b21b61f0699e6c38a3169b2890f57636757a894caf22879b1515d1aa00ee8131d3cf7b61ab9c747690bd6ef3d93ed002c1f3a8e9b7a6b056f76cad42d67ae3f01c1d8d4d8576b950efe65b6312b700f2000f8c3821a70ba1e4800b5bdb4223f9db27c509495eb638025c4dc898c13ae9f86c944e5428209a111701bc4e2db44a7c890774b0063e20158fd0d9cebf4f05d40c74afd168d0e8968b14a56c95b0a3b657cbe0ad270170e4154d596c112156c2a9a9fc30898be1f362ca2ce1fe4e4399ab8ea3735b8f091ada9d613411b54760b7c39c956f225bb9724bd4fd8174a4703151d1b5acf2c979f446d8a33036ec652add04478a44f34bab617f15ed40451cf7603ead7f8f58f8e2fc02ca7c75c7d37cbcd9f09811abd881ef16a15e6bb4e1fe37ff96fe03421286fe37f19120fc66a105fb2b1ee0cbd19feb4e9f20b02fc5d06f6b0d8bbf393da408e2f7e7cae536852b5f81690596e78b66ca1ec10af873a8acd62cb716bdb40107019e7f3acb4d11d3e50590c2ca485c0b4a47f0c28847ee0afaa617284e5ef1fcf9fc5ec00c6cc2404016a565e4154538f93d0adee6cdb72665efb4a319a98dd58dd81e52263516a006c037a27ad249ce0efd69e4f6a685a1b6404e95938325bb1b2db35984bc37c4e9751825aaa592089511344328c84e18a470b718e3a3fa7cd6f06cf2c2352d5e6895c734bf1c8d22eb9c2037378f0609211298f71fa633ed923f31c934b05ece2375bbf700f4fd30525a20a510b7f0102f24ff2b7eb76ac77d98bc')\nkey = bytearray.fromhex('800816b1629bcfa519f57a502a6a841298a9f5c20203d8818fdd18271a3b1682')\nkey_int = int(key.hex(), 16)\nnonce = bytearray.fromhex('d97c2e3410f37ac7b5dcd8df')\ntag = bytearray.fromhex('76fe172806c0b41816887630ca74f2f8')\n\ncount = 0\ntime_start = time()\nfor i in range(len(key) * 8):\n    for j in range(len(key) * 8):\n        try:\n            new_key_int = key_int\n            new_key_int = new_key_int ^ (1 << i)\n            count += 1\n            if i != j:  # Only switching second bit if not the same position as the first\n                count += 1\n                new_key_int = new_key_int ^ (1 << j)\n            new_key = bytearray.fromhex(hex(new_key_int)[2:])\n\n            cipher = AES.new(new_key, AES.MODE_GCM, nonce=nonce)\n            plaintext = cipher.decrypt_and_verify(ciphertext, tag)  # Throws ValueError ''MAC check failed' on wrong key\n            print('Plaintext:\\n', plaintext.decode('utf-8'))  # [...] PST{7e7343c9cbe6114f8fd312490816387d}\n            print('Key:', new_key.hex())  # 800816b1629bcfa519f57a502a6a841298a9e5c20243d8818fdd18271a3b1682\n            print('Bits flipped: %d & %d' % (i, j))  # 86 & 108\n            time_spent = round(time() - time_start)\n            # Prints something like 'Found key, decrypted ciphertext and verified plaintext in 12 seconds after flipping 44163 bits.':\n            print('Found key, decrypted ciphertext and verified plaintext in %d seconds after flipping %d bits.' % (time_spent, count))\n            exit(0)\n        except ValueError as e:\n            # Printing out something from time to time so we feel that something's happening:\n            if count % 500 == 0:\n                print(e, count, i, j)\n</pre>\nThe plaintext was as follows:\n<code style=\"font-size:60%;\"> ﻿SPST\n21.12.19\n\nKantinesituasjonen\nKantinen har nå landet avtale med ny råvareleverandør, og første leveranse blir idag. \nDet blir altså vintersolverv-torsk som planlagt.\n\nLekkasje fra SPSTs interne nettverk\nI forbindelse med angrepet mot stordatamaskinen som startet 12.12.19, ble det eksfiltrert en mindre mengde dokumenter gradert TEMMELIG HEMMELIG. Som en konsekvens av dette har vi fra idag tatt i bruk en ny krypteringsalgoritme for data i bevegelse. Vi har opplevd litt problemer med de dedikerte linjene for overføring av nøkkelmateriell, men leverandøren vår jobber på spreng for å fikse dette.\n\n\nYtterligere operasjoner mot NPST\n- Lørdag 14.12.19 fikk en av våre dyktige kildeføringspingviner informasjon om NPSTs planlagte julebord. Vi har ikke lykkes i å bekrefte informasjonen, men kilden forteller at det skal konkurreres i hammerdistanse\n- Tirsdag 17.12.19 ble det gjennomført en vellykket sabotasjeaksjon mot NPSTs matlager. Her ble passordet skiftet til rudolf2, og hashing-algoritme byttet ut med MD5. Det vurderes som MULIG at dette vil påvirke julen.\n- Onsdag 18.12.19 ble det som en HOAX/avledningsoperasjon plassert en helt vanlig ponni i reinsdyrstallen til Jule NISSEN. Dette vil trolig kunne påvirke julen ytterligere.\n\n\nUkens ansatt\nDenne ukens ansatt ønsker ikke å opptre med navn, men vi kan avsløre at pingvinen jobber ved SPSTs PINGINT-seksjon, og har gjort en utmerket jobb med kildene sine den siste tiden.\n\n\nTakk til alle for utmerket arbeid uka som har vært.\nSjef SPST, Keiserpingvinen\n\nFLAGG: PST{7e7343c9cbe6114f8fd312490816387d}\n</code>\nAs seen above, the flag is <code>PST{7e7343c9cbe6114f8fd312490816387d}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 22nd - Fake news - 10 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>SPST has got an ongoing news campaign called \"Cancel Chrimstas\". The challenge is to check out the campaign page and look for a flag.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#22. desember\">Challenge</a>\n - <a href=\"https://kalender.npst.no/22/\">Daily brief</a>\n - <a href=\"https://spst.no\">Campaign site</a>\n\n<h6>Solution</h6>Just as in real life you can find a lot of interesting stuff in <code><a href=\"https://blog.roysolberg.com/2018/06/robots-txt-linkifier\">robots.txt</a></code>. It's always worth checking out. And in <a href=\"https://spst.no/robots.txt\">https://spst.no/robots.txt</a> it's said that <a href=\"https://spst.no/temmelig-hemmelig/\">https://spst.no/temmelig-hemmelig/</a> shouldn't be visited by crawlers. That is where we get the flag for this challenge: <code>PST{fc35fdc70d5fc69d269883a822c7a53e}</code> (MD5 hash of <code>html</code>).\n</span></div></li><li><div class=\"collapsible-header\">December 22nd - Source code - 15 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge is to find the source code of the application to gain access to it.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#22. desember\">Challenge</a>\n - <a href=\"https://kalender.npst.no/22/\">Daily brief</a>\n - <a href=\"https://spst.no/temmelig-hemmelig/\">Secret part of campaign site</a>\n\n<h6>Solution</h6>The secret part of the campaign site that we found in the previous challenge has some kind of access key field that allows for input in the regex pattern <code>[ -.]+</code> It is seemingly used to retrieve some kind of message. Lucky for us the source code also hides a link to the Github repository for the site: <a href=\"https://github.com/SydpolarSikkerhetstjeneste/spst.no\">https://github.com/SydpolarSikkerhetstjeneste/spst.no</a>\n\nAgain we are pretty aligned with the real world as the developers at some point in time has made it easier to get access to this secret stuff and there's a password to be found in the commit history. The shortcut has been since been removed and it's stated that the regex we saw is morse code. The commit at <a href=\"https://github.com/SydpolarSikkerhetstjeneste/spst.no/commit/0fd327317a7fd9321ee4fab0a439bb040d67c581\">commit 0fd327317a7fd9321ee4fab0a439bb040d67c581</a> reveals that the password could be <code>pingvinerbestingenprotest</code> in morse code.\n\nThe password can be <a href=\"http://icyberchef.com/#recipe=To_Morse_Code('-/.','Space','Line feed')&input=cGluZ3ZpbmVyYmVzdGluZ2VucHJvdGVzdA\">converted via CyberChef</a> and entered. Sucess. We're given back a message to Pen Gwyn that includes an image. In the <a href=\"https://en.wikipedia.org/wiki/Alt_attribute\">alt attribute</a> there's a flag: <code>PST{f2e0e89f59722af1f388529720b9db03}</code>.\n</span></div></li><li><div class=\"collapsible-header\">December 22nd - &amp;nbsp; - 20 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>We're only told that SPST may have hidden information for hackers like us.\n\n<h6>Solution</h6>I did not like this one. It starts out pretty simple with a QR code hidden as text in the image. I found it using the tool at <a href=\"https://stylesuxx.github.io/steganography/\">https://stylesuxx.github.io/steganography/</a>. The QR code is given as this: \n<code style=\"font-size:10%;display:inline-block;line-height: 1;\">SSSSSSSSSSSSSSSSSSSSSSSSSSSS        SSSS                SSSS    SSSS    SSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS        SSSS                SSSS    SSSS    SSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS        SSSS                SSSS    SSSS    SSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS        SSSS                SSSS    SSSS    SSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                \nSSSS                    SSSS    SSSSSSSS    SSSSSSSS    SSSSSSSS                SSSS    SSSS                    SSSS                \nSSSS                    SSSS    SSSSSSSS    SSSSSSSS    SSSSSSSS                SSSS    SSSS                    SSSS                \nSSSS                    SSSS    SSSSSSSS    SSSSSSSS    SSSSSSSS                SSSS    SSSS                    SSSS                \nSSSS                    SSSS    SSSSSSSS    SSSSSSSS    SSSSSSSS                SSSS    SSSS                    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS        SSSSSSSSSSSS            SSSS        SSSS    SSSS    SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS        SSSSSSSSSSSS            SSSS        SSSS    SSSS    SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS        SSSSSSSSSSSS            SSSS        SSSS    SSSS    SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS        SSSSSSSSSSSS            SSSS        SSSS    SSSS    SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSS    SSSS                SSSSSSSSSSSS            SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSS    SSSS                SSSSSSSSSSSS            SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSS    SSSS                SSSSSSSSSSSS            SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSS    SSSS                SSSSSSSSSSSS            SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS            SSSS    SSSSSSSS        SSSS        SSSSSSSS    SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS            SSSS    SSSSSSSS        SSSS        SSSSSSSS    SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS            SSSS    SSSSSSSS        SSSS        SSSSSSSS    SSSS    SSSSSSSSSSSS    SSSS                \nSSSS    SSSSSSSSSSSS    SSSS            SSSS    SSSSSSSS        SSSS        SSSSSSSS    SSSS    SSSSSSSSSSSS    SSSS                \nSSSS                    SSSS    SSSS    SSSS        SSSSSSSSSSSS    SSSSSSSS            SSSS                    SSSS                \nSSSS                    SSSS    SSSS    SSSS        SSSSSSSSSSSS    SSSSSSSS            SSSS                    SSSS                \nSSSS                    SSSS    SSSS    SSSS        SSSSSSSSSSSS    SSSSSSSS            SSSS                    SSSS                \nSSSS                    SSSS    SSSS    SSSS        SSSSSSSSSSSS    SSSSSSSS            SSSS                    SSSS                \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                \n                                                SSSSSSSS    SSSSSSSS                                                                \n                                                SSSSSSSS    SSSSSSSS                                                                \n                                                SSSSSSSS    SSSSSSSS                                                                \n                                                SSSSSSSS    SSSSSSSS                                                                \nSSSSSSSSSSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSS    SSSS    SSSSSSSSSSSSSSSSSSSS    SSSSSSSS    SSSS    SSSS    SSSS                    \nSSSSSSSSSSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSS    SSSS    SSSSSSSSSSSSSSSSSSSS    SSSSSSSS    SSSS    SSSS    SSSS                    \nSSSSSSSSSSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSS    SSSS    SSSSSSSSSSSSSSSSSSSS    SSSSSSSS    SSSS    SSSS    SSSS                    \nSSSSSSSSSSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSS    SSSS    SSSSSSSSSSSSSSSSSSSS    SSSSSSSS    SSSS    SSSS    SSSS                    \n    SSSSSSSSSSSS    SSSS            SSSS                        SSSS        SSSS        SSSS    SSSS            SSSS                \n    SSSSSSSSSSSS    SSSS            SSSS                        SSSS        SSSS        SSSS    SSSS            SSSS                \n    SSSSSSSSSSSS    SSSS            SSSS                        SSSS        SSSS        SSSS    SSSS            SSSS                \n    SSSSSSSSSSSS    SSSS            SSSS                        SSSS        SSSS        SSSS    SSSS            SSSS                \n    SSSSSSSS    SSSSSSSSSSSS    SSSSSSSS    SSSSSSSS        SSSS    SSSSSSSS        SSSSSSSSSSSS        SSSSSSSS                    \n    SSSSSSSS    SSSSSSSSSSSS    SSSSSSSS    SSSSSSSS        SSSS    SSSSSSSS        SSSSSSSSSSSS        SSSSSSSS                    \n    SSSSSSSS    SSSSSSSSSSSS    SSSSSSSS    SSSSSSSS        SSSS    SSSSSSSS        SSSSSSSSSSSS        SSSSSSSS                    \n    SSSSSSSS    SSSSSSSSSSSS    SSSSSSSS    SSSSSSSS        SSSS    SSSSSSSS        SSSSSSSSSSSS        SSSSSSSS                    \n    SSSS    SSSS    SSSS            SSSSSSSSSSSS        SSSS    SSSS        SSSSSSSS        SSSSSSSSSSSS                            \n    SSSS    SSSS    SSSS            SSSSSSSSSSSS        SSSS    SSSS        SSSSSSSS        SSSSSSSSSSSS                            \n    SSSS    SSSS    SSSS            SSSSSSSSSSSS        SSSS    SSSS        SSSSSSSS        SSSSSSSSSSSS                            \n    SSSS    SSSS    SSSS            SSSSSSSSSSSS        SSSS    SSSS        SSSSSSSS        SSSSSSSSSSSS                            \n                    SSSSSSSSSSSS    SSSS    SSSS                    SSSS            SSSS    SSSS        SSSSSSSS                    \n                    SSSSSSSSSSSS    SSSS    SSSS                    SSSS            SSSS    SSSS        SSSSSSSS                    \n                    SSSSSSSSSSSS    SSSS    SSSS                    SSSS            SSSS    SSSS        SSSSSSSS                    \n                    SSSSSSSSSSSS    SSSS    SSSS                    SSSS            SSSS    SSSS        SSSSSSSS                    \nSSSSSSSSSSSSSSSSSSSSSSSS    SSSS        SSSS    SSSSSSSSSSSS            SSSSSSSSSSSS    SSSS    SSSS        SSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSS    SSSS        SSSS    SSSSSSSSSSSS            SSSSSSSSSSSS    SSSS    SSSS        SSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSS    SSSS        SSSS    SSSSSSSSSSSS            SSSSSSSSSSSS    SSSS    SSSS        SSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSS    SSSS        SSSS    SSSSSSSSSSSS            SSSSSSSSSSSS    SSSS    SSSS        SSSSSSSS                \n    SSSS    SSSS        SSSS        SSSSSSSS        SSSSSSSSSSSSSSSS                        SSSSSSSSSSSS                            \n    SSSS    SSSS        SSSS        SSSSSSSS        SSSSSSSSSSSSSSSS                        SSSSSSSSSSSS                            \n    SSSS    SSSS        SSSS        SSSSSSSS        SSSSSSSSSSSSSSSS                        SSSSSSSSSSSS                            \n    SSSS    SSSS        SSSS        SSSSSSSS        SSSSSSSSSSSSSSSS                        SSSSSSSSSSSS                            \nSSSSSSSSSSSS    SSSS            SSSSSSSS        SSSSSSSS    SSSSSSSS        SSSS        SSSS    SSSS        SSSS                    \nSSSSSSSSSSSS    SSSS            SSSSSSSS        SSSSSSSS    SSSSSSSS        SSSS        SSSS    SSSS        SSSS                    \nSSSSSSSSSSSS    SSSS            SSSSSSSS        SSSSSSSS    SSSSSSSS        SSSS        SSSS    SSSS        SSSS                    \nSSSSSSSSSSSS    SSSS            SSSSSSSS        SSSSSSSS    SSSSSSSS        SSSS        SSSS    SSSS        SSSS                    \nSSSSSSSSSSSS    SSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSSSSSS    SSSSSSSS        SSSS    SSSS    SSSSSSSSSSSSSSSS                \nSSSSSSSSSSSS    SSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSSSSSS    SSSSSSSS        SSSS    SSSS    SSSSSSSSSSSSSSSS                \nSSSSSSSSSSSS    SSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSSSSSS    SSSSSSSS        SSSS    SSSS    SSSSSSSSSSSSSSSS                \nSSSSSSSSSSSS    SSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSSSSSS    SSSSSSSS        SSSS    SSSS    SSSSSSSSSSSSSSSS                \nSSSSSSSS    SSSSSSSSSSSS    SSSS        SSSS                    SSSS        SSSSSSSS    SSSS    SSSS    SSSS    SSSS                \nSSSSSSSS    SSSSSSSSSSSS    SSSS        SSSS                    SSSS        SSSSSSSS    SSSS    SSSS    SSSS    SSSS                \nSSSSSSSS    SSSSSSSSSSSS    SSSS        SSSS                    SSSS        SSSSSSSS    SSSS    SSSS    SSSS    SSSS                \nSSSSSSSS    SSSSSSSSSSSS    SSSS        SSSS                    SSSS        SSSSSSSS    SSSS    SSSS    SSSS    SSSS                \nSSSS        SSSS        SSSS                SSSSSSSS        SSSS    SSSSSSSS                    SSSS        SSSS                    \nSSSS        SSSS        SSSS                SSSSSSSS        SSSS    SSSSSSSS                    SSSS        SSSS                    \nSSSS        SSSS        SSSS                SSSSSSSS        SSSS    SSSSSSSS                    SSSS        SSSS                    \nSSSS        SSSS        SSSS                SSSSSSSS        SSSS    SSSSSSSS                    SSSS        SSSS                    \nSSSS    SSSSSSSS    SSSS        SSSS        SSSS        SSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSSSSSS        SSSS                \nSSSS    SSSSSSSS    SSSS        SSSS        SSSS        SSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSSSSSS        SSSS                \nSSSS    SSSSSSSS    SSSS        SSSS        SSSS        SSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSSSSSS        SSSS                \nSSSS    SSSSSSSS    SSSS        SSSS        SSSS        SSSSSSSSSSSS    SSSS    SSSS    SSSS    SSSSSSSS        SSSS                \nSSSS    SSSS        SSSSSSSSSSSS    SSSS    SSSS            SSSSSSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSS    SSSS    SSSS                \nSSSS    SSSS        SSSSSSSSSSSS    SSSS    SSSS            SSSSSSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSS    SSSS    SSSS                \nSSSS    SSSS        SSSSSSSSSSSS    SSSS    SSSS            SSSSSSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSS    SSSS    SSSS                \nSSSS    SSSS        SSSSSSSSSSSS    SSSS    SSSS            SSSSSSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSS    SSSS    SSSS                \n                                SSSS    SSSS    SSSSSSSSSSSS                    SSSS            SSSSSSSS    SSSSSSSS                \n                                SSSS    SSSS    SSSSSSSSSSSS                    SSSS            SSSSSSSS    SSSSSSSS                \n                                SSSS    SSSS    SSSSSSSSSSSS                    SSSS            SSSSSSSS    SSSSSSSS                \n                                SSSS    SSSS    SSSSSSSSSSSS                    SSSS            SSSSSSSS    SSSSSSSS                \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSSSSSS            SSSSSSSSSSSSSSSS        SSSSSSSS    SSSS    SSSSSSSS    SSSS                    \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSSSSSS            SSSSSSSSSSSSSSSS        SSSSSSSS    SSSS    SSSSSSSS    SSSS                    \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSSSSSS            SSSSSSSSSSSSSSSS        SSSSSSSS    SSSS    SSSSSSSS    SSSS                    \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSSSSSS            SSSSSSSSSSSSSSSS        SSSSSSSS    SSSS    SSSSSSSS    SSSS                    \nSSSS                    SSSS                    SSSSSSSS    SSSS            SSSSSSSS            SSSS                                \nSSSS                    SSSS                    SSSSSSSS    SSSS            SSSSSSSS            SSSS                                \nSSSS                    SSSS                    SSSSSSSS    SSSS            SSSSSSSS            SSSS                                \nSSSS                    SSSS                    SSSSSSSS    SSSS            SSSSSSSS            SSSS                                \nSSSS    SSSSSSSSSSSS    SSSS    SSSS            SSSS    SSSS    SSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                        \nSSSS    SSSSSSSSSSSS    SSSS    SSSS            SSSS    SSSS    SSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                        \nSSSS    SSSSSSSSSSSS    SSSS    SSSS            SSSS    SSSS    SSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                        \nSSSS    SSSSSSSSSSSS    SSSS    SSSS            SSSS    SSSS    SSSSSSSSSSSS    SSSSSSSSSSSSSSSSSSSSSSSSSSSS                        \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSSSSSS                                SSSS            SSSS            SSSSSSSS                \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSSSSSS                                SSSS            SSSS            SSSSSSSS                \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSSSSSS                                SSSS            SSSS            SSSSSSSS                \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSSSSSS                                SSSS            SSSS            SSSSSSSS                \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSS    SSSSSSSS        SSSSSSSS            SSSSSSSSSSSS    SSSSSSSS    SSSS                    \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSS    SSSSSSSS        SSSSSSSS            SSSSSSSSSSSS    SSSSSSSS    SSSS                    \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSS    SSSSSSSS        SSSSSSSS            SSSSSSSSSSSS    SSSSSSSS    SSSS                    \nSSSS    SSSSSSSSSSSS    SSSS    SSSSSSSS    SSSSSSSS        SSSSSSSS            SSSSSSSSSSSS    SSSSSSSS    SSSS                    \nSSSS                    SSSS    SSSS        SSSS        SSSSSSSSSSSS    SSSSSSSSSSSS                        SSSS                    \nSSSS                    SSSS    SSSS        SSSS        SSSSSSSSSSSS    SSSSSSSSSSSS                        SSSS                    \nSSSS                    SSSS    SSSS        SSSS        SSSSSSSSSSSS    SSSSSSSSSSSS                        SSSS                    \nSSSS                    SSSS    SSSS        SSSS        SSSSSSSSSSSS    SSSSSSSSSSSS                        SSSS                    \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSSSSSS    SSSS            SSSS    SSSS            SSSS        SSSSSSSSSSSS                        \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSSSSSS    SSSS            SSSS    SSSS            SSSS        SSSSSSSSSSSS                        \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSSSSSS    SSSS            SSSS    SSSS            SSSS        SSSSSSSSSSSS                        \nSSSSSSSSSSSSSSSSSSSSSSSSSSSS    SSSSSSSS    SSSS            SSSS    SSSS            SSSS        SSSSSSSSSSSS                        \n</code>\n\nIt wasn't possible to have any of the QR code scanners I tried to read the QR code as it was. Maybe there are better ways to do it, but I changed the S characters with a square one (like e.g. ▢), scaled a screenshot of it a bit and inverted the colours. The text encoded is <code>/8a2a8e12017977d9dbf0ed33e254e94e.txt</code>.\n\nAt first sight <a href=\"https://spst.no/8a2a8e12017977d9dbf0ed33e254e94e.txt\">https://spst.no/8a2a8e12017977d9dbf0ed33e254e94e.txt</a> returns the same data as any other 404 pages at spst.no. But that isn't the case. It return status code 200 and many of the spaces are different <a href=\"https://en.wikipedia.org/wiki/Control_character\">control character</a> variants of space.\n\nI needed a hint figuring out what this was. Turns out you are supposed to throw away printable characters, split the remaining 888 bytes into triplets and use <a href=\"https://en.wikipedia.org/wiki/Quaternary_numeral_system\">base-4-numeral system</a> and traslate to ASCII.\n\nNote that my code doesn't figure out any of this, but has this info as a base. The code converts the bytes to base-4 and tries out the different combinations of converting the different byte combinations to the numbers 0-3.<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport string\nimport itertools\n\nwith open('8a2a8e12017977d9dbf0ed33e254e94e.txt') as file:\n    contents = file.read()\nprint(contents)\nb = bytes(contents, 'utf-8')\nprint('Length with printable chars:', len(b), 'bytes')  # 1337 bytes\n\n# First we remove all printable chars\nfor l in string.printable:\n    contents = contents.replace(l, '')\n\nb = bytes(contents, 'utf-8')\nprint('Length without printable chars:', len(b), 'bytes')  # 888 bytes\n\nb_set = set()\n\nfor i in range(0, len(b), 3):  # Runs through 3 and 3 bytes\n    b2 = b[i:i+3]\n    if not b2 in b_set:\n        b_set.add(b2)\n\nprint('Found', len(b_set), 'different 3-bytes variants:', b_set)\n\n\ndef count_chars(s, chars):\n    return sum(s.count(c) for c in chars)\n\n\nalphabet = string.ascii_letters + 'æøåÆØÅ .,{}' + string.whitespace + string.digits  # Assuming these should be most of the chars in the text\ndigits = string.digits[:len(b_set)]\nbest_score_text = None\nbest_score = 0\n\nfor permutation in itertools.permutations(digits):\n    output = ''\n    b_dict = {}\n    char_counter = 0\n    for i in range(0, len(b), 3):\n        b2 = b[i:i+3]\n        if not b2 in b_dict:\n            b_dict[b2] = permutation[char_counter]\n            char_counter += 1\n        output += b_dict[b2]\n    plaintext = ''\n    for i in range(0, len(output), 8):\n        plaintext += chr(int(output[i:i+8], 4))\n    score = count_chars(plaintext, alphabet)\n    if score >= best_score:\n        best_score = score\n        best_score_text = plaintext\n        # Prints stuff like 'Found new best alphabet [('0', '1', '3', '2')] giving the plaintext [PST{67b8601a11e47a9ee3bf08ddfd0b79ba}] (score: 37).'\n        print('Found new best alphabet [%s] giving the plaintext [%s] (score: %d).' % (permutation, best_score_text, best_score))\n</pre>\nThe flag printed is <code>PST{67b8601a11e47a9ee3bf08ddfd0b79ba}</code> (MD5 hash of <code>whitespace</code>).\n</span></div></li><li><div class=\"collapsible-header\">December 23rd - Mysterious Christmas card - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>Santa got a very special Christmas card in his electronic mailbox. The card has no flip side and therefore no text on it. The challenge is to decode it to find out who sent it or similar.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Mystisk julekort\">Challenge</a>\n - <a href=\"https://kalender.npst.no/23/\">Daily brief</a>\n - <a href=\"https://kalender.npst.no/30.png\">Christmas card</a>\n\n<h6>Hint #1</h6><i>The snail knows which pixels contain data.</i>\n\n<h6>Hint #2</h6><i>When the challenge was made two decisions were made; the contents of the file and the filename. The filename is mostly relevant deep inside a rabbit hole, or should we say snail hole?</i>\n\n<h6>Hint #3</h6><i>Everything happens in bitplan 0. The snail makes plan drawings for three separate snail shells, R, G, B, with the base in the neighbourhood in first line plus the rule of the snail.\n\nYou have to traverse the snail's plan drawings. Start on row 1 pixel 0 and go through plain drawings R, G, B, then row 1 pixel 1, R-G-B. Every time you find a 1-bit in the snail's plan drawings you pick a bit from the same place in the picture so that there are room for the snail shells.</i>\n\n<h6>Solution</h6>During December it became clear that if no one had submitted a flag within 1 hour it was a tricky challenge. No one solved this one until all three hints were published.\n\nI never got around to solving this. Even though the hints are getting more and more clear I think I would have needed one or two more to solve this without spending a lot of time.\n\nI'd recommend checking out the solution at <a href=\"https://github.com/nordbo/writeups/blob/master/npst/23/solve.py\">https://github.com/nordbo/writeups/blob/master/npst/23/solve.py</a>. The few lines of Python almost makes it look easy to solve it. 🙂 The filename <code>30.png</code> hints to <a href=\"https://en.wikipedia.org/wiki/Rule_30\">Rule 30</a>.\n</span></div></li><li><div class=\"collapsible-header\">December 23rd - Fragmented conversation - 5 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The work done in the challenge day 21 made is possible to intercept a conversation between two senior SPST agents. Seemingly there's a code being transmitted - a code that may be used to find some kind of article. The name of the article is of interest. The challenge is to decode the data, get the code and get the title of the article in question.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#Fragmentert samtale\">Challenge</a>\n - <a href=\"https://kalender.npst.no/23/\">Daily brief</a>\n - <a href=\"https://kalender.npst.no/finn_koden.zip\">PCAP file</a>\n\n<h6>Solution</h6>For the first time in this calendar it was possible to do challenge 2 before 1 was solved. After reading challenge 1. I took the opportunity to focus on this while everyone else was doing the first.\n\nWhen I opened the PCAP file and only saw UDP packages (audio data I suppose) I turned to the daily brief again and re-read the text. Everything was full of hints of a <a href=\"https://www.finn.no/\">finn.no</a> code. PST likes to hint about their job ads, so relativly quickly I realized that we were looking for the title of a job ad at finn.no.\n\nLooking at PST's open jobs at finn.no there was in particular one that was kind of related to this: <a href=\"http://finn.no/165890971\">finn.no/165890971</a>\n\nThe title of the job opening was <i>Nettverksspesialist</i>. In the specified flag format that was <code>PST{0844d949169d24679a1f0438f89c69e3}</code>.\n\nThis was the only challenge I was the first one to solve. <em>I haven't had the time to look at the PCAP data yet. I will try to do that soon, and if not I'll publish someone else's solution. :)</em>\n</span></div></li><li><div class=\"collapsible-header\">December 24th - Operation \"Cancel Christmas\" - 24 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge is to stop SPST's operation <i>\"Cancel Christmas\"</i>. Sources say that it's run at their online operations centre available from all over the world.\n\n<h6>Links</h6> - <a href=\"https://intranett.npst.no/challenges#24. desember\">Challenge</a>\n - <a href=\"https://kalender.npst.no/24/\">Daily brief</a>\n\n<h6>Solution</h6><b>Step 1 - locating the operation centre</b>\nThe only clue we've got is that we are looking for someting online. Maybe a quick subdomain scanner will do. I downloaded a <a href=\"https://github.com/rbsec/dnscan/blob/master/subdomains.txt\">random list of subdomains</a> and created a simple script for scanning:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nimport requests\n\nfile = open(\"subdomains.txt\")\ncontent = file.read()\nsubdomains = content.splitlines()\ndomain = 'spst.no'\n\nfor subdomain in subdomains:\n    url = f\"http://{subdomain}.{domain}\"\n    try:\n        requests.get(url)\n    except requests.ConnectionError:\n        pass\n    else:\n        print(\"[+] Discovered subdomain:\", url)\n\n\"\"\"\n[+] Discovered subdomain: http://api.spst.no\n[+] Discovered subdomain: http://ops.spst.no\n[+] Discovered subdomain: http://www.spst.no\n\"\"\"\n</pre>\nVoilà, we've found the operation centre at <a href=\"http://ops.spst.no\">ops.spst.no</a>.\n\n<b>Step 2 - Deciphering Enigma ciphertext</b>\nThe moment the cancel button for the operation is clicked the server spits out this: <code style=\"font-size:60%;\">SAXVC OIWPT GQOJZ OXEHI ZVCWU NCCOW FIKVP NOENT CETAU IKPCM ZLOYP BJHEC KPEXG RJWDO DJBBI HQDTG FFBQV LJAZC ZOFIC ZAIWJ QEVCL FXAVC PDUWT GBIGM SSWAO OXJHP PLKXH TGQAY COIQL ZSWIL HKMYR YMPZZ PTIEL PSRIP YVRKC DINBR WJZJP HHNXM HGYWN XXIGB UTTOX AEPKZ TUCMC MGFHC WHSAY KFVVS PDBFE KABAB PNBVR IZGTX PERJZ GDHQJ JDUYV FAOYV JWZOU WXXPR HVDLL BQTJI HULQP ACIXG NUPUS PCKHT LOKLN ZCLZO QVWSL HPBWD ATZES JEITM AJIFU SIVVF PHPEN UYHZK AWIZY MNQLH ZVKJJ EEYSZ LLUEM NZAFA OZXYL WBRPX JUKQG KIEXX CDYAT IHVJK HOMGI UVAOQ PBXRN HAAWG XOBAZ UILJB KYSBP IOBKH GYZBD IPQNG VSUTS YXOGY KEIKK TIKKQ RFVWQ NBCEK TIJLC CXRDB TUNXT SBKWR YDBR</code>\n\nFinally there's a chance to use the clues that have been collected throughout the calendar: <code>notater.png</code> (Dec 1st), Pen Gwen's Strava profile picture (Dec 8th), <code>huskelapp.png</code> (Dec 15th) and <code>95728ce2159815f2e2a253c664b2493f.png</code> (Dec 22nd)\n\nNot surprisingly these are all pieces for an <a href=\"https://en.wikipedia.org/wiki/Cryptanalysis_of_the_Enigma\">Enigma cipher</a>. If we just <a href=\"https://gchq.github.io/CyberChef/#recipe=Enigma('3-rotor','LEYJVCNIXWPBQMDRTAKZGFUHOS','A','A','ESOVPZJAYQUIRHXLNFTGKDCMWB<K','P','S','NZJHGRCXMYSWBOUFAIVLPEKQDT<AN','T','F','NZJHGRCXMYSWBOUFAIVLPEKQDT<AN','T','W','AY BR CU DH EQ FS GL IP JX KN MO TZ VW','CO NG RA TS',true)&input=U0FYVkMgT0lXUFQgR1FPSlogT1hFSEkgWlZDV1UgTkNDT1cgRklLVlAgTk9FTlQgQ0VUQVUgSUtQQ00gWkxPWVAgQkpIRUMgS1BFWEcgUkpXRE8gREpCQkkgSFFEVEcgRkZCUVYgTEpBWkMgWk9GSUMgWkFJV0ogUUVWQ0wgRlhBVkMgUERVV1QgR0JJR00gU1NXQU8gT1hKSFAgUExLWEggVEdRQVkgQ09JUUwgWlNXSUwgSEtNWVIgWU1QWlogUFRJRUwgUFNSSVAgWVZSS0MgRElOQlIgV0paSlAgSEhOWE0gSEdZV04gWFhJR0IgVVRUT1ggQUVQS1ogVFVDTUMgTUdGSEMgV0hTQVkgS0ZWVlMgUERCRkUgS0FCQUIgUE5CVlIgSVpHVFggUEVSSlogR0RIUUogSkRVWVYgRkFPWVYgSldaT1UgV1hYUFIgSFZETEwgQlFUSkkgSFVMUVAgQUNJWEcgTlVQVVMgUENLSFQgTE9LTE4gWkNMWk8gUVZXU0wgSFBCV0QgQVRaRVMgSkVJVE0gQUpJRlUgU0lWVkYgUEhQRU4gVVlIWksgQVdJWlkgTU5RTEggWlZLSkogRUVZU1ogTExVRU0gTlpBRkEgT1pYWUwgV0JSUFggSlVLUUcgS0lFWFggQ0RZQVQgSUhWSksgSE9NR0kgVVZBT1EgUEJYUk4gSEFBV0cgWE9CQVogVUlMSkIgS1lTQlAgSU9CS0ggR1laQkQgSVBRTkcgVlNVVFMgWVhPR1kgS0VJS0sgVElLS1EgUkZWV1EgTkJDRUsgVElKTEMgQ1hSREIgVFVOWFQgU0JLV1IgWURCUg\">input everything into CyberChef</a> we get the following plaintext: <code style=\"font-size:60%;\">FIVEZ EROSI XNINE SIXSE VENSI XSEVE NTWOZ EROSI XONES EVENS IXTWO ONEZE ROAFO URNIN ESIXE SIXSE VENSI XFIVE SIXET WOZER OSIXT WOSIX FSIXB SEVEN THREE SEVEN FOURS IXONE SEVEN SIXSI XBSIX ASIXF IVESI XBSEV ENTHR EETWO EZERO AFOUR CSIXF IVESE VENFO URTWO ZEROS IXNIN ETWOZ EROSI XEIGH TSIXF IVESE VENEI GHTTW OZERO SEVEN ZEROC THREE AFIVE TWOZE ROSIX SIXCT HREEB EIGHT SIXCS IXSEV ENSIX FIVES IXESI XFOUR SIXFI VETWO ZEROS EVENT WOSIX FIVES IXSEV ENSIX FIVES EVENE IGHTT HREEA TWOZE ROFIV EBFIV ECSIX FOURS IXONE TWODS IXSIX FIVED SEVEN BTHRE ETWOS EVEND FIVEC TWOES EVENT HREES EVENZ EROSE VENTH REESE VENFO URFIV ECTWO ESIXE SIXF</code>\n\n<b>Step 3 - Decoding Enigma plaintext</b>\nThe output from Enigma deciphering is partly readable with English numbers. If we replace them we'll get a long hexadecimal string. Let's check out what that is in UTF-8:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\nplaintext = 'FIVEZ EROSI XNINE SIXSE VENSI XSEVE NTWOZ EROSI XONES EVENS IXTWO ONEZE ROAFO URNIN ESIXE SIXSE VENSI XFIVE SIXET WOZER OSIXT WOSIX FSIXB SEVEN THREE SEVEN FOURS IXONE SEVEN SIXSI XBSIX ASIXF IVESI XBSEV ENTHR EETWO EZERO AFOUR CSIXF IVESE VENFO URTWO ZEROS IXNIN ETWOZ EROSI XEIGH TSIXF IVESE VENEI GHTTW OZERO SEVEN ZEROC THREE AFIVE TWOZE ROSIX SIXCT HREEB EIGHT SIXCS IXSEV ENSIX FIVES IXESI XFOUR SIXFI VETWO ZEROS EVENT WOSIX FIVES IXSEV ENSIX FIVES EVENE IGHTT HREEA TWOZE ROFIV EBFIV ECSIX FOURS IXONE TWODS IXSIX FIVED SEVEN BTHRE ETWOS EVEND FIVEC TWOES EVENT HREES EVENZ EROSE VENTH REESE VENFO URFIV ECTWO ESIXE SIXF'\nplaintext = plaintext.replace(' ', '')\nplaintext = plaintext.replace('ZERO', '0')\nplaintext = plaintext.replace('ONE', '1')\nplaintext = plaintext.replace('TWO', '2')\nplaintext = plaintext.replace('THREE', '3')\nplaintext = plaintext.replace('FOUR', '4')\nplaintext = plaintext.replace('FIVE', '5')\nplaintext = plaintext.replace('SIX', '6')\nplaintext = plaintext.replace('SEVEN', '7')\nplaintext = plaintext.replace('EIGHT', '8')\nplaintext = plaintext.replace('NINE', '9')\nprint(plaintext)\n\nplaintext = bytes.fromhex(plaintext).decode('utf-8')\nprint('Plaintext:\\n%s' % plaintext)\n\n\"\"\"\nPlaintext:\nPigg av!\nIngen bokstavkjeks.\nLet i hex på følgende regex: [\\da-f]{2}\\.spst\\.no\n\"\"\"\n</pre>\n\nNo luck cancelling the operation. We're missing a \"letter cookie\" and they want us to look   in <code>[da-f]{2}.spst.no</code>.\n\n<b>Step 4 - DNS records</b>\nI spent so much time looking for servers in the range <code>[\\da-f]{2}\\.spst\\.no</code> and all other variants I could think of. That was time wasted. Even though I earlier looked at the DNS records of spst.no I didn't think of looking for DNS records for these non-existing servers. At this step we want to look at the <code><a href=\"https://en.wikipedia.org/wiki/TXT_record\">TXT</a></code> and <code><a href=\"https://en.wikipedia.org/wiki/CNAME_record\">CNAME</a></code> DNS records.\n\nI tried using a Python library for scripting the DNS queries, but I got inconsistent answers every single time for the TXT records. <a href=\"https://digwebinterface.com/\">https://digwebinterface.com</a> proved å much better source for getting out the data.\n\nWhat's interesting about the TXT records is that each domain had one record with one character. The CNAME mapped every domain to one of the other 255 domain names - except one that pointed to <code>slutt.spst.no</code> (slutt=end). The CNAME records determined the order of the characters in the TXT records. A simple script can be used to get the string we want:<pre class=\"prettyprint lang-py\">#!/usr/bin/python3\npointers = {'00.spst.no': 'cf.spst.no', '01.spst.no': '91.spst.no', '02.spst.no': '42.spst.no', '03.spst.no': '45.spst.no', '04.spst.no': '48.spst.no', '05.spst.no': '17.spst.no', '06.spst.no': '11.spst.no', '07.spst.no': '93.spst.no', '08.spst.no': '20.spst.no', '09.spst.no': '75.spst.no', '0a.spst.no': 'a4.spst.no', '0b.spst.no': 'fe.spst.no', '0c.spst.no': '41.spst.no', '0d.spst.no': '13.spst.no', '0e.spst.no': 'c9.spst.no', '0f.spst.no': '53.spst.no', '10.spst.no': '47.spst.no', '11.spst.no': 'b7.spst.no', '12.spst.no': '63.spst.no', '13.spst.no': 'c2.spst.no', '14.spst.no': '27.spst.no', '15.spst.no': 'a1.spst.no', '16.spst.no': '38.spst.no', '17.spst.no': 'e3.spst.no', '18.spst.no': 'bd.spst.no', '19.spst.no': '5d.spst.no', '1a.spst.no': '2f.spst.no', '1b.spst.no': '05.spst.no', '1c.spst.no': '0d.spst.no', '1d.spst.no': '83.spst.no', '1e.spst.no': '78.spst.no', '1f.spst.no': '74.spst.no', '20.spst.no': '4b.spst.no', '21.spst.no': 'c4.spst.no', '22.spst.no': '10.spst.no', '23.spst.no': '16.spst.no', '24.spst.no': '33.spst.no', '25.spst.no': 'e2.spst.no', '26.spst.no': 'eb.spst.no', '27.spst.no': 'e5.spst.no', '28.spst.no': '6f.spst.no', '29.spst.no': '79.spst.no', '2a.spst.no': 'c6.spst.no', '2b.spst.no': 'd7.spst.no', '2c.spst.no': 'e6.spst.no', '2d.spst.no': 'b1.spst.no', '2e.spst.no': 'ea.spst.no', '2f.spst.no': 'df.spst.no', '30.spst.no': 'e1.spst.no', '31.spst.no': 'fc.spst.no', '32.spst.no': 'f0.spst.no', '33.spst.no': '52.spst.no', '34.spst.no': 'f9.spst.no', '35.spst.no': 'd4.spst.no', '36.spst.no': '1e.spst.no', '37.spst.no': 'd0.spst.no', '38.spst.no': 'f2.spst.no', '39.spst.no': '61.spst.no', '3a.spst.no': '09.spst.no', '3b.spst.no': '88.spst.no', '3c.spst.no': '71.spst.no', '3d.spst.no': 'bf.spst.no', '3e.spst.no': '43.spst.no', '3f.spst.no': '9c.spst.no', '40.spst.no': '28.spst.no', '41.spst.no': '24.spst.no', '42.spst.no': '3a.spst.no', '43.spst.no': 'ce.spst.no', '44.spst.no': '23.spst.no', '45.spst.no': '81.spst.no', '46.spst.no': 'aa.spst.no', '47.spst.no': 'cb.spst.no', '48.spst.no': '19.spst.no', '49.spst.no': 'c7.spst.no', '4a.spst.no': '04.spst.no', '4b.spst.no': 'dd.spst.no', '4c.spst.no': '12.spst.no', '4d.spst.no': '0a.spst.no', '4e.spst.no': '7e.spst.no', '4f.spst.no': '0b.spst.no', '50.spst.no': '9e.spst.no', '51.spst.no': '22.spst.no', '52.spst.no': '57.spst.no', '53.spst.no': 'a6.spst.no', '54.spst.no': 'ab.spst.no', '55.spst.no': '2a.spst.no', '56.spst.no': 'bc.spst.no', '57.spst.no': '5b.spst.no', '58.spst.no': '0f.spst.no', '59.spst.no': 'ba.spst.no', '5a.spst.no': 'ed.spst.no', '5b.spst.no': 'b3.spst.no', '5c.spst.no': '8c.spst.no', '5d.spst.no': '34.spst.no', '5e.spst.no': '4d.spst.no', '5f.spst.no': 'a0.spst.no', '60.spst.no': '76.spst.no', '61.spst.no': 'c5.spst.no', '62.spst.no': '01.spst.no', '63.spst.no': '0c.spst.no', '64.spst.no': '06.spst.no', '65.spst.no': 'd3.spst.no', '66.spst.no': '25.spst.no', '67.spst.no': '69.spst.no', '68.spst.no': '49.spst.no', '69.spst.no': '3b.spst.no', '6a.spst.no': 'ec.spst.no', '6b.spst.no': 'ef.spst.no', '6c.spst.no': 'c3.spst.no', '6d.spst.no': '32.spst.no', '6e.spst.no': 'f3.spst.no', '6f.spst.no': 'd5.spst.no', '70.spst.no': '37.spst.no', '71.spst.no': 'f7.spst.no', '72.spst.no': '62.spst.no', '73.spst.no': '31.spst.no', '74.spst.no': '4a.spst.no', '75.spst.no': '60.spst.no', '76.spst.no': '07.spst.no', '77.spst.no': 'd9.spst.no', '78.spst.no': 'e4.spst.no', '79.spst.no': '1d.spst.no', '7a.spst.no': 'f6.spst.no', '7b.spst.no': 'b6.spst.no', '7c.spst.no': 'e0.spst.no', '7d.spst.no': '65.spst.no', '7e.spst.no': '6b.spst.no', '7f.spst.no': '3e.spst.no',\n            '80.spst.no': 'b4.spst.no', '81.spst.no': '9b.spst.no', '82.spst.no': 'ae.spst.no', '83.spst.no': '5e.spst.no', '84.spst.no': '73.spst.no', '85.spst.no': '99.spst.no', '86.spst.no': 'de.spst.no', '87.spst.no': 'c1.spst.no', '88.spst.no': 'e7.spst.no', '89.spst.no': '6d.spst.no', '8a.spst.no': '2e.spst.no', '8b.spst.no': '44.spst.no', '8c.spst.no': '7a.spst.no', '8d.spst.no': '15.spst.no', '8e.spst.no': '55.spst.no', '8f.spst.no': '21.spst.no', '90.spst.no': '6e.spst.no', '91.spst.no': '1a.spst.no', '92.spst.no': 'e9.spst.no', '93.spst.no': '3f.spst.no', '94.spst.no': 'db.spst.no', '95.spst.no': '5f.spst.no', '96.spst.no': 'ee.spst.no', '97.spst.no': '96.spst.no', '98.spst.no': '7c.spst.no', '99.spst.no': '39.spst.no', '9a.spst.no': '95.spst.no', '9b.spst.no': '1c.spst.no', '9c.spst.no': '4f.spst.no', '9d.spst.no': 'fa.spst.no', '9e.spst.no': '8e.spst.no', '9f.spst.no': '87.spst.no', 'a0.spst.no': '26.spst.no', 'a1.spst.no': 'cd.spst.no', 'a2.spst.no': '35.spst.no', 'a3.spst.no': '0e.spst.no', 'a4.spst.no': '5c.spst.no', 'a5.spst.no': 'd8.spst.no', 'a6.spst.no': 'b2.spst.no', 'a7.spst.no': 'bb.spst.no', 'a8.spst.no': '3c.spst.no', 'a9.spst.no': 'b5.spst.no', 'aa.spst.no': '67.spst.no', 'ab.spst.no': 'a9.spst.no', 'ac.spst.no': '70.spst.no', 'ad.spst.no': '8f.spst.no', 'ae.spst.no': '85.spst.no', 'af.spst.no': 'ca.spst.no', 'b0.spst.no': '8a.spst.no', 'b1.spst.no': '6a.spst.no', 'b2.spst.no': 'd2.spst.no', 'b3.spst.no': '50.spst.no', 'b4.spst.no': '2b.spst.no', 'b5.spst.no': '51.spst.no', 'b6.spst.no': '6c.spst.no', 'b7.spst.no': '59.spst.no', 'b8.spst.no': '98.spst.no', 'b9.spst.no': '02.spst.no', 'ba.spst.no': '40.spst.no', 'bb.spst.no': 'c0.spst.no', 'bc.spst.no': 'b8.spst.no', 'bd.spst.no': '2c.spst.no', 'be.spst.no': '8d.spst.no', 'bf.spst.no': '8b.spst.no', 'c0.spst.no': '86.spst.no', 'c1.spst.no': '46.spst.no', 'c2.spst.no': '90.spst.no', 'c3.spst.no': 'a3.spst.no', 'c4.spst.no': '14.spst.no', 'c5.spst.no': '94.spst.no', 'c6.spst.no': 'a8.spst.no', 'c7.spst.no': 'fd.spst.no', 'c8.spst.no': '64.spst.no', 'c9.spst.no': 'ac.spst.no', 'ca.spst.no': 'b0.spst.no', 'cb.spst.no': '30.spst.no', 'cc.spst.no': 'd1.spst.no', 'cd.spst.no': 'a5.spst.no', 'ce.spst.no': '68.spst.no', 'cf.spst.no': '3d.spst.no', 'd0.spst.no': 'f8.spst.no', 'd1.spst.no': 'da.spst.no', 'd2.spst.no': '2d.spst.no', 'd3.spst.no': '1b.spst.no', 'd4.spst.no': '56.spst.no', 'd5.spst.no': '58.spst.no', 'd6.spst.no': 'dc.spst.no', 'd7.spst.no': '72.spst.no', 'd8.spst.no': '08.spst.no', 'd9.spst.no': '36.spst.no', 'da.spst.no': '54.spst.no', 'db.spst.no': '80.spst.no', 'dc.spst.no': '7b.spst.no', 'dd.spst.no': '18.spst.no', 'de.spst.no': '00.spst.no', 'df.spst.no': '29.spst.no', 'e0.spst.no': 'fb.spst.no', 'e1.spst.no': '97.spst.no', 'e2.spst.no': 'b9.spst.no', 'e3.spst.no': '9a.spst.no', 'e4.spst.no': '03.spst.no', 'e5.spst.no': '4e.spst.no', 'e6.spst.no': '4c.spst.no', 'e7.spst.no': 'a7.spst.no', 'e8.spst.no': '92.spst.no', 'e9.spst.no': '77.spst.no', 'ea.spst.no': '82.spst.no', 'eb.spst.no': '66.spst.no', 'ec.spst.no': '7d.spst.no', 'ed.spst.no': 'slutt.spst.no', 'ee.spst.no': 'c8.spst.no', 'ef.spst.no': 'af.spst.no', 'f0.spst.no': '5a.spst.no', 'f1.spst.no': '7f.spst.no', 'f2.spst.no': 'cc.spst.no', 'f3.spst.no': '89.spst.no', 'f4.spst.no': 'd6.spst.no', 'f5.spst.no': 'ad.spst.no', 'f6.spst.no': '84.spst.no', 'f7.spst.no': '9d.spst.no', 'f8.spst.no': 'ff.spst.no', 'f9.spst.no': 'be.spst.no', 'fa.spst.no': 'f4.spst.no', 'fb.spst.no': '9f.spst.no', 'fc.spst.no': '1f.spst.no', 'fd.spst.no': 'a2.spst.no', 'fe.spst.no': 'e8.spst.no', 'ff.spst.no': 'f1.spst.no'}\nletters = {'00.spst.no': 'c', '01.spst.no': 'e', '02.spst.no': 'W', '03.spst.no': '3', '04.spst.no': '0', '05.spst.no': 'l', '06.spst.no': '4', '07.spst.no': 'k', '08.spst.no': 'J', '09.spst.no': '1', '0a.spst.no': 'w', '0b.spst.no': 'G', '0c.spst.no': '6', '0d.spst.no': 'L', '0e.spst.no': 'H', '0f.spst.no': 'A', '10.spst.no': 'Z', '11.spst.no': 'T', '12.spst.no': 'w', '13.spst.no': 'k', '14.spst.no': 'a', '15.spst.no': '0', '16.spst.no': 'b', '17.spst.no': 'R', '18.spst.no': 'z', '19.spst.no': 'x', '1a.spst.no': 'X', '1b.spst.no': 'B', '1c.spst.no': 'X', '1d.spst.no': '2', '1e.spst.no': '7', '1f.spst.no': 'L', '20.spst.no': '7', '21.spst.no': 's', '22.spst.no': 'M', '23.spst.no': 'H', '24.spst.no': 'p', '25.spst.no': 'I', '26.spst.no': 'r', '27.spst.no': 'v', '28.spst.no': 'o', '29.spst.no': 'Y', '2a.spst.no': 'V', '2b.spst.no': '4', '2c.spst.no': 'e', '2d.spst.no': '2', '2e.spst.no': '9', '2f.spst.no': 'R', '30.spst.no': 'P', '31.spst.no': 'W', '32.spst.no': 'B', '33.spst.no': 'b', '34.spst.no': 'F', '35.spst.no': 'T', '36.spst.no': 'P', '37.spst.no': 'Y', '38.spst.no': 'R', '39.spst.no': 'b', '3a.spst.no': 'P', '3b.spst.no': 'W', '3c.spst.no': 'y', '3d.spst.no': 'z', '3e.spst.no': 'T', '3f.spst.no': 'r', '40.spst.no': 't', '41.spst.no': '0', '42.spst.no': '5', '43.spst.no': 'A', '44.spst.no': 'B', '45.spst.no': 'p', '46.spst.no': 'V', '47.spst.no': 'L', '48.spst.no': 'n', '49.spst.no': '3', '4a.spst.no': 'F', '4b.spst.no': 'Z', '4c.spst.no': 'n', '4d.spst.no': '7', '4e.spst.no': 'e', '4f.spst.no': 'g', '50.spst.no': 'c', '51.spst.no': 'p', '52.spst.no': 'S', '53.spst.no': '0', '54.spst.no': 'C', '55.spst.no': 'b', '56.spst.no': 'E', '57.spst.no': 'K', '58.spst.no': 'u', '59.spst.no': '9', '5a.spst.no': 'h', '5b.spst.no': 'L', '5c.spst.no': '6', '5d.spst.no': 'e', '5e.spst.no': 'U', '5f.spst.no': 'Z', '60.spst.no': '1', '61.spst.no': '0', '62.spst.no': 'W', '63.spst.no': 'e', '64.spst.no': 'u', '65.spst.no': 'q', '66.spst.no': 'j', '67.spst.no': 'G', '68.spst.no': 'p', '69.spst.no': 'c', '6a.spst.no': 'L', '6b.spst.no': 'G', '6c.spst.no': 'V', '6d.spst.no': 'B', '6e.spst.no': 'm', '6f.spst.no': '4', '70.spst.no': 'f', '71.spst.no': 'F', '72.spst.no': 'c', '73.spst.no': 'k', '74.spst.no': 'R', '75.spst.no': 'K', '76.spst.no': 'H', '77.spst.no': '7', '78.spst.no': 'S', '79.spst.no': '2', '7a.spst.no': 'F', '7b.spst.no': 'X', '7c.spst.no': 'O', '7d.spst.no': '0', '7e.spst.no': 'd', '7f.spst.no': 'D',\n           '80.spst.no': 'N', '81.spst.no': 'S', '82.spst.no': 'a', '83.spst.no': 'J', '84.spst.no': 'q', '85.spst.no': '2', '86.spst.no': 's', '87.spst.no': 'd', '88.spst.no': 'y', '89.spst.no': 'L', '8a.spst.no': 'q', '8b.spst.no': 'n', '8c.spst.no': 'q', '8d.spst.no': 'r', '8e.spst.no': 'v', '8f.spst.no': 'k', '90.spst.no': 'G', '91.spst.no': 'N', '92.spst.no': '4', '93.spst.no': 'K', '94.spst.no': 'Q', '95.spst.no': 'x', '96.spst.no': 'l', '97.spst.no': 'E', '98.spst.no': 'F', '99.spst.no': 'h', '9a.spst.no': 'd', '9b.spst.no': 'N', '9c.spst.no': 'j', '9d.spst.no': 'd', '9e.spst.no': 'w', '9f.spst.no': 'K', 'a0.spst.no': 'K', 'a1.spst.no': '2', 'a2.spst.no': 'v', 'a3.spst.no': 'G', 'a4.spst.no': 'a', 'a5.spst.no': 'x', 'a6.spst.no': 'i', 'a7.spst.no': 'L', 'a8.spst.no': '3', 'a9.spst.no': '4', 'aa.spst.no': 'W', 'ab.spst.no': 'P', 'ac.spst.no': '4', 'ad.spst.no': 'o', 'ae.spst.no': 'm', 'af.spst.no': 'y', 'b0.spst.no': 'D', 'b1.spst.no': 'e', 'b2.spst.no': 'j', 'b3.spst.no': 'X', 'b4.spst.no': 'T', 'b5.spst.no': 'z', 'b6.spst.no': 'C', 'b7.spst.no': 'p', 'b8.spst.no': 'J', 'b9.spst.no': 'i', 'ba.spst.no': 'L', 'bb.spst.no': 'D', 'bc.spst.no': 'D', 'bd.spst.no': 'V', 'be.spst.no': 'N', 'bf.spst.no': '8', 'c0.spst.no': 'c', 'c1.spst.no': 'B', 'c2.spst.no': 'l', 'c3.spst.no': '6', 'c4.spst.no': 't', 'c5.spst.no': 'm', 'c6.spst.no': '2', 'c7.spst.no': 'O', 'c8.spst.no': 'e', 'c9.spst.no': 'N', 'ca.spst.no': '9', 'cb.spst.no': 'Q', 'cc.spst.no': 'U', 'cd.spst.no': 'j', 'ce.spst.no': 'o', 'cf.spst.no': 'w', 'd0.spst.no': 'n', 'd1.spst.no': 'G', 'd2.spst.no': 'U', 'd3.spst.no': 'Q', 'd4.spst.no': 'E', 'd5.spst.no': 'z', 'd6.spst.no': 'a', 'd7.spst.no': 'w', 'd8.spst.no': 'p', 'd9.spst.no': 'x', 'da.spst.no': '9', 'db.spst.no': 'Y', 'dc.spst.no': 'P', 'dd.spst.no': 'I', 'de.spst.no': 'u', 'df.spst.no': 'k', 'e0.spst.no': 'e', 'e1.spst.no': 'v', 'e2.spst.no': 'q', 'e3.spst.no': 'Q', 'e4.spst.no': 'g', 'e5.spst.no': '=', 'e6.spst.no': 'W', 'e7.spst.no': '7', 'e8.spst.no': 'j', 'e9.spst.no': 'M', 'ea.spst.no': 'r', 'eb.spst.no': 'a', 'ec.spst.no': 'k', 'ed.spst.no': 'G', 'ee.spst.no': '1', 'ef.spst.no': '1', 'f0.spst.no': 'b', 'f1.spst.no': 'w', 'f2.spst.no': '9', 'f3.spst.no': '4', 'f4.spst.no': '4', 'f5.spst.no': 'b', 'f6.spst.no': 'J', 'f7.spst.no': 'O', 'f8.spst.no': 'z', 'f9.spst.no': 'Z', 'fa.spst.no': 'N', 'fb.spst.no': 'u', 'fc.spst.no': 'M', 'fd.spst.no': '8', 'fe.spst.no': 'I', 'ff.spst.no': 's'}\nlast_pointer = None\nfor key, value in pointers.items():\n    if not value in pointers:\n        print('Last pointer is', key) # 'Last pointer is ed.spst.no'\n        last_pointer = key\n        break\nordered = ''\ndomains = last_pointer\nwhile True:\n    ordered = letters[last_pointer] + ordered\n    found = False\n    for key, value in pointers.items():\n        if last_pointer == value:\n            found = True\n            last_pointer = key\n            break\n    print(ordered)\n    if not found:\n        break\n\n\"\"\"\"\nbokstav=edG1y9Dq9ram2hb0mQYNT4wcWeNXRkY22JU7wa6qFJqkWMLRF0nxeFZNr02jxpJ7ZIzVeWnwe60pbSKLXcwvbV23yFOdN4aPXCV6GHN4fYnzswDTAop3O8vTEEDJFOeuKdBVWGcWy7LDcsucwz8nBHbR9UG9CP4zpMZLQPvEl1eu4Tp9Lto4zuA0ijU2eLk0qQBlRQdxZKrajIqiW5P1K1HkKrjgGIj4M7xP7Sg3pSNXLklGm4LBBbhG\n\"\"\"\n</pre>\n\n<code>bokstav</code> (=letter) equals something is printed. We were told we were missing a <i>bokstavkjeks</i> (=letter cookie). This is the cookie name and value we need.\n<pre class=\"prettyprint lang-bsh\">curl 'https://ops.spst.no/api/abort' -H 'cookie: bokstav=edG1y9Dq9ram2hb0mQYNT4wcWeNXRkY22JU7wa6qFJqkWMLRF0nxeFZNr02jxpJ7ZIzVeWnwe60pbSKLXcwvbV23yFOdN4aPXCV6GHN4fYnzswDTAop3O8vTEEDJFOeuKdBVWGcWy7LDcsucwz8nBHbR9UG9CP4zpMZLQPvEl1eu4Tp9Lto4zuA0ijU2eLk0qQBlRQdxZKrajIqiW5P1K1HkKrjgGIj4M7xP7Sg3pSNXLklGm4LBBbhG'\n\nArrgh! Vi gir opp for denne gang.\nhttps://npst.no/_6331fff126233c324c9f5fc49c49a8b6.html%\n</pre>\n\nWe're given a URL to <a href=\"https://npst.no/_6331fff126233c324c9f5fc49c49a8b6.html\">https://npst.no/_6331fff126233c324c9f5fc49c49a8b6.html</a>. And there it is; a proper Star Wars intro as an outro and our final flag. Take a moment to enjoy the victory. 🚩 Christmas is saved.\n\nThe flag is <code>PST{82a1f79e6ce39ef16d0ef4ef1c1d2fcc}</code>.\n</span></div></li></ul><script>\n$(document).ready(function(){\n    $('.collapsible').collapsible();\n});\n</script>\n<h4>Credits</h4>While I worked on all the challenges alone there were a few times I was stuck long enough to discuss or ask for hints from Frank Karlstrøm (<a href=\"https://twitter.com/fjankk\">Twitter</a>, <a href=\"https://fjank.no/\">blog</a>). I'm pretty sure I wouldn't have nailed all challenges otherwise.\n\n<h4>Scores</h4>The CTF closed by the end of New Year's Eve. Looking at <a href=\"https://intranett.npst.no/scoreboard\">the scoreboard</a> there were 19 users who managed to get all 274 points. 39 users managed to solve challenge 24 (18 by the end of Christmas Eve). The \"problem\" that stopped many from full score was challenge 23 which neeed 3 hints from PST before it was solved. There were 1048 users that successfully submitted at least 1 correct flag, though I suppose there's quite a few non-real users among them. Still, there have been several hundred persons trying out the challenges. I think that's pretty good.\n\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1 white-text\">Enjoy reading about IT security? <span style=\"text-decoration:underline;\"><a class=\"white-text\" href=\"/category/security\">Check out more of my posts.</a></span></div></div><h4>Some final thoughts</h4>This was actually my very first CTF. I don't think the intention was to have a very beginner friendly CTF, but at the same time the challenges generally weren't very hard. I think it's really cool that PST did this. This and previous job ads is a great way of showing off some of the expertise they are looking for. They sure get a lot of both media attention and awareness in the IT industry. I'm pretty sure this can - at least in the long run - help them hire the right people.\n\nI wish that the challenges weren't published at midnight. I mean, it's fine if it was PST's way to map out who's got no commitments, no family, no job, no school. Otherwise it was a bit harsh with 19 out of 24 days like this. I'm happy that I was able to stay away most midnights, but it was hard not to check out the new challenge on the mobile when waking up in the middle of the night. Personally I'd like the challenges to be published like 6 p.m. I'm not sure if I'd give away that many hours of next December.\n\nI saw some minor critisim of the hints being suddenly published instead without having the release time published up front. I think that is a valid point for those really competing in staying and ending on the top of the scoreboard.\n\nIt feels good that it's over now. You know your brain is working overtime when you immediately start looking for clues when you see toy penguins at the store, or you have dreams where you are trying to figure out the charset of some binary data.. 😅\n\n<em>All in all, I think it was a great and very fun CTF. I think it was entertaining with the theme and storyline. I'm impressed by PST and I hope they continue with this and similar things in the future. It's good for them and it's good for all of us if we can increase the expertise in our industry.</em>\n\n<h4>Request for comments</h4>If you have thoughts about my solutions, the CTF, or if I have missed something cool; don't hesitate to comment here or <a href=\"/about\">contact me in some other way</a>. 🙂\n",
        "images": [
            "/images/pst304.jpg",
            "/images/pst301-autopsy.png",
            "/images/pst302-autopsy.png",
            "/images/pst303-punched_card.png"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Behind the news",
                "url": "/behind-the-news"
            },
            {
                "title": "Challenge",
                "url": "/challenge"
            }
        ]
    },
    {
        "title": "Capture the flag with the Norwegian Police Security Service - Easter edition",
        "published": true,
        "publishDate": "2020-04-15T14:00:00.000Z",
        "summary": "Here's a write-up showing how to solve the challenges of the Norwegian Police Security Service's Easter CTF.",
        "niceUrl": "/2020/04/pst-challenge-4",
        "text": "\n<h4>Background 👮</h4>The <a href=\"https://en.wikipedia.org/wiki/Norwegian_Police_Security_Service\">Norwegian Police Security Service</a> (with the Norwegian abbreviation <a href=\"https://www.pst.no/\">PST</a> which I'll use for this write-up) is the police <a href=\"https://en.wikipedia.org/wiki/Security_agency\">security agency</a> of Norway. Following up on <a href=\"/2020/01/pst-challenge-3\">their big Christmas CTF advent calendar</a> they now did a smaller CTF for Easter.\n\n<h4>The theme 🐰</h4>This time PST added an H in their name and created the imaginary <i>Easter Bunny's Security Service</i> (Påskeharens sikkerhetstjeneste = PHST). PHST's role is supposedly to protect the Easter Bunny's egg basket and core values. Everything happened on <a href=\"https://phst.no/\">phst.no</a> from April 9th to April 13th 2020.\n\n<h4>Challenges and solutions</h4>Let's jump straight in. Click on a challenge to expand it.\n<a class=\"skip-link\" href=\"#\" aria-hidden=\"true\" onclick=\"var c=$('.collapsible');var shouldOpen=c.children('.active').length === 0;for(var i=0;i<c.children().length;i++){c.collapsible(shouldOpen ? 'open' : 'close', i);}return false;\"><u>Expand/collapse all</u></a><ul class=\"collapsible expandable\" data-collapsible=\"expandable\"><li><div class=\"collapsible-header\">Maundy Thursday - 10 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6><img class=\"materialboxed responsive-img\" title=\"Who has taken this picture?\" data-caption=\"Who has taken this picture?\" alt=\"Clue\" src=\"/images/pst401-skjaertorsdag.png\">\nWe are told that the Easter Bunny's eggs were stolen and that someone had sent the picture above and that it might contain a clue.\n\n<h6>Solution</h6>For this you could use some local or online tool for extracting the image meta data. <a href=\"https://en.wikipedia.org/wiki/Strings_(Unix)\">strings</a></code> would also be a nice candiate for this. The PNG image description field contains the text <code>CUFG{Qrer_snatre_zrt_nyqev!!}</code>.\n\nThat looks a lot like the output of a <a href=\"https://en.wikipedia.org/wiki/Caesar_cipher\">Caesar cipher</a>. <a href=\"https://gchq.github.io/CyberChef/#recipe=ROT13(true,true,13)&input=Q1VGR3tRcmVyX3NuYXRyZV96cnRfbnlxZXYhIX0\">Using an online tool</a> you can quickly see that the flag is <code>PHST{Dere_fanger_meg_aldri!!}</code> (=<i>\"You'll never catch me!!\"</i>).\n\nWe are given a piece of a rebus: <code>bravo = \"19de0b5a1eeef635c2b4fec6e7c7\"</code></span>\n</div></li><li><div class=\"collapsible-header\">Good Friday - 20 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6><img class=\"materialboxed responsive-img\" title=\"Are these the stolen eggs?\" data-caption=\"Are these the stolen eggs?\" alt=\"Clue\" src=\"/images/pst402-paskeegg_langfredag.png\">\nPHST received the above picture. It might show the eggs that disappeared. The challenge is to find something of interesting in the picture.\n\n<h6>Solution</h6>This time the information we are looking for isn't hidden in the meta data. The eggs are all coloured, and we see a sheet specifying a number for each colour. The sheet also has a reference to <a href=\"https://en.wikipedia.org/wiki/Electronic_color_code#Resistors\"><i>resistor colour code</i></a>. You have to decode each egg as a 3 colour band resistor. Starting from the top of the top left egg you would first get brown, brown, red. That translates to 1, 1, 2.\n\nFollowing that logic for all the eggs give these numbers: <code>112 052 052 115 107 051 104 052 114 051 110 033</code>\n\nThe numbers can be <a href=\"https://gchq.github.io/CyberChef/#recipe=From_Decimal('Space',false)&input=MTEyIDA1MiAwNTIgMTE1IDEwNyAwNTEgMTA0IDA1MiAxMTQgMDUxIDExMCAwMzM\">converted as an integer array to ASCII</a>: <code>p44sk3h4r3n!</code> (=leet for <i>The Easter Bunny!</i>). The flag is <code>PHST{p44sk3h4r3n!}</code>.\n\nWe are also given another piece of the rebus: <code>{delta: \"03074978df7930e256789cb87ea67358\"}</code></span>\n</div></li><li><div class=\"collapsible-header\">Holy Saturday - 20 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The bad guys have been accessing the servers of the Easter Bunny. Tracing them back leads to the address <code>1F423.com</code>. We are asked to find out something in regards of the <i>address</i>.\n\n<h6>Solution</h6>I was stuck on this for a long time. <code>U+1F423</code> happens to be the unicode for <a href=\"https://www.fileformat.info/info/unicode/char/1f423/index.htm\">🐣 (hatching chick)</a>. I was so sure the flag was related to this.\n\nHowever, looking at the DNS records there is an interesting <a href=\"https://en.wikipedia.org/wiki/LOC_record\">LOC record</a>. Using the command <code>dig loc 1F423.com</code> or <a href=\"https://digwebinterface.com/?hostnames=1f423.com&type=LOC&ns=resolver&useresolver=8.8.4.4\">an online tool</a> the following coordinates are returned: <code>60 47 34.900 N 11 6 3.600 E 0.00m 0.00m 0.00m 0.00m</code>\n\n<a href=\"https://www.google.com/maps/place/60°47'34.9%22N+11°06'03.6%22E/@60.7930278,11.0988113,460m/data=!3m2!1e3!4b1!4m5!3m4!1s0x0:0x0!8m2!3d60.7930278!4d11.101\">Pasting the coordinates into Google Maps</a> shows the <a href=\"https://en.wikipedia.org/wiki/Vikingskipet\">Hamar Olympic Hall - Vikingskipet</a>. That is no coincident as it every Easter hosts the world's second largest computer party: <a href=\"https://en.wikipedia.org/wiki/The_Gathering_(LAN_party)\">The Gathering</a>. PST has also used this LAN party for recruitment purposes. The flag is <code>PHST{Vikingskipet}</code>.\n\nWe are given a piece of a rebus: <code>echo: \"a3f6ce4eb662e4797a39b\"</code></span>\n</div></li><li><div class=\"collapsible-header\">Easter Day - 20 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>We are told that the threat actor has had access to the network, and we are given a <a href=\"https://en.wikipedia.org/wiki/pcap\">pcap</a> <a href=\"/stuff/mistenkelig.pcap\"><code>mistenkelig.pcap</code></a> showing some of the network traffic. The challenge is to figure out what information the threat actor has gotten hold of.\n\n<h6>Solution</h6>Most of the traffic in the pcap is encrypted. Considering how the other challenges could be solved with just using online tools I spent a lot of time trying to find something interesting in the network traffic not looking at the encrypted traffic. That was a mistake.\n\nThe encrypted traffic is using <a href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security\">TLS</a>. For some reason all parameters for the TLS handshakes for one of the computers are sent to another one (is this the intruder doing this or some crazy network logging?). <a href=\"https://en.wikipedia.org/wiki/Wireshark\">Wireshark</a> is an absolutely magical packet analyzer that can take these keys and secrets and display the decrypted data sent over the wire. It can also extract all the files transmitted.\n<img class=\"materialboxed responsive-img\" title=\"Wait, what? Are those TLS secrets?\" data-caption=\"Wait, what? Are those TLS secrets?\" alt=\"Wireshark screenshot\" src=\"/images/pst403-pcap.png\">\nIt turns out that the document the intruder gets a hold of isn't very exciting, but a PDF with the weather forecast for the mentioned <i>Vikingskipet</i>. The flag is <code>PHST{Weather forecast for Vikingskipet}</code>.</span>\n\nWe are also given a piece of a rebus: <code>$charlie = \"664150457e1f2ccc3399\"</code></span>\n</div></li><li><div class=\"collapsible-header\">Second Easter Day - 30 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>We are given a Python program that controls the physical access to the place of the egg thieves. The challenge is to gain access to the system.\n\n<h6>Links</h6> - <a href=\"/stuff/merkelig.py.txt\">Python script: <code>merkelig.py</code></a>\n - <a href=\"/stuff/underfundig.txt\">Emojis: <code>underfundig</code></a>\n - <a href=\"/images/pst404-paskekyllingbetjenter.png\">Picture of Easter chicken officers</a>\n\n<h6>Solution</h6>This one was right up my alley. Though tricky at first it's always fun with a programming challenge like this. The script is pretty neat. It uses emoji input and has a set of operations that these emojis can trigger. Those operations can read input from the keyboard and write output to the screen. In practice we are given a set of input that makes the program ask for a password and tells whether or not it was correct.\n\nIt didn't take too long to shortcut the program to make it believe it got the correct input and tell that the password was correct. The problem was that the flag was the password you had to type in, and the flag wasn't directly stored in either the program or the input. So you would need to figure out what input triggered the message telling that the password was correct.\n\nThe program uses a few pointers and a stack to store the user input and the output. Playing with the stack I saw that the password had to be 34 characters long. Then the password could be brute forced.\n\nThough it didn't look this pretty when I tried hacking it together to be among the first ones to solve it, here's a cleaned up solution. It requires change in only one line in the initial script as mentioned below. The change makes the program throw an exception the moment it receives either incorrect password length or an incorrect character in the password (starting from the end of the password). This variant of the solution also figures out the password length on it's own too.<pre class=\"prettyprint lang-py\">\"\"\"\nNOTE: Add 'raise Exception(sp)' on line 45 in merkelig.py\n\"\"\"\nimport sys\nfrom time import time\nfrom string import printable\n\nsys.argv.append('underfundig')  # We'll just append the input file here ourselves\n\npassword = '#' * 40\n\ndef readline():\n    return password.encode()\n\nsys.stdin.buffer.readline = readline  # Quick and dirty replacement of readline()\n\nchar_to_change = len(password) - 1\nt = time()\nwhile True:\n    for l in printable:\n        password = password[0:char_to_change] + l + password[char_to_change + 1:]\n        found_password = True\n        try:\n            import merkelig\n        except Exception as e:\n            if e.args[0] != char_to_change:\n                password = password.strip()\n                print(password)\n            char_to_change = e.args[0] - 1  # raise Exception(sp)\n            found_password = False\n        finally:\n            if found_password:\n                # Prints 'Found password in 1143 ms: PHST{Mitt navn er Gwyn. Pen Gwyn.}':\n                print('Found password in', round((time() - t) * 1000), 'ms:', password)\n\n</pre>\n<img src=\"/images/pst405-cracking.gif\" alt=\"Cracking in progress\" title=\"Slowmo of cracking process. Click to see again.\" onclick=\"this.src='/images/pst405-cracking.gif'\"/>\nThe flag was <code>PHST{Mitt navn er Gwyn. Pen Gwyn.}</code> (=\"<i>My name is Gwyn. Pen Gwyn.</i>\"). So just like <a href=\"/2020/01/pst-challenge-3\">Pen Gwyn gave NPST a hard time last Christmas</a>, he now has been after PHST.\n\nThe final piece for the rebus was this: <code>String alfa = \"0c405bdf5899c3db8ba0d1909f9\"</code></span>\n</span>\n</div></li><li><div class=\"collapsible-header\">Rebus - 10 points</div><div class=\"collapsible-body\"><span><h6>Challenge</h6>The challenge was to solve the rebus <code>print(\"https://www.phst.no/\" + alfa + bravo + charlie + delta + echo + \".html\")</code>\n\n<h6>Solution</h6></span>We have found all the different pieces of the rebus and we can add them together to get <code style=\"font-size:60%;overflow-wrap: break-word;\"><a href=\"https://www.phst.no/0c405bdf5899c3db8ba0d1909f919de0b5a1eeef635c2b4fec6e7c7664150457e1f2ccc339903074978df7930e256789cb87ea67358a3f6ce4eb662e4797a39b.html\">https://www.phst.no/0c405bdf5899c3db8ba0d1909f919de0b5a1eeef635c2b4fec6e7c7664150457e1f2ccc339903074978df7930e256789cb87ea67358a3f6ce4eb662e4797a39b.html</a></code>:\n<pre class=\"prettyprint lang-py\">alfa = \"0c405bdf5899c3db8ba0d1909f9\"\nbravo = \"19de0b5a1eeef635c2b4fec6e7c7\"\ncharlie = \"664150457e1f2ccc3399\"\ndelta = \"03074978df7930e256789cb87ea67358\"\necho = \"a3f6ce4eb662e4797a39b\"\nprint(\"https://www.phst.no/\" + alfa + bravo + charlie + delta + echo + \".html\")</pre>\nThe final flag - found on that page - was <code>PHST{Du klarte SHAbussen, veldig bra jobba!}</code> (=<i>\"You did the SHAbus, very nicely done!\"</i>).\n</div></li></ul><script>\n$(document).ready(function(){\n    $('.collapsible').collapsible();\n});\n</script>\n<h4>Scores</h4>By the end of the day of second Easter day 19 people had full score and a total of 24 had solved all the challenges. I was pretty happy being the fourth person to solve the last challenge and therefore placing me on fourth place in total.\n\n<div style=\"padding-top:80px;\" class=\"col s12 m5 l5 xl4 right\"><div class=\"card-panel light-blue darken-1 white-text\">Enjoy reading about IT security? <span style=\"text-decoration:underline;\"><a class=\"white-text\" href=\"/category/security\">Check out more of my posts.</a></span></div></div><h4>Some final thoughts</h4>I really enjoyed these Easter puzzles. They were entertaining, varied and they didn't need that big of a time investment. Maybe the best part was that the challenges were opened daily at 12 p.m. instead of 12 a.m., so there was no need to lose any sleep or check the mobile in the middle of the night.\n",
        "images": [
            "/images/pst406-congrats.jpg"
        ],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Challenge",
                "url": "/challenge"
            }
        ]
    },
    {
        "title": "Case #XX: ",
        "published": false,
        "publishDate": "2020-01-01T04:30:00.000Z",
        "updateDate": "2020-01-01T05:30:00.000Z",
        "summary": "",
        "niceUrl": "/2020/XX/title",
        "text": "",
        "hot": false,
        "author": "Roy Solberg",
        "images": [],
        "category": {
            "title": "Security",
            "url": "/security"
        },
        "tags": [
            {
                "title": "Security Monday",
                "url": "/security-monday"
            }
        ]
    }
]
}(window.SpaBlog));
